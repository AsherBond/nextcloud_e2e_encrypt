(function(){"use strict";try{if(typeof document<"u"){var i=document.createElement("style");i.appendChild(document.createTextNode("/*!\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */.toastify.dialogs{min-width:200px;background:none;background-color:var(--color-main-background);color:var(--color-main-text);box-shadow:0 0 6px 0 var(--color-box-shadow);padding:0 12px;margin-top:45px;position:fixed;z-index:10100;border-radius:var(--border-radius);display:flex;align-items:center}.toastify.dialogs .toast-undo-container{display:flex;align-items:center}.toastify.dialogs .toast-undo-button,.toastify.dialogs .toast-close{position:static;overflow:hidden;box-sizing:border-box;min-width:44px;height:100%;padding:12px;white-space:nowrap;background-repeat:no-repeat;background-position:center;background-color:transparent;min-height:0}.toastify.dialogs .toast-undo-button.toast-close,.toastify.dialogs .toast-close.toast-close{text-indent:0;opacity:.4;border:none;min-height:44px;margin-left:10px;font-size:0}.toastify.dialogs .toast-undo-button.toast-close:before,.toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\");content:\" \";filter:var(--background-invert-if-dark);display:inline-block;width:16px;height:16px}.toastify.dialogs .toast-undo-button.toast-undo-button,.toastify.dialogs .toast-close.toast-undo-button{height:calc(100% - 6px);margin:3px 3px 3px 12px}.toastify.dialogs .toast-undo-button:hover,.toastify.dialogs .toast-undo-button:focus,.toastify.dialogs .toast-undo-button:active,.toastify.dialogs .toast-close:hover,.toastify.dialogs .toast-close:focus,.toastify.dialogs .toast-close:active{cursor:pointer;opacity:1}.toastify.dialogs.toastify-top{right:10px}.toastify.dialogs.toast-with-click{cursor:pointer}.toastify.dialogs.toast-error{border-left:3px solid var(--color-error)}.toastify.dialogs.toast-info{border-left:3px solid var(--color-primary)}.toastify.dialogs.toast-warning{border-left:3px solid var(--color-warning)}.toastify.dialogs.toast-success,.toastify.dialogs.toast-undo{border-left:3px solid var(--color-success)}.theme--dark .toastify.dialogs .toast-close.toast-close:before{background-image:url(\"data:image/svg+xml,%3csvg%20viewBox='0%200%2016%2016'%20height='16'%20width='16'%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20style='fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2'%3e%3cpath%20d='M6.4%2019%205%2017.6l5.6-5.6L5%206.4%206.4%205l5.6%205.6L17.6%205%2019%206.4%2013.4%2012l5.6%205.6-1.4%201.4-5.6-5.6L6.4%2019Z'%20style='fill:%23fff;fill-rule:nonzero'%20transform='matrix(.85714%200%200%20.85714%20-2.286%20-2.286)'/%3e%3c/svg%3e\")}.nc-generic-dialog .dialog__actions{justify-content:space-between;min-width:calc(100% - 12px)}/*!\n * SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */._file-picker__file-icon_19mjt_9{width:32px;height:32px;min-width:32px;min-height:32px;background-repeat:no-repeat;background-size:contain;display:flex;justify-content:center}tr.file-picker__row[data-v-15187afc]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-15187afc]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-15187afc]{padding:0 2px}tr.file-picker__row td[data-v-15187afc]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-15187afc]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-15187afc]{padding-inline:2px 0}@keyframes gradient-15187afc{0%{background-position:0% 50%}50%{background-position:100% 50%}to{background-position:0% 50%}}.loading-row .row-checkbox[data-v-15187afc]{text-align:center!important}.loading-row span[data-v-15187afc]{display:inline-block;height:24px;background:linear-gradient(to right,var(--color-background-darker),var(--color-text-maxcontrast),var(--color-background-darker));background-size:600px 100%;border-radius:var(--border-radius);animation:gradient-15187afc 12s ease infinite}.loading-row .row-wrapper[data-v-15187afc]{display:inline-flex;align-items:center}.loading-row .row-checkbox span[data-v-15187afc]{width:24px}.loading-row .row-name span[data-v-15187afc]:last-of-type{margin-inline-start:6px;width:130px}.loading-row .row-size span[data-v-15187afc]{width:80px}.loading-row .row-modified span[data-v-15187afc]{width:90px}/*!\n* SPDX-FileCopyrightText: 2023-2024 Nextcloud GmbH and Nextcloud contributors\n* SPDX-License-Identifier: AGPL-3.0-or-later\n*/tr.file-picker__row[data-v-cb12dccb]{height:var(--row-height, 50px)}tr.file-picker__row td[data-v-cb12dccb]{cursor:pointer;overflow:hidden;text-overflow:ellipsis;border-bottom:none}tr.file-picker__row td.row-checkbox[data-v-cb12dccb]{padding:0 2px}tr.file-picker__row td[data-v-cb12dccb]:not(.row-checkbox){padding-inline:14px 0}tr.file-picker__row td.row-size[data-v-cb12dccb]{text-align:end;padding-inline:0 14px}tr.file-picker__row td.row-name[data-v-cb12dccb]{padding-inline:2px 0}.file-picker__row--selected[data-v-cb12dccb]{background-color:var(--color-background-dark)}.file-picker__row[data-v-cb12dccb]:hover{background-color:var(--color-background-hover)}.file-picker__name-container[data-v-cb12dccb]{display:flex;justify-content:start;align-items:center;height:100%}.file-picker__file-name[data-v-cb12dccb]{padding-inline-start:6px;min-width:0;overflow:hidden;text-overflow:ellipsis}.file-picker__file-extension[data-v-cb12dccb]{color:var(--color-text-maxcontrast);min-width:fit-content}.file-picker__header-preview[data-v-006fdbd0]{width:22px;height:32px;flex:0 0 auto}.file-picker__files[data-v-006fdbd0]{margin:2px;margin-inline-start:12px;overflow:scroll auto}.file-picker__files table[data-v-006fdbd0]{width:100%;max-height:100%;table-layout:fixed}.file-picker__files th[data-v-006fdbd0]{position:-webkit-sticky;position:sticky;z-index:1;top:0;background-color:var(--color-main-background);padding:2px}.file-picker__files th .header-wrapper[data-v-006fdbd0]{display:flex}.file-picker__files th.row-checkbox[data-v-006fdbd0]{width:44px}.file-picker__files th.row-name[data-v-006fdbd0]{width:230px}.file-picker__files th.row-size[data-v-006fdbd0]{width:100px}.file-picker__files th.row-modified[data-v-006fdbd0]{width:120px}.file-picker__files th[data-v-006fdbd0]:not(.row-size) .button-vue__wrapper{justify-content:start;flex-direction:row-reverse}.file-picker__files th[data-v-006fdbd0]:not(.row-size) .button-vue{padding-inline:16px 4px}.file-picker__files th.row-size[data-v-006fdbd0] .button-vue__wrapper{justify-content:end}.file-picker__files th[data-v-006fdbd0] .button-vue__wrapper{color:var(--color-text-maxcontrast)}.file-picker__files th[data-v-006fdbd0] .button-vue__wrapper .button-vue__text{font-weight:400}.file-picker__breadcrumbs[data-v-b357227a]{flex-grow:0!important}.file-picker__side[data-v-b42054b8]{display:flex;flex-direction:column;align-items:stretch;gap:.5rem;min-width:200px;padding:2px;margin-block-start:7px;overflow:auto}.file-picker__side[data-v-b42054b8] .button-vue__wrapper{justify-content:start}.file-picker__filter-input[data-v-b42054b8]{margin-block:7px;max-width:260px}@media (max-width: 736px){.file-picker__side[data-v-b42054b8]{flex-direction:row;min-width:unset}}@media (max-width: 512px){.file-picker__side[data-v-b42054b8]{flex-direction:row;min-width:unset}.file-picker__filter-input[data-v-b42054b8]{max-width:unset}}.file-picker__navigation{padding-inline:8px 2px}.file-picker__navigation,.file-picker__navigation *{box-sizing:border-box}.file-picker__navigation .v-select.select{min-width:220px}@media (min-width: 513px) and (max-width: 736px){.file-picker__navigation{gap:11px}}@media (max-width: 512px){.file-picker__navigation{flex-direction:column-reverse!important}}.file-picker__view[data-v-20b719ba]{height:50px;display:flex;justify-content:start;align-items:center}.file-picker__view h3[data-v-20b719ba]{font-weight:700;height:fit-content;margin:0}.file-picker__main[data-v-20b719ba]{box-sizing:border-box;width:100%;display:flex;flex-direction:column;min-height:0;flex:1;padding-inline:2px}.file-picker__main *[data-v-20b719ba]{box-sizing:border-box}[data-v-20b719ba] .file-picker{height:min(80vh,800px)!important}@media (max-width: 512px){[data-v-20b719ba] .file-picker{height:calc(100% - 16px - var(--default-clickable-area))!important}}[data-v-20b719ba] .file-picker__content{display:flex;flex-direction:column;overflow:hidden}.material-design-icon[data-v-e4fac465]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.input-field[data-v-e4fac465]{--input-border-radius: var(--border-radius-element, var(--border-radius-large));--input-padding-start: var(--border-radius-large);--input-padding-end: var(--border-radius-large);position:relative;width:100%;margin-block-start:6px}.input-field--disabled[data-v-e4fac465]{opacity:.4;filter:saturate(.4)}.input-field--label-outside[data-v-e4fac465]{margin-block-start:0}.input-field--leading-icon[data-v-e4fac465]{--input-padding-start: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--trailing-icon[data-v-e4fac465]{--input-padding-end: calc(var(--default-clickable-area) - var(--default-grid-baseline))}.input-field--pill[data-v-e4fac465]{--input-border-radius: var(--border-radius-pill)}.input-field__main-wrapper[data-v-e4fac465]{height:var(--default-clickable-area);position:relative}.input-field__input[data-v-e4fac465]{--input-border-width-offset: calc(var(--border-width-input-focused, 2px) - var(--border-width-input, 2px));background-color:var(--color-main-background);color:var(--color-main-text);border:var(--border-width-input, 2px) solid var(--color-border-maxcontrast);border-radius:var(--input-border-radius);cursor:pointer;-webkit-appearance:textfield!important;-moz-appearance:textfield!important;appearance:textfield!important;font-size:var(--default-font-size);text-overflow:ellipsis;height:calc(var(--default-clickable-area) - 2 * var(--input-border-width-offset))!important;width:100%;padding-inline:calc(var(--input-padding-start) + var(--input-border-width-offset)) calc(var(--input-padding-end) + var(--input-border-width-offset));padding-block:var(--input-border-width-offset)}.input-field__input[data-v-e4fac465]::placeholder{color:var(--color-text-maxcontrast)}.input-field__input[data-v-e4fac465]:active:not([disabled]),.input-field__input[data-v-e4fac465]:hover:not([disabled]),.input-field__input[data-v-e4fac465]:focus:not([disabled]){border-color:var(--color-main-text);border-width:var(--border-width-input-focused, 2px);box-shadow:0 0 0 2px var(--color-main-background)!important;--input-border-width-offset: 0px}.input-field__input:focus+.input-field__label[data-v-e4fac465],.input-field__input:hover:not(:placeholder-shown)+.input-field__label[data-v-e4fac465]{color:var(--color-main-text)}.input-field__input[data-v-e4fac465]:focus{cursor:text}.input-field__input[data-v-e4fac465]:disabled{cursor:default}.input-field__input[data-v-e4fac465]:focus-visible{box-shadow:unset!important}.input-field__input--success[data-v-e4fac465]{border-color:var(--color-success)!important}.input-field__input--success[data-v-e4fac465]:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field__input--error[data-v-e4fac465],.input-field__input[data-v-e4fac465]:invalid{border-color:var(--color-error)!important}.input-field__input--error[data-v-e4fac465]:focus-visible,.input-field__input[data-v-e4fac465]:invalid:focus-visible{box-shadow:#f8fafc 0 0 0 2px,var(--color-primary-element) 0 0 0 4px,#0000000d 0 1px 2px}.input-field:not(.input-field--label-outside) .input-field__input[data-v-e4fac465]:not(:focus)::placeholder{opacity:0}.input-field__label[data-v-e4fac465]{--input-label-font-size: var(--default-font-size);position:absolute;margin-inline:var(--input-padding-start) var(--input-padding-end);max-width:fit-content;font-size:var(--input-label-font-size);inset-block-start:calc((var(--default-clickable-area) - 1lh) / 2);inset-inline:var(--border-width-input-focused, 2px);color:var(--color-text-maxcontrast);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none;transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick),background-color var(--animation-quick) var(--animation-slow)}.input-field__input:focus+.input-field__label[data-v-e4fac465],.input-field__input:not(:placeholder-shown)+.input-field__label[data-v-e4fac465]{--input-label-font-size: 13px;line-height:1.5;inset-block-start:calc(-1.5 * var(--input-label-font-size) / 2);font-weight:500;border-radius:var(--default-grid-baseline) var(--default-grid-baseline) 0 0;background-color:var(--color-main-background);padding-inline:var(--default-grid-baseline);margin-inline:calc(var(--input-padding-start) - var(--default-grid-baseline)) calc(var(--input-padding-end) - var(--default-grid-baseline));transition:height var(--animation-quick),inset-block-start var(--animation-quick),font-size var(--animation-quick),color var(--animation-quick)}.input-field__icon[data-v-e4fac465]{position:absolute;height:var(--default-clickable-area);width:var(--default-clickable-area);display:flex;align-items:center;justify-content:center;opacity:.7;inset-block-end:0}.input-field__icon--leading[data-v-e4fac465]{inset-inline-start:0px}.input-field__icon--trailing[data-v-e4fac465]{inset-inline-end:0px}.input-field__trailing-button[data-v-e4fac465]{--button-size: calc(var(--default-clickable-area) - 2 * var(--border-width-input-focused, 2px)) !important;--button-radius: calc(var(--input-border-radius) - var(--border-width-input-focused, 2px))}.input-field__trailing-button.button-vue[data-v-e4fac465]{position:absolute;top:var(--border-width-input-focused, 2px);inset-inline-end:var(--border-width-input-focused, 2px)}.input-field__trailing-button.button-vue[data-v-e4fac465]:focus-visible{box-shadow:none!important}.input-field__helper-text-message[data-v-e4fac465]{padding-block:4px;padding-inline:var(--border-radius-large);display:flex;align-items:center;color:var(--color-text-maxcontrast)}.input-field__helper-text-message__icon[data-v-e4fac465]{margin-inline-end:8px}.input-field__helper-text-message--error[data-v-e4fac465]{color:var(--color-error-text)}.input-field__helper-text-message--success[data-v-e4fac465]{color:var(--color-success-text)}")),document.head.appendChild(i)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
var Xg=Object.defineProperty,Zg=Object.defineProperties;var Qg=Object.getOwnPropertyDescriptors;var Cd=Object.getOwnPropertySymbols;var Yg=Object.prototype.hasOwnProperty,ew=Object.prototype.propertyIsEnumerable;var xd=s=>{throw TypeError(s)};var sm=(s,e,t)=>e in s?Xg(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qe=(s,e)=>{for(var t in e||(e={}))Yg.call(e,t)&&sm(s,t,e[t]);if(Cd)for(var t of Cd(e))ew.call(e,t)&&sm(s,t,e[t]);return s},Et=(s,e)=>Zg(s,Qg(e));var ve=(s,e,t)=>sm(s,typeof e!="symbol"?e+"":e,t),rm=(s,e,t)=>e.has(s)||xd("Cannot "+t);var H=(s,e,t)=>(rm(s,e,"read from private field"),t?t.call(s):e.get(s)),Ct=(s,e,t)=>e.has(s)?xd("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),Pe=(s,e,t,r)=>(rm(s,e,"write to private field"),r?r.call(s,t):e.set(s,t),t),Xs=(s,e,t)=>(rm(s,e,"access private method"),t);import{p as Ge,g as It,l as Hf,a as Xm,b as Gh,U as tw,o as sw,c as rw,d as Ft,e as Mf,v as Ff,n as hc,N as aw,G as nw,r as iw,C as ow,t as am,f as uw,h as lw,i as cw,j as nm,k as Id,m as Zm,q as hw,s as mw,u as fw,w as dw}from"./_plugin-vue2_normalizer-Dq3WFFJL.chunk.mjs";import{f as je,B as pe,s as Eo,a as Eh,O as $,N as Fe,I as B,S as A,g as f,A as X,b as J,c as T,d as R,e as re,C as I,R as Z,h as ke,P as _,i as ce,j as Je,G as Ee,k as ua,u as yo,l as Ql,m as Ch,t as Qm,n as Yl,o as pw,p as gw,q as Vd,r as Bd,E as ec,U as Ym,v as xh,w as ef,x as tf,y as Jc,z as Ls,T as sf,V as ww,D as $p,F as yw,H as vw,J as bw,K as Sw,X as Aw,L as Nw}from"./ArrowRight-CY2b9hgN-BW4ZCjRR.chunk.mjs";import{u as Kp}from"./useModelMigration-EhAWvqDD-jxeRKUXt.chunk.mjs";import{N as kw}from"./NcCheckboxRadioSwitch-R1y0mLbC-D6EkT7zG.chunk.mjs";function Ew(s){return s&&s.split("/").map(encodeURIComponent).join("/")}function rr(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Pd(s,e,t){Cw(s,e),e.set(s,t)}function Cw(s,e){if(e.has(s))throw new TypeError("Cannot initialize the same private elements twice on an object")}function at(s,e){var t=Hp(s,e,"get");return xw(s,t)}function xw(s,e){return e.get?e.get.call(s):e.value}function Od(s,e,t){var r=Hp(s,e,"set");return Iw(s,r,t),t}function Hp(s,e,t){if(!e.has(s))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(s)}function Iw(s,e,t){if(e.set)e.set.call(s,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}var Vw=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",ot=new WeakMap,Oo=new WeakMap;class zh{constructor(e){var{executor:t=()=>{},internals:r=qf(),promise:a=new Promise((n,u)=>t(n,u,i=>{r.onCancelList.push(i)}))}=e;Pd(this,ot,{writable:!0,value:void 0}),Pd(this,Oo,{writable:!0,value:void 0}),rr(this,Vw,"CancelablePromise"),this.cancel=this.cancel.bind(this),Od(this,ot,r),Od(this,Oo,a||new Promise((n,u)=>t(n,u,i=>{r.onCancelList.push(i)})))}then(e,t){return qc(at(this,Oo).then(dc(e,at(this,ot)),dc(t,at(this,ot))),at(this,ot))}catch(e){return qc(at(this,Oo).catch(dc(e,at(this,ot))),at(this,ot))}finally(e,t){return t&&at(this,ot).onCancelList.push(e),qc(at(this,Oo).finally(dc(()=>{if(e)return t&&(at(this,ot).onCancelList=at(this,ot).onCancelList.filter(r=>r!==e)),e()},at(this,ot))),at(this,ot))}cancel(){at(this,ot).isCanceled=!0;var e=at(this,ot).onCancelList;at(this,ot).onCancelList=[];for(var t of e)if(typeof t=="function")try{t()}catch(r){console.error(r)}}isCanceled(){return at(this,ot).isCanceled===!0}}class ar extends zh{constructor(e){super({executor:e})}}rr(ar,"all",function(s){return pc(s,Promise.all(s))}),rr(ar,"allSettled",function(s){return pc(s,Promise.allSettled(s))}),rr(ar,"any",function(s){return pc(s,Promise.any(s))}),rr(ar,"race",function(s){return pc(s,Promise.race(s))}),rr(ar,"resolve",function(s){return Dd(Promise.resolve(s))}),rr(ar,"reject",function(s){return Dd(Promise.reject(s))}),rr(ar,"isCancelable",Jf);function Dd(s){return qc(s,qf())}function Jf(s){return s instanceof ar||s instanceof zh}function dc(s,e){if(s)return t=>{if(!e.isCanceled){var r=s(t);return Jf(r)&&e.onCancelList.push(r.cancel),r}return t}}function qc(s,e){return new zh({internals:e,promise:s})}function pc(s,e){var t=qf();return t.onCancelList.push(()=>{for(var r of s)Jf(r)&&r.cancel()}),new zh({internals:t,promise:e})}function qf(){return{isCanceled:!1,onCancelList:[]}}var im={},Bw={2:s=>{function e(a,n,u){a instanceof RegExp&&(a=t(a,u)),n instanceof RegExp&&(n=t(n,u));var i=r(a,n,u);return i&&{start:i[0],end:i[1],pre:u.slice(0,i[0]),body:u.slice(i[0]+a.length,i[1]),post:u.slice(i[1]+n.length)}}function t(a,n){var u=n.match(a);return u?u[0]:null}function r(a,n,u){var i,l,o,c,m,h=u.indexOf(a),p=u.indexOf(n,h+1),d=h;if(h>=0&&p>0){for(i=[],o=u.length;d>=0&&!m;)d==h?(i.push(d),h=u.indexOf(a,d+1)):i.length==1?m=[i.pop(),p]:((l=i.pop())<o&&(o=l,c=p),p=u.indexOf(n,d+1)),d=h<p&&h>=0?h:p;i.length&&(m=[o,c])}return m}s.exports=e,e.range=r},101:function(s,e,t){var r;s=t.nmd(s),function(a){var n=(s&&s.exports,typeof It=="object"&&It);n.global!==n&&n.window;var u=function(m){this.message=m};(u.prototype=new Error).name="InvalidCharacterError";var i=function(m){throw new u(m)},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=/[\t\n\f\r ]/g,c={encode:function(m){m=String(m),/[^\0-\xFF]/.test(m)&&i("The string to be encoded contains characters outside of the Latin1 range.");for(var h,p,d,w,y=m.length%3,k="",g=-1,b=m.length-y;++g<b;)h=m.charCodeAt(g)<<16,p=m.charCodeAt(++g)<<8,d=m.charCodeAt(++g),k+=l.charAt((w=h+p+d)>>18&63)+l.charAt(w>>12&63)+l.charAt(w>>6&63)+l.charAt(63&w);return y==2?(h=m.charCodeAt(g)<<8,p=m.charCodeAt(++g),k+=l.charAt((w=h+p)>>10)+l.charAt(w>>4&63)+l.charAt(w<<2&63)+"="):y==1&&(w=m.charCodeAt(g),k+=l.charAt(w>>2)+l.charAt(w<<4&63)+"=="),k},decode:function(m){var h=(m=String(m).replace(o,"")).length;h%4==0&&(h=(m=m.replace(/==?$/,"")).length),(h%4==1||/[^+a-zA-Z0-9/]/.test(m))&&i("Invalid character: the string to be decoded is not correctly encoded.");for(var p,d,w=0,y="",k=-1;++k<h;)d=l.indexOf(m.charAt(k)),p=w%4?64*p+d:d,w++%4&&(y+=String.fromCharCode(255&p>>(-2*w&6)));return y},version:"1.0.0"};(r=function(){return c}.call(e,t,e,s))===void 0||(s.exports=r)}()},172:(s,e)=>{e.d=function(t){if(!t)return 0;for(var r=(t=t.toString()).length,a=t.length;a--;){var n=t.charCodeAt(a);56320<=n&&n<=57343&&a--,127<n&&n<=2047?r++:2047<n&&n<=65535&&(r+=2)}return r}},526:s=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var r=[],a=0;a<t.length;a++)r.push(255&t.charCodeAt(a));return r},bytesToString:function(t){for(var r=[],a=0;a<t.length;a++)r.push(String.fromCharCode(t[a]));return r.join("")}}};s.exports=e},298:s=>{var e,t;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t={rotl:function(r,a){return r<<a|r>>>32-a},rotr:function(r,a){return r<<32-a|r>>>a},endian:function(r){if(r.constructor==Number)return 16711935&t.rotl(r,8)|4278255360&t.rotl(r,24);for(var a=0;a<r.length;a++)r[a]=t.endian(r[a]);return r},randomBytes:function(r){for(var a=[];r>0;r--)a.push(Math.floor(256*Math.random()));return a},bytesToWords:function(r){for(var a=[],n=0,u=0;n<r.length;n++,u+=8)a[u>>>5]|=r[n]<<24-u%32;return a},wordsToBytes:function(r){for(var a=[],n=0;n<32*r.length;n+=8)a.push(r[n>>>5]>>>24-n%32&255);return a},bytesToHex:function(r){for(var a=[],n=0;n<r.length;n++)a.push((r[n]>>>4).toString(16)),a.push((15&r[n]).toString(16));return a.join("")},hexToBytes:function(r){for(var a=[],n=0;n<r.length;n+=2)a.push(parseInt(r.substr(n,2),16));return a},bytesToBase64:function(r){for(var a=[],n=0;n<r.length;n+=3)for(var u=r[n]<<16|r[n+1]<<8|r[n+2],i=0;i<4;i++)8*n+6*i<=8*r.length?a.push(e.charAt(u>>>6*(3-i)&63)):a.push("=");return a.join("")},base64ToBytes:function(r){r=r.replace(/[^A-Z0-9+\/]/gi,"");for(var a=[],n=0,u=0;n<r.length;u=++n%4)u!=0&&a.push((e.indexOf(r.charAt(n-1))&Math.pow(2,-2*u+8)-1)<<2*u|e.indexOf(r.charAt(n))>>>6-2*u);return a}},s.exports=t},635:(s,e,t)=>{const r=t(31),a=t(338),n=t(221);s.exports={XMLParser:a,XMLValidator:r,XMLBuilder:n}},705:(s,e)=>{const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",r="["+t+"]["+t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+r+"$");e.isExist=function(n){return n!==void 0},e.isEmptyObject=function(n){return Object.keys(n).length===0},e.merge=function(n,u,i){if(u){const l=Object.keys(u),o=l.length;for(let c=0;c<o;c++)n[l[c]]=i==="strict"?[u[l[c]]]:u[l[c]]}},e.getValue=function(n){return e.isExist(n)?n:""},e.isName=function(n){return a.exec(n)!=null},e.getAllMatches=function(n,u){const i=[];let l=u.exec(n);for(;l;){const o=[];o.startIndex=u.lastIndex-l[0].length;const c=l.length;for(let m=0;m<c;m++)o.push(l[m]);i.push(o),l=u.exec(n)}return i},e.nameRegexp=r},31:(s,e,t)=>{const r=t(705),a={allowBooleanAttributes:!1,unpairedTags:[]};function n(g){return g===" "||g==="	"||g==="\n"||g==="\r"}function u(g,b){const N=b;for(;b<g.length;b++)if(!(g[b]!="?"&&g[b]!=" ")){const S=g.substr(N,b-N);if(b>5&&S==="xml")return d("InvalidXml","XML declaration allowed only at the start of the document.",y(g,b));if(g[b]=="?"&&g[b+1]==">"){b++;break}}return b}function i(g,b){if(g.length>b+5&&g[b+1]==="-"&&g[b+2]==="-"){for(b+=3;b<g.length;b++)if(g[b]==="-"&&g[b+1]==="-"&&g[b+2]===">"){b+=2;break}}else if(g.length>b+8&&g[b+1]==="D"&&g[b+2]==="O"&&g[b+3]==="C"&&g[b+4]==="T"&&g[b+5]==="Y"&&g[b+6]==="P"&&g[b+7]==="E"){let N=1;for(b+=8;b<g.length;b++)if(g[b]==="<")N++;else if(g[b]===">"&&(N--,N===0))break}else if(g.length>b+9&&g[b+1]==="["&&g[b+2]==="C"&&g[b+3]==="D"&&g[b+4]==="A"&&g[b+5]==="T"&&g[b+6]==="A"&&g[b+7]==="["){for(b+=8;b<g.length;b++)if(g[b]==="]"&&g[b+1]==="]"&&g[b+2]===">"){b+=2;break}}return b}e.validate=function(g,b){b=Object.assign({},a,b);const N=[];let S=!1,C=!1;g[0]==="\uFEFF"&&(g=g.substr(1));for(let E=0;E<g.length;E++)if(g[E]==="<"&&g[E+1]==="?"){if(E+=2,E=u(g,E),E.err)return E}else{if(g[E]!=="<"){if(n(g[E]))continue;return d("InvalidChar","char '"+g[E]+"' is not expected.",y(g,E))}{let P=E;if(E++,g[E]==="!"){E=i(g,E);continue}{let K=!1;g[E]==="/"&&(K=!0,E++);let L="";for(;E<g.length&&g[E]!==">"&&g[E]!==" "&&g[E]!=="	"&&g[E]!=="\n"&&g[E]!=="\r";E++)L+=g[E];if(L=L.trim(),L[L.length-1]==="/"&&(L=L.substring(0,L.length-1),E--),x=L,!r.isName(x)){let M;return M=L.trim().length===0?"Invalid space after '<'.":"Tag '"+L+"' is an invalid name.",d("InvalidTag",M,y(g,E))}const U=c(g,E);if(U===!1)return d("InvalidAttr","Attributes for '"+L+"' have open quote.",y(g,E));let j=U.value;if(E=U.index,j[j.length-1]==="/"){const M=E-j.length;j=j.substring(0,j.length-1);const G=h(j,b);if(G!==!0)return d(G.err.code,G.err.msg,y(g,M+G.err.line));S=!0}else if(K){if(!U.tagClosed)return d("InvalidTag","Closing tag '"+L+"' doesn't have proper closing.",y(g,E));if(j.trim().length>0)return d("InvalidTag","Closing tag '"+L+"' can't have attributes or invalid starting.",y(g,P));if(N.length===0)return d("InvalidTag","Closing tag '"+L+"' has not been opened.",y(g,P));{const M=N.pop();if(L!==M.tagName){let G=y(g,M.tagStartPos);return d("InvalidTag","Expected closing tag '"+M.tagName+"' (opened in line "+G.line+", col "+G.col+") instead of closing tag '"+L+"'.",y(g,P))}N.length==0&&(C=!0)}}else{const M=h(j,b);if(M!==!0)return d(M.err.code,M.err.msg,y(g,E-j.length+M.err.line));if(C===!0)return d("InvalidXml","Multiple possible root nodes found.",y(g,E));b.unpairedTags.indexOf(L)!==-1||N.push({tagName:L,tagStartPos:P}),S=!0}for(E++;E<g.length;E++)if(g[E]==="<"){if(g[E+1]==="!"){E++,E=i(g,E);continue}if(g[E+1]!=="?")break;if(E=u(g,++E),E.err)return E}else if(g[E]==="&"){const M=p(g,E);if(M==-1)return d("InvalidChar","char '&' is not expected.",y(g,E));E=M}else if(C===!0&&!n(g[E]))return d("InvalidXml","Extra text at the end",y(g,E));g[E]==="<"&&E--}}}var x;return S?N.length==1?d("InvalidTag","Unclosed tag '"+N[0].tagName+"'.",y(g,N[0].tagStartPos)):!(N.length>0)||d("InvalidXml","Invalid '"+JSON.stringify(N.map(E=>E.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):d("InvalidXml","Start tag expected.",1)};const l='"',o="'";function c(g,b){let N="",S="",C=!1;for(;b<g.length;b++){if(g[b]===l||g[b]===o)S===""?S=g[b]:S!==g[b]||(S="");else if(g[b]===">"&&S===""){C=!0;break}N+=g[b]}return S===""&&{value:N,index:b,tagClosed:C}}const m=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function h(g,b){const N=r.getAllMatches(g,m),S={};for(let C=0;C<N.length;C++){if(N[C][1].length===0)return d("InvalidAttr","Attribute '"+N[C][2]+"' has no space in starting.",k(N[C]));if(N[C][3]!==void 0&&N[C][4]===void 0)return d("InvalidAttr","Attribute '"+N[C][2]+"' is without value.",k(N[C]));if(N[C][3]===void 0&&!b.allowBooleanAttributes)return d("InvalidAttr","boolean attribute '"+N[C][2]+"' is not allowed.",k(N[C]));const x=N[C][2];if(!w(x))return d("InvalidAttr","Attribute '"+x+"' is an invalid name.",k(N[C]));if(S.hasOwnProperty(x))return d("InvalidAttr","Attribute '"+x+"' is repeated.",k(N[C]));S[x]=1}return!0}function p(g,b){if(g[++b]===";")return-1;if(g[b]==="#")return function(S,C){let x=/\d/;for(S[C]==="x"&&(C++,x=/[\da-fA-F]/);C<S.length;C++){if(S[C]===";")return C;if(!S[C].match(x))break}return-1}(g,++b);let N=0;for(;b<g.length;b++,N++)if(!(g[b].match(/\w/)&&N<20)){if(g[b]===";")break;return-1}return b}function d(g,b,N){return{err:{code:g,msg:b,line:N.line||N,col:N.col}}}function w(g){return r.isName(g)}function y(g,b){const N=g.substring(0,b).split(/\r?\n/);return{line:N.length,col:N[N.length-1].length+1}}function k(g){return g.startIndex+g[1].length}},221:(s,e,t)=>{const r=t(87),a={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(o,c){return c},attributeValueProcessor:function(o,c){return c},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function n(o){this.options=Object.assign({},a,o),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=l),this.processTextOrObjNode=u,this.options.format?(this.indentate=i,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function u(o,c,m){const h=this.j2x(o,m+1);return o[this.options.textNodeName]!==void 0&&Object.keys(o).length===1?this.buildTextValNode(o[this.options.textNodeName],c,h.attrStr,m):this.buildObjectNode(h.val,c,h.attrStr,m)}function i(o){return this.options.indentBy.repeat(o)}function l(o){return!(!o.startsWith(this.options.attributeNamePrefix)||o===this.options.textNodeName)&&o.substr(this.attrPrefixLen)}n.prototype.build=function(o){return this.options.preserveOrder?r(o,this.options):(Array.isArray(o)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(o={[this.options.arrayNodeName]:o}),this.j2x(o,0).val)},n.prototype.j2x=function(o,c){let m="",h="";for(let p in o)if(Object.prototype.hasOwnProperty.call(o,p))if(o[p]===void 0)this.isAttribute(p)&&(h+="");else if(o[p]===null)this.isAttribute(p)?h+="":p[0]==="?"?h+=this.indentate(c)+"<"+p+"?"+this.tagEndChar:h+=this.indentate(c)+"<"+p+"/"+this.tagEndChar;else if(o[p]instanceof Date)h+=this.buildTextValNode(o[p],p,"",c);else if(typeof o[p]!="object"){const d=this.isAttribute(p);if(d)m+=this.buildAttrPairStr(d,""+o[p]);else if(p===this.options.textNodeName){let w=this.options.tagValueProcessor(p,""+o[p]);h+=this.replaceEntitiesValue(w)}else h+=this.buildTextValNode(o[p],p,"",c)}else if(Array.isArray(o[p])){const d=o[p].length;let w="",y="";for(let k=0;k<d;k++){const g=o[p][k];if(g!==void 0)if(g===null)p[0]==="?"?h+=this.indentate(c)+"<"+p+"?"+this.tagEndChar:h+=this.indentate(c)+"<"+p+"/"+this.tagEndChar;else if(typeof g=="object")if(this.options.oneListGroup){const b=this.j2x(g,c+1);w+=b.val,this.options.attributesGroupName&&g.hasOwnProperty(this.options.attributesGroupName)&&(y+=b.attrStr)}else w+=this.processTextOrObjNode(g,p,c);else if(this.options.oneListGroup){let b=this.options.tagValueProcessor(p,g);b=this.replaceEntitiesValue(b),w+=b}else w+=this.buildTextValNode(g,p,"",c)}this.options.oneListGroup&&(w=this.buildObjectNode(w,p,y,c)),h+=w}else if(this.options.attributesGroupName&&p===this.options.attributesGroupName){const d=Object.keys(o[p]),w=d.length;for(let y=0;y<w;y++)m+=this.buildAttrPairStr(d[y],""+o[p][d[y]])}else h+=this.processTextOrObjNode(o[p],p,c);return{attrStr:m,val:h}},n.prototype.buildAttrPairStr=function(o,c){return c=this.options.attributeValueProcessor(o,""+c),c=this.replaceEntitiesValue(c),this.options.suppressBooleanAttributes&&c==="true"?" "+o:" "+o+'="'+c+'"'},n.prototype.buildObjectNode=function(o,c,m,h){if(o==="")return c[0]==="?"?this.indentate(h)+"<"+c+m+"?"+this.tagEndChar:this.indentate(h)+"<"+c+m+this.closeTag(c)+this.tagEndChar;{let p="</"+c+this.tagEndChar,d="";return c[0]==="?"&&(d="?",p=""),!m&&m!==""||o.indexOf("<")!==-1?this.options.commentPropName!==!1&&c===this.options.commentPropName&&d.length===0?this.indentate(h)+"<!--".concat(o,"-->")+this.newLine:this.indentate(h)+"<"+c+m+d+this.tagEndChar+o+this.indentate(h)+p:this.indentate(h)+"<"+c+m+d+">"+o+p}},n.prototype.closeTag=function(o){let c="";return this.options.unpairedTags.indexOf(o)!==-1?this.options.suppressUnpairedNode||(c="/"):c=this.options.suppressEmptyNode?"/":"></".concat(o),c},n.prototype.buildTextValNode=function(o,c,m,h){if(this.options.cdataPropName!==!1&&c===this.options.cdataPropName)return this.indentate(h)+"<![CDATA[".concat(o,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&c===this.options.commentPropName)return this.indentate(h)+"<!--".concat(o,"-->")+this.newLine;if(c[0]==="?")return this.indentate(h)+"<"+c+m+"?"+this.tagEndChar;{let p=this.options.tagValueProcessor(c,o);return p=this.replaceEntitiesValue(p),p===""?this.indentate(h)+"<"+c+m+this.closeTag(c)+this.tagEndChar:this.indentate(h)+"<"+c+m+">"+p+"</"+c+this.tagEndChar}},n.prototype.replaceEntitiesValue=function(o){if(o&&o.length>0&&this.options.processEntities)for(let c=0;c<this.options.entities.length;c++){const m=this.options.entities[c];o=o.replace(m.regex,m.val)}return o},s.exports=n},87:s=>{function e(u,i,l,o){let c="",m=!1;for(let h=0;h<u.length;h++){const p=u[h],d=t(p);if(d===void 0)continue;let w="";if(w=l.length===0?d:"".concat(l,".").concat(d),d===i.textNodeName){let b=p[d];a(w,i)||(b=i.tagValueProcessor(d,b),b=n(b,i)),m&&(c+=o),c+=b,m=!1;continue}if(d===i.cdataPropName){m&&(c+=o),c+="<![CDATA[".concat(p[d][0][i.textNodeName],"]]>"),m=!1;continue}if(d===i.commentPropName){c+=o+"<!--".concat(p[d][0][i.textNodeName],"-->"),m=!0;continue}if(d[0]==="?"){const b=r(p[":@"],i),N=d==="?xml"?"":o;let S=p[d][0][i.textNodeName];S=S.length!==0?" "+S:"",c+=N+"<".concat(d).concat(S).concat(b,"?>"),m=!0;continue}let y=o;y!==""&&(y+=i.indentBy);const k=o+"<".concat(d).concat(r(p[":@"],i)),g=e(p[d],i,w,y);i.unpairedTags.indexOf(d)!==-1?i.suppressUnpairedNode?c+=k+">":c+=k+"/>":g&&g.length!==0||!i.suppressEmptyNode?g&&g.endsWith(">")?c+=k+">".concat(g).concat(o,"</").concat(d,">"):(c+=k+">",g&&o!==""&&(g.includes("/>")||g.includes("</"))?c+=o+i.indentBy+g+o:c+=g,c+="</".concat(d,">")):c+=k+"/>",m=!0}return c}function t(u){const i=Object.keys(u);for(let l=0;l<i.length;l++){const o=i[l];if(u.hasOwnProperty(o)&&o!==":@")return o}}function r(u,i){let l="";if(u&&!i.ignoreAttributes)for(let o in u){if(!u.hasOwnProperty(o))continue;let c=i.attributeValueProcessor(o,u[o]);c=n(c,i),c===!0&&i.suppressBooleanAttributes?l+=" ".concat(o.substr(i.attributeNamePrefix.length)):l+=" ".concat(o.substr(i.attributeNamePrefix.length),'="').concat(c,'"')}return l}function a(u,i){let l=(u=u.substr(0,u.length-i.textNodeName.length-1)).substr(u.lastIndexOf(".")+1);for(let o in i.stopNodes)if(i.stopNodes[o]===u||i.stopNodes[o]==="*."+l)return!0;return!1}function n(u,i){if(u&&u.length>0&&i.processEntities)for(let l=0;l<i.entities.length;l++){const o=i.entities[l];u=u.replace(o.regex,o.val)}return u}s.exports=function(u,i){let l="";return i.format&&i.indentBy.length>0&&(l="\n"),e(u,i,"",l)}},193:(s,e,t)=>{const r=t(705);function a(m,h){let p="";for(;h<m.length&&m[h]!=="'"&&m[h]!=='"';h++)p+=m[h];if(p=p.trim(),p.indexOf(" ")!==-1)throw new Error("External entites are not supported");const d=m[h++];let w="";for(;h<m.length&&m[h]!==d;h++)w+=m[h];return[p,w,h]}function n(m,h){return m[h+1]==="!"&&m[h+2]==="-"&&m[h+3]==="-"}function u(m,h){return m[h+1]==="!"&&m[h+2]==="E"&&m[h+3]==="N"&&m[h+4]==="T"&&m[h+5]==="I"&&m[h+6]==="T"&&m[h+7]==="Y"}function i(m,h){return m[h+1]==="!"&&m[h+2]==="E"&&m[h+3]==="L"&&m[h+4]==="E"&&m[h+5]==="M"&&m[h+6]==="E"&&m[h+7]==="N"&&m[h+8]==="T"}function l(m,h){return m[h+1]==="!"&&m[h+2]==="A"&&m[h+3]==="T"&&m[h+4]==="T"&&m[h+5]==="L"&&m[h+6]==="I"&&m[h+7]==="S"&&m[h+8]==="T"}function o(m,h){return m[h+1]==="!"&&m[h+2]==="N"&&m[h+3]==="O"&&m[h+4]==="T"&&m[h+5]==="A"&&m[h+6]==="T"&&m[h+7]==="I"&&m[h+8]==="O"&&m[h+9]==="N"}function c(m){if(r.isName(m))return m;throw new Error("Invalid entity name ".concat(m))}s.exports=function(m,h){const p={};if(m[h+3]!=="O"||m[h+4]!=="C"||m[h+5]!=="T"||m[h+6]!=="Y"||m[h+7]!=="P"||m[h+8]!=="E")throw new Error("Invalid Tag instead of DOCTYPE");{h+=9;let d=1,w=!1,y=!1,k="";for(;h<m.length;h++)if(m[h]!=="<"||y)if(m[h]===">"){if(y?m[h-1]==="-"&&m[h-2]==="-"&&(y=!1,d--):d--,d===0)break}else m[h]==="["?w=!0:k+=m[h];else{if(w&&u(m,h))h+=7,[entityName,val,h]=a(m,h+1),val.indexOf("&")===-1&&(p[c(entityName)]={regx:RegExp("&".concat(entityName,";"),"g"),val});else if(w&&i(m,h))h+=8;else if(w&&l(m,h))h+=8;else if(w&&o(m,h))h+=9;else{if(!n)throw new Error("Invalid DOCTYPE");y=!0}d++,k=""}if(d!==0)throw new Error("Unclosed DOCTYPE")}return{entities:p,i:h}}},63:(s,e)=>{const t={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(r,a){return a},attributeValueProcessor:function(r,a){return a},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(r,a,n){return r}};e.buildOptions=function(r){return Object.assign({},t,r)},e.defaultOptions=t},299:(s,e,t)=>{const r=t(705),a=t(365),n=t(193),u=t(494);function i(S){const C=Object.keys(S);for(let x=0;x<C.length;x++){const E=C[x];this.lastEntities[E]={regex:new RegExp("&"+E+";","g"),val:S[E]}}}function l(S,C,x,E,P,K,L){if(S!==void 0&&(this.options.trimValues&&!E&&(S=S.trim()),S.length>0)){L||(S=this.replaceEntitiesValue(S));const U=this.options.tagValueProcessor(C,S,x,P,K);return U==null?S:typeof U!=typeof S||U!==S?U:this.options.trimValues||S.trim()===S?N(S,this.options.parseTagValue,this.options.numberParseOptions):S}}function o(S){if(this.options.removeNSPrefix){const C=S.split(":"),x=S.charAt(0)==="/"?"/":"";if(C[0]==="xmlns")return"";C.length===2&&(S=x+C[1])}return S}const c=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function m(S,C,x){if(!this.options.ignoreAttributes&&typeof S=="string"){const E=r.getAllMatches(S,c),P=E.length,K={};for(let L=0;L<P;L++){const U=this.resolveNameSpace(E[L][1]);let j=E[L][4],M=this.options.attributeNamePrefix+U;if(U.length)if(this.options.transformAttributeName&&(M=this.options.transformAttributeName(M)),M==="__proto__"&&(M="#__proto__"),j!==void 0){this.options.trimValues&&(j=j.trim()),j=this.replaceEntitiesValue(j);const G=this.options.attributeValueProcessor(U,j,C);K[M]=G==null?j:typeof G!=typeof j||G!==j?G:N(j,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(K[M]=!0)}if(!Object.keys(K).length)return;if(this.options.attributesGroupName){const L={};return L[this.options.attributesGroupName]=K,L}return K}}const h=function(S){S=S.replace(/\r\n?/g,"\n");const C=new a("!xml");let x=C,E="",P="";for(let K=0;K<S.length;K++)if(S[K]==="<")if(S[K+1]==="/"){const L=k(S,">",K,"Closing Tag is not closed.");let U=S.substring(K+2,L).trim();if(this.options.removeNSPrefix){const G=U.indexOf(":");G!==-1&&(U=U.substr(G+1))}this.options.transformTagName&&(U=this.options.transformTagName(U)),x&&(E=this.saveTextToParentTag(E,x,P));const j=P.substring(P.lastIndexOf(".")+1);if(U&&this.options.unpairedTags.indexOf(U)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(U,">"));let M=0;j&&this.options.unpairedTags.indexOf(j)!==-1?(M=P.lastIndexOf(".",P.lastIndexOf(".")-1),this.tagsNodeStack.pop()):M=P.lastIndexOf("."),P=P.substring(0,M),x=this.tagsNodeStack.pop(),E="",K=L}else if(S[K+1]==="?"){let L=g(S,K,!1,"?>");if(!L)throw new Error("Pi Tag is not closed.");if(E=this.saveTextToParentTag(E,x,P),!(this.options.ignoreDeclaration&&L.tagName==="?xml"||this.options.ignorePiTags)){const U=new a(L.tagName);U.add(this.options.textNodeName,""),L.tagName!==L.tagExp&&L.attrExpPresent&&(U[":@"]=this.buildAttributesMap(L.tagExp,P,L.tagName)),this.addChild(x,U,P)}K=L.closeIndex+1}else if(S.substr(K+1,3)==="!--"){const L=k(S,"-->",K+4,"Comment is not closed.");if(this.options.commentPropName){const U=S.substring(K+4,L-2);E=this.saveTextToParentTag(E,x,P),x.add(this.options.commentPropName,[{[this.options.textNodeName]:U}])}K=L}else if(S.substr(K+1,2)==="!D"){const L=n(S,K);this.docTypeEntities=L.entities,K=L.i}else if(S.substr(K+1,2)==="!["){const L=k(S,"]]>",K,"CDATA is not closed.")-2,U=S.substring(K+9,L);E=this.saveTextToParentTag(E,x,P);let j=this.parseTextData(U,x.tagname,P,!0,!1,!0,!0);j==null&&(j=""),this.options.cdataPropName?x.add(this.options.cdataPropName,[{[this.options.textNodeName]:U}]):x.add(this.options.textNodeName,j),K=L+2}else{let L=g(S,K,this.options.removeNSPrefix),U=L.tagName;const j=L.rawTagName;let M=L.tagExp,G=L.attrExpPresent,we=L.closeIndex;this.options.transformTagName&&(U=this.options.transformTagName(U)),x&&E&&x.tagname!=="!xml"&&(E=this.saveTextToParentTag(E,x,P,!1));const ae=x;if(ae&&this.options.unpairedTags.indexOf(ae.tagname)!==-1&&(x=this.tagsNodeStack.pop(),P=P.substring(0,P.lastIndexOf("."))),U!==C.tagname&&(P+=P?"."+U:U),this.isItStopNode(this.options.stopNodes,P,U)){let Y="";if(M.length>0&&M.lastIndexOf("/")===M.length-1)U[U.length-1]==="/"?(U=U.substr(0,U.length-1),P=P.substr(0,P.length-1),M=U):M=M.substr(0,M.length-1),K=L.closeIndex;else if(this.options.unpairedTags.indexOf(U)!==-1)K=L.closeIndex;else{const F=this.readStopNodeData(S,j,we+1);if(!F)throw new Error("Unexpected end of ".concat(j));K=F.i,Y=F.tagContent}const se=new a(U);U!==M&&G&&(se[":@"]=this.buildAttributesMap(M,P,U)),Y&&(Y=this.parseTextData(Y,U,P,!0,G,!0,!0)),P=P.substr(0,P.lastIndexOf(".")),se.add(this.options.textNodeName,Y),this.addChild(x,se,P)}else{if(M.length>0&&M.lastIndexOf("/")===M.length-1){U[U.length-1]==="/"?(U=U.substr(0,U.length-1),P=P.substr(0,P.length-1),M=U):M=M.substr(0,M.length-1),this.options.transformTagName&&(U=this.options.transformTagName(U));const Y=new a(U);U!==M&&G&&(Y[":@"]=this.buildAttributesMap(M,P,U)),this.addChild(x,Y,P),P=P.substr(0,P.lastIndexOf("."))}else{const Y=new a(U);this.tagsNodeStack.push(x),U!==M&&G&&(Y[":@"]=this.buildAttributesMap(M,P,U)),this.addChild(x,Y,P),x=Y}E="",K=we}}else E+=S[K];return C.child};function p(S,C,x){const E=this.options.updateTag(C.tagname,x,C[":@"]);E===!1||(typeof E=="string"&&(C.tagname=E),S.addChild(C))}const d=function(S){if(this.options.processEntities){for(let C in this.docTypeEntities){const x=this.docTypeEntities[C];S=S.replace(x.regx,x.val)}for(let C in this.lastEntities){const x=this.lastEntities[C];S=S.replace(x.regex,x.val)}if(this.options.htmlEntities)for(let C in this.htmlEntities){const x=this.htmlEntities[C];S=S.replace(x.regex,x.val)}S=S.replace(this.ampEntity.regex,this.ampEntity.val)}return S};function w(S,C,x,E){return S&&(E===void 0&&(E=Object.keys(C.child).length===0),(S=this.parseTextData(S,C.tagname,x,!1,!!C[":@"]&&Object.keys(C[":@"]).length!==0,E))!==void 0&&S!==""&&C.add(this.options.textNodeName,S),S=""),S}function y(S,C,x){const E="*."+x;for(const P in S){const K=S[P];if(E===K||C===K)return!0}return!1}function k(S,C,x,E){const P=S.indexOf(C,x);if(P===-1)throw new Error(E);return P+C.length-1}function g(S,C,x){const E=function(G,we){let ae,Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:">",se="";for(let F=we;F<G.length;F++){let W=G[F];if(ae)W===ae&&(ae="");else if(W==='"'||W==="'")ae=W;else if(W===Y[0]){if(!Y[1])return{data:se,index:F};if(G[F+1]===Y[1])return{data:se,index:F}}else W==="	"&&(W=" ");se+=W}}(S,C+1,arguments.length>3&&arguments[3]!==void 0?arguments[3]:">");if(!E)return;let P=E.data;const K=E.index,L=P.search(/\s/);let U=P,j=!0;L!==-1&&(U=P.substring(0,L),P=P.substring(L+1).trimStart());const M=U;if(x){const G=U.indexOf(":");G!==-1&&(U=U.substr(G+1),j=U!==E.data.substr(G+1))}return{tagName:U,tagExp:P,closeIndex:K,attrExpPresent:j,rawTagName:M}}function b(S,C,x){const E=x;let P=1;for(;x<S.length;x++)if(S[x]==="<")if(S[x+1]==="/"){const K=k(S,">",x,"".concat(C," is not closed"));if(S.substring(x+2,K).trim()===C&&(P--,P===0))return{tagContent:S.substring(E,x),i:K};x=K}else if(S[x+1]==="?")x=k(S,"?>",x+1,"StopNode is not closed.");else if(S.substr(x+1,3)==="!--")x=k(S,"-->",x+3,"StopNode is not closed.");else if(S.substr(x+1,2)==="![")x=k(S,"]]>",x,"StopNode is not closed.")-2;else{const K=g(S,x,">");K&&((K&&K.tagName)===C&&K.tagExp[K.tagExp.length-1]!=="/"&&P++,x=K.closeIndex)}}function N(S,C,x){if(C&&typeof S=="string"){const E=S.trim();return E==="true"||E!=="false"&&u(S,x)}return r.isExist(S)?S:""}s.exports=class{constructor(S){this.options=S,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(C,x)=>String.fromCharCode(Number.parseInt(x,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(C,x)=>String.fromCharCode(Number.parseInt(x,16))}},this.addExternalEntities=i,this.parseXml=h,this.parseTextData=l,this.resolveNameSpace=o,this.buildAttributesMap=m,this.isItStopNode=y,this.replaceEntitiesValue=d,this.readStopNodeData=b,this.saveTextToParentTag=w,this.addChild=p}}},338:(s,e,t)=>{const{buildOptions:r}=t(63),a=t(299),{prettify:n}=t(728),u=t(31);s.exports=class{constructor(i){this.externalEntities={},this.options=r(i)}parse(i,l){if(typeof i!="string"){if(!i.toString)throw new Error("XML data is accepted in String or Bytes[] form.");i=i.toString()}if(l){l===!0&&(l={});const m=u.validate(i,l);if(m!==!0)throw Error("".concat(m.err.msg,":").concat(m.err.line,":").concat(m.err.col))}const o=new a(this.options);o.addExternalEntities(this.externalEntities);const c=o.parseXml(i);return this.options.preserveOrder||c===void 0?c:n(c,this.options)}addEntity(i,l){if(l.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(i.indexOf("&")!==-1||i.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(l==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[i]=l}}},728:(s,e)=>{function t(u,i,l){let o;const c={};for(let m=0;m<u.length;m++){const h=u[m],p=r(h);let d="";if(d=l===void 0?p:l+"."+p,p===i.textNodeName)o===void 0?o=h[p]:o+=""+h[p];else{if(p===void 0)continue;if(h[p]){let w=t(h[p],i,d);const y=n(w,i);h[":@"]?a(w,h[":@"],d,i):Object.keys(w).length!==1||w[i.textNodeName]===void 0||i.alwaysCreateTextNode?Object.keys(w).length===0&&(i.alwaysCreateTextNode?w[i.textNodeName]="":w=""):w=w[i.textNodeName],c[p]!==void 0&&c.hasOwnProperty(p)?(Array.isArray(c[p])||(c[p]=[c[p]]),c[p].push(w)):i.isArray(p,d,y)?c[p]=[w]:c[p]=w}}}return typeof o=="string"?o.length>0&&(c[i.textNodeName]=o):o!==void 0&&(c[i.textNodeName]=o),c}function r(u){const i=Object.keys(u);for(let l=0;l<i.length;l++){const o=i[l];if(o!==":@")return o}}function a(u,i,l,o){if(i){const c=Object.keys(i),m=c.length;for(let h=0;h<m;h++){const p=c[h];o.isArray(p,l+"."+p,!0,!0)?u[p]=[i[p]]:u[p]=i[p]}}}function n(u,i){const{textNodeName:l}=i,o=Object.keys(u).length;return o===0||!(o!==1||!u[l]&&typeof u[l]!="boolean"&&u[l]!==0)}e.prettify=function(u,i){return t(u,i)}},365:s=>{s.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},135:s=>{function e(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}s.exports=function(t){return t!=null&&(e(t)||function(r){return typeof r.readFloatLE=="function"&&typeof r.slice=="function"&&e(r.slice(0,0))}(t)||!!t._isBuffer)}},542:(s,e,t)=>{(function(){var r=t(298),a=t(526).utf8,n=t(135),u=t(526).bin,i=function(l,o){l.constructor==String?l=o&&o.encoding==="binary"?u.stringToBytes(l):a.stringToBytes(l):n(l)?l=Array.prototype.slice.call(l,0):Array.isArray(l)||l.constructor===Uint8Array||(l=l.toString());for(var c=r.bytesToWords(l),m=8*l.length,h=1732584193,p=-271733879,d=-1732584194,w=271733878,y=0;y<c.length;y++)c[y]=16711935&(c[y]<<8|c[y]>>>24)|4278255360&(c[y]<<24|c[y]>>>8);c[m>>>5]|=128<<m%32,c[14+(m+64>>>9<<4)]=m;var k=i._ff,g=i._gg,b=i._hh,N=i._ii;for(y=0;y<c.length;y+=16){var S=h,C=p,x=d,E=w;h=k(h,p,d,w,c[y+0],7,-680876936),w=k(w,h,p,d,c[y+1],12,-389564586),d=k(d,w,h,p,c[y+2],17,606105819),p=k(p,d,w,h,c[y+3],22,-1044525330),h=k(h,p,d,w,c[y+4],7,-176418897),w=k(w,h,p,d,c[y+5],12,1200080426),d=k(d,w,h,p,c[y+6],17,-1473231341),p=k(p,d,w,h,c[y+7],22,-45705983),h=k(h,p,d,w,c[y+8],7,1770035416),w=k(w,h,p,d,c[y+9],12,-1958414417),d=k(d,w,h,p,c[y+10],17,-42063),p=k(p,d,w,h,c[y+11],22,-1990404162),h=k(h,p,d,w,c[y+12],7,1804603682),w=k(w,h,p,d,c[y+13],12,-40341101),d=k(d,w,h,p,c[y+14],17,-1502002290),h=g(h,p=k(p,d,w,h,c[y+15],22,1236535329),d,w,c[y+1],5,-165796510),w=g(w,h,p,d,c[y+6],9,-1069501632),d=g(d,w,h,p,c[y+11],14,643717713),p=g(p,d,w,h,c[y+0],20,-373897302),h=g(h,p,d,w,c[y+5],5,-701558691),w=g(w,h,p,d,c[y+10],9,38016083),d=g(d,w,h,p,c[y+15],14,-660478335),p=g(p,d,w,h,c[y+4],20,-405537848),h=g(h,p,d,w,c[y+9],5,568446438),w=g(w,h,p,d,c[y+14],9,-1019803690),d=g(d,w,h,p,c[y+3],14,-187363961),p=g(p,d,w,h,c[y+8],20,1163531501),h=g(h,p,d,w,c[y+13],5,-1444681467),w=g(w,h,p,d,c[y+2],9,-51403784),d=g(d,w,h,p,c[y+7],14,1735328473),h=b(h,p=g(p,d,w,h,c[y+12],20,-1926607734),d,w,c[y+5],4,-378558),w=b(w,h,p,d,c[y+8],11,-2022574463),d=b(d,w,h,p,c[y+11],16,1839030562),p=b(p,d,w,h,c[y+14],23,-35309556),h=b(h,p,d,w,c[y+1],4,-1530992060),w=b(w,h,p,d,c[y+4],11,1272893353),d=b(d,w,h,p,c[y+7],16,-155497632),p=b(p,d,w,h,c[y+10],23,-1094730640),h=b(h,p,d,w,c[y+13],4,681279174),w=b(w,h,p,d,c[y+0],11,-358537222),d=b(d,w,h,p,c[y+3],16,-722521979),p=b(p,d,w,h,c[y+6],23,76029189),h=b(h,p,d,w,c[y+9],4,-640364487),w=b(w,h,p,d,c[y+12],11,-421815835),d=b(d,w,h,p,c[y+15],16,530742520),h=N(h,p=b(p,d,w,h,c[y+2],23,-995338651),d,w,c[y+0],6,-198630844),w=N(w,h,p,d,c[y+7],10,1126891415),d=N(d,w,h,p,c[y+14],15,-1416354905),p=N(p,d,w,h,c[y+5],21,-57434055),h=N(h,p,d,w,c[y+12],6,1700485571),w=N(w,h,p,d,c[y+3],10,-1894986606),d=N(d,w,h,p,c[y+10],15,-1051523),p=N(p,d,w,h,c[y+1],21,-2054922799),h=N(h,p,d,w,c[y+8],6,1873313359),w=N(w,h,p,d,c[y+15],10,-30611744),d=N(d,w,h,p,c[y+6],15,-1560198380),p=N(p,d,w,h,c[y+13],21,1309151649),h=N(h,p,d,w,c[y+4],6,-145523070),w=N(w,h,p,d,c[y+11],10,-1120210379),d=N(d,w,h,p,c[y+2],15,718787259),p=N(p,d,w,h,c[y+9],21,-343485551),h=h+S>>>0,p=p+C>>>0,d=d+x>>>0,w=w+E>>>0}return r.endian([h,p,d,w])};i._ff=function(l,o,c,m,h,p,d){var w=l+(o&c|~o&m)+(h>>>0)+d;return(w<<p|w>>>32-p)+o},i._gg=function(l,o,c,m,h,p,d){var w=l+(o&m|c&~m)+(h>>>0)+d;return(w<<p|w>>>32-p)+o},i._hh=function(l,o,c,m,h,p,d){var w=l+(o^c^m)+(h>>>0)+d;return(w<<p|w>>>32-p)+o},i._ii=function(l,o,c,m,h,p,d){var w=l+(c^(o|~m))+(h>>>0)+d;return(w<<p|w>>>32-p)+o},i._blocksize=16,i._digestsize=16,s.exports=function(l,o){if(l==null)throw new Error("Illegal argument "+l);var c=r.wordsToBytes(i(l,o));return o&&o.asBytes?c:o&&o.asString?u.bytesToString(c):r.bytesToHex(c)}})()},285:(s,e,t)=>{var r=t(2);s.exports=function(k){return k?(k.substr(0,2)==="{}"&&(k="\\{\\}"+k.substr(2)),y(function(g){return g.split("\\\\").join(a).split("\\{").join(n).split("\\}").join(u).split("\\,").join(i).split("\\.").join(l)}(k),!0).map(c)):[]};var a="\0SLASH"+Math.random()+"\0",n="\0OPEN"+Math.random()+"\0",u="\0CLOSE"+Math.random()+"\0",i="\0COMMA"+Math.random()+"\0",l="\0PERIOD"+Math.random()+"\0";function o(k){return parseInt(k,10)==k?parseInt(k,10):k.charCodeAt(0)}function c(k){return k.split(a).join("\\").split(n).join("{").split(u).join("}").split(i).join(",").split(l).join(".")}function m(k){if(!k)return[""];var g=[],b=r("{","}",k);if(!b)return k.split(",");var N=b.pre,S=b.body,C=b.post,x=N.split(",");x[x.length-1]+="{"+S+"}";var E=m(C);return C.length&&(x[x.length-1]+=E.shift(),x.push.apply(x,E)),g.push.apply(g,x),g}function h(k){return"{"+k+"}"}function p(k){return/^-?0\d/.test(k)}function d(k,g){return k<=g}function w(k,g){return k>=g}function y(k,g){var b=[],N=r("{","}",k);if(!N)return[k];var S=N.pre,C=N.post.length?y(N.post,!1):[""];if(/\$$/.test(N.pre))for(var x=0;x<C.length;x++){var E=S+"{"+N.body+"}"+C[x];b.push(E)}else{var P,K,L=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(N.body),U=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(N.body),j=L||U,M=N.body.indexOf(",")>=0;if(!j&&!M)return N.post.match(/,.*\}/)?y(k=N.pre+"{"+N.body+u+N.post):[k];if(j)P=N.body.split(/\.\./);else if((P=m(N.body)).length===1&&(P=y(P[0],!1).map(h)).length===1)return C.map(function(Zt){return N.pre+P[0]+Zt});if(j){var G=o(P[0]),we=o(P[1]),ae=Math.max(P[0].length,P[1].length),Y=P.length==3?Math.abs(o(P[2])):1,se=d;we<G&&(Y*=-1,se=w);var F=P.some(p);K=[];for(var W=G;se(W,we);W+=Y){var q;if(U)(q=String.fromCharCode(W))==="\\"&&(q="");else if(q=String(W),F){var ee=ae-q.length;if(ee>0){var ie=new Array(ee+1).join("0");q=W<0?"-"+ie+q.slice(1):ie+q}}K.push(q)}}else{K=[];for(var Ie=0;Ie<P.length;Ie++)K.push.apply(K,y(P[Ie],!1))}for(Ie=0;Ie<K.length;Ie++)for(x=0;x<C.length;x++)E=S+K[Ie]+C[x],(!g||j||E)&&b.push(E)}return b}},829:s=>{function e(o){return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},e(o)}function t(o){var c=typeof Map=="function"?new Map:void 0;return t=function(m){if(m===null||(h=m,Function.toString.call(h).indexOf("[native code]")===-1))return m;var h;if(typeof m!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(m))return c.get(m);c.set(m,p)}function p(){return r(m,arguments,n(this).constructor)}return p.prototype=Object.create(m.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),a(p,m)},t(o)}function r(o,c,m){return r=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(h){return!1}}()?Reflect.construct:function(h,p,d){var w=[null];w.push.apply(w,p);var y=new(Function.bind.apply(h,w));return d&&a(y,d.prototype),y},r.apply(null,arguments)}function a(o,c){return a=Object.setPrototypeOf||function(m,h){return m.__proto__=h,m},a(o,c)}function n(o){return n=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},n(o)}var u=function(o){function c(m){var h;return function(p,d){if(!(p instanceof d))throw new TypeError("Cannot call a class as a function")}(this,c),(h=function(p,d){return!d||e(d)!=="object"&&typeof d!="function"?function(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}(p):d}(this,n(c).call(this,m))).name="ObjectPrototypeMutationError",h}return function(m,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");m.prototype=Object.create(h&&h.prototype,{constructor:{value:m,writable:!0,configurable:!0}}),h&&a(m,h)}(c,o),c}(t(Error));function i(o,c){for(var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){},h=c.split("."),p=h.length,d=function(k){var g=h[k];if(!o)return{v:void 0};if(g==="+"){if(Array.isArray(o))return{v:o.map(function(N,S){var C=h.slice(k+1);return C.length>0?i(N,C.join("."),m):m(o,S,h,k)})};var b=h.slice(0,k).join(".");throw new Error("Object at wildcard (".concat(b,") is not an array"))}o=m(o,g,h,k)},w=0;w<p;w++){var y=d(w);if(e(y)==="object")return y.v}return o}function l(o,c){return o.length===c+1}s.exports={set:function(o,c,m){if(e(o)!="object"||o===null||c===void 0)return o;if(typeof c=="number")return o[c]=m,o[c];try{return i(o,c,function(h,p,d,w){if(h===Reflect.getPrototypeOf({}))throw new u("Attempting to mutate Object.prototype");if(!h[p]){var y=Number.isInteger(Number(d[w+1])),k=d[w+1]==="+";h[p]=y||k?[]:{}}return l(d,w)&&(h[p]=m),h[p]})}catch(h){if(h instanceof u)throw h;return o}},get:function(o,c){if(e(o)!="object"||o===null||c===void 0)return o;if(typeof c=="number")return o[c];try{return i(o,c,function(m,h){return m[h]})}catch(m){return o}},has:function(o,c){var m=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e(o)!="object"||o===null||c===void 0)return!1;if(typeof c=="number")return c in o;try{var h=!1;return i(o,c,function(p,d,w,y){if(!l(w,y))return p&&p[d];h=m.own?p.hasOwnProperty(d):d in p}),h}catch(p){return!1}},hasOwn:function(o,c,m){return this.has(o,c,m||{own:!0})},isIn:function(o,c,m){var h=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};if(e(o)!="object"||o===null||c===void 0)return!1;try{var p=!1,d=!1;return i(o,c,function(w,y,k,g){return p=p||w===m||!!w&&w[y]===m,d=l(k,g)&&e(w)==="object"&&y in w,w&&w[y]}),h.validPath?p&&d:p}catch(w){return!1}},ObjectPrototypeMutationError:u}},47:(s,e,t)=>{var r=t(410),a=function(o){return typeof o=="string"};function n(o,c){for(var m=[],h=0;h<o.length;h++){var p=o[h];p&&p!=="."&&(p===".."?m.length&&m[m.length-1]!==".."?m.pop():c&&m.push(".."):m.push(p))}return m}var u=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,i={};function l(o){return u.exec(o).slice(1)}i.resolve=function(){for(var o="",c=!1,m=arguments.length-1;m>=-1&&!c;m--){var h=m>=0?arguments[m]:Ge.cwd();if(!a(h))throw new TypeError("Arguments to path.resolve must be strings");h&&(o=h+"/"+o,c=h.charAt(0)==="/")}return(c?"/":"")+(o=n(o.split("/"),!c).join("/"))||"."},i.normalize=function(o){var c=i.isAbsolute(o),m=o.substr(-1)==="/";return(o=n(o.split("/"),!c).join("/"))||c||(o="."),o&&m&&(o+="/"),(c?"/":"")+o},i.isAbsolute=function(o){return o.charAt(0)==="/"},i.join=function(){for(var o="",c=0;c<arguments.length;c++){var m=arguments[c];if(!a(m))throw new TypeError("Arguments to path.join must be strings");m&&(o+=o?"/"+m:m)}return i.normalize(o)},i.relative=function(o,c){function m(g){for(var b=0;b<g.length&&g[b]==="";b++);for(var N=g.length-1;N>=0&&g[N]==="";N--);return b>N?[]:g.slice(b,N+1)}o=i.resolve(o).substr(1),c=i.resolve(c).substr(1);for(var h=m(o.split("/")),p=m(c.split("/")),d=Math.min(h.length,p.length),w=d,y=0;y<d;y++)if(h[y]!==p[y]){w=y;break}var k=[];for(y=w;y<h.length;y++)k.push("..");return(k=k.concat(p.slice(w))).join("/")},i._makeLong=function(o){return o},i.dirname=function(o){var c=l(o),m=c[0],h=c[1];return m||h?(h&&(h=h.substr(0,h.length-1)),m+h):"."},i.basename=function(o,c){var m=l(o)[2];return c&&m.substr(-1*c.length)===c&&(m=m.substr(0,m.length-c.length)),m},i.extname=function(o){return l(o)[3]},i.format=function(o){if(!r.isObject(o))throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof o);var c=o.root||"";if(!a(c))throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof o.root);return(o.dir?o.dir+i.sep:"")+(o.base||"")},i.parse=function(o){if(!a(o))throw new TypeError("Parameter 'pathString' must be a string, not "+typeof o);var c=l(o);if(!c||c.length!==4)throw new TypeError("Invalid path '"+o+"'");return c[1]=c[1]||"",c[2]=c[2]||"",c[3]=c[3]||"",{root:c[0],dir:c[0]+c[1].slice(0,c[1].length-1),base:c[2],ext:c[3],name:c[2].slice(0,c[2].length-c[3].length)}},i.sep="/",i.delimiter=":",s.exports=i},647:(s,e)=>{var t=Object.prototype.hasOwnProperty;function r(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch(u){return null}}function a(n){try{return encodeURIComponent(n)}catch(u){return null}}e.stringify=function(n,u){u=u||"";var i,l,o=[];for(l in typeof u!="string"&&(u="?"),n)if(t.call(n,l)){if((i=n[l])||i!=null&&!isNaN(i)||(i=""),l=a(l),i=a(i),l===null||i===null)continue;o.push(l+"="+i)}return o.length?u+o.join("&"):""},e.parse=function(n){for(var u,i=/([^=?#&]+)=?([^&]*)/g,l={};u=i.exec(n);){var o=r(u[1]),c=r(u[2]);o===null||c===null||o in l||(l[o]=c)}return l}},670:s=>{s.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}},494:s=>{const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const r={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};s.exports=function(a){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n=Object.assign({},r,n),!a||typeof a!="string")return a;let u=a.trim();if(n.skipLike!==void 0&&n.skipLike.test(u))return a;if(n.hex&&e.test(u))return Number.parseInt(u,16);{const l=t.exec(u);if(l){const o=l[1],c=l[2];let m=((i=l[3])&&i.indexOf(".")!==-1&&((i=i.replace(/0+$/,""))==="."?i="0":i[0]==="."?i="0"+i:i[i.length-1]==="."&&(i=i.substr(0,i.length-1))),i);const h=l[4]||l[6];if(!n.leadingZeros&&c.length>0&&o&&u[2]!=="."||!n.leadingZeros&&c.length>0&&!o&&u[1]!==".")return a;{const p=Number(u),d=""+p;return d.search(/[eE]/)!==-1||h?n.eNotation?p:a:u.indexOf(".")!==-1?d==="0"&&m===""||d===m||o&&d==="-"+m?p:a:c?m===d||o+m===d?p:a:u===d||u===o+d?p:a}}return a}var i}},737:(s,e,t)=>{var r=t(670),a=t(647),n=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,u=/[\n\r\t]/g,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,l=/:\d+$/,o=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,c=/^[a-zA-Z]:/;function m(g){return(g||"").toString().replace(n,"")}var h=[["#","hash"],["?","query"],function(g,b){return w(b.protocol)?g.replace(/\\/g,"/"):g},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function d(g){var b,N=(typeof window<"u"?window:typeof It<"u"?It:typeof self<"u"?self:{}).location||{},S={},C=typeof(g=g||N);if(g.protocol==="blob:")S=new k(unescape(g.pathname),{});else if(C==="string")for(b in S=new k(g,{}),p)delete S[b];else if(C==="object"){for(b in g)b in p||(S[b]=g[b]);S.slashes===void 0&&(S.slashes=i.test(g.href))}return S}function w(g){return g==="file:"||g==="ftp:"||g==="http:"||g==="https:"||g==="ws:"||g==="wss:"}function y(g,b){g=(g=m(g)).replace(u,""),b=b||{};var N,S=o.exec(g),C=S[1]?S[1].toLowerCase():"",x=!!S[2],E=!!S[3],P=0;return x?E?(N=S[2]+S[3]+S[4],P=S[2].length+S[3].length):(N=S[2]+S[4],P=S[2].length):E?(N=S[3]+S[4],P=S[3].length):N=S[4],C==="file:"?P>=2&&(N=N.slice(2)):w(C)?N=S[4]:C?x&&(N=N.slice(2)):P>=2&&w(b.protocol)&&(N=S[4]),{protocol:C,slashes:x||w(C),slashesCount:P,rest:N}}function k(g,b,N){if(g=(g=m(g)).replace(u,""),!(this instanceof k))return new k(g,b,N);var S,C,x,E,P,K,L=h.slice(),U=typeof b,j=this,M=0;for(U!=="object"&&U!=="string"&&(N=b,b=null),N&&typeof N!="function"&&(N=a.parse),S=!(C=y(g||"",b=d(b))).protocol&&!C.slashes,j.slashes=C.slashes||S&&b.slashes,j.protocol=C.protocol||b.protocol||"",g=C.rest,(C.protocol==="file:"&&(C.slashesCount!==2||c.test(g))||!C.slashes&&(C.protocol||C.slashesCount<2||!w(j.protocol)))&&(L[3]=[/(.*)/,"pathname"]);M<L.length;M++)typeof(E=L[M])!="function"?(x=E[0],K=E[1],x!=x?j[K]=g:typeof x=="string"?~(P=x==="@"?g.lastIndexOf(x):g.indexOf(x))&&(typeof E[2]=="number"?(j[K]=g.slice(0,P),g=g.slice(P+E[2])):(j[K]=g.slice(P),g=g.slice(0,P))):(P=x.exec(g))&&(j[K]=P[1],g=g.slice(0,P.index)),j[K]=j[K]||S&&E[3]&&b[K]||"",E[4]&&(j[K]=j[K].toLowerCase())):g=E(g,j);N&&(j.query=N(j.query)),S&&b.slashes&&j.pathname.charAt(0)!=="/"&&(j.pathname!==""||b.pathname!=="")&&(j.pathname=function(G,we){if(G==="")return we;for(var ae=(we||"/").split("/").slice(0,-1).concat(G.split("/")),Y=ae.length,se=ae[Y-1],F=!1,W=0;Y--;)ae[Y]==="."?ae.splice(Y,1):ae[Y]===".."?(ae.splice(Y,1),W++):W&&(Y===0&&(F=!0),ae.splice(Y,1),W--);return F&&ae.unshift(""),se!=="."&&se!==".."||ae.push(""),ae.join("/")}(j.pathname,b.pathname)),j.pathname.charAt(0)!=="/"&&w(j.protocol)&&(j.pathname="/"+j.pathname),r(j.port,j.protocol)||(j.host=j.hostname,j.port=""),j.username=j.password="",j.auth&&(~(P=j.auth.indexOf(":"))?(j.username=j.auth.slice(0,P),j.username=encodeURIComponent(decodeURIComponent(j.username)),j.password=j.auth.slice(P+1),j.password=encodeURIComponent(decodeURIComponent(j.password))):j.username=encodeURIComponent(decodeURIComponent(j.auth)),j.auth=j.password?j.username+":"+j.password:j.username),j.origin=j.protocol!=="file:"&&w(j.protocol)&&j.host?j.protocol+"//"+j.host:"null",j.href=j.toString()}k.prototype={set:function(g,b,N){var S=this;switch(g){case"query":typeof b=="string"&&b.length&&(b=(N||a.parse)(b)),S[g]=b;break;case"port":S[g]=b,r(b,S.protocol)?b&&(S.host=S.hostname+":"+b):(S.host=S.hostname,S[g]="");break;case"hostname":S[g]=b,S.port&&(b+=":"+S.port),S.host=b;break;case"host":S[g]=b,l.test(b)?(b=b.split(":"),S.port=b.pop(),S.hostname=b.join(":")):(S.hostname=b,S.port="");break;case"protocol":S.protocol=b.toLowerCase(),S.slashes=!N;break;case"pathname":case"hash":if(b){var C=g==="pathname"?"/":"#";S[g]=b.charAt(0)!==C?C+b:b}else S[g]=b;break;case"username":case"password":S[g]=encodeURIComponent(b);break;case"auth":var x=b.indexOf(":");~x?(S.username=b.slice(0,x),S.username=encodeURIComponent(decodeURIComponent(S.username)),S.password=b.slice(x+1),S.password=encodeURIComponent(decodeURIComponent(S.password))):S.username=encodeURIComponent(decodeURIComponent(b))}for(var E=0;E<h.length;E++){var P=h[E];P[4]&&(S[P[1]]=S[P[1]].toLowerCase())}return S.auth=S.password?S.username+":"+S.password:S.username,S.origin=S.protocol!=="file:"&&w(S.protocol)&&S.host?S.protocol+"//"+S.host:"null",S.href=S.toString(),S},toString:function(g){g&&typeof g=="function"||(g=a.stringify);var b,N=this,S=N.host,C=N.protocol;C&&C.charAt(C.length-1)!==":"&&(C+=":");var x=C+(N.protocol&&N.slashes||w(N.protocol)?"//":"");return N.username?(x+=N.username,N.password&&(x+=":"+N.password),x+="@"):N.password?(x+=":"+N.password,x+="@"):N.protocol!=="file:"&&w(N.protocol)&&!S&&N.pathname!=="/"&&(x+="@"),(S[S.length-1]===":"||l.test(N.hostname)&&!N.port)&&(S+=":"),x+=S+N.pathname,(b=typeof N.query=="object"?g(N.query):N.query)&&(x+=b.charAt(0)!=="?"?"?"+b:b),N.hash&&(x+=N.hash),x}},k.extractProtocol=y,k.location=d,k.trimLeft=m,k.qs=a,s.exports=k},410:()=>{},388:()=>{},805:()=>{},345:()=>{},800:()=>{}},Td={};function de(s){var e=Td[s];if(e!==void 0)return e.exports;var t=Td[s]={id:s,loaded:!1,exports:{}};return Bw[s].call(t.exports,t,t.exports,de),t.loaded=!0,t.exports}de.n=s=>{var e=s&&s.__esModule?()=>s.default:()=>s;return de.d(e,{a:e}),e},de.d=(s,e)=>{for(var t in e)de.o(e,t)&&!de.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:e[t]})},de.o=(s,e)=>Object.prototype.hasOwnProperty.call(s,e),de.nmd=s=>(s.paths=[],s.children||(s.children=[]),s);var Xt={};de.d(Xt,{hT:()=>vt,O4:()=>Ws,Kd:()=>$w,YK:()=>Kw,UU:()=>Wy,Gu:()=>qp,ky:()=>sg,h4:()=>mc,ch:()=>_h,hq:()=>Ln,i5:()=>rg});var Pw=de(737),Ow=de.n(Pw);function om(s){if(!rf(s))throw new Error("Parameter was not an error")}function rf(s){return!!s&&typeof s=="object"&&(e=s,Object.prototype.toString.call(e)==="[object Error]")||s instanceof Error;var e}class At extends Error{constructor(e,t){const r=[...arguments],{options:a,shortMessage:n}=function(i){let l,o="";if(i.length===0)l={};else if(rf(i[0]))l={cause:i[0]},o=i.slice(1).join(" ")||"";else if(i[0]&&typeof i[0]=="object")l=Object.assign({},i[0]),o=i.slice(1).join(" ")||"";else{if(typeof i[0]!="string")throw new Error("Invalid arguments passed to Layerr");l={},o=o=i.join(" ")||""}return{options:l,shortMessage:o}}(r);let u=n;if(a.cause&&(u="".concat(u,": ").concat(a.cause.message)),super(u),this.message=u,a.name&&typeof a.name=="string"?this.name=a.name:this.name="Layerr",a.cause&&Object.defineProperty(this,"_cause",{value:a.cause}),Object.defineProperty(this,"_info",{value:{}}),a.info&&typeof a.info=="object"&&Object.assign(this._info,a.info),Error.captureStackTrace){const i=a.constructorOpt||this.constructor;Error.captureStackTrace(this,i)}}static cause(e){return om(e),e._cause&&rf(e._cause)?e._cause:null}static fullStack(e){var r;om(e);const t=At.cause(e);return t?"".concat(e.stack,"\ncaused by: ").concat(At.fullStack(t)):(r=e.stack)!=null?r:""}static info(e){om(e);const t={},r=At.cause(e);return r&&Object.assign(t,At.info(r)),e._info&&Object.assign(t,e._info),t}toString(){let e=this.name||this.constructor.name||this.constructor.prototype.name;return this.message&&(e="".concat(e,": ").concat(this.message)),e}}var Dw=de(47),Ih=de.n(Dw);const Rd="__PATH_SEPARATOR_POSIX__",Ld="__PATH_SEPARATOR_WINDOWS__";function Ce(s){try{const e=s.replace(/\//g,Rd).replace(/\\\\/g,Ld);return encodeURIComponent(e).split(Ld).join("\\\\").split(Rd).join("/")}catch(e){throw new At(e,"Failed encoding path")}}function jd(s){return s.startsWith("/")?s:"/"+s}function tc(s){let e=s;return e[0]!=="/"&&(e="/"+e),/^.+\/$/.test(e)&&(e=e.substr(0,e.length-1)),e}function Tw(s){let e=new(Ow())(s).pathname;return e.length<=0&&(e="/"),tc(e)}function xe(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return function(){return function(r){var a=[];if(r.length===0)return"";if(typeof r[0]!="string")throw new TypeError("Url must be a string. Received "+r[0]);if(r[0].match(/^[^/:]+:\/*$/)&&r.length>1){var n=r.shift();r[0]=n+r[0]}r[0].match(/^file:\/\/\//)?r[0]=r[0].replace(/^([^/:]+):\/*/,"$1:///"):r[0]=r[0].replace(/^([^/:]+):\/*/,"$1://");for(var u=0;u<r.length;u++){var i=r[u];if(typeof i!="string")throw new TypeError("Url must be a string. Received "+i);i!==""&&(u>0&&(i=i.replace(/^[\/]+/,"")),i=u<r.length-1?i.replace(/[\/]+$/,""):i.replace(/[\/]+$/,"/"),a.push(i))}var l=a.join("/"),o=(l=l.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o.shift()+(o.length>0?"?":"")+o.join("&")}(typeof arguments[0]=="object"?arguments[0]:[].slice.call(arguments))}(e.reduce((r,a,n)=>((n===0||a!=="/"||a==="/"&&r[r.length-1]!=="/")&&r.push(a),r),[]))}var Rw=de(542),Do=de.n(Rw);const Lw="abcdef0123456789";function Ud(s,e){const t=s.url.replace("//",""),r=t.indexOf("/")==-1?"/":t.slice(t.indexOf("/")),a=s.method?s.method.toUpperCase():"GET",n=!!/(^|,)\s*auth\s*($|,)/.test(e.qop)&&"auth",u="00000000".concat(e.nc).slice(-8),i=function(h,p,d,w,y,k,g){const b=g||Do()("".concat(p,":").concat(d,":").concat(w));return h&&h.toLowerCase()==="md5-sess"?Do()("".concat(b,":").concat(y,":").concat(k)):b}(e.algorithm,e.username,e.realm,e.password,e.nonce,e.cnonce,e.ha1),l=Do()("".concat(a,":").concat(r)),o=n?Do()("".concat(i,":").concat(e.nonce,":").concat(u,":").concat(e.cnonce,":").concat(n,":").concat(l)):Do()("".concat(i,":").concat(e.nonce,":").concat(l)),c={username:e.username,realm:e.realm,nonce:e.nonce,uri:r,qop:n,response:o,nc:u,cnonce:e.cnonce,algorithm:e.algorithm,opaque:e.opaque},m=[];for(const h in c)c[h]&&(h==="qop"||h==="nc"||h==="algorithm"?m.push("".concat(h,"=").concat(c[h])):m.push("".concat(h,'="').concat(c[h],'"')));return"Digest ".concat(m.join(", "))}function Mp(s){return(s.headers&&s.headers.get("www-authenticate")||"").split(/\s/)[0].toLowerCase()==="digest"}var jw=de(101),Fp=de.n(jw);function $d(s){return Fp().decode(s)}function Kd(s,e){var t;return"Basic ".concat((t="".concat(s,":").concat(e),Fp().encode(t)))}const Vh=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:typeof window<"u"?window:globalThis,Uw=Vh.fetch.bind(Vh),$w=Vh.Request,Kw=Vh.Response;let vt=function(s){return s.Auto="auto",s.Digest="digest",s.None="none",s.Password="password",s.Token="token",s}({}),Ws=function(s){return s.DataTypeNoLength="data-type-no-length",s.InvalidAuthType="invalid-auth-type",s.InvalidOutputFormat="invalid-output-format",s.LinkUnsupportedAuthType="link-unsupported-auth",s.InvalidUpdateRange="invalid-update-range",s.NotSupported="not-supported",s}({});function Jp(s,e,t,r,a){switch(s.authType){case vt.Auto:e&&t&&(s.headers.Authorization=Kd(e,t));break;case vt.Digest:s.digest=function(u,i,l){return{username:u,password:i,ha1:l,nc:0,algorithm:"md5",hasDigestAuth:!1}}(e,t,a);break;case vt.None:break;case vt.Password:s.headers.Authorization=Kd(e,t);break;case vt.Token:s.headers.Authorization="".concat((n=r).token_type," ").concat(n.access_token);break;default:throw new At({info:{code:Ws.InvalidAuthType}},"Invalid auth type: ".concat(s.authType))}var n}de(345),de(800);const Hd="@@HOTPATCHER",Hw=()=>{};function um(s){return{original:s,methods:[s],final:!1}}class Mw{constructor(){this._configuration={registry:{},getEmptyAction:"null"},this.__type__=Hd}get configuration(){return this._configuration}get getEmptyAction(){return this.configuration.getEmptyAction}set getEmptyAction(e){this.configuration.getEmptyAction=e}control(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e||e.__type__!==Hd)throw new Error("Failed taking control of target HotPatcher instance: Invalid type or object");return Object.keys(e.configuration.registry).forEach(r=>{this.configuration.registry.hasOwnProperty(r)?t&&(this.configuration.registry[r]=Object.assign({},e.configuration.registry[r])):this.configuration.registry[r]=Object.assign({},e.configuration.registry[r])}),e._configuration=this.configuration,this}execute(e){const t=this.get(e)||Hw;for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return t(...a)}get(e){const t=this.configuration.registry[e];if(!t)switch(this.getEmptyAction){case"null":return null;case"throw":throw new Error("Failed handling method request: No method provided for override: ".concat(e));default:throw new Error("Failed handling request which resulted in an empty method: Invalid empty-action specified: ".concat(this.getEmptyAction))}return function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];if(a.length===0)throw new Error("Failed creating sequence: No functions provided");return function(){for(var u=arguments.length,i=new Array(u),l=0;l<u;l++)i[l]=arguments[l];let o=i;const c=this;for(;a.length>0;)o=[a.shift().apply(c,o)];return o[0]}}(...t.methods)}isPatched(e){return!!this.configuration.registry[e]}patch(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{chain:a=!1}=r;if(this.configuration.registry[e]&&this.configuration.registry[e].final)throw new Error("Failed patching '".concat(e,"': Method marked as being final"));if(typeof t!="function")throw new Error("Failed patching '".concat(e,"': Provided method is not a function"));if(a)this.configuration.registry[e]?this.configuration.registry[e].methods.push(t):this.configuration.registry[e]=um(t);else if(this.isPatched(e)){const{original:n}=this.configuration.registry[e];this.configuration.registry[e]=Object.assign(um(t),{original:n})}else this.configuration.registry[e]=um(t);return this}patchInline(e,t){this.isPatched(e)||this.patch(e,t);for(var r=arguments.length,a=new Array(r>2?r-2:0),n=2;n<r;n++)a[n-2]=arguments[n];return this.execute(e,...a)}plugin(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.forEach(n=>{this.patch(e,n,{chain:!0})}),this}restore(e){if(!this.isPatched(e))throw new Error("Failed restoring method: No method present for key: ".concat(e));if(typeof this.configuration.registry[e].original!="function")throw new Error("Failed restoring method: Original method not found or of invalid type for key: ".concat(e));return this.configuration.registry[e].methods=[this.configuration.registry[e].original],this}setFinal(e){if(!this.configuration.registry.hasOwnProperty(e))throw new Error("Failed marking '".concat(e,"' as final: No method found for key"));return this.configuration.registry[e].final=!0,this}}let lm=null;function qp(){return lm||(lm=new Mw),lm}function Bh(s){return function(e){if(typeof e!="object"||e===null||Object.prototype.toString.call(e)!="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(s)?Object.assign({},s):Object.setPrototypeOf(Object.assign({},s),Object.getPrototypeOf(s))}function Md(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];let r=null,a=[...e];for(;a.length>0;){const n=a.shift();r=r?Wp(r,n):Bh(n)}return r}function Wp(s,e){const t=Bh(s);return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)?Array.isArray(e[r])?t[r]=Array.isArray(t[r])?[...t[r],...e[r]]:[...e[r]]:typeof e[r]=="object"&&e[r]?t[r]=typeof t[r]=="object"&&t[r]?Wp(t[r],e[r]):Bh(e[r]):t[r]=e[r]:t[r]=e[r]}),t}function Fw(s){const e={};for(const t of s.keys())e[t]=s.get(t);return e}function af(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];if(e.length===0)return{};const r={};return e.reduce((a,n)=>(Object.keys(n).forEach(u=>{const i=u.toLowerCase();r.hasOwnProperty(i)?a[r[i]]=n[u]:(r[i]=u,a[u]=n[u])}),a),{})}de(805);const Jw=typeof ArrayBuffer=="function",{toString:qw}=Object.prototype;function Gp(s){return Jw&&(s instanceof ArrayBuffer||qw.call(s)==="[object ArrayBuffer]")}function zp(s){return s!=null&&s.constructor!=null&&typeof s.constructor.isBuffer=="function"&&s.constructor.isBuffer(s)}function Wf(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}function nf(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const _p=Wf(function(s){const e=s._digest;return delete s._digest,e.hasDigestAuth&&(s=Md(s,{headers:{Authorization:Ud(s,e)}})),nf(Ph(s),function(t){let r=!1;return a=function(u){return r?u:t},(n=function(){if(t.status==401)return e.hasDigestAuth=function(u,i){if(!Mp(u))return!1;const l=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/gi;for(;;){const o=u.headers&&u.headers.get("www-authenticate")||"",c=l.exec(o);if(!c)break;i[c[1]]=c[2]||c[3]}return i.nc+=1,i.cnonce=function(){let o="";for(let c=0;c<32;++c)o="".concat(o).concat(Lw[Math.floor(16*Math.random())]);return o}(),!0}(t,e),function(){if(e.hasDigestAuth)return nf(Ph(s=Md(s,{headers:{Authorization:Ud(s,e)}})),function(u){return u.status==401?e.hasDigestAuth=!1:e.nc++,r=!0,u})}();e.nc++}())&&n.then?n.then(a):a(n);var a,n})}),Ww=Wf(function(s,e){return nf(Ph(s),function(t){return t.ok?(e.authType=vt.Password,t):t.status==401&&Mp(t)?(e.authType=vt.Digest,Jp(e,e.username,e.password,void 0,void 0),s._digest=e.digest,_p(s)):t})}),_e=Wf(function(s,e){return e.authType===vt.Auto?Ww(s,e):s._digest?_p(s):Ph(s)});function Xe(s,e,t){const r=Bh(s);return r.headers=af(e.headers,r.headers||{},t.headers||{}),t.data!==void 0&&(r.data=t.data),t.signal&&(r.signal=t.signal),e.httpAgent&&(r.httpAgent=e.httpAgent),e.httpsAgent&&(r.httpsAgent=e.httpsAgent),e.digest&&(r._digest=e.digest),typeof e.withCredentials=="boolean"&&(r.withCredentials=e.withCredentials),r}function Ph(s){const e=qp();return e.patchInline("request",t=>e.patchInline("fetch",Uw,t.url,function(r){let a={};const n={method:r.method};if(r.headers&&(a=af(a,r.headers)),r.data!==void 0){const[u,i]=function(l){if(typeof l=="string")return[l,{}];if(zp(l))return[l,{}];if(Gp(l))return[l,{}];if(l&&typeof l=="object")return[JSON.stringify(l),{"content-type":"application/json"}];throw new Error("Unable to convert request body: Unexpected body type: "+typeof l)}(r.data);n.body=u,a=af(a,i)}return r.signal&&(n.signal=r.signal),r.withCredentials&&(n.credentials="include"),n.headers=a,n}(t)),s)}var Gw=de(285);const Oh=s=>{if(typeof s!="string")throw new TypeError("invalid pattern");if(s.length>65536)throw new TypeError("pattern is too long")},zw={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},To=s=>s.replace(/[[\]\\-]/g,"\\$&"),Fd=s=>s.join(""),_w=(s,e)=>{const t=e;if(s.charAt(t)!=="[")throw new Error("not in a brace expression");const r=[],a=[];let n=t+1,u=!1,i=!1,l=!1,o=!1,c=t,m="";e:for(;n<s.length;){const w=s.charAt(n);if(w!=="!"&&w!=="^"||n!==t+1){if(w==="]"&&u&&!l){c=n+1;break}if(u=!0,w!=="\\"||l){if(w==="["&&!l){for(const[y,[k,g,b]]of Object.entries(zw))if(s.startsWith(y,n)){if(m)return["$.",!1,s.length-t,!0];n+=y.length,b?a.push(k):r.push(k),i=i||g;continue e}}l=!1,m?(w>m?r.push(To(m)+"-"+To(w)):w===m&&r.push(To(w)),m="",n++):s.startsWith("-]",n+1)?(r.push(To(w+"-")),n+=2):s.startsWith("-",n+1)?(m=w,n+=2):(r.push(To(w)),n++)}else l=!0,n++}else o=!0,n++}if(c<n)return["",!1,0,!1];if(!r.length&&!a.length)return["$.",!1,s.length-t,!0];if(a.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!o)return[(h=r[0].length===2?r[0].slice(-1):r[0],h.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),!1,c-t,!1];var h;const p="["+(o?"^":"")+Fd(r)+"]",d="["+(o?"":"^")+Fd(a)+"]";return[r.length&&a.length?"("+p+"|"+d+")":r.length?p:d,i,c-t,!0]},Zo=function(s){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?s.replace(/\[([^\/\\])\]/g,"$1"):s.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1")},Xw=new Set(["!","?","+","*","@"]),Jd=s=>Xw.has(s),cm="(?!\\.)",Zw=new Set(["[","."]),Qw=new Set(["..","."]),Yw=new Set("().*{}+?[]^$\\!"),Gf="[^/]",qd=Gf+"*?",Wd=Gf+"+?";var We,et,Ts,Se,He,zr,Nn,_r,ms,kn,cc,Rn,Xp,oa,Wc,of,Zp;const dt=class dt{constructor(e,t){Ct(this,Rn);ve(this,"type");Ct(this,We);Ct(this,et);Ct(this,Ts,!1);Ct(this,Se,[]);Ct(this,He);Ct(this,zr);Ct(this,Nn);Ct(this,_r,!1);Ct(this,ms);Ct(this,kn);Ct(this,cc,!1);let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.type=e,e&&Pe(this,et,!0),Pe(this,He,t),Pe(this,We,H(this,He)?H(H(this,He),We):this),Pe(this,ms,H(this,We)===this?r:H(H(this,We),ms)),Pe(this,Nn,H(this,We)===this?[]:H(H(this,We),Nn)),e!=="!"||H(H(this,We),_r)||H(this,Nn).push(this),Pe(this,zr,H(this,He)?H(H(this,He),Se).length:0)}get hasMagic(){if(H(this,et)!==void 0)return H(this,et);for(const e of H(this,Se))if(typeof e!="string"&&(e.type||e.hasMagic))return Pe(this,et,!0);return H(this,et)}toString(){return H(this,kn)!==void 0?H(this,kn):this.type?Pe(this,kn,this.type+"("+H(this,Se).map(e=>String(e)).join("|")+")"):Pe(this,kn,H(this,Se).map(e=>String(e)).join(""))}push(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(const a of t)if(a!==""){if(typeof a!="string"&&!(a instanceof dt&&H(a,He)===this))throw new Error("invalid part: "+a);H(this,Se).push(a)}}toJSON(){var t;const e=this.type===null?H(this,Se).slice().map(r=>typeof r=="string"?r:r.toJSON()):[this.type,...H(this,Se).map(r=>r.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===H(this,We)||H(H(this,We),_r)&&((t=H(this,He))==null?void 0:t.type)==="!")&&e.push({}),e}isStart(){var t;if(H(this,We)===this)return!0;if(!((t=H(this,He))!=null&&t.isStart()))return!1;if(H(this,zr)===0)return!0;const e=H(this,He);for(let r=0;r<H(this,zr);r++){const a=H(e,Se)[r];if(!(a instanceof dt&&a.type==="!"))return!1}return!0}isEnd(){var t,r,a;if(H(this,We)===this||((t=H(this,He))==null?void 0:t.type)==="!")return!0;if(!((r=H(this,He))!=null&&r.isEnd()))return!1;if(!this.type)return(a=H(this,He))==null?void 0:a.isEnd();const e=H(this,He)?H(H(this,He),Se).length:0;return H(this,zr)===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){const t=new dt(this.type,e);for(const r of H(this,Se))t.copyIn(r);return t}static fromGlob(e){var a;let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=new dt(null,void 0,t);return Xs(a=dt,oa,Wc).call(a,e,r,0,t),r}toMMPattern(){if(this!==H(this,We))return H(this,We).toMMPattern();const e=this.toString(),[t,r,a,n]=this.toRegExpSource();if(!(a||H(this,et)||H(this,ms).nocase&&!H(this,ms).nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return r;const u=(H(this,ms).nocase?"i":"")+(n?"u":"");return Object.assign(new RegExp("^".concat(t,"$"),u),{_src:t,_glob:e})}get options(){return H(this,ms)}toRegExpSource(e){var l;const t=e!=null?e:!!H(this,ms).dot;if(H(this,We)===this&&Xs(this,Rn,Xp).call(this),!this.type){const o=this.isStart()&&this.isEnd(),c=H(this,Se).map(p=>{var g;const[d,w,y,k]=typeof p=="string"?Xs(g=dt,oa,Zp).call(g,p,H(this,et),o):p.toRegExpSource(e);return Pe(this,et,H(this,et)||y),Pe(this,Ts,H(this,Ts)||k),d}).join("");let m="";if(this.isStart()&&typeof H(this,Se)[0]=="string"&&(H(this,Se).length!==1||!Qw.has(H(this,Se)[0]))){const p=Zw,d=t&&p.has(c.charAt(0))||c.startsWith("\\.")&&p.has(c.charAt(2))||c.startsWith("\\.\\.")&&p.has(c.charAt(4)),w=!t&&!e&&p.has(c.charAt(0));m=d?"(?!(?:^|/)\\.\\.?(?:$|/))":w?cm:""}let h="";return this.isEnd()&&H(H(this,We),_r)&&((l=H(this,He))==null?void 0:l.type)==="!"&&(h="(?:$|\\/)"),[m+c+h,Zo(c),Pe(this,et,!!H(this,et)),H(this,Ts)]}const r=this.type==="*"||this.type==="+",a=this.type==="!"?"(?:(?!(?:":"(?:";let n=Xs(this,Rn,of).call(this,t);if(this.isStart()&&this.isEnd()&&!n&&this.type!=="!"){const o=this.toString();return Pe(this,Se,[o]),this.type=null,Pe(this,et,void 0),[o,Zo(this.toString()),!1,!1]}let u=!r||e||t?"":Xs(this,Rn,of).call(this,!0);u===n&&(u=""),u&&(n="(?:".concat(n,")(?:").concat(u,")*?"));let i="";return i=this.type==="!"&&H(this,cc)?(this.isStart()&&!t?cm:"")+Wd:a+n+(this.type==="!"?"))"+(!this.isStart()||t||e?"":cm)+qd+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&u?")":this.type==="*"&&u?")?":")".concat(this.type)),[i,Zo(n),Pe(this,et,!!H(this,et)),H(this,Ts)]}};We=new WeakMap,et=new WeakMap,Ts=new WeakMap,Se=new WeakMap,He=new WeakMap,zr=new WeakMap,Nn=new WeakMap,_r=new WeakMap,ms=new WeakMap,kn=new WeakMap,cc=new WeakMap,Rn=new WeakSet,Xp=function(){if(this!==H(this,We))throw new Error("should only call on root");if(H(this,_r))return this;let e;for(this.toString(),Pe(this,_r,!0);e=H(this,Nn).pop();){if(e.type!=="!")continue;let t=e,r=H(t,He);for(;r;){for(let a=H(t,zr)+1;!r.type&&a<H(r,Se).length;a++)for(const n of H(e,Se)){if(typeof n=="string")throw new Error("string part in extglob AST??");n.copyIn(H(r,Se)[a])}t=r,r=H(t,He)}}return this},oa=new WeakSet,Wc=function(e,t,r,a){var p,d;let n=!1,u=!1,i=-1,l=!1;if(t.type===null){let w=r,y="";for(;w<e.length;){const k=e.charAt(w++);if(n||k==="\\")n=!n,y+=k;else if(u)w===i+1?k!=="^"&&k!=="!"||(l=!0):k!=="]"||w===i+2&&l||(u=!1),y+=k;else if(k!=="[")if(a.noext||!Jd(k)||e.charAt(w)!=="(")y+=k;else{t.push(y),y="";const g=new dt(k,t);w=Xs(p=dt,oa,Wc).call(p,e,g,w,a),t.push(g)}else u=!0,i=w,l=!1,y+=k}return t.push(y),w}let o=r+1,c=new dt(null,t);const m=[];let h="";for(;o<e.length;){const w=e.charAt(o++);if(n||w==="\\")n=!n,h+=w;else if(u)o===i+1?w!=="^"&&w!=="!"||(l=!0):w!=="]"||o===i+2&&l||(u=!1),h+=w;else if(w!=="[")if(Jd(w)&&e.charAt(o)==="("){c.push(h),h="";const y=new dt(w,c);c.push(y),o=Xs(d=dt,oa,Wc).call(d,e,y,o,a)}else if(w!=="|"){if(w===")")return h===""&&H(t,Se).length===0&&Pe(t,cc,!0),c.push(h),h="",t.push(...m,c),o;h+=w}else c.push(h),h="",m.push(c),c=new dt(null,t);else u=!0,i=o,l=!1,h+=w}return t.type=null,Pe(t,et,void 0),Pe(t,Se,[e.substring(r-1)]),o},of=function(e){return H(this,Se).map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");const[r,a,n,u]=t.toRegExpSource(e);return Pe(this,Ts,H(this,Ts)||u),r}).filter(t=>!(this.isStart()&&this.isEnd()&&!t)).join("|")},Zp=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=!1,n="",u=!1;for(let i=0;i<e.length;i++){const l=e.charAt(i);if(a)a=!1,n+=(Yw.has(l)?"\\":"")+l;else if(l!=="\\"){if(l==="["){const[o,c,m,h]=_w(e,i);if(m){n+=o,u=u||c,i+=m-1,t=t||h;continue}}l!=="*"?l!=="?"?n+=l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):(n+=Gf,t=!0):(n+=r&&e==="*"?Wd:qd,t=!0)}else i===e.length-1?n+="\\\\":a=!0}return[n,Zo(e),!!t,u]},Ct(dt,oa);let Dh=dt;const mt=function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Oh(e),!(!t.nocomment&&e.charAt(0)==="#")&&new Th(e,t).match(s)},ey=/^\*+([^+@!?\*\[\(]*)$/,ty=s=>e=>!e.startsWith(".")&&e.endsWith(s),sy=s=>e=>e.endsWith(s),ry=s=>(s=s.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(s)),ay=s=>(s=s.toLowerCase(),e=>e.toLowerCase().endsWith(s)),ny=/^\*+\.\*+$/,iy=s=>!s.startsWith(".")&&s.includes("."),oy=s=>s!=="."&&s!==".."&&s.includes("."),uy=/^\.\*+$/,ly=s=>s!=="."&&s!==".."&&s.startsWith("."),cy=/^\*+$/,hy=s=>s.length!==0&&!s.startsWith("."),my=s=>s.length!==0&&s!=="."&&s!=="..",fy=/^\?+([^+@!?\*\[\(]*)?$/,dy=s=>{let[e,t=""]=s;const r=Qp([e]);return t?(t=t.toLowerCase(),a=>r(a)&&a.toLowerCase().endsWith(t)):r},py=s=>{let[e,t=""]=s;const r=Yp([e]);return t?(t=t.toLowerCase(),a=>r(a)&&a.toLowerCase().endsWith(t)):r},gy=s=>{let[e,t=""]=s;const r=Yp([e]);return t?a=>r(a)&&a.endsWith(t):r},wy=s=>{let[e,t=""]=s;const r=Qp([e]);return t?a=>r(a)&&a.endsWith(t):r},Qp=s=>{let[e]=s;const t=e.length;return r=>r.length===t&&!r.startsWith(".")},Yp=s=>{let[e]=s;const t=e.length;return r=>r.length===t&&r!=="."&&r!==".."},eg=typeof Ge=="object"&&Ge?typeof im=="object"&&im&&im.__MINIMATCH_TESTING_PLATFORM__||Ge.platform:"posix";mt.sep=eg==="win32"?"\\":"/";const Kt=Symbol("globstar **");mt.GLOBSTAR=Kt,mt.filter=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return t=>mt(t,s,e)};const Ut=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.assign({},s,e)};mt.defaults=s=>{if(!s||typeof s!="object"||!Object.keys(s).length)return mt;const e=mt;return Object.assign(function(t,r){return e(t,r,Ut(s,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))},{Minimatch:class extends e.Minimatch{constructor(t){super(t,Ut(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}))}static defaults(t){return e.defaults(Ut(s,t)).Minimatch}},AST:class extends e.AST{constructor(t,r){super(t,r,Ut(s,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}))}static fromGlob(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.AST.fromGlob(t,Ut(s,r))}},unescape:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.unescape(t,Ut(s,r))},escape:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.escape(t,Ut(s,r))},filter:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.filter(t,Ut(s,r))},defaults:t=>e.defaults(Ut(s,t)),makeRe:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.makeRe(t,Ut(s,r))},braceExpand:function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e.braceExpand(t,Ut(s,r))},match:function(t,r){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return e.match(t,r,Ut(s,a))},sep:e.sep,GLOBSTAR:Kt})};const tg=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Oh(s),e.nobrace||!/\{(?:(?!\{).)*\}/.test(s)?[s]:Gw(s)};mt.braceExpand=tg,mt.makeRe=function(s){return new Th(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).makeRe()},mt.match=function(s,e){const t=new Th(e,arguments.length>2&&arguments[2]!==void 0?arguments[2]:{});return s=s.filter(r=>t.match(r)),t.options.nonull&&!s.length&&s.push(e),s};const Gd=/[?*]|[+@!]\(.*?\)|\[|\]/;class Th{constructor(e){ve(this,"options");ve(this,"set");ve(this,"pattern");ve(this,"windowsPathsNoEscape");ve(this,"nonegate");ve(this,"negate");ve(this,"comment");ve(this,"empty");ve(this,"preserveMultipleSlashes");ve(this,"partial");ve(this,"globSet");ve(this,"globParts");ve(this,"nocase");ve(this,"isWindows");ve(this,"platform");ve(this,"windowsNoMagicRoot");ve(this,"regexp");let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Oh(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||eg,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!(!this.isWindows||!this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(const e of this.set)for(const t of e)if(typeof t!="string")return!0;return!1}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#")return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=function(){return console.error(...arguments)}),this.debug(this.pattern,this.globSet);const r=this.globSet.map(n=>this.slashSplit(n));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let a=this.globParts.map((n,u,i)=>{if(this.isWindows&&this.windowsNoMagicRoot){const l=!(n[0]!==""||n[1]!==""||n[2]!=="?"&&Gd.test(n[2])||Gd.test(n[3])),o=/^[a-z]:/i.test(n[0]);if(l)return[...n.slice(0,4),...n.slice(4).map(c=>this.parse(c))];if(o)return[n[0],...n.slice(1).map(c=>this.parse(c))]}return n.map(l=>this.parse(l))});if(this.debug(this.pattern,a),this.set=a.filter(n=>n.indexOf(!1)===-1),this.isWindows)for(let n=0;n<this.set.length;n++){const u=this.set[n];u[0]===""&&u[1]===""&&this.globParts[n][2]==="?"&&typeof u[3]=="string"&&/^[a-z]:$/i.test(u[3])&&(u[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let a=0;a<e[r].length;a++)e[r][a]==="**"&&(e[r][a]="*");const{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):e=t>=1?this.levelOneOptimize(e):this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let r=-1;for(;(r=t.indexOf("**",r+1))!==-1;){let a=r;for(;t[a+1]==="**";)a++;a!==r&&t.splice(r,a-r)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((r,a)=>{const n=r[r.length-1];return a==="**"&&n==="**"?r:a===".."&&n&&n!==".."&&n!=="."&&n!=="**"?(r.pop(),r):(r.push(a),r)},[])).length===0?[""]:t)}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let a=1;a<e.length-1;a++){const n=e[a];a===1&&n===""&&e[0]===""||n!=="."&&n!==""||(t=!0,e.splice(a,1),a--)}e[0]!=="."||e.length!==2||e[1]!=="."&&e[1]!==""||(t=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){const a=e[r-1];a&&a!=="."&&a!==".."&&a!=="**"&&(t=!0,e.splice(r-1,2),r-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let r of e){let a=-1;for(;(a=r.indexOf("**",a+1))!==-1;){let u=a;for(;r[u+1]==="**";)u++;u>a&&r.splice(a+1,u-a);let i=r[a+1];const l=r[a+2],o=r[a+3];if(i!==".."||!l||l==="."||l===".."||!o||o==="."||o==="..")continue;t=!0,r.splice(a,1);const c=r.slice(0);c[a]="**",e.push(c),a--}if(!this.preserveMultipleSlashes){for(let u=1;u<r.length-1;u++){const i=r[u];u===1&&i===""&&r[0]===""||i!=="."&&i!==""||(t=!0,r.splice(u,1),u--)}r[0]!=="."||r.length!==2||r[1]!=="."&&r[1]!==""||(t=!0,r.pop())}let n=0;for(;(n=r.indexOf("..",n+1))!==-1;){const u=r[n-1];if(u&&u!=="."&&u!==".."&&u!=="**"){t=!0;const i=n===1&&r[n+1]==="**"?["."]:[];r.splice(n-1,2,...i),r.length===0&&r.push(""),n-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){const a=this.partsMatch(e[t],e[r],!this.preserveMultipleSlashes);if(a){e[t]=[],e[r]=a;break}}return e.filter(t=>t.length)}partsMatch(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],a=0,n=0,u=[],i="";for(;a<e.length&&n<t.length;)if(e[a]===t[n])u.push(i==="b"?t[n]:e[a]),a++,n++;else if(r&&e[a]==="**"&&t[n]===e[a+1])u.push(e[a]),a++;else if(r&&t[n]==="**"&&e[a]===t[n+1])u.push(t[n]),n++;else if(e[a]!=="*"||!t[n]||!this.options.dot&&t[n].startsWith(".")||t[n]==="**"){if(t[n]!=="*"||!e[a]||!this.options.dot&&e[a].startsWith(".")||e[a]==="**"||i==="a")return!1;i="b",u.push(t[n]),a++,n++}else{if(i==="b")return!1;i="a",u.push(e[a]),a++,n++}return e.length===t.length&&u}parseNegate(){if(this.nonegate)return;const e=this.pattern;let t=!1,r=0;for(let a=0;a<e.length&&e.charAt(a)==="!";a++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const a=this.options;if(this.isWindows){const w=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),y=!w&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),k=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),g=y?3:w?0:void 0,b=!k&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3])?3:k?0:void 0;if(typeof g=="number"&&typeof b=="number"){const[N,S]=[e[g],t[b]];N.toLowerCase()===S.toLowerCase()&&(t[b]=N,b>g?t=t.slice(b):g>b&&(e=e.slice(g)))}}const{optimizationLevel:n=1}=this.options;n>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var u=0,i=0,l=e.length,o=t.length;u<l&&i<o;u++,i++){this.debug("matchOne loop");var c=t[i],m=e[u];if(this.debug(t,c,m),c===!1)return!1;if(c===Kt){this.debug("GLOBSTAR",[t,c,m]);var h=u,p=i+1;if(p===o){for(this.debug("** at the end");u<l;u++)if(e[u]==="."||e[u]===".."||!a.dot&&e[u].charAt(0)===".")return!1;return!0}for(;h<l;){var d=e[h];if(this.debug("\nglobstar while",e,h,t,p,d),this.matchOne(e.slice(h),t.slice(p),r))return this.debug("globstar found match!",h,l,d),!0;if(d==="."||d===".."||!a.dot&&d.charAt(0)==="."){this.debug("dot detected!",e,h,t,p);break}this.debug("globstar swallow a segment, and continue"),h++}return!(!r||(this.debug("\n>>> no match, partial?",e,h,t,p),h!==l))}let w;if(typeof c=="string"?(w=m===c,this.debug("string match",c,m,w)):(w=c.test(m),this.debug("pattern match",c,m,w)),!w)return!1}if(u===l&&i===o)return!0;if(u===l)return r;if(i===o)return u===l-1&&e[u]==="";throw new Error("wtf?")}braceExpand(){return tg(this.pattern,this.options)}parse(e){Oh(e);const t=this.options;if(e==="**")return Kt;if(e==="")return"";let r,a=null;(r=e.match(cy))?a=t.dot?my:hy:(r=e.match(ey))?a=(t.nocase?t.dot?ay:ry:t.dot?sy:ty)(r[1]):(r=e.match(fy))?a=(t.nocase?t.dot?py:dy:t.dot?gy:wy)(r):(r=e.match(ny))?a=t.dot?oy:iy:(r=e.match(uy))&&(a=ly);const n=Dh.fromGlob(e,this.options).toMMPattern();return a&&typeof n=="object"&&Reflect.defineProperty(n,"test",{value:a}),n}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",a=new Set(t.nocase?["i"]:[]);let n=e.map(l=>{const o=l.map(c=>{if(c instanceof RegExp)for(const m of c.flags.split(""))a.add(m);return typeof c=="string"?c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):c===Kt?Kt:c._src});return o.forEach((c,m)=>{const h=o[m+1],p=o[m-1];c===Kt&&p!==Kt&&(p===void 0?h!==void 0&&h!==Kt?o[m+1]="(?:\\/|"+r+"\\/)?"+h:o[m]=r:h===void 0?o[m-1]=p+"(?:\\/|"+r+")?":h!==Kt&&(o[m-1]=p+"(?:\\/|\\/"+r+"\\/)"+h,o[m+1]=Kt))}),o.filter(c=>c!==Kt).join("/")}).join("|");const[u,i]=e.length>1?["(?:",")"]:["",""];n="^"+u+n+i+"$",this.negate&&(n="^(?!"+n+").+$");try{this.regexp=new RegExp(n,[...a].join(""))}catch(l){this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.partial;if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;const r=this.options;this.isWindows&&(e=e.split("\\").join("/"));const a=this.slashSplit(e);this.debug(this.pattern,"split",a);const n=this.set;this.debug(this.pattern,"set",n);let u=a[a.length-1];if(!u)for(let i=a.length-2;!u&&i>=0;i--)u=a[i];for(let i=0;i<n.length;i++){const l=n[i];let o=a;if(r.matchBase&&l.length===1&&(o=[u]),this.matchOne(o,l,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}static defaults(e){return mt.defaults(e).Minimatch}}function zf(s){const e=new Error("".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"","Invalid response: ").concat(s.status," ").concat(s.statusText));return e.status=s.status,e.response=s,e}function Ze(s,e){const{status:t}=e;if(t===401&&s.digest)return e;if(t>=400)throw zf(e);return e}function Ln(s,e){return arguments.length>2&&arguments[2]!==void 0&&arguments[2]?{data:e,headers:s.headers?Fw(s.headers):{},status:s.status,statusText:s.statusText}:e}mt.AST=Dh,mt.Minimatch=Th,mt.escape=function(s){let{windowsPathsNoEscape:e=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return e?s.replace(/[?*()[\]]/g,"[$&]"):s.replace(/[?*()[\]\\]/g,"\\$&")},mt.unescape=Zo;const yy=(zd=function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=Xe({url:xe(s.remoteURL,Ce(e)),method:"COPY",headers:{Destination:xe(s.remoteURL,Ce(t)),Overwrite:r.overwrite===!1?"F":"T",Depth:r.shallow?"0":"infinity"}},s,r);return u=function(i){Ze(s,i)},(n=_e(a,s))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u},function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];try{return Promise.resolve(zd.apply(this,s))}catch(t){return Promise.reject(t)}});var zd,_f=de(635),vy=de(829),Ds=de.n(vy),fo=function(s){return s.Array="array",s.Object="object",s.Original="original",s}(fo||{});function gc(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:fo.Original;const r=Ds().get(s,e);return t==="array"&&Array.isArray(r)===!1?[r]:t==="object"&&Array.isArray(r)?r[0]:r}function mc(s){return new Promise(e=>{e(function(t){const{multistatus:r}=t;if(r==="")return{multistatus:{response:[]}};if(!r)throw new Error("Invalid response: No root multistatus found");const a={multistatus:Array.isArray(r)?r[0]:r};return Ds().set(a,"multistatus.response",gc(a,"multistatus.response",fo.Array)),Ds().set(a,"multistatus.response",Ds().get(a,"multistatus.response").map(n=>function(u){const i=Object.assign({},u);return i.status?Ds().set(i,"status",gc(i,"status",fo.Object)):(Ds().set(i,"propstat",gc(i,"propstat",fo.Object)),Ds().set(i,"propstat.prop",gc(i,"propstat.prop",fo.Object))),i}(n))),a}(new _f.XMLParser({removeNSPrefix:!0,numberParseOptions:{hex:!0,leadingZeros:!1}}).parse(s)))})}function _h(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const{getlastmodified:r=null,getcontentlength:a="0",resourcetype:n=null,getcontenttype:u=null,getetag:i=null}=s,l=n&&typeof n=="object"&&n.collection!==void 0?"directory":"file",o={filename:e,basename:Ih().basename(e),lastmod:r,size:parseInt(a,10),type:l,etag:typeof i=="string"?i.replace(/"/g,""):null};return l==="file"&&(o.mime=u&&typeof u=="string"?u.split(";")[0]:""),t&&(s.displayname!==void 0&&(s.displayname=String(s.displayname)),o.props=s),o}function sg(s,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2],r=null;try{s.multistatus.response[0].propstat&&(r=s.multistatus.response[0])}catch(c){}if(!r)throw new Error("Failed getting item stat: bad response");const{propstat:{prop:a,status:n}}=r,[u,i,l]=n.split(" ",3),o=parseInt(i,10);if(o>=400){const c=new Error("Invalid response: ".concat(o," ").concat(l));throw c.status=o,c}return _h(a,tc(e),t)}function rg(s){switch(String(s)){case"-3":return"unlimited";case"-2":case"-1":return"unknown";default:return parseInt(String(s),10)}}function hm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Xf=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:r=!1}=t,a=Xe({url:xe(s.remoteURL,Ce(e)),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},s,t);return hm(_e(a,s),function(n){return Ze(s,n),hm(n.text(),function(u){return hm(mc(u),function(i){const l=sg(i,e,r);return Ln(n,l,r)})})})});function ag(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const by=ng(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=function(n){if(!n||n==="/")return[];let u=n;const i=[];do i.push(u),u=Ih().dirname(u);while(u&&u!=="/");return i}(tc(e));r.sort((n,u)=>n.length>u.length?1:u.length>n.length?-1:0);let a=!1;return function(n,u,i){if(typeof n[Xd]=="function"){let w=function(y){try{for(;!(l=m.next()).done;)if((y=u(l.value))&&y.then){if(!Zd(y))return void y.then(w,c||(c=bt.bind(null,o=new po,2)));y=y.v}o?bt(o,1,y):o=y}catch(k){bt(o||(o=new po),2,k)}};var l,o,c,m=n[Xd]();if(w(),m.return){var h=function(y){try{l.done||m.return()}catch(k){}return y};if(o&&o.then)return o.then(h,function(y){throw h(y)});h()}return o}if(!("length"in n))throw new TypeError("Object is not iterable");for(var p=[],d=0;d<n.length;d++)p.push(n[d]);return function(w,y,k){var g,b,N=-1;return function S(C){try{for(;++N<w.length&&(!k||!k());)if((C=y(N))&&C.then){if(!Zd(C))return void C.then(S,b||(b=bt.bind(null,g=new po,2)));C=C.v}g?bt(g,1,C):g=C}catch(x){bt(g||(g=new po),2,x)}}(),g}(p,function(w){return u(p[w])},i)}(r,function(n){return u=function(){return function(l,o){try{var c=ag(Xf(s,n),function(m){if(m.type!=="directory")throw new Error("Path includes a file: ".concat(e))})}catch(m){return o(m)}return c&&c.then?c.then(void 0,o):c}(0,function(l){const o=l;return function(){if(o.status===404)return a=!0,_d(uf(s,n,Et(Qe({},t),{recursive:!1})));throw l}()})},(i=function(){if(a)return _d(uf(s,n,Et(Qe({},t),{recursive:!1})))}())&&i.then?i.then(u):u();var u,i},function(){return!1})});function ng(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}function Sy(){}function _d(s,e){return s&&s.then?s.then(Sy):Promise.resolve()}const Xd=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function bt(s,e,t){if(!s.s){if(t instanceof po){if(!t.s)return void(t.o=bt.bind(null,s,e));1&e&&(e=t.s),t=t.v}if(t&&t.then)return void t.then(bt.bind(null,s,e),bt.bind(null,s,2));s.s=e,s.v=t;const r=s.o;r&&r(s)}}const po=function(){function s(){}return s.prototype.then=function(e,t){const r=new s,a=this.s;if(a){const n=1&a?e:t;if(n){try{bt(r,1,n(this.v))}catch(u){bt(r,2,u)}return r}return this}return this.o=function(n){try{const u=n.v;1&n.s?bt(r,1,e?e(u):u):t?bt(r,1,t(u)):bt(r,2,u)}catch(u){bt(r,2,u)}},r},s}();function Zd(s){return s instanceof po&&1&s.s}const uf=ng(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t.recursive===!0)return by(s,e,t);const r=Xe({url:xe(s.remoteURL,(a=Ce(e),a.endsWith("/")?a:a+"/")),method:"MKCOL"},s,t);var a;return ag(_e(r,s),function(n){Ze(s,n)})});var Ay=de(388),Qd=de.n(Ay);const Ny=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r={};if(typeof t.range=="object"&&typeof t.range.start=="number"){let i="bytes=".concat(t.range.start,"-");typeof t.range.end=="number"&&(i="".concat(i).concat(t.range.end)),r.Range=i}const a=Xe({url:xe(s.remoteURL,Ce(e)),method:"GET",headers:r},s,t);return u=function(i){if(Ze(s,i),r.Range&&i.status!==206){const l=new Error("Invalid response code for partial request: ".concat(i.status));throw l.status=i.status,l}return t.callback&&setTimeout(()=>{t.callback(i)},0),i.body},(n=_e(a,s))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u}),ky=()=>{},Ey=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){t.url||(t.url=xe(s.remoteURL,Ce(e)));const r=Xe(t,s,{});return n=function(u){return Ze(s,u),u},(a=_e(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),Cy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xe({url:xe(s.remoteURL,Ce(e)),method:"DELETE"},s,t);return n=function(u){Ze(s,u)},(a=_e(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n}),xy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function(r,a){try{var n=(u=Xf(s,e,t),i=function(){return!0},l?i?i(u):u:(u&&u.then||(u=Promise.resolve(u)),i?u.then(i):u))}catch(o){return a(o)}var u,i,l;return n&&n.then?n.then(void 0,a):n}(0,function(r){if(r.status===404)return!1;throw r})});function mm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Iy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xe({url:xe(s.remoteURL,Ce(e),"/"),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:t.deep?"infinity":"1"}},s,t);return mm(_e(r,s),function(a){return Ze(s,a),mm(a.text(),function(n){if(!n)throw new Error("Failed parsing directory contents: Empty response");return mm(mc(n),function(u){const i=jd(e);let l=function(o,c,m){let h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],p=arguments.length>4&&arguments[4]!==void 0&&arguments[4];const d=Ih().join(c,"/"),{multistatus:{response:w}}=o,y=w.map(k=>{const g=function(N){try{return N.replace(/^https?:\/\/[^\/]+/,"")}catch(S){throw new At(S,"Failed normalising HREF")}}(k.href),{propstat:{prop:b}}=k;return _h(b,d==="/"?decodeURIComponent(tc(g)):tc(Ih().relative(decodeURIComponent(d),decodeURIComponent(g))),h)});return p?y:y.filter(k=>k.basename&&(k.type==="file"||k.filename!==m.replace(/\/$/,"")))}(u,jd(s.remoteBasePath||s.remotePath),i,t.details,t.includeSelf);return t.glob&&(l=function(o,c){return o.filter(m=>mt(m.filename,c,{matchBase:!0}))}(l,t.glob)),Ln(a,l,t.details)})})})});function Zf(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}const Vy=Zf(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xe({url:xe(s.remoteURL,Ce(e)),method:"GET",headers:{Accept:"text/plain"},transformResponse:[Oy]},s,t);return Rh(_e(r,s),function(a){return Ze(s,a),Rh(a.text(),function(n){return Ln(a,n,t.details)})})});function Rh(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const By=Zf(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xe({url:xe(s.remoteURL,Ce(e)),method:"GET"},s,t);return Rh(_e(r,s),function(a){let n;return Ze(s,a),function(u,i){var l=u();return l&&l.then?l.then(i):i()}(function(){return Rh(a.arrayBuffer(),function(u){n=u})},function(){return Ln(a,n,t.details)})})}),Py=Zf(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{format:r="binary"}=t;if(r!=="binary"&&r!=="text")throw new At({info:{code:Ws.InvalidOutputFormat}},"Invalid output format: ".concat(r));return r==="text"?Vy(s,e,t):By(s,e,t)}),Oy=s=>s;function Dy(s){return new _f.XMLBuilder({attributeNamePrefix:"@_",format:!0,ignoreAttributes:!1,suppressEmptyNode:!0}).build(ig({lockinfo:{"@_xmlns:d":"DAV:",lockscope:{exclusive:{}},locktype:{write:{}},owner:{href:s}}},"d"))}function ig(s,e){const t=Qe({},s);for(const r in t)t.hasOwnProperty(r)&&(t[r]&&typeof t[r]=="object"&&r.indexOf(":")===-1?(t["".concat(e,":").concat(r)]=ig(t[r],e),delete t[r]):/^@_/.test(r)===!1&&(t["".concat(e,":").concat(r)]=t[r],delete t[r]));return t}function lf(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}function og(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}const Ty=og(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=Xe({url:xe(s.remoteURL,Ce(e)),method:"UNLOCK",headers:{"Lock-Token":t}},s,r);return lf(_e(a,s),function(n){if(Ze(s,n),n.status!==204&&n.status!==200)throw zf(n)})}),Ry=og(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{refreshToken:r,timeout:a=Ly}=t,n={Accept:"text/plain,application/xml",Timeout:a};r&&(n.If=r);const u=Xe({url:xe(s.remoteURL,Ce(e)),method:"LOCK",headers:n,data:Dy(s.contactHref)},s,t);return lf(_e(u,s),function(i){return Ze(s,i),lf(i.text(),function(l){const o=(h=l,new _f.XMLParser({removeNSPrefix:!0,parseAttributeValue:!0,parseTagValue:!0}).parse(h)),c=Ds().get(o,"prop.lockdiscovery.activelock.locktoken.href"),m=Ds().get(o,"prop.lockdiscovery.activelock.timeout");var h;if(!c)throw zf(i,"No lock token received: ");return{token:c,serverTimeout:m}})})}),Ly="Infinite, Second-4100000000";function fm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const jy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const t=e.path||"/",r=Xe({url:xe(s.remoteURL,t),method:"PROPFIND",headers:{Accept:"text/plain,application/xml",Depth:"0"}},s,e);return fm(_e(r,s),function(a){return Ze(s,a),fm(a.text(),function(n){return fm(mc(n),function(u){const i=function(l){try{const[o]=l.multistatus.response,{propstat:{prop:{"quota-used-bytes":c,"quota-available-bytes":m}}}=o;return c!==void 0&&m!==void 0?{used:parseInt(String(c),10),available:rg(m)}:null}catch(o){}return null}(u);return Ln(a,i,e.details)})})})});function dm(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const Uy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{details:r=!1}=t,a=Xe({url:xe(s.remoteURL,Ce(e)),method:"SEARCH",headers:{Accept:"text/plain,application/xml","Content-Type":s.headers["Content-Type"]||"application/xml; charset=utf-8"}},s,t);return dm(_e(a,s),function(n){return Ze(s,n),dm(n.text(),function(u){return dm(mc(u),function(i){const l=function(o,c,m){const h={truncated:!1,results:[]};return h.truncated=o.multistatus.response.some(p=>{var d,w;return((w=(p.status||((d=p.propstat)==null?void 0:d.status)).split(" ",3))==null?void 0:w[1])==="507"&&p.href.replace(/\/$/,"").endsWith(Ce(c).replace(/\/$/,""))}),o.multistatus.response.forEach(p=>{if(p.propstat===void 0)return;const d=p.href.split("/").map(decodeURIComponent).join("/");h.results.push(_h(p.propstat.prop,d,m))}),h}(i,e,r);return Ln(n,l,r)})})})}),$y=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const a=Xe({url:xe(s.remoteURL,Ce(e)),method:"MOVE",headers:{Destination:xe(s.remoteURL,Ce(t)),Overwrite:r.overwrite===!1?"F":"T"}},s,r);return u=function(i){Ze(s,i)},(n=_e(a,s))&&n.then||(n=Promise.resolve(n)),u?n.then(u):n;var n,u});var Ky=de(172);const Hy=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const{contentLength:a=!0,overwrite:n=!0}=r,u={"Content-Type":"application/octet-stream"};a===!1||(u["Content-Length"]=typeof a=="number"?"".concat(a):"".concat(function(c){if(Gp(c))return c.byteLength;if(zp(c))return c.length;if(typeof c=="string")return(0,Ky.d)(c);throw new At({info:{code:Ws.DataTypeNoLength}},"Cannot calculate data length: Invalid type")}(t))),n||(u["If-None-Match"]="*");const i=Xe({url:xe(s.remoteURL,Ce(e)),method:"PUT",headers:u,data:t},s,r);return o=function(c){try{Ze(s,c)}catch(m){const h=m;if(h.status!==412||n)throw h;return!1}return!0},(l=_e(i,s))&&l.then||(l=Promise.resolve(l)),o?l.then(o):l;var l,o}),ug=function(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}(function(s,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=Xe({url:xe(s.remoteURL,Ce(e)),method:"OPTIONS"},s,t);return n=function(u){var i,l;try{Ze(s,u)}catch(o){throw o}return{compliance:((i=u.headers.get("DAV"))!=null?i:"").split(",").map(o=>o.trim()),server:(l=u.headers.get("Server"))!=null?l:""}},(a=_e(r,s))&&a.then||(a=Promise.resolve(a)),n?a.then(n):a;var a,n});function zl(s,e,t){return s&&s.then||(s=Promise.resolve(s)),e?s.then(e):s}const My=Qf(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>r||t<0)throw new At({info:{code:Ws.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const u={"Content-Type":"application/octet-stream","Content-Length":""+(r-t+1),"Content-Range":"bytes ".concat(t,"-").concat(r,"/*")},i=Xe({url:xe(s.remoteURL,Ce(e)),method:"PUT",headers:u,data:a},s,n);return zl(_e(i,s),function(l){Ze(s,l)})});function Yd(s,e){var t=s();return t&&t.then?t.then(e):e(t)}const Fy=Qf(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};if(t>r||t<0)throw new At({info:{code:Ws.InvalidUpdateRange}},"Invalid update range ".concat(t," for partial update"));const u={"Content-Type":"application/x-sabredav-partialupdate","Content-Length":""+(r-t+1),"X-Update-Range":"bytes=".concat(t,"-").concat(r)},i=Xe({url:xe(s.remoteURL,Ce(e)),method:"PATCH",headers:u,data:a},s,n);return zl(_e(i,s),function(l){Ze(s,l)})});function Qf(s){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(s.apply(this,e))}catch(r){return Promise.reject(r)}}}const Jy=Qf(function(s,e,t,r,a){let n=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{};return zl(ug(s,e,n),function(u){let i=!1;return Yd(function(){if(u.compliance.includes("sabredav-partialupdate"))return zl(Fy(s,e,t,r,a,n),function(l){return i=!0,l})},function(l){let o=!1;return i?l:Yd(function(){if(u.server.includes("Apache")&&u.compliance.includes("<http://apache.org/dav/propset/fs/1>"))return zl(My(s,e,t,r,a,n),function(c){return o=!0,c})},function(c){if(o)return c;throw new At({info:{code:Ws.NotSupported}},"Not supported")})})})}),qy="https://github.com/perry-mitchell/webdav-client/blob/master/LOCK_CONTACT.md";function Wy(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{authType:t=null,remoteBasePath:r,contactHref:a=qy,ha1:n,headers:u={},httpAgent:i,httpsAgent:l,password:o,token:c,username:m,withCredentials:h}=e;let p=t;p||(p=m||o?vt.Password:vt.None);const d={authType:p,remoteBasePath:r,contactHref:a,ha1:n,headers:Object.assign({},u),httpAgent:i,httpsAgent:l,password:o,remotePath:Tw(s),remoteURL:s,token:c,username:m,withCredentials:h};return Jp(d,m,o,c,n),{copyFile:(w,y,k)=>yy(d,w,y,k),createDirectory:(w,y)=>uf(d,w,y),createReadStream:(w,y)=>function(k,g){let b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const N=new(Qd()).PassThrough;return Ny(k,g,b).then(S=>{S.pipe(N)}).catch(S=>{N.emit("error",S)}),N}(d,w,y),createWriteStream:(w,y,k)=>function(g,b){let N=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},S=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ky;const C=new(Qd()).PassThrough,x={};N.overwrite===!1&&(x["If-None-Match"]="*");const E=Xe({url:xe(g.remoteURL,Ce(b)),method:"PUT",headers:x,data:C,maxRedirects:0},g,N);return _e(E,g).then(P=>Ze(g,P)).then(P=>{setTimeout(()=>{S(P)},0)}).catch(P=>{C.emit("error",P)}),C}(d,w,y,k),customRequest:(w,y)=>Ey(d,w,y),deleteFile:(w,y)=>Cy(d,w,y),exists:(w,y)=>xy(d,w,y),getDirectoryContents:(w,y)=>Iy(d,w,y),getFileContents:(w,y)=>Py(d,w,y),getFileDownloadLink:w=>function(y,k){let g=xe(y.remoteURL,Ce(k));const b=/^https:/i.test(g)?"https":"http";switch(y.authType){case vt.None:break;case vt.Password:{const N=$d(y.headers.Authorization.replace(/^Basic /i,"").trim());g=g.replace(/^https?:\/\//,"".concat(b,"://").concat(N,"@"));break}default:throw new At({info:{code:Ws.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return g}(d,w),getFileUploadLink:w=>function(y,k){let g="".concat(xe(y.remoteURL,Ce(k)),"?Content-Type=application/octet-stream");const b=/^https:/i.test(g)?"https":"http";switch(y.authType){case vt.None:break;case vt.Password:{const N=$d(y.headers.Authorization.replace(/^Basic /i,"").trim());g=g.replace(/^https?:\/\//,"".concat(b,"://").concat(N,"@"));break}default:throw new At({info:{code:Ws.LinkUnsupportedAuthType}},"Unsupported auth type for file link: ".concat(y.authType))}return g}(d,w),getHeaders:()=>Object.assign({},d.headers),getQuota:w=>jy(d,w),lock:(w,y)=>Ry(d,w,y),moveFile:(w,y,k)=>$y(d,w,y,k),putFileContents:(w,y,k)=>Hy(d,w,y,k),partialUpdateFileContents:(w,y,k,g,b)=>Jy(d,w,y,k,g,b),getDAVCompliance:w=>ug(d,w),search:(w,y)=>Uy(d,w,y),setHeaders:w=>{d.headers=Object.assign({},w)},stat:(w,y)=>Xf(d,w,y),unlock:(w,y,k)=>Ty(d,w,y,k)}}Xt.hT,Xt.O4,Xt.Kd,Xt.YK;var Gy=Xt.UU,zy=Xt.Gu,_y=Xt.ky,Xy=Xt.h4;Xt.ch,Xt.hq,Xt.i5;function Yf(){var s;return(s=Hf("files_sharing","isPublic",null))!=null?s:document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function Zy(){var s,e,t;return(t=(e=Hf("files_sharing","sharingToken",null))!=null?e:(s=document.querySelector('input#sharingToken[type="hidden"]'))==null?void 0:s.value)!=null?t:null}const cf=Xm().setApp("@nextcloud/files").detectUser().build();var Jt=(s=>(s[s.NONE=0]="NONE",s[s.CREATE=4]="CREATE",s[s.READ=1]="READ",s[s.UPDATE=2]="UPDATE",s[s.DELETE=8]="DELETE",s[s.SHARE=16]="SHARE",s[s.ALL=31]="ALL",s))(Jt||{}),Xh=(s=>(s.Folder="folder",s.File="file",s))(Xh||{});const lg=function(s,e){return s.match(e)!==null},ep=(s,e)=>{if(s.id&&typeof s.id!="number")throw new Error("Invalid id type of value");if(!s.source)throw new Error("Missing mandatory source");try{new URL(s.source)}catch(t){throw new Error("Invalid source format, source must be a valid URL")}if(!s.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(s.displayname&&typeof s.displayname!="string")throw new Error("Invalid displayname type");if(s.mtime&&!(s.mtime instanceof Date))throw new Error("Invalid mtime type");if(s.crtime&&!(s.crtime instanceof Date))throw new Error("Invalid crtime type");if(!s.mime||typeof s.mime!="string"||!s.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in s&&typeof s.size!="number"&&s.size!==void 0)throw new Error("Invalid size type");if("permissions"in s&&s.permissions!==void 0&&!(typeof s.permissions=="number"&&s.permissions>=Jt.NONE&&s.permissions<=Jt.ALL))throw new Error("Invalid permissions");if(s.owner&&s.owner!==null&&typeof s.owner!="string")throw new Error("Invalid owner type");if(s.attributes&&typeof s.attributes!="object")throw new Error("Invalid attributes type");if(s.root&&typeof s.root!="string")throw new Error("Invalid root type");if(s.root&&!s.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(s.root&&!s.source.includes(s.root))throw new Error("Root must be part of the source");if(s.root&&lg(s.source,e)){const t=s.source.match(e)[0];if(!s.source.includes(Ft.join(t,s.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(s.status&&!Object.values(ed).includes(s.status))throw new Error("Status must be a valid NodeStatus")};var ed=(s=>(s.NEW="new",s.FAILED="failed",s.LOADING="loading",s.LOCKED="locked",s))(ed||{});class Zh{constructor(e,t){ve(this,"_data");ve(this,"_attributes");ve(this,"_knownDavService",/(remote|public)\.php\/(web)?dav/i);ve(this,"readonlyAttributes",Object.entries(Object.getOwnPropertyDescriptors(Zh.prototype)).filter(e=>typeof e[1].get=="function"&&e[0]!=="__proto__").map(e=>e[0]));ve(this,"handler",{set:(e,t,r)=>this.readonlyAttributes.includes(t)?!1:Reflect.set(e,t,r),deleteProperty:(e,t)=>this.readonlyAttributes.includes(t)?!1:Reflect.deleteProperty(e,t),get:(e,t,r)=>this.readonlyAttributes.includes(t)?(cf.warn('Accessing "Node.attributes.'.concat(t,'" is deprecated, access it directly on the Node instance.')),Reflect.get(this,t)):Reflect.get(e,t,r)});var r,a;ep(e,t||this._knownDavService),this._data=Et(Qe({displayname:(r=e.attributes)==null?void 0:r.displayname},e),{attributes:{}}),this._attributes=new Proxy(this._data.attributes,this.handler),this.update((a=e.attributes)!=null?a:{}),t&&(this._knownDavService=t)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:e}=new URL(this.source);return e+Ew(this.source.slice(e.length))}get basename(){return Ft.basename(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(e){this._data.displayname=e}get extension(){return Ft.extname(this.source)}get dirname(){if(this.root){let t=this.source;this.isDavResource&&(t=t.split(this._knownDavService).pop());const r=t.indexOf(this.root),a=this.root.replace(/\/$/,"");return Ft.dirname(t.slice(r+a.length)||"/")}const e=new URL(this.source);return Ft.dirname(e.pathname)}get mime(){return this._data.mime}get mtime(){return this._data.mtime}set mtime(e){this._data.mtime=e}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(e){this.updateMtime(),this._data.size=e}get attributes(){return this._attributes}get permissions(){return this.owner===null&&!this.isDavResource?Jt.READ:this._data.permissions!==void 0?this._data.permissions:Jt.NONE}set permissions(e){this.updateMtime(),this._data.permissions=e}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return lg(this.source,this._knownDavService)}get isDavRessource(){return this.isDavResource}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavResource&&Ft.dirname(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){let e=this.source;this.isDavResource&&(e=e.split(this._knownDavService).pop());const t=e.indexOf(this.root),r=this.root.replace(/\/$/,"");return e.slice(t+r.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){var e;return(e=this._data)==null?void 0:e.id}get status(){var e;return(e=this._data)==null?void 0:e.status}set status(e){this._data.status=e}get data(){return structuredClone(this._data)}move(e){ep(Et(Qe({},this._data),{source:e}),this._knownDavService);const t=this.basename;this._data.source=e,this.displayname===t&&this.basename!==t&&(this.displayname=this.basename),this.updateMtime()}rename(e){if(e.includes("/"))throw new Error("Invalid basename");this.move(Ft.dirname(this.source)+"/"+e)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(e){for(const[t,r]of Object.entries(e))try{r===void 0?delete this.attributes[t]:this.attributes[t]=r}catch(a){if(a instanceof TypeError)continue;throw a}}}class td extends Zh{get type(){return Xh.File}clone(){return new td(this.data)}}class sd extends Zh{constructor(e){super(Et(Qe({},e),{mime:"httpd/unix-directory"}))}get type(){return Xh.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}clone(){return new sd(this.data)}}const Qy=function(s=""){let e=Jt.NONE;return s&&((s.includes("C")||s.includes("K"))&&(e|=Jt.CREATE),s.includes("G")&&(e|=Jt.READ),(s.includes("W")||s.includes("N")||s.includes("V"))&&(e|=Jt.UPDATE),s.includes("D")&&(e|=Jt.DELETE),s.includes("R")&&(e|=Jt.SHARE)),e},Yy=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],ev={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},tv=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Yy]),window._nc_dav_properties.map(s=>"<".concat(s," />")).join(" ")},sv=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces=Qe({},ev)),Object.keys(window._nc_dav_namespaces).map(s=>{var e;return"xmlns:".concat(s,'="').concat((e=window._nc_dav_namespaces)==null?void 0:e[s],'"')}).join(" ")},rv=function(){return'<?xml version="1.0"?>\n		<d:propfind '.concat(sv(),">\n			<d:prop>\n				").concat(tv(),"\n			</d:prop>\n		</d:propfind>")};function av(){var s;return Yf()?"/files/".concat(Zy()):"/files/".concat((s=Gh())==null?void 0:s.uid)}const nv=av();function iv(){const s=tw("dav");return Yf()?s.replace("remote.php","public.php"):s}const cg=iv(),ov=function(s=cg,e={}){const t=Gy(s,{headers:e});function r(a){t.setHeaders(Et(Qe({},e),{"X-Requested-With":"XMLHttpRequest",requesttoken:a!=null?a:""}))}return sw(r),r(rw()),zy().patch("fetch",(a,n)=>{const u=n.headers;return u!=null&&u.method&&(n.method=u.method,delete u.method),fetch(a,n)}),t},uv=function(s,e=nv,t=cg){var m,h;let r=(m=Gh())==null?void 0:m.uid;if(Yf())r=r!=null?r:"anonymous";else if(!r)throw new Error("No user id found");const a=s.props,n=Qy(a==null?void 0:a.permissions),u=String((a==null?void 0:a["owner-id"])||r),i=a.fileid||0,l=new Date(Date.parse(s.lastmod)),o=new Date(Date.parse(a.creationdate)),c={id:i,source:"".concat(t).concat(s.filename),mtime:!isNaN(l.getTime())&&l.getTime()!==0?l:void 0,crtime:!isNaN(o.getTime())&&o.getTime()!==0?o:void 0,mime:s.mime||"application/octet-stream",displayname:a.displayname!==void 0?String(a.displayname):void 0,size:(a==null?void 0:a.size)||Number.parseInt(a.getcontentlength||"0"),status:i<0?ed.FAILED:void 0,permissions:n,owner:u,root:e,attributes:Et(Qe(Qe({},s),a),{hasPreview:a==null?void 0:a["has-preview"]})};return(h=c.attributes)==null||delete h.props,s.type==="file"?new td(c):new sd(c)};var pm={},rd=(s=>(s.DEFAULT="default",s.HIDDEN="hidden",s))(rd||{});class lv{constructor(e){ve(this,"_action");this.validateAction(e),this._action=e}get id(){return this._action.id}get displayName(){return this._action.displayName}get title(){return this._action.title}get iconSvgInline(){return this._action.iconSvgInline}get enabled(){return this._action.enabled}get exec(){return this._action.exec}get execBatch(){return this._action.execBatch}get order(){return this._action.order}get parent(){return this._action.parent}get default(){return this._action.default}get destructive(){return this._action.destructive}get inline(){return this._action.inline}get renderInline(){return this._action.renderInline}validateAction(e){if(!e.id||typeof e.id!="string")throw new Error("Invalid id");if(!e.displayName||typeof e.displayName!="function")throw new Error("Invalid displayName function");if("title"in e&&typeof e.title!="function")throw new Error("Invalid title function");if(!e.iconSvgInline||typeof e.iconSvgInline!="function")throw new Error("Invalid iconSvgInline function");if(!e.exec||typeof e.exec!="function")throw new Error("Invalid exec function");if("enabled"in e&&typeof e.enabled!="function")throw new Error("Invalid enabled function");if("execBatch"in e&&typeof e.execBatch!="function")throw new Error("Invalid execBatch function");if("order"in e&&typeof e.order!="number")throw new Error("Invalid order");if(e.destructive!==void 0&&typeof e.destructive!="boolean")throw new Error("Invalid destructive flag");if("parent"in e&&typeof e.parent!="string")throw new Error("Invalid parent");if(e.default&&!Object.values(rd).includes(e.default))throw new Error("Invalid default");if("inline"in e&&typeof e.inline!="function")throw new Error("Invalid inline function");if("renderInline"in e&&typeof e.renderInline!="function")throw new Error("Invalid renderInline function")}}const cv=function(s){if(typeof window._nc_fileactions>"u"&&(window._nc_fileactions=[],cf.debug("FileActions initialized")),window._nc_fileactions.find(e=>e.id===s.id)){cf.error("FileAction ".concat(s.id," already registered"),{action:s});return}window._nc_fileactions.push(s)};var hv={};(function(s){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+t+"]*",a=new RegExp("^"+r+"$"),n=function(i,l){const o=[];let c=l.exec(i);for(;c;){const m=[];m.startIndex=l.lastIndex-c[0].length;const h=c.length;for(let p=0;p<h;p++)m.push(c[p]);o.push(m),c=l.exec(i)}return o},u=function(i){const l=a.exec(i);return!(l===null||typeof l>"u")};s.isExist=function(i){return typeof i<"u"},s.isEmptyObject=function(i){return Object.keys(i).length===0},s.merge=function(i,l,o){if(l){const c=Object.keys(l),m=c.length;for(let h=0;h<m;h++)o==="strict"?i[c[h]]=[l[c[h]]]:i[c[h]]=l[c[h]]}},s.getValue=function(i){return s.isExist(i)?i:""},s.isName=u,s.getAllMatches=n,s.nameRegexp=r})(hv),!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const mv=typeof Ge=="object"&&pm&&pm.NODE_DEBUG&&/\bsemver\b/i.test(pm.NODE_DEBUG)?(...s)=>console.error("SEMVER",...s):()=>{};var fv=mv;const dv="2.0.0",hg=256,pv=Number.MAX_SAFE_INTEGER||9007199254740991,gv=16,wv=hg-6,yv=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var vv={MAX_LENGTH:hg,MAX_SAFE_COMPONENT_LENGTH:gv,MAX_SAFE_BUILD_LENGTH:wv,MAX_SAFE_INTEGER:pv,RELEASE_TYPES:yv,SEMVER_SPEC_VERSION:dv,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},tp={exports:{}};(function(s,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=vv,n=fv;e=s.exports={};const u=e.re=[],i=e.safeRe=[],l=e.src=[],o=e.t={};let c=0;const m="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[m,r]],p=w=>{for(const[y,k]of h)w=w.split("".concat(y,"*")).join("".concat(y,"{0,").concat(k,"}")).split("".concat(y,"+")).join("".concat(y,"{1,").concat(k,"}"));return w},d=(w,y,k)=>{const g=p(y),b=c++;n(w,b,y),o[w]=b,l[b]=y,u[b]=new RegExp(y,k?"g":void 0),i[b]=new RegExp(g,k?"g":void 0)};d("NUMERICIDENTIFIER","0|[1-9]\\d*"),d("NUMERICIDENTIFIERLOOSE","\\d+"),d("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(m,"*")),d("MAINVERSION","(".concat(l[o.NUMERICIDENTIFIER],")\\.(").concat(l[o.NUMERICIDENTIFIER],")\\.(").concat(l[o.NUMERICIDENTIFIER],")")),d("MAINVERSIONLOOSE","(".concat(l[o.NUMERICIDENTIFIERLOOSE],")\\.(").concat(l[o.NUMERICIDENTIFIERLOOSE],")\\.(").concat(l[o.NUMERICIDENTIFIERLOOSE],")")),d("PRERELEASEIDENTIFIER","(?:".concat(l[o.NUMERICIDENTIFIER],"|").concat(l[o.NONNUMERICIDENTIFIER],")")),d("PRERELEASEIDENTIFIERLOOSE","(?:".concat(l[o.NUMERICIDENTIFIERLOOSE],"|").concat(l[o.NONNUMERICIDENTIFIER],")")),d("PRERELEASE","(?:-(".concat(l[o.PRERELEASEIDENTIFIER],"(?:\\.").concat(l[o.PRERELEASEIDENTIFIER],")*))")),d("PRERELEASELOOSE","(?:-?(".concat(l[o.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(l[o.PRERELEASEIDENTIFIERLOOSE],")*))")),d("BUILDIDENTIFIER","".concat(m,"+")),d("BUILD","(?:\\+(".concat(l[o.BUILDIDENTIFIER],"(?:\\.").concat(l[o.BUILDIDENTIFIER],")*))")),d("FULLPLAIN","v?".concat(l[o.MAINVERSION]).concat(l[o.PRERELEASE],"?").concat(l[o.BUILD],"?")),d("FULL","^".concat(l[o.FULLPLAIN],"$")),d("LOOSEPLAIN","[v=\\s]*".concat(l[o.MAINVERSIONLOOSE]).concat(l[o.PRERELEASELOOSE],"?").concat(l[o.BUILD],"?")),d("LOOSE","^".concat(l[o.LOOSEPLAIN],"$")),d("GTLT","((?:<|>)?=?)"),d("XRANGEIDENTIFIERLOOSE","".concat(l[o.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),d("XRANGEIDENTIFIER","".concat(l[o.NUMERICIDENTIFIER],"|x|X|\\*")),d("XRANGEPLAIN","[v=\\s]*(".concat(l[o.XRANGEIDENTIFIER],")(?:\\.(").concat(l[o.XRANGEIDENTIFIER],")(?:\\.(").concat(l[o.XRANGEIDENTIFIER],")(?:").concat(l[o.PRERELEASE],")?").concat(l[o.BUILD],"?)?)?")),d("XRANGEPLAINLOOSE","[v=\\s]*(".concat(l[o.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(l[o.XRANGEIDENTIFIERLOOSE],")(?:\\.(").concat(l[o.XRANGEIDENTIFIERLOOSE],")(?:").concat(l[o.PRERELEASELOOSE],")?").concat(l[o.BUILD],"?)?)?")),d("XRANGE","^".concat(l[o.GTLT],"\\s*").concat(l[o.XRANGEPLAIN],"$")),d("XRANGELOOSE","^".concat(l[o.GTLT],"\\s*").concat(l[o.XRANGEPLAINLOOSE],"$")),d("COERCEPLAIN","(^|[^\\d])(\\d{1,".concat(t,"})(?:\\.(\\d{1,").concat(t,"}))?(?:\\.(\\d{1,").concat(t,"}))?")),d("COERCE","".concat(l[o.COERCEPLAIN],"(?:$|[^\\d])")),d("COERCEFULL",l[o.COERCEPLAIN]+"(?:".concat(l[o.PRERELEASE],")?(?:").concat(l[o.BUILD],")?(?:$|[^\\d])")),d("COERCERTL",l[o.COERCE],!0),d("COERCERTLFULL",l[o.COERCEFULL],!0),d("LONETILDE","(?:~>?)"),d("TILDETRIM","(\\s*)".concat(l[o.LONETILDE],"\\s+"),!0),e.tildeTrimReplace="$1~",d("TILDE","^".concat(l[o.LONETILDE]).concat(l[o.XRANGEPLAIN],"$")),d("TILDELOOSE","^".concat(l[o.LONETILDE]).concat(l[o.XRANGEPLAINLOOSE],"$")),d("LONECARET","(?:\\^)"),d("CARETTRIM","(\\s*)".concat(l[o.LONECARET],"\\s+"),!0),e.caretTrimReplace="$1^",d("CARET","^".concat(l[o.LONECARET]).concat(l[o.XRANGEPLAIN],"$")),d("CARETLOOSE","^".concat(l[o.LONECARET]).concat(l[o.XRANGEPLAINLOOSE],"$")),d("COMPARATORLOOSE","^".concat(l[o.GTLT],"\\s*(").concat(l[o.LOOSEPLAIN],")$|^$")),d("COMPARATOR","^".concat(l[o.GTLT],"\\s*(").concat(l[o.FULLPLAIN],")$|^$")),d("COMPARATORTRIM","(\\s*)".concat(l[o.GTLT],"\\s*(").concat(l[o.LOOSEPLAIN],"|").concat(l[o.XRANGEPLAIN],")"),!0),e.comparatorTrimReplace="$1$2$3",d("HYPHENRANGE","^\\s*(".concat(l[o.XRANGEPLAIN],")\\s+-\\s+(").concat(l[o.XRANGEPLAIN],")\\s*$")),d("HYPHENRANGELOOSE","^\\s*(".concat(l[o.XRANGEPLAINLOOSE],")\\s+-\\s+(").concat(l[o.XRANGEPLAINLOOSE],")\\s*$")),d("STAR","(<|>)?=?\\s*\\*"),d("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),d("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(tp,tp.exports);var ad={},Qh={};(function(s){const e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r="["+e+"]["+t+"]*",a=new RegExp("^"+r+"$"),n=function(i,l){const o=[];let c=l.exec(i);for(;c;){const m=[];m.startIndex=l.lastIndex-c[0].length;const h=c.length;for(let p=0;p<h;p++)m.push(c[p]);o.push(m),c=l.exec(i)}return o},u=function(i){const l=a.exec(i);return!(l===null||typeof l>"u")};s.isExist=function(i){return typeof i<"u"},s.isEmptyObject=function(i){return Object.keys(i).length===0},s.merge=function(i,l,o){if(l){const c=Object.keys(l),m=c.length;for(let h=0;h<m;h++)o==="strict"?i[c[h]]=[l[c[h]]]:i[c[h]]=l[c[h]]}},s.getValue=function(i){return s.isExist(i)?i:""},s.isName=u,s.getAllMatches=n,s.nameRegexp=r})(Qh);const nd=Qh,bv={allowBooleanAttributes:!1,unpairedTags:[]};ad.validate=function(s,e){e=Object.assign({},bv,e);const t=[];let r=!1,a=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let n=0;n<s.length;n++)if(s[n]==="<"&&s[n+1]==="?"){if(n+=2,n=rp(s,n),n.err)return n}else if(s[n]==="<"){let u=n;if(n++,s[n]==="!"){n=ap(s,n);continue}else{let i=!1;s[n]==="/"&&(i=!0,n++);let l="";for(;n<s.length&&s[n]!==">"&&s[n]!==" "&&s[n]!=="	"&&s[n]!=="\n"&&s[n]!=="\r";n++)l+=s[n];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),n--),!Iv(l)){let m;return l.trim().length===0?m="Invalid space after '<'.":m="Tag '"+l+"' is an invalid name.",Oe("InvalidTag",m,ft(s,n))}const o=Nv(s,n);if(o===!1)return Oe("InvalidAttr","Attributes for '"+l+"' have open quote.",ft(s,n));let c=o.value;if(n=o.index,c[c.length-1]==="/"){const m=n-c.length;c=c.substring(0,c.length-1);const h=np(c,e);if(h===!0)r=!0;else return Oe(h.err.code,h.err.msg,ft(s,m+h.err.line))}else if(i)if(o.tagClosed){if(c.trim().length>0)return Oe("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",ft(s,u));if(t.length===0)return Oe("InvalidTag","Closing tag '"+l+"' has not been opened.",ft(s,u));{const m=t.pop();if(l!==m.tagName){let h=ft(s,m.tagStartPos);return Oe("InvalidTag","Expected closing tag '"+m.tagName+"' (opened in line "+h.line+", col "+h.col+") instead of closing tag '"+l+"'.",ft(s,u))}t.length==0&&(a=!0)}}else return Oe("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",ft(s,n));else{const m=np(c,e);if(m!==!0)return Oe(m.err.code,m.err.msg,ft(s,n-c.length+m.err.line));if(a===!0)return Oe("InvalidXml","Multiple possible root nodes found.",ft(s,n));e.unpairedTags.indexOf(l)!==-1||t.push({tagName:l,tagStartPos:u}),r=!0}for(n++;n<s.length;n++)if(s[n]==="<")if(s[n+1]==="!"){n++,n=ap(s,n);continue}else if(s[n+1]==="?"){if(n=rp(s,++n),n.err)return n}else break;else if(s[n]==="&"){const m=Cv(s,n);if(m==-1)return Oe("InvalidChar","char '&' is not expected.",ft(s,n));n=m}else if(a===!0&&!sp(s[n]))return Oe("InvalidXml","Extra text at the end",ft(s,n));s[n]==="<"&&n--}}else{if(sp(s[n]))continue;return Oe("InvalidChar","char '"+s[n]+"' is not expected.",ft(s,n))}if(r){if(t.length==1)return Oe("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",ft(s,t[0].tagStartPos));if(t.length>0)return Oe("InvalidXml","Invalid '"+JSON.stringify(t.map(n=>n.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Oe("InvalidXml","Start tag expected.",1);return!0};function sp(s){return s===" "||s==="	"||s==="\n"||s==="\r"}function rp(s,e){const t=e;for(;e<s.length;e++)if(s[e]=="?"||s[e]==" "){const r=s.substr(t,e-t);if(e>5&&r==="xml")return Oe("InvalidXml","XML declaration allowed only at the start of the document.",ft(s,e));if(s[e]=="?"&&s[e+1]==">"){e++;break}else continue}return e}function ap(s,e){if(s.length>e+5&&s[e+1]==="-"&&s[e+2]==="-"){for(e+=3;e<s.length;e++)if(s[e]==="-"&&s[e+1]==="-"&&s[e+2]===">"){e+=2;break}}else if(s.length>e+8&&s[e+1]==="D"&&s[e+2]==="O"&&s[e+3]==="C"&&s[e+4]==="T"&&s[e+5]==="Y"&&s[e+6]==="P"&&s[e+7]==="E"){let t=1;for(e+=8;e<s.length;e++)if(s[e]==="<")t++;else if(s[e]===">"&&(t--,t===0))break}else if(s.length>e+9&&s[e+1]==="["&&s[e+2]==="C"&&s[e+3]==="D"&&s[e+4]==="A"&&s[e+5]==="T"&&s[e+6]==="A"&&s[e+7]==="["){for(e+=8;e<s.length;e++)if(s[e]==="]"&&s[e+1]==="]"&&s[e+2]===">"){e+=2;break}}return e}const Sv='"',Av="'";function Nv(s,e){let t="",r="",a=!1;for(;e<s.length;e++){if(s[e]===Sv||s[e]===Av)r===""?r=s[e]:r!==s[e]||(r="");else if(s[e]===">"&&r===""){a=!0;break}t+=s[e]}return r!==""?!1:{value:t,index:e,tagClosed:a}}const kv=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function np(s,e){const t=nd.getAllMatches(s,kv),r={};for(let a=0;a<t.length;a++){if(t[a][1].length===0)return Oe("InvalidAttr","Attribute '"+t[a][2]+"' has no space in starting.",Ro(t[a]));if(t[a][3]!==void 0&&t[a][4]===void 0)return Oe("InvalidAttr","Attribute '"+t[a][2]+"' is without value.",Ro(t[a]));if(t[a][3]===void 0&&!e.allowBooleanAttributes)return Oe("InvalidAttr","boolean attribute '"+t[a][2]+"' is not allowed.",Ro(t[a]));const n=t[a][2];if(!xv(n))return Oe("InvalidAttr","Attribute '"+n+"' is an invalid name.",Ro(t[a]));if(!r.hasOwnProperty(n))r[n]=1;else return Oe("InvalidAttr","Attribute '"+n+"' is repeated.",Ro(t[a]))}return!0}function Ev(s,e){let t=/\d/;for(s[e]==="x"&&(e++,t=/[\da-fA-F]/);e<s.length;e++){if(s[e]===";")return e;if(!s[e].match(t))break}return-1}function Cv(s,e){if(e++,s[e]===";")return-1;if(s[e]==="#")return e++,Ev(s,e);let t=0;for(;e<s.length;e++,t++)if(!(s[e].match(/\w/)&&t<20)){if(s[e]===";")break;return-1}return e}function Oe(s,e,t){return{err:{code:s,msg:e,line:t.line||t,col:t.col}}}function xv(s){return nd.isName(s)}function Iv(s){return nd.isName(s)}function ft(s,e){const t=s.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function Ro(s){return s.startIndex+s[1].length}var hf={};const mg={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,e,t){return s}},Vv=function(s){return Object.assign({},mg,s)};hf.buildOptions=Vv,hf.defaultOptions=mg;class Bv{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}var Pv=Bv;const Ov=Qh;function Dv(s,e){const t={};if(s[e+3]==="O"&&s[e+4]==="C"&&s[e+5]==="T"&&s[e+6]==="Y"&&s[e+7]==="P"&&s[e+8]==="E"){e=e+9;let r=1,a=!1,n=!1,u="";for(;e<s.length;e++)if(s[e]==="<"&&!n){if(a&&Lv(s,e))e+=7,[entityName,val,e]=Tv(s,e+1),val.indexOf("&")===-1&&(t[Kv(entityName)]={regx:RegExp("&".concat(entityName,";"),"g"),val});else if(a&&jv(s,e))e+=8;else if(a&&Uv(s,e))e+=8;else if(a&&$v(s,e))e+=9;else if(Rv)n=!0;else throw new Error("Invalid DOCTYPE");r++,u=""}else if(s[e]===">"){if(n?s[e-1]==="-"&&s[e-2]==="-"&&(n=!1,r--):r--,r===0)break}else s[e]==="["?a=!0:u+=s[e];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function Tv(s,e){let t="";for(;e<s.length&&s[e]!=="'"&&s[e]!=='"';e++)t+=s[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");const r=s[e++];let a="";for(;e<s.length&&s[e]!==r;e++)a+=s[e];return[t,a,e]}function Rv(s,e){return s[e+1]==="!"&&s[e+2]==="-"&&s[e+3]==="-"}function Lv(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="N"&&s[e+4]==="T"&&s[e+5]==="I"&&s[e+6]==="T"&&s[e+7]==="Y"}function jv(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="L"&&s[e+4]==="E"&&s[e+5]==="M"&&s[e+6]==="E"&&s[e+7]==="N"&&s[e+8]==="T"}function Uv(s,e){return s[e+1]==="!"&&s[e+2]==="A"&&s[e+3]==="T"&&s[e+4]==="T"&&s[e+5]==="L"&&s[e+6]==="I"&&s[e+7]==="S"&&s[e+8]==="T"}function $v(s,e){return s[e+1]==="!"&&s[e+2]==="N"&&s[e+3]==="O"&&s[e+4]==="T"&&s[e+5]==="A"&&s[e+6]==="T"&&s[e+7]==="I"&&s[e+8]==="O"&&s[e+9]==="N"}function Kv(s){if(Ov.isName(s))return s;throw new Error("Invalid entity name ".concat(s))}var Hv=Dv;const Mv=/^[-+]?0x[a-fA-F0-9]+$/,Fv=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const Jv={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function qv(s,e={}){if(e=Object.assign({},Jv,e),!s||typeof s!="string")return s;let t=s.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return s;if(e.hex&&Mv.test(t))return Number.parseInt(t,16);{const r=Fv.exec(t);if(r){const a=r[1],n=r[2];let u=Wv(r[3]);const i=r[4]||r[6];if(!e.leadingZeros&&n.length>0&&a&&t[2]!=="."||!e.leadingZeros&&n.length>0&&!a&&t[1]!==".")return s;{const l=Number(t),o=""+l;return o.search(/[eE]/)!==-1||i?e.eNotation?l:s:t.indexOf(".")!==-1?o==="0"&&u===""||o===u||a&&o==="-"+u?l:s:n?u===o||a+u===o?l:s:t===o||t===a+o?l:s}}else return s}}function Wv(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}var Gv=qv;function zv(s){return typeof s=="function"?s:Array.isArray(s)?e=>{for(const t of s)if(typeof t=="string"&&e===t||t instanceof RegExp&&t.test(e))return!0}:()=>!1}var fg=zv;const dg=Qh,Lo=Pv,_v=Hv,Xv=Gv,Zv=fg;let Qv=class{constructor(s){this.options=s,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=Yv,this.parseXml=ab,this.parseTextData=eb,this.resolveNameSpace=tb,this.buildAttributesMap=rb,this.isItStopNode=ub,this.replaceEntitiesValue=ib,this.readStopNodeData=cb,this.saveTextToParentTag=ob,this.addChild=nb,this.ignoreAttributesFn=Zv(this.options.ignoreAttributes)}};function Yv(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:s[r]}}}function eb(s,e,t,r,a,n,u){if(s!==void 0&&(this.options.trimValues&&!r&&(s=s.trim()),s.length>0)){u||(s=this.replaceEntitiesValue(s));const i=this.options.tagValueProcessor(e,s,t,a,n);return i==null?s:typeof i!=typeof s||i!==s?i:this.options.trimValues?ff(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?ff(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function tb(s){if(this.options.removeNSPrefix){const e=s.split(":"),t=s.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(s=t+e[1])}return s}const sb=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function rb(s,e,t){if(this.options.ignoreAttributes!==!0&&typeof s=="string"){const r=dg.getAllMatches(s,sb),a=r.length,n={};for(let u=0;u<a;u++){const i=this.resolveNameSpace(r[u][1]);if(this.ignoreAttributesFn(i,e))continue;let l=r[u][4],o=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),o==="__proto__"&&(o="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);const c=this.options.attributeValueProcessor(i,l,e);c==null?n[o]=l:typeof c!=typeof l||c!==l?n[o]=c:n[o]=ff(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[o]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const u={};return u[this.options.attributesGroupName]=n,u}return n}}const ab=function(s){s=s.replace(/\r\n?/g,"\n");const e=new Lo("!xml");let t=e,r="",a="";for(let n=0;n<s.length;n++)if(s[n]==="<")if(s[n+1]==="/"){const u=vn(s,">",n,"Closing Tag is not closed.");let i=s.substring(n+2,u).trim();if(this.options.removeNSPrefix){const c=i.indexOf(":");c!==-1&&(i=i.substr(c+1))}this.options.transformTagName&&(i=this.options.transformTagName(i)),t&&(r=this.saveTextToParentTag(r,t,a));const l=a.substring(a.lastIndexOf(".")+1);if(i&&this.options.unpairedTags.indexOf(i)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(i,">"));let o=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(o=a.lastIndexOf(".",a.lastIndexOf(".")-1),this.tagsNodeStack.pop()):o=a.lastIndexOf("."),a=a.substring(0,o),t=this.tagsNodeStack.pop(),r="",n=u}else if(s[n+1]==="?"){let u=mf(s,n,!1,"?>");if(!u)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,t,a),!(this.options.ignoreDeclaration&&u.tagName==="?xml"||this.options.ignorePiTags)){const i=new Lo(u.tagName);i.add(this.options.textNodeName,""),u.tagName!==u.tagExp&&u.attrExpPresent&&(i[":@"]=this.buildAttributesMap(u.tagExp,a,u.tagName)),this.addChild(t,i,a)}n=u.closeIndex+1}else if(s.substr(n+1,3)==="!--"){const u=vn(s,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const i=s.substring(n+4,u-2);r=this.saveTextToParentTag(r,t,a),t.add(this.options.commentPropName,[{[this.options.textNodeName]:i}])}n=u}else if(s.substr(n+1,2)==="!D"){const u=_v(s,n);this.docTypeEntities=u.entities,n=u.i}else if(s.substr(n+1,2)==="!["){const u=vn(s,"]]>",n,"CDATA is not closed.")-2,i=s.substring(n+9,u);r=this.saveTextToParentTag(r,t,a);let l=this.parseTextData(i,t.tagname,a,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:i}]):t.add(this.options.textNodeName,l),n=u+2}else{let u=mf(s,n,this.options.removeNSPrefix),i=u.tagName;const l=u.rawTagName;let o=u.tagExp,c=u.attrExpPresent,m=u.closeIndex;this.options.transformTagName&&(i=this.options.transformTagName(i)),t&&r&&t.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,t,a,!1));const h=t;if(h&&this.options.unpairedTags.indexOf(h.tagname)!==-1&&(t=this.tagsNodeStack.pop(),a=a.substring(0,a.lastIndexOf("."))),i!==e.tagname&&(a+=a?"."+i:i),this.isItStopNode(this.options.stopNodes,a,i)){let p="";if(o.length>0&&o.lastIndexOf("/")===o.length-1)i[i.length-1]==="/"?(i=i.substr(0,i.length-1),a=a.substr(0,a.length-1),o=i):o=o.substr(0,o.length-1),n=u.closeIndex;else if(this.options.unpairedTags.indexOf(i)!==-1)n=u.closeIndex;else{const w=this.readStopNodeData(s,l,m+1);if(!w)throw new Error("Unexpected end of ".concat(l));n=w.i,p=w.tagContent}const d=new Lo(i);i!==o&&c&&(d[":@"]=this.buildAttributesMap(o,a,i)),p&&(p=this.parseTextData(p,i,a,!0,c,!0,!0)),a=a.substr(0,a.lastIndexOf(".")),d.add(this.options.textNodeName,p),this.addChild(t,d,a)}else{if(o.length>0&&o.lastIndexOf("/")===o.length-1){i[i.length-1]==="/"?(i=i.substr(0,i.length-1),a=a.substr(0,a.length-1),o=i):o=o.substr(0,o.length-1),this.options.transformTagName&&(i=this.options.transformTagName(i));const p=new Lo(i);i!==o&&c&&(p[":@"]=this.buildAttributesMap(o,a,i)),this.addChild(t,p,a),a=a.substr(0,a.lastIndexOf("."))}else{const p=new Lo(i);this.tagsNodeStack.push(t),i!==o&&c&&(p[":@"]=this.buildAttributesMap(o,a,i)),this.addChild(t,p,a),t=p}r="",n=m}}else r+=s[n];return e.child};function nb(s,e,t){const r=this.options.updateTag(e.tagname,t,e[":@"]);r===!1||(typeof r=="string"&&(e.tagname=r),s.addChild(e))}const ib=function(s){if(this.options.processEntities){for(let e in this.docTypeEntities){const t=this.docTypeEntities[e];s=s.replace(t.regx,t.val)}for(let e in this.lastEntities){const t=this.lastEntities[e];s=s.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){const t=this.htmlEntities[e];s=s.replace(t.regex,t.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function ob(s,e,t,r){return s&&(r===void 0&&(r=Object.keys(e.child).length===0),s=this.parseTextData(s,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,r),s!==void 0&&s!==""&&e.add(this.options.textNodeName,s),s=""),s}function ub(s,e,t){const r="*."+t;for(const a in s){const n=s[a];if(r===n||e===n)return!0}return!1}function lb(s,e,t=">"){let r,a="";for(let n=e;n<s.length;n++){let u=s[n];if(r)u===r&&(r="");else if(u==='"'||u==="'")r=u;else if(u===t[0])if(t[1]){if(s[n+1]===t[1])return{data:a,index:n}}else return{data:a,index:n};else u==="	"&&(u=" ");a+=u}}function vn(s,e,t,r){const a=s.indexOf(e,t);if(a===-1)throw new Error(r);return a+e.length-1}function mf(s,e,t,r=">"){const a=lb(s,e+1,r);if(!a)return;let n=a.data;const u=a.index,i=n.search(/\s/);let l=n,o=!0;i!==-1&&(l=n.substring(0,i),n=n.substring(i+1).trimStart());const c=l;if(t){const m=l.indexOf(":");m!==-1&&(l=l.substr(m+1),o=l!==a.data.substr(m+1))}return{tagName:l,tagExp:n,closeIndex:u,attrExpPresent:o,rawTagName:c}}function cb(s,e,t){const r=t;let a=1;for(;t<s.length;t++)if(s[t]==="<")if(s[t+1]==="/"){const n=vn(s,">",t,"".concat(e," is not closed"));if(s.substring(t+2,n).trim()===e&&(a--,a===0))return{tagContent:s.substring(r,t),i:n};t=n}else if(s[t+1]==="?")t=vn(s,"?>",t+1,"StopNode is not closed.");else if(s.substr(t+1,3)==="!--")t=vn(s,"-->",t+3,"StopNode is not closed.");else if(s.substr(t+1,2)==="![")t=vn(s,"]]>",t,"StopNode is not closed.")-2;else{const n=mf(s,t,">");n&&((n&&n.tagName)===e&&n.tagExp[n.tagExp.length-1]!=="/"&&a++,t=n.closeIndex)}}function ff(s,e,t){if(e&&typeof s=="string"){const r=s.trim();return r==="true"?!0:r==="false"?!1:Xv(s,t)}else return dg.isExist(s)?s:""}var hb=Qv,pg={};function mb(s,e){return gg(s,e)}function gg(s,e,t){let r;const a={};for(let n=0;n<s.length;n++){const u=s[n],i=fb(u);let l="";if(t===void 0?l=i:l=t+"."+i,i===e.textNodeName)r===void 0?r=u[i]:r+=""+u[i];else{if(i===void 0)continue;if(u[i]){let o=gg(u[i],e,l);const c=pb(o,e);u[":@"]?db(o,u[":@"],l,e):Object.keys(o).length===1&&o[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?o=o[e.textNodeName]:Object.keys(o).length===0&&(e.alwaysCreateTextNode?o[e.textNodeName]="":o=""),a[i]!==void 0&&a.hasOwnProperty(i)?(Array.isArray(a[i])||(a[i]=[a[i]]),a[i].push(o)):e.isArray(i,l,c)?a[i]=[o]:a[i]=o}}}return typeof r=="string"?r.length>0&&(a[e.textNodeName]=r):r!==void 0&&(a[e.textNodeName]=r),a}function fb(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(r!==":@")return r}}function db(s,e,t,r){if(e){const a=Object.keys(e),n=a.length;for(let u=0;u<n;u++){const i=a[u];r.isArray(i,t+"."+i,!0,!0)?s[i]=[e[i]]:s[i]=e[i]}}}function pb(s,e){const{textNodeName:t}=e,r=Object.keys(s).length;return!!(r===0||r===1&&(s[t]||typeof s[t]=="boolean"||s[t]===0))}pg.prettify=mb;const{buildOptions:gb}=hf,wb=hb,{prettify:yb}=pg,vb=ad;let bb=class{constructor(s){this.externalEntities={},this.options=gb(s)}parse(s,e){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});const a=vb.validate(s,e);if(a!==!0)throw Error("".concat(a.err.msg,":").concat(a.err.line,":").concat(a.err.col))}const t=new wb(this.options);t.addExternalEntities(this.externalEntities);const r=t.parseXml(s);return this.options.preserveOrder||r===void 0?r:yb(r,this.options)}addEntity(s,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=e}};var Sb=bb;const Ab="\n";function Nb(s,e){let t="";return e.format&&e.indentBy.length>0&&(t=Ab),wg(s,e,"",t)}function wg(s,e,t,r){let a="",n=!1;for(let u=0;u<s.length;u++){const i=s[u],l=kb(i);if(l===void 0)continue;let o="";if(t.length===0?o=l:o="".concat(t,".").concat(l),l===e.textNodeName){let d=i[l];Eb(o,e)||(d=e.tagValueProcessor(l,d),d=yg(d,e)),n&&(a+=r),a+=d,n=!1;continue}else if(l===e.cdataPropName){n&&(a+=r),a+="<![CDATA[".concat(i[l][0][e.textNodeName],"]]>"),n=!1;continue}else if(l===e.commentPropName){a+=r+"<!--".concat(i[l][0][e.textNodeName],"-->"),n=!0;continue}else if(l[0]==="?"){const d=ip(i[":@"],e),w=l==="?xml"?"":r;let y=i[l][0][e.textNodeName];y=y.length!==0?" "+y:"",a+=w+"<".concat(l).concat(y).concat(d,"?>"),n=!0;continue}let c=r;c!==""&&(c+=e.indentBy);const m=ip(i[":@"],e),h=r+"<".concat(l).concat(m),p=wg(i[l],e,o,c);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?a+=h+">":a+=h+"/>":(!p||p.length===0)&&e.suppressEmptyNode?a+=h+"/>":p&&p.endsWith(">")?a+=h+">".concat(p).concat(r,"</").concat(l,">"):(a+=h+">",p&&r!==""&&(p.includes("/>")||p.includes("</"))?a+=r+e.indentBy+p+r:a+=p,a+="</".concat(l,">")),n=!0}return a}function kb(s){const e=Object.keys(s);for(let t=0;t<e.length;t++){const r=e[t];if(s.hasOwnProperty(r)&&r!==":@")return r}}function ip(s,e){let t="";if(s&&!e.ignoreAttributes)for(let r in s){if(!s.hasOwnProperty(r))continue;let a=e.attributeValueProcessor(r,s[r]);a=yg(a,e),a===!0&&e.suppressBooleanAttributes?t+=" ".concat(r.substr(e.attributeNamePrefix.length)):t+=" ".concat(r.substr(e.attributeNamePrefix.length),'="').concat(a,'"')}return t}function Eb(s,e){s=s.substr(0,s.length-e.textNodeName.length-1);let t=s.substr(s.lastIndexOf(".")+1);for(let r in e.stopNodes)if(e.stopNodes[r]===s||e.stopNodes[r]==="*."+t)return!0;return!1}function yg(s,e){if(s&&s.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){const r=e.entities[t];s=s.replace(r.regex,r.val)}return s}var Cb=Nb;const xb=Cb,Ib=fg,Vb={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Xr(s){this.options=Object.assign({},Vb,s),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=Ib(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=Ob),this.processTextOrObjNode=Bb,this.options.format?(this.indentate=Pb,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Xr.prototype.build=function(s){return this.options.preserveOrder?xb(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0,[]).val)},Xr.prototype.j2x=function(s,e,t){let r="",a="";const n=t.join(".");for(let u in s)if(Object.prototype.hasOwnProperty.call(s,u))if(typeof s[u]>"u")this.isAttribute(u)&&(a+="");else if(s[u]===null)this.isAttribute(u)?a+="":u[0]==="?"?a+=this.indentate(e)+"<"+u+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+u+"/"+this.tagEndChar;else if(s[u]instanceof Date)a+=this.buildTextValNode(s[u],u,"",e);else if(typeof s[u]!="object"){const i=this.isAttribute(u);if(i&&!this.ignoreAttributesFn(i,n))r+=this.buildAttrPairStr(i,""+s[u]);else if(!i)if(u===this.options.textNodeName){let l=this.options.tagValueProcessor(u,""+s[u]);a+=this.replaceEntitiesValue(l)}else a+=this.buildTextValNode(s[u],u,"",e)}else if(Array.isArray(s[u])){const i=s[u].length;let l="",o="";for(let c=0;c<i;c++){const m=s[u][c];if(!(typeof m>"u"))if(m===null)u[0]==="?"?a+=this.indentate(e)+"<"+u+"?"+this.tagEndChar:a+=this.indentate(e)+"<"+u+"/"+this.tagEndChar;else if(typeof m=="object")if(this.options.oneListGroup){const h=this.j2x(m,e+1,t.concat(u));l+=h.val,this.options.attributesGroupName&&m.hasOwnProperty(this.options.attributesGroupName)&&(o+=h.attrStr)}else l+=this.processTextOrObjNode(m,u,e,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(u,m);h=this.replaceEntitiesValue(h),l+=h}else l+=this.buildTextValNode(m,u,"",e)}this.options.oneListGroup&&(l=this.buildObjectNode(l,u,o,e)),a+=l}else if(this.options.attributesGroupName&&u===this.options.attributesGroupName){const i=Object.keys(s[u]),l=i.length;for(let o=0;o<l;o++)r+=this.buildAttrPairStr(i[o],""+s[u][i[o]])}else a+=this.processTextOrObjNode(s[u],u,e,t);return{attrStr:r,val:a}},Xr.prototype.buildAttrPairStr=function(s,e){return e=this.options.attributeValueProcessor(s,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+s:" "+s+'="'+e+'"'};function Bb(s,e,t,r){const a=this.j2x(s,t+1,r.concat(e));return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],e,a.attrStr,t):this.buildObjectNode(a.val,e,a.attrStr,t)}Xr.prototype.buildObjectNode=function(s,e,t,r){if(s==="")return e[0]==="?"?this.indentate(r)+"<"+e+t+"?"+this.tagEndChar:this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let a="</"+e+this.tagEndChar,n="";return e[0]==="?"&&(n="?",a=""),(t||t==="")&&s.indexOf("<")===-1?this.indentate(r)+"<"+e+t+n+">"+s+a:this.options.commentPropName!==!1&&e===this.options.commentPropName&&n.length===0?this.indentate(r)+"<!--".concat(s,"-->")+this.newLine:this.indentate(r)+"<"+e+t+n+this.tagEndChar+s+this.indentate(r)+a}},Xr.prototype.closeTag=function(s){let e="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e="></".concat(s),e},Xr.prototype.buildTextValNode=function(s,e,t,r){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(r)+"<![CDATA[".concat(s,"]]>")+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(r)+"<!--".concat(s,"-->")+this.newLine;if(e[0]==="?")return this.indentate(r)+"<"+e+t+"?"+this.tagEndChar;{let a=this.options.tagValueProcessor(e,s);return a=this.replaceEntitiesValue(a),a===""?this.indentate(r)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(r)+"<"+e+t+">"+a+"</"+e+this.tagEndChar}},Xr.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){const t=this.options.entities[e];s=s.replace(t.regex,t.val)}return s};function Pb(s){return this.options.indentBy.repeat(s)}function Ob(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var Db=Xr;const Tb=ad,Rb=Sb,Lb=Db;var jb={XMLParser:Rb,XMLValidator:Tb,XMLBuilder:Lb};const Ub=s=>s===null?Xm().setApp("end_to_end_encryption").build():Xm().setApp("end_to_end_encryption").setUid(s.uid).build(),it=Ub(Gh());function $b(s){return String.fromCharCode(...s)}function vg(s){return Uint8Array.from(s,e=>e.charCodeAt(0))}function Kb(s){return Array.from(s).map(e=>e.toString(16).padStart(2,"0")).join("")}function ws(s){return vg(atob(s))}function id(s){const e=s.replace(/-----BEGIN ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/-----END ((PRIVATE KEY)|(PUBLIC KEY)|(CERTIFICATE))-----/,"").replace(/\n/g,"");return ws(e)}class Ne{constructor(e={}){if("view"in e)this.fromUint8Array(e.view);else if("buffer"in e)this.fromArrayBuffer(e.buffer);else if("string"in e)this.fromString(e.string);else if("hexstring"in e)this.fromHexString(e.hexstring);else if("length"in e&&e.length>0){if(this.length=e.length,e.stub)for(let t=0;t<this._view.length;t++)this._view[t]=e.stub}else this.length=0}set buffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}get view(){return this._view}get length(){return this.view.byteLength}set length(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}fromUint8Array(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}fromString(e){const t=e.length;this.length=t;for(let r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}toString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}fromHexString(e){const t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);const r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);let a=0,n=0;for(let u=0;u<t;u++)u%2?(n|=r.get(e.charAt(u)),this.view[a]=n,a++):n=r.get(e.charAt(u))<<4}toHexString(e=0,t=this.view.length-e){let r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(let a=e;a<e+t;a++){const n=this.view[a].toString(16).toUpperCase();r=r+(n.length==1?"0":"")+n}return r}copy(e=0,t=this.length-e){if(!e&&!this.length)return new Ne;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ne({buffer:this._buffer.slice(e,e+t)})}slice(e=0,t=this.length){if(!e&&!this.length)return new Ne;if(e<0||e>this.length-1)throw new Error("Wrong start position: ".concat(e));return new Ne({buffer:this._buffer.slice(e,t)})}realloc(e){const t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}append(e){const t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}insert(e,t=0,r=this.length-t){return t>this.length-1?!1:(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}isEqual(e){if(this.length!=e.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}isEqualView(e){if(e.length!=this.view.length)return!1;for(let t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}findPattern(e,t,r,a){const{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a),l=e.length;if(l>u)return-1;const o=[];for(let c=0;c<l;c++)o.push(e.view[c]);for(let c=0;c<=u-l;c++){let m=!0;const h=i?n-l-c:n+c;for(let p=0;p<l;p++)if(this.view[p+h]!=o[p]){m=!1;break}if(m)return i?n-l-c:n+l+c}return-1}findFirstIn(e,t,r,a){const{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a),l={id:-1,position:i?0:n+u,length:0};for(let o=0;o<e.length;o++){const c=this.findPattern(e[o],n,u,i);if(c!=-1){let m=!1;const h=e[o].length;i?c-h>=l.position-l.length&&(m=!0):c-h<=l.position-l.length&&(m=!0),m&&(l.position=c,l.id=o,l.length=h)}}return l}findAllIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const u=[];let i={id:-1,position:a};do{const l=i.position;if(i=this.findFirstIn(e,i.position,n),i.id==-1)break;n-=i.position-l,u.push({id:i.id,position:i.position})}while(!0);return u}findAllPatternIn(e,t,r){const{start:a,length:n}=this.prepareFindParameters(t,r),u=[],i=e.length;if(i>n)return-1;const l=Array.from(e.view);for(let o=0;o<=n-i;o++){let c=!0;const m=a+o;for(let h=0;h<i;h++)if(this.view[h+m]!=l[h]){c=!1;break}c&&(u.push(a+i+o),o+=i-1)}return u}findFirstNotIn(e,t,r,a){let{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a);const l={left:{id:-1,position:n},right:{id:-1,position:0},value:new Ne};let o=u;for(;o>0;){if(l.right=this.findFirstIn(e,i?n-u+o:n+u-o,o,i),l.right.id==-1){u=o,i?n-=u:n=l.left.position,l.value=new Ne({buffer:this._buffer.slice(n,n+u)});break}if(l.right.position!=(i?l.left.position-e[l.right.id].length:l.left.position+e[l.right.id].length)){i?(n=l.right.position+e[l.right.id].length,u=l.left.position-l.right.position-e[l.right.id].length):(n=l.left.position,u=l.right.position-l.left.position-e[l.right.id].length),l.value=new Ne({buffer:this._buffer.slice(n,n+u)});break}l.left=l.right,o-=e[l.right.id].length}if(i){const c=l.right;l.right=l.left,l.left=c}return l}findAllNotIn(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const u=[];let i={left:{id:-1,position:a},right:{id:-1,position:a},value:new Ne};do{const l=i.right.position;i=this.findFirstNotIn(e,i.right.position,n),n-=i.right.position-l,u.push({left:{id:i.left.id,position:i.left.position},right:{id:i.right.id,position:i.right.position},value:i.value})}while(i.right.id!=-1);return u}findFirstSequence(e,t,r,a){let{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a);const l=this.skipNotPatterns(e,n,u,i);if(l==-1)return{position:-1,value:new Ne};const o=this.skipPatterns(e,l,u-(i?n-l:l-n),i);i?(n=o,u=l-o):(n=l,u=o-l);const c=new Ne({buffer:this._buffer.slice(n,n+u)});return{position:o,value:c}}findAllSequences(e,t,r){let{start:a,length:n}=this.prepareFindParameters(t,r);const u=[];let i={position:a,value:new Ne};do{const l=i.position;i=this.findFirstSequence(e,i.position,n),i.position!=-1&&(n-=i.position-l,u.push({position:i.position,value:i.value}))}while(i.position!=-1);return u}findPairedPatterns(e,t,r,a){const n=[];if(e.isEqual(t))return n;const{start:u,length:i}=this.prepareFindParameters(r,a);let l=0;const o=this.findAllPatternIn(e,u,i);if(!Array.isArray(o)||o.length==0)return n;const c=this.findAllPatternIn(t,u,i);if(!Array.isArray(c)||c.length==0)return n;for(;l<o.length&&c.length!=0;){if(o[0]==c[0]){n.push({left:o[0],right:c[0]}),o.splice(0,1),c.splice(0,1);continue}if(o[l]>c[0])break;for(;o[l]<c[0]&&(l++,!(l>=o.length)););n.push({left:o[l-1],right:c[0]}),o.splice(l-1,1),c.splice(0,1),l=0}return n.sort((m,h)=>m.left-h.left),n}findPairedArrays(e,t,r,a){const{start:n,length:u}=this.prepareFindParameters(r,a),i=[];let l=0;const o=this.findAllIn(e,n,u);if(o.length==0)return i;const c=this.findAllIn(t,n,u);if(c.length==0)return i;for(;l<o.length&&c.length!=0;){if(o[0].position==c[0].position){i.push({left:o[0],right:c[0]}),o.splice(0,1),c.splice(0,1);continue}if(o[l].position>c[0].position)break;for(;o[l].position<c[0].position&&(l++,!(l>=o.length)););i.push({left:o[l-1],right:c[0]}),o.splice(l-1,1),c.splice(0,1),l=0}return i.sort((m,h)=>m.left.position-h.left.position),i}replacePattern(e,t,r,a,n=null){let u=[],i;const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:o,length:c}=this.prepareFindParameters(r,a);if(n==null){if(u=this.findAllIn([e],o,c),u.length==0)return l}else u=n;l.searchPatternPositions.push(...Array.from(u,d=>d.position));const m=e.length-t.length,h=new ArrayBuffer(this.view.length-u.length*m),p=new Uint8Array(h);for(p.set(new Uint8Array(this.buffer,0,o)),i=0;i<u.length;i++){const d=i==0?o:u[i-1].position;p.set(new Uint8Array(this.buffer,d,u[i].position-e.length-d),d-i*m),p.set(t.view,u[i].position-e.length-i*m),l.replacePatternPositions.push(u[i].position-e.length-i*m)}return i--,p.set(new Uint8Array(this.buffer,u[i].position,this.length-u[i].position),u[i].position-e.length+t.length-i*m),this.buffer=h,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(e,t,r,a){const{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a);let l=n;for(let o=0;o<e.length;o++){const c=e[o].length,m=i?l-c:l;let h=!0;for(let p=0;p<c;p++)if(this.view[p+m]!=e[o].view[p]){h=!1;break}if(h){if(o=-1,i){if(l-=c,l<=0)return l}else if(l+=c,l>=n+u)return l}}return l}skipNotPatterns(e,t,r,a){const{start:n,length:u,backward:i}=this.prepareFindParameters(t,r,a);let l=-1;for(let o=0;o<u;o++){for(let c=0;c<e.length;c++){const m=e[c].length,h=i?n-o-m:n+o;let p=!0;for(let d=0;d<m;d++)if(this.view[d+h]!=e[c].view[d]){p=!1;break}if(p){l=i?n-o:n+o;break}}if(l!=-1)break}return l}prepareFindParameters(e=null,t=null,r=!1){return e===null&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(t===null&&(t=e),t>e&&(t=e)):(t===null&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}const Hb=16777216;class ra{constructor(e={}){this._stream=new Ne,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,"view"in e?this.stream=new Ne({view:e.view}):"buffer"in e?this.stream=new Ne({buffer:e.buffer}):"string"in e?this.stream=new Ne({string:e.string}):"hexstring"in e?this.stream=new Ne({hexstring:e.hexstring}):"stream"in e?this.stream=e.stream.slice():this.stream=new Ne,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findPattern(e,this.start,this.length,this.backward);if(r==-1)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}findFirstIn(e,t=null){(t==null||t>this.length)&&(t=this.length);const r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(r.id==-1)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}findAllIn(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}findFirstNotIn(e,t=null){(t==null||t>this._length)&&(t=this._length);const r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(r.left.id==-1&&r.right.id==-1)return r;if(this.backward){if(r.right.id!=-1&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ne}}else if(r.left.id!=-1&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new Ne};return this.backward?r.left.id==-1?this.start=0:this.start=r.left.position:r.right.id==-1?this.start=this._start+this._length:this.start=r.right.position,r}findAllNotIn(e){const t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}findFirstSequence(e,t=null,r=null){(t==null||t>this._length)&&(t=this._length),(r==null||r>t)&&(r=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(a.value.length==0)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new Ne}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new Ne};return this.start=a.position,a}findAllSequences(e){const t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}findPairedPatterns(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[]}return n}findPairedArrays(e,t,r=null){(r==null||r>this.length)&&(r=this.length);const a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length){if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[]}return n}replacePattern(e,t){const r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return t==-1?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=e.length*2,this.start=this._start+e.length,this.prevLength-=e.length*2}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);this._length<e&&(e=this._length);let r;if(this.backward){const a=this._stream.view.subarray(this._length-e,this._length);r=new Uint8Array(e);for(let n=0;n<e;n++)r[e-1-n]=a[n]}else r=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),r}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:t[0]*Hb+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+ra.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}ra.APPEND_BLOCK=1e3;function Mb(s){return s instanceof Uint8Array||ArrayBuffer.isView(s)&&s.constructor.name==="Uint8Array"}function bg(s,...e){if(!Mb(s))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(s.length))throw new Error("Uint8Array expected of length "+e+", got length="+s.length)}function op(s,e=!0){if(s.destroyed)throw new Error("Hash instance has been destroyed");if(e&&s.finished)throw new Error("Hash#digest() has already been called")}function Fb(s,e){bg(s);const t=e.outputLen;if(s.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const gm=s=>new DataView(s.buffer,s.byteOffset,s.byteLength),ls=(s,e)=>s<<32-e|s>>>e,wm=(s,e)=>s<<e|s>>>32-e>>>0;function Jb(s){if(typeof s!="string")throw new Error("utf8ToBytes expected string, got "+typeof s);return new Uint8Array(new TextEncoder().encode(s))}function Sg(s){return typeof s=="string"&&(s=Jb(s)),bg(s),s}class qb{clone(){return this._cloneInto()}}function Yh(s){const e=r=>s().update(Sg(r)).digest(),t=s();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>s(),e}function Wb(s,e,t,r){if(typeof s.setBigUint64=="function")return s.setBigUint64(e,t,r);const a=BigInt(32),n=BigInt(4294967295),u=Number(t>>a&n),i=Number(t&n),l=r?4:0,o=r?0:4;s.setUint32(e+l,u,r),s.setUint32(e+o,i,r)}const Ag=(s,e,t)=>s&e^~s&t,Ng=(s,e,t)=>s&e^s&t^e&t;class od extends qb{constructor(e,t,r,a){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=a,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=gm(this.buffer)}update(e){op(this);const{view:t,buffer:r,blockLen:a}=this;e=Sg(e);const n=e.length;for(let u=0;u<n;){const i=Math.min(a-this.pos,n-u);if(i===a){const l=gm(e);for(;a<=n-u;u+=a)this.process(l,u);continue}r.set(e.subarray(u,u+i),this.pos),this.pos+=i,u+=i,this.pos===a&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){op(this),Fb(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:a,isLE:n}=this;let{pos:u}=this;t[u++]=128,this.buffer.subarray(u).fill(0),this.padOffset>a-u&&(this.process(r,0),u=0);for(let m=u;m<a;m++)t[m]=0;Wb(r,a-8,BigInt(this.length*8),n),this.process(r,0);const i=gm(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const o=l/4,c=this.get();if(o>c.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<o;m++)i.setUint32(4*m,c[m],n)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:a,finished:n,destroyed:u,pos:i}=this;return e.length=a,e.pos=i,e.finished=n,e.destroyed=u,a%t&&e.buffer.set(r),e}}const jo=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),Zs=new Uint32Array(80);let Gb=class extends od{constructor(){super(64,20,8,!1),this.A=jo[0]|0,this.B=jo[1]|0,this.C=jo[2]|0,this.D=jo[3]|0,this.E=jo[4]|0}get(){const{A:s,B:e,C:t,D:r,E:a}=this;return[s,e,t,r,a]}set(s,e,t,r,a){this.A=s|0,this.B=e|0,this.C=t|0,this.D=r|0,this.E=a|0}process(s,e){for(let i=0;i<16;i++,e+=4)Zs[i]=s.getUint32(e,!1);for(let i=16;i<80;i++)Zs[i]=wm(Zs[i-3]^Zs[i-8]^Zs[i-14]^Zs[i-16],1);let{A:t,B:r,C:a,D:n,E:u}=this;for(let i=0;i<80;i++){let l,o;i<20?(l=Ag(r,a,n),o=1518500249):i<40?(l=r^a^n,o=1859775393):i<60?(l=Ng(r,a,n),o=2400959708):(l=r^a^n,o=3395469782);const c=wm(t,5)+l+u+o+Zs[i]|0;u=n,n=a,a=wm(r,30),r=t,t=c}t=t+this.A|0,r=r+this.B|0,a=a+this.C|0,n=n+this.D|0,u=u+this.E|0,this.set(t,r,a,n,u)}roundClean(){Zs.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}};const zb=Yh(()=>new Gb),_b=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qs=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ys=new Uint32Array(64);let Xb=class extends od{constructor(){super(64,32,8,!1),this.A=Qs[0]|0,this.B=Qs[1]|0,this.C=Qs[2]|0,this.D=Qs[3]|0,this.E=Qs[4]|0,this.F=Qs[5]|0,this.G=Qs[6]|0,this.H=Qs[7]|0}get(){const{A:s,B:e,C:t,D:r,E:a,F:n,G:u,H:i}=this;return[s,e,t,r,a,n,u,i]}set(s,e,t,r,a,n,u,i){this.A=s|0,this.B=e|0,this.C=t|0,this.D=r|0,this.E=a|0,this.F=n|0,this.G=u|0,this.H=i|0}process(s,e){for(let c=0;c<16;c++,e+=4)Ys[c]=s.getUint32(e,!1);for(let c=16;c<64;c++){const m=Ys[c-15],h=Ys[c-2],p=ls(m,7)^ls(m,18)^m>>>3,d=ls(h,17)^ls(h,19)^h>>>10;Ys[c]=d+Ys[c-7]+p+Ys[c-16]|0}let{A:t,B:r,C:a,D:n,E:u,F:i,G:l,H:o}=this;for(let c=0;c<64;c++){const m=ls(u,6)^ls(u,11)^ls(u,25),h=o+m+Ag(u,i,l)+_b[c]+Ys[c]|0,p=(ls(t,2)^ls(t,13)^ls(t,22))+Ng(t,r,a)|0;o=l,l=i,i=u,u=n+h|0,n=a,a=r,r=t,t=h+p|0}t=t+this.A|0,r=r+this.B|0,a=a+this.C|0,n=n+this.D|0,u=u+this.E|0,i=i+this.F|0,l=l+this.G|0,o=o+this.H|0,this.set(t,r,a,n,u,i,l,o)}roundClean(){Ys.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Zb=Yh(()=>new Xb),wc=BigInt(2**32-1),df=BigInt(32);function kg(s,e=!1){return e?{h:Number(s&wc),l:Number(s>>df&wc)}:{h:Number(s>>df&wc)|0,l:Number(s&wc)|0}}function Qb(s,e=!1){let t=new Uint32Array(s.length),r=new Uint32Array(s.length);for(let a=0;a<s.length;a++){const{h:n,l:u}=kg(s[a],e);[t[a],r[a]]=[n,u]}return[t,r]}const Yb=(s,e)=>BigInt(s>>>0)<<df|BigInt(e>>>0),e0=(s,e,t)=>s>>>t,t0=(s,e,t)=>s<<32-t|e>>>t,s0=(s,e,t)=>s>>>t|e<<32-t,r0=(s,e,t)=>s<<32-t|e>>>t,a0=(s,e,t)=>s<<64-t|e>>>t-32,n0=(s,e,t)=>s>>>t-32|e<<64-t,i0=(s,e)=>e,o0=(s,e)=>s,u0=(s,e,t)=>s<<t|e>>>32-t,l0=(s,e,t)=>e<<t|s>>>32-t,c0=(s,e,t)=>e<<t-32|s>>>64-t,h0=(s,e,t)=>s<<t-32|e>>>64-t;function m0(s,e,t,r){const a=(e>>>0)+(r>>>0);return{h:s+t+(a/2**32|0)|0,l:a|0}}const f0=(s,e,t)=>(s>>>0)+(e>>>0)+(t>>>0),d0=(s,e,t,r)=>e+t+r+(s/2**32|0)|0,p0=(s,e,t,r)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0),g0=(s,e,t,r,a)=>e+t+r+a+(s/2**32|0)|0,w0=(s,e,t,r,a)=>(s>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(a>>>0),y0=(s,e,t,r,a,n)=>e+t+r+a+n+(s/2**32|0)|0,te={fromBig:kg,split:Qb,toBig:Yb,shrSH:e0,shrSL:t0,rotrSH:s0,rotrSL:r0,rotrBH:a0,rotrBL:n0,rotr32H:i0,rotr32L:o0,rotlSH:u0,rotlSL:l0,rotlBH:c0,rotlBL:h0,add:m0,add3L:f0,add3H:d0,add4L:p0,add4H:g0,add5H:y0,add5L:w0},[v0,b0]=te.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(s=>BigInt(s))),er=new Uint32Array(80),tr=new Uint32Array(80);let Eg=class extends od{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:s,Al:e,Bh:t,Bl:r,Ch:a,Cl:n,Dh:u,Dl:i,Eh:l,El:o,Fh:c,Fl:m,Gh:h,Gl:p,Hh:d,Hl:w}=this;return[s,e,t,r,a,n,u,i,l,o,c,m,h,p,d,w]}set(s,e,t,r,a,n,u,i,l,o,c,m,h,p,d,w){this.Ah=s|0,this.Al=e|0,this.Bh=t|0,this.Bl=r|0,this.Ch=a|0,this.Cl=n|0,this.Dh=u|0,this.Dl=i|0,this.Eh=l|0,this.El=o|0,this.Fh=c|0,this.Fl=m|0,this.Gh=h|0,this.Gl=p|0,this.Hh=d|0,this.Hl=w|0}process(s,e){for(let g=0;g<16;g++,e+=4)er[g]=s.getUint32(e),tr[g]=s.getUint32(e+=4);for(let g=16;g<80;g++){const b=er[g-15]|0,N=tr[g-15]|0,S=te.rotrSH(b,N,1)^te.rotrSH(b,N,8)^te.shrSH(b,N,7),C=te.rotrSL(b,N,1)^te.rotrSL(b,N,8)^te.shrSL(b,N,7),x=er[g-2]|0,E=tr[g-2]|0,P=te.rotrSH(x,E,19)^te.rotrBH(x,E,61)^te.shrSH(x,E,6),K=te.rotrSL(x,E,19)^te.rotrBL(x,E,61)^te.shrSL(x,E,6),L=te.add4L(C,K,tr[g-7],tr[g-16]),U=te.add4H(L,S,P,er[g-7],er[g-16]);er[g]=U|0,tr[g]=L|0}let{Ah:t,Al:r,Bh:a,Bl:n,Ch:u,Cl:i,Dh:l,Dl:o,Eh:c,El:m,Fh:h,Fl:p,Gh:d,Gl:w,Hh:y,Hl:k}=this;for(let g=0;g<80;g++){const b=te.rotrSH(c,m,14)^te.rotrSH(c,m,18)^te.rotrBH(c,m,41),N=te.rotrSL(c,m,14)^te.rotrSL(c,m,18)^te.rotrBL(c,m,41),S=c&h^~c&d,C=m&p^~m&w,x=te.add5L(k,N,C,b0[g],tr[g]),E=te.add5H(x,y,b,S,v0[g],er[g]),P=x|0,K=te.rotrSH(t,r,28)^te.rotrBH(t,r,34)^te.rotrBH(t,r,39),L=te.rotrSL(t,r,28)^te.rotrBL(t,r,34)^te.rotrBL(t,r,39),U=t&a^t&u^a&u,j=r&n^r&i^n&i;y=d|0,k=w|0,d=h|0,w=p|0,h=c|0,p=m|0,{h:c,l:m}=te.add(l|0,o|0,E|0,P|0),l=u|0,o=i|0,u=a|0,i=n|0,a=t|0,n=r|0;const M=te.add3L(P,L,j);t=te.add3H(M,E,K,U),r=M|0}({h:t,l:r}=te.add(this.Ah|0,this.Al|0,t|0,r|0)),{h:a,l:n}=te.add(this.Bh|0,this.Bl|0,a|0,n|0),{h:u,l:i}=te.add(this.Ch|0,this.Cl|0,u|0,i|0),{h:l,l:o}=te.add(this.Dh|0,this.Dl|0,l|0,o|0),{h:c,l:m}=te.add(this.Eh|0,this.El|0,c|0,m|0),{h,l:p}=te.add(this.Fh|0,this.Fl|0,h|0,p|0),{h:d,l:w}=te.add(this.Gh|0,this.Gl|0,d|0,w|0),{h:y,l:k}=te.add(this.Hh|0,this.Hl|0,y|0,k|0),this.set(t,r,a,n,u,i,l,o,c,m,h,p,d,w,y,k)}roundClean(){er.fill(0),tr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},S0=class extends Eg{constructor(){super(),this.Ah=-876896931,this.Al=-1056596264,this.Bh=1654270250,this.Bl=914150663,this.Ch=-1856437926,this.Cl=812702999,this.Dh=355462360,this.Dl=-150054599,this.Eh=1731405415,this.El=-4191439,this.Fh=-1900787065,this.Fl=1750603025,this.Gh=-619958771,this.Gl=1694076839,this.Hh=1203062813,this.Hl=-1090891868,this.outputLen=48}};const A0=Yh(()=>new Eg),N0=Yh(()=>new S0),Ue=new ArrayBuffer(0),v="";class he extends TypeError{constructor(){super(...arguments),this.name=he.NAME}static isType(e,t){if(typeof t=="string"){if(t==="Array"&&Array.isArray(e)||t==="ArrayBuffer"&&e instanceof ArrayBuffer||t==="ArrayBufferView"&&ArrayBuffer.isView(e)||typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...r){for(const n of r)if(this.isType(e,n))return;const a=r.map(n=>n instanceof Function&&"name"in n?n.name:"".concat(n));throw new he("Parameter '".concat(t,"' is not of type ").concat(a.length>1?"(".concat(a.join(" or "),")"):a[0]))}}he.NAME="ArgumentError";class ne extends TypeError{static assert(...e){let t=null,r,a;typeof e[0]=="string"?(t=e[0],r=e[1],a=e.slice(2)):(r=e[0],a=e.slice(1)),he.assert(r,"parameters","object");for(const n of a)if(r[n]==null)throw new ne(n,t)}static assertEmpty(e,t,r){if(e==null)throw new ne(t,r)}constructor(e,t=null,r){super(),this.name=ne.NAME,this.field=e,t&&(this.target=t),r?this.message=r:this.message="Absent mandatory parameter '".concat(e,"' ").concat(t?" in '".concat(t,"'"):v)}}ne.NAME="ParameterError";class O extends Error{static assertSchema(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}static assert(e,t){if(e.offset===-1)throw new O("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}constructor(e){super(e),this.name="AsnError"}}class D{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=je(e);O.assert(t,this.name);try{return new this({schema:t.result})}catch(r){throw new O("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}static defaultValues(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}static schema(e={}){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch(r){t=this.toSchema(!0)}return ce.ToString(t.toBER(),e)}}D.CLASS_NAME="PkiObject";function Fr(s){let e=!1,t=v;const r=s.trim();for(let a=0;a<r.length;a++)r.charCodeAt(a)===32?e===!1&&(e=!0):(e&&(t+=" ",e=!1),t+=r[a]);return t.toLowerCase()}const Uo="type",ym="value";class Zr extends D{constructor(e={}){super(),this.type=f(e,Uo,Zr.defaultValues(Uo)),this.value=f(e,ym,Zr.defaultValues(ym)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uo:return v;case ym:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.type||v}),new X({name:t.value||v})]})}fromSchema(e){T(e,[Uo,"typeValue"]);const t=R(e,e,Zr.schema({names:{type:Uo,value:"typeValue"}}));O.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new A({value:[new J({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return Object.keys(this.value).length!==0?e.value=this.value.toJSON():e.value=this.value,e}isEqual(e){const t=[xh.blockName(),ef.blockName(),tf.blockName(),Jc.blockName(),Ls.blockName(),sf.blockName(),ww.blockName(),$p.blockName(),yw.blockName(),vw.blockName(),bw.blockName(),Sw.blockName()];if(e instanceof ArrayBuffer)return pe.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===Zr.blockName()){if(this.type!==e.type)return!1;const r=[!1,!1],a=this.value.constructor.blockName();for(const n of t)a===n&&(r[0]=!0),e.value.constructor.blockName()===n&&(r[1]=!0);if(r[0]!==r[1])return!1;if(r[0]&&r[1]){const n=Fr(this.value.valueBlock.value),u=Fr(e.value.valueBlock.value);if(n.localeCompare(u)!==0)return!1}else if(!pe.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}Zr.CLASS_NAME="AttributeTypeAndValue";const ha="typesAndValues",yc="valueBeforeDecode",up="RDN";class me extends D{constructor(e={}){super(),this.typesAndValues=f(e,ha,me.defaultValues(ha)),this.valueBeforeDecode=f(e,yc,me.defaultValues(yc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ha:return[];case yc:return Ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ha:return t.length===0;case yc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.repeatedSequence||v,value:new Je({value:[new Z({name:t.repeatedSet||v,value:Zr.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){T(e,[up,ha]);const t=R(e,e,me.schema({names:{blockName:up,repeatedSet:ha}}));O.assertSchema(t,this.className),ha in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,r=>new Zr({schema:r}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(this.valueBeforeDecode.byteLength===0)return new A({value:[new Je({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=je(this.valueBeforeDecode);if(O.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof A))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof me){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,r]of this.typesAndValues.entries())if(r.isEqual(e.typesAndValues[t])===!1)return!1;return!0}return e instanceof ArrayBuffer?Ql(this.valueBeforeDecode,e):!1}}me.CLASS_NAME="RelativeDistinguishedNames";const Qo="type",Yo="value";function k0(s={},e=!1){const t=f(s,"names",{});return new A({optional:e,value:[new I({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:t.country_name||v,value:[new ke({value:[new Jc,new Ls]})]}),new I({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:t.administration_domain_name||v,value:[new ke({value:[new Jc,new Ls]})]}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:t.network_address||v,isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:t.terminal_identifier||v,isHexOnly:!0}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:t.private_domain_name||v,value:[new ke({value:[new Jc,new Ls]})]}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:t.organization_name||v,isHexOnly:!0}),new _({optional:!0,name:t.numeric_user_identifier||v,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new I({optional:!0,name:t.personal_name||v,idBlock:{tagClass:3,tagNumber:5},value:[new _({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new _({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new I({optional:!0,name:t.organizational_unit_names||v,idBlock:{tagClass:3,tagNumber:6},value:[new Z({value:new Ls})]})]})}function E0(s=!1){return new A({optional:s,value:[new Ls,new Ls]})}function C0(s=!1){return new Je({optional:s,value:[new _({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new X]})]})}class ue extends D{constructor(e={}){super(),this.type=f(e,Qo,ue.defaultValues(Qo)),this.value=f(e,Yo,ue.defaultValues(Yo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qo:return 9;case Yo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qo:return t===ue.defaultValues(e);case Yo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new ke({value:[new I({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||v,value:[new J,new I({idBlock:{tagClass:3,tagNumber:0},value:[new X]})]}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:1}}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:2}}),new I({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||v,value:[k0(t.builtInStandardAttributes||{},!1),E0(!0),C0(!0)]}),new I({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||v,value:[me.schema(t.directoryName||{})]}),new I({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||v,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({value:[new sf,new Ls,new tf,new xh,new ef]})]}),new I({idBlock:{tagClass:3,tagNumber:1},value:[new ke({value:[new sf,new Ls,new tf,new xh,new ef]})]})]}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:6}}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:7}}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){T(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=R(e,e,ue.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(O.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=t.result.blockName;break;case 1:case 2:case 6:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=22;const a=r.toBER(!1),n=je(a);O.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value}break;case 3:this.value=t.result.blockName;break;case 4:this.value=new me({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new $({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const r=t.result.blockName;r.idBlock.tagClass=1,r.idBlock.tagNumber=6;const a=r.toBER(!1),n=je(a);O.assert(n,"GeneralName registeredID"),this.value=n.result.valueBlock.toString()}break}}toSchema(){switch(this.type){case 0:case 3:case 5:return new I({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new $p({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new I({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new J({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return ue.schema()}}toJSON(){const e={type:this.type,value:v};if(typeof this.value=="string")e.value=this.value;else try{e.value=this.value.toJSON()}catch(t){}return e}}ue.CLASS_NAME="GeneralName";const eu="accessMethod",tu="accessLocation",x0=[eu,tu];class En extends D{constructor(e={}){super(),this.accessMethod=f(e,eu,En.defaultValues(eu)),this.accessLocation=f(e,tu,En.defaultValues(tu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eu:return v;case tu:return new ue;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.accessMethod||v}),ue.schema(t.accessLocation||{})]})}fromSchema(e){T(e,x0);const t=R(e,e,En.schema({names:{accessMethod:eu,accessLocation:{names:{blockName:tu}}}}));O.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new ue({schema:t.result.accessLocation})}toSchema(){return new A({value:[new J({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}En.CLASS_NAME="AccessDescription";const nr="seconds",ir="millis",or="micros";class Dt extends D{constructor(e={}){super(),nr in e&&(this.seconds=f(e,nr,Dt.defaultValues(nr))),ir in e&&(this.millis=f(e,ir,Dt.defaultValues(ir))),or in e&&(this.micros=f(e,or,Dt.defaultValues(or))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nr:case ir:case or:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case nr:case ir:case or:return t===Dt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,optional:!0,value:[new B({optional:!0,name:t.seconds||v}),new _({name:t.millis||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.micros||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){T(e,[nr,ir,or]);const t=R(e,e,Dt.schema({names:{seconds:nr,millis:ir,micros:or}}));if(O.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const r=new B({valueHex:t.result.millis.valueBlock.valueHex});this.millis=r.valueBlock.valueDec}if("micros"in t.result){const r=new B({valueHex:t.result.micros.valueBlock.valueHex});this.micros=r.valueBlock.valueDec}}toSchema(){const e=[];if(this.seconds!==void 0&&e.push(new B({value:this.seconds})),this.millis!==void 0){const t=new B({value:this.millis});e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(this.micros!==void 0){const t=new B({value:this.micros});e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new A({value:e})}toJSON(){const e={};return this.seconds!==void 0&&(e.seconds=this.seconds),this.millis!==void 0&&(e.millis=this.millis),this.micros!==void 0&&(e.micros=this.micros),e}}Dt.CLASS_NAME="Accuracy";const vc="algorithmId",$o="algorithmParams",Cg="algorithm",pf="params",I0=[Cg,pf];class V extends D{constructor(e={}){super(),this.algorithmId=f(e,vc,V.defaultValues(vc)),$o in e&&(this.algorithmParams=f(e,$o,V.defaultValues($o))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vc:return v;case $o:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vc:return t===v;case $o:return t instanceof X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,optional:t.optional||!1,value:[new J({name:t.algorithmIdentifier||v}),new X({name:t.algorithmParams||v,optional:!0})]})}fromSchema(e){T(e,I0);const t=R(e,e,V.schema({names:{algorithmIdentifier:Cg,algorithmParams:pf}}));O.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),pf in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new J({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof X)&&e.push(this.algorithmParams),new A({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof X)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return!(e instanceof V)||this.algorithmId!==e.algorithmId?!1:this.algorithmParams?e.algorithmParams?JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!1:!e.algorithmParams}}V.CLASS_NAME="AlgorithmIdentifier";const Gn="altNames",V0=[Gn];class Co extends D{constructor(e={}){super(),this.altNames=f(e,Gn,Co.defaultValues(Gn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Gn:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.altNames||v,value:ue.schema()})]})}fromSchema(e){T(e,V0);const t=R(e,e,Co.schema({names:{altNames:Gn}}));O.assertSchema(t,this.className),Gn in t.result&&(this.altNames=Array.from(t.result.altNames,r=>new ue({schema:r})))}toSchema(){return new A({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}Co.CLASS_NAME="AltName";const zn="type",_n="values",B0=[zn,_n];class ge extends D{constructor(e={}){super(),this.type=f(e,zn,ge.defaultValues(zn)),this.values=f(e,_n,ge.defaultValues(_n)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zn:return v;case _n:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zn:return t===v;case _n:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.type||v}),new Je({name:t.setName||v,value:[new Z({name:t.values||v,value:new X})]})]})}fromSchema(e){T(e,B0);const t=R(e,e,ge.schema({names:{type:zn,values:_n}}));O.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new A({value:[new J({value:this.type}),new Je({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}ge.CLASS_NAME="Attribute";const su="notBeforeTime",ru="notAfterTime",P0=[su,ru];class is extends D{constructor(e={}){super(),this.notBeforeTime=f(e,su,is.defaultValues(su)),this.notAfterTime=f(e,ru,is.defaultValues(ru)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case su:case ru:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Ee({name:t.notBeforeTime||v}),new Ee({name:t.notAfterTime||v})]})}fromSchema(e){T(e,P0);const t=R(e,e,is.schema({names:{notBeforeTime:su,notAfterTime:ru}}));O.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new A({value:[new Ee({valueDate:this.notBeforeTime}),new Ee({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}is.CLASS_NAME="AttCertValidityPeriod";const Ko="names",lp="generalNames";class qe extends D{constructor(e={}){super(),this.names=f(e,Ko,qe.defaultValues(Ko)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"names":return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,Ko,{});return new A({optional:t,name:r.blockName||v,value:[new Z({name:r.generalNames||v,value:ue.schema()})]})}fromSchema(e){T(e,[Ko,lp]);const t=R(e,e,qe.schema({names:{blockName:Ko,generalNames:lp}}));O.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,r=>new ue({schema:r}))}toSchema(){return new A({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}qe.CLASS_NAME="GeneralNames";const O0="2.5.29.9",D0="2.5.29.14",T0="2.5.29.15",R0="2.5.29.16",xg="2.5.29.17",Ig="2.5.29.18",ud="2.5.29.19",L0="2.5.29.20",j0="2.5.29.27",U0="2.5.29.21",$0="2.5.29.24",Vg="2.5.29.28",Bg="2.5.29.29",Pg="2.5.29.30",Og="2.5.29.31",ld="2.5.29.46",Dg="2.5.29.32",$t="2.5.29.32.0",K0="1.3.6.1.4.1.311.21.10",Tg="2.5.29.33",cd="2.5.29.35",Rg="2.5.29.36",H0="2.5.29.37",M0="2.5.29.54",hd="1.3.6.1.5.5.7.1.1",F0="1.3.6.1.5.5.7.1.11",J0="1.3.6.1.4.1.11129.2.4.2",q0="1.3.6.1.4.1.311.21.7",W0="1.3.6.1.4.1.311.21.1",G0="1.3.6.1.5.5.7.1.3",md="1.2.840.113549.1.7.1",Lg="1.2.840.113549.1.7.2",jg="1.2.840.113549.1.7.3",Ug="1.2.840.113549.1.7.6",z0="1.2.840.113549.1.9.16.1.4",cp="1.2.840.113549.1.9.22.1",_0="1.2.840.113549.1.9.22.2",hp="1.2.840.113549.1.9.22.3",mp="1.2.840.113549.1.9.23.1",X0="1.3.6.1.5.5.7",Z0="".concat(X0,".48"),Gc="".concat(Z0,".1.1"),ga="keyIdentifier",wa="authorityCertIssuer",ya="authorityCertSerialNumber",Q0=[ga,wa,ya];class Qr extends D{constructor(e={}){super(),ga in e&&(this.keyIdentifier=f(e,ga,Qr.defaultValues(ga))),wa in e&&(this.authorityCertIssuer=f(e,wa,Qr.defaultValues(wa))),ya in e&&(this.authorityCertSerialNumber=f(e,ya,Qr.defaultValues(ya))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ga:return new $;case wa:return[];case ya:return new B;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new _({name:t.keyIdentifier||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.authorityCertIssuer||v,value:ue.schema()})]}),new _({name:t.authorityCertSerialNumber||v,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){T(e,Q0);const t=R(e,e,Qr.schema({names:{keyIdentifier:ga,authorityCertIssuer:wa,authorityCertSerialNumber:ya}}));O.assertSchema(t,this.className),ga in t.result&&(this.keyIdentifier=new $({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),wa in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,r=>new ue({schema:r}))),ya in t.result&&(this.authorityCertSerialNumber=new B({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new _({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new A({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}Qr.CLASS_NAME="AuthorityKeyIdentifier";const ma="pathLenConstraint",fa="cA";class Cn extends D{constructor(e={}){super(),this.cA=f(e,fa,!1),ma in e&&(this.pathLenConstraint=f(e,ma,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fa:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new ua({optional:!0,name:t.cA||v}),new B({optional:!0,name:t.pathLenConstraint||v})]})}fromSchema(e){T(e,[fa,ma]);const t=R(e,e,Cn.schema({names:{cA:fa,pathLenConstraint:ma}}));O.assertSchema(t,this.className),fa in t.result&&(this.cA=t.result.cA.valueBlock.value),ma in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==Cn.defaultValues(fa)&&e.push(new ua({value:this.cA})),ma in this&&(this.pathLenConstraint instanceof B?e.push(this.pathLenConstraint):e.push(new B({value:this.pathLenConstraint}))),new A({value:e})}toJSON(){const e={};return this.cA!==Cn.defaultValues(fa)&&(e.cA=this.cA),ma in this&&(this.pathLenConstraint instanceof B?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}Cn.CLASS_NAME="BasicConstraints";const vm="certificateIndex",bm="keyIndex";class sc extends D{constructor(e={}){super(),this.certificateIndex=f(e,vm,sc.defaultValues(vm)),this.keyIndex=f(e,bm,sc.defaultValues(bm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vm:case bm:return 0;default:return super.defaultValues(e)}}static schema(){return new B}fromSchema(e){if(e.constructor.blockName()!==B.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const r=new Uint8Array(t);switch(!0){case t.byteLength<4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(r,4-t.byteLength),t=m.slice(0)}break;case t.byteLength>4:{const m=new ArrayBuffer(4);new Uint8Array(m).set(r.slice(0,4)),t=m.slice(0)}break}const a=t.slice(0,2),n=new Uint8Array(a);let u=n[0];n[0]=n[1],n[1]=u;const i=new Uint16Array(a);this.keyIndex=i[0];const l=t.slice(2),o=new Uint8Array(l);u=o[0],o[0]=o[1],o[1]=u;const c=new Uint16Array(l);this.certificateIndex=c[0]}toSchema(){const e=new ArrayBuffer(2),t=new Uint16Array(e);t[0]=this.certificateIndex;const r=new Uint8Array(e);let a=r[0];r[0]=r[1],r[1]=a;const n=new ArrayBuffer(2),u=new Uint16Array(n);u[0]=this.keyIndex;const i=new Uint8Array(n);return a=i[0],i[0]=i[1],i[1]=a,new B({valueHex:yo(n,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}sc.CLASS_NAME="CAVersion";const au="policyQualifierId",nu="qualifier",Y0=[au,nu];class xn extends D{constructor(e={}){super(),this.policyQualifierId=f(e,au,xn.defaultValues(au)),this.qualifier=f(e,nu,xn.defaultValues(nu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case au:return v;case nu:return new X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.policyQualifierId||v}),new X({name:t.qualifier||v})]})}fromSchema(e){T(e,Y0);const t=R(e,e,xn.schema({names:{policyQualifierId:au,qualifier:nu}}));O.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new A({value:[new J({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}xn.CLASS_NAME="PolicyQualifierInfo";const iu="policyIdentifier",va="policyQualifiers",e1=[iu,va];class In extends D{constructor(e={}){super(),this.policyIdentifier=f(e,iu,In.defaultValues(iu)),va in e&&(this.policyQualifiers=f(e,va,In.defaultValues(va))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case iu:return v;case va:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.policyIdentifier||v}),new A({optional:!0,value:[new Z({name:t.policyQualifiers||v,value:xn.schema()})]})]})}fromSchema(e){T(e,e1);const t=R(e,e,In.schema({names:{policyIdentifier:iu,policyQualifiers:va}}));O.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),va in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,r=>new xn({schema:r})))}toSchema(){const e=[];return e.push(new J({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new A({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}In.CLASS_NAME="PolicyInformation";const ou="certificatePolicies",t1=[ou];class xo extends D{constructor(e={}){super(),this.certificatePolicies=f(e,ou,xo.defaultValues(ou)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ou:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.certificatePolicies||v,value:In.schema()})]})}fromSchema(e){T(e,t1);const t=R(e,e,xo.schema({names:{certificatePolicies:ou}}));O.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,r=>new In({schema:r}))}toSchema(){return new A({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}xo.CLASS_NAME="CertificatePolicies";const uu="templateID",Ss="templateMajorVersion",As="templateMinorVersion",s1=[uu,Ss,As];class go extends D{constructor(e={}){super(),this.templateID=f(e,uu,go.defaultValues(uu)),Ss in e&&(this.templateMajorVersion=f(e,Ss,go.defaultValues(Ss))),As in e&&(this.templateMinorVersion=f(e,As,go.defaultValues(As))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uu:return v;case Ss:case As:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.templateID||v}),new B({name:t.templateMajorVersion||v,optional:!0}),new B({name:t.templateMinorVersion||v,optional:!0})]})}fromSchema(e){T(e,s1);const t=R(e,e,go.schema({names:{templateID:uu,templateMajorVersion:Ss,templateMinorVersion:As}}));O.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Ss in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),As in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const e=[];return e.push(new J({value:this.templateID})),Ss in this&&e.push(new B({value:this.templateMajorVersion})),As in this&&e.push(new B({value:this.templateMinorVersion})),new A({value:e})}toJSON(){const e={templateID:this.templateID};return Ss in this&&(e.templateMajorVersion=this.templateMajorVersion),As in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}const ba="distributionPoint",$g="distributionPointNames",Sa="reasons",Aa="cRLIssuer",Kg="cRLIssuerNames",r1=[ba,$g,Sa,Aa,Kg];class Yr extends D{constructor(e={}){super(),ba in e&&(this.distributionPoint=f(e,ba,Yr.defaultValues(ba))),Sa in e&&(this.reasons=f(e,Sa,Yr.defaultValues(Sa))),Aa in e&&(this.cRLIssuer=f(e,Aa,Yr.defaultValues(Aa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ba:return[];case Sa:return new re;case Aa:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({value:[new I({name:t.distributionPoint||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.distributionPointNames||v,value:ue.schema()})]}),new I({name:t.distributionPoint||v,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:me.schema().valueBlock.value})]})]}),new _({name:t.reasons||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new I({name:t.cRLIssuer||v,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Z({name:t.cRLIssuerNames||v,value:ue.schema()})]})]})}fromSchema(e){T(e,r1);const t=R(e,e,Yr.schema({names:{distributionPoint:ba,distributionPointNames:$g,reasons:Sa,cRLIssuer:Aa,cRLIssuerNames:Kg}}));O.assertSchema(t,this.className),ba in t.result&&(t.result.distributionPoint.idBlock.tagNumber===0&&(this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ue({schema:r}))),t.result.distributionPoint.idBlock.tagNumber===1&&(this.distributionPoint=new me({schema:new A({value:t.result.distributionPoint.valueBlock.value})}))),Sa in t.result&&(this.reasons=new re({valueHex:t.result.reasons.valueBlock.valueHex})),Aa in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,r=>new ue({schema:r})))}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new I({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):t=new I({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new I({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}Yr.CLASS_NAME="DistributionPoint";const lu="distributionPoints",a1=[lu];class Io extends D{constructor(e={}){super(),this.distributionPoints=f(e,lu,Io.defaultValues(lu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case lu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.distributionPoints||v,value:Yr.schema()})]})}fromSchema(e){T(e,a1);const t=R(e,e,Io.schema({names:{distributionPoints:lu}}));O.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,r=>new Yr({schema:r}))}toSchema(){return new A({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}Io.CLASS_NAME="CRLDistributionPoints";const cu="keyPurposes",n1=[cu];class rc extends D{constructor(e={}){super(),this.keyPurposes=f(e,cu,rc.defaultValues(cu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cu:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.keyPurposes||v,value:new J})]})}fromSchema(e){T(e,n1);const t=R(e,e,rc.schema({names:{keyPurposes:cu}}));O.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,r=>r.valueBlock.toString())}toSchema(){return new A({value:Array.from(this.keyPurposes,e=>new J({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}rc.CLASS_NAME="ExtKeyUsage";const Ho="accessDescriptions";class Vo extends D{constructor(e={}){super(),this.accessDescriptions=f(e,Ho,Vo.defaultValues(Ho)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ho:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.accessDescriptions||v,value:En.schema()})]})}fromSchema(e){T(e,[Ho]);const t=R(e,e,Vo.schema({names:{accessDescriptions:Ho}}));O.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,r=>new En({schema:r}))}toSchema(){return new A({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}Vo.CLASS_NAME="InfoAccess";const Na="distributionPoint",Hg="distributionPointNames",ur="onlyContainsUserCerts",lr="onlyContainsCACerts",cr="onlySomeReasons",hr="indirectCRL",mr="onlyContainsAttributeCerts",i1=[Na,Hg,ur,lr,cr,hr,mr];class Ye extends D{constructor(e={}){super(),Na in e&&(this.distributionPoint=f(e,Na,Ye.defaultValues(Na))),this.onlyContainsUserCerts=f(e,ur,Ye.defaultValues(ur)),this.onlyContainsCACerts=f(e,lr,Ye.defaultValues(lr)),cr in e&&(this.onlySomeReasons=f(e,cr,Ye.defaultValues(cr))),this.indirectCRL=f(e,hr,Ye.defaultValues(hr)),this.onlyContainsAttributeCerts=f(e,mr,Ye.defaultValues(mr)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Na:return[];case ur:return!1;case lr:return!1;case cr:return 0;case hr:return!1;case mr:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ke({value:[new I({name:t.distributionPoint||v,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.distributionPointNames||v,value:ue.schema()})]}),new I({name:t.distributionPoint||v,idBlock:{tagClass:3,tagNumber:1},value:me.schema().valueBlock.value})]})]}),new _({name:t.onlyContainsUserCerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _({name:t.onlyContainsCACerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new _({name:t.onlySomeReasons||v,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new _({name:t.indirectCRL||v,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new _({name:t.onlyContainsAttributeCerts||v,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){T(e,i1);const t=R(e,e,Ye.schema({names:{distributionPoint:Na,distributionPointNames:Hg,onlyContainsUserCerts:ur,onlyContainsCACerts:lr,onlySomeReasons:cr,indirectCRL:hr,onlyContainsAttributeCerts:mr}}));if(O.assertSchema(t,this.className),Na in t.result)switch(!0){case t.result.distributionPoint.idBlock.tagNumber===0:this.distributionPoint=Array.from(t.result.distributionPointNames,r=>new ue({schema:r}));break;case t.result.distributionPoint.idBlock.tagNumber===1:this.distributionPoint=new me({schema:new A({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(ur in t.result){const r=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=r[0]!==0}if(lr in t.result){const r=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=r[0]!==0}if(cr in t.result){const r=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=r[0]}if(hr in t.result){const r=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=r[0]!==0}if(mr in t.result){const r=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=r[0]!==0}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new I({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,r=>r.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==Ye.defaultValues(ur)&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==Ye.defaultValues(lr)&&e.push(new _({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),this.onlySomeReasons!==void 0){const t=new ArrayBuffer(1),r=new Uint8Array(t);r[0]=this.onlySomeReasons,e.push(new _({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==Ye.defaultValues(hr)&&e.push(new _({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==Ye.defaultValues(mr)&&e.push(new _({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new A({value:e})}toJSON(){const e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,t=>t.toJSON()):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==Ye.defaultValues(ur)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==Ye.defaultValues(lr)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),cr in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==Ye.defaultValues(hr)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==Ye.defaultValues(mr)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}Ye.CLASS_NAME="IssuingDistributionPoint";const hu="base",Xn="minimum",fr="maximum",o1=[hu,Xn,fr];class ps extends D{constructor(e={}){super(),this.base=f(e,hu,ps.defaultValues(hu)),this.minimum=f(e,Xn,ps.defaultValues(Xn)),fr in e&&(this.maximum=f(e,fr,ps.defaultValues(fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hu:return new ue;case Xn:return 0;case fr:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[ue.schema(t.base||{}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({name:t.minimum||v})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new B({name:t.maximum||v})]})]})}fromSchema(e){T(e,o1);const t=R(e,e,ps.schema({names:{base:{names:{blockName:hu}},minimum:Xn,maximum:fr}}));O.assertSchema(t,this.className),this.base=new ue({schema:t.result.base}),Xn in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),fr in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),this.minimum!==0){let t=0;this.minimum instanceof B?t=this.minimum:t=new B({value:this.minimum}),e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(fr in this){let t=0;this.maximum instanceof B?t=this.maximum:t=new B({value:this.maximum}),e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new A({value:e})}toJSON(){const e={base:this.base.toJSON()};return this.minimum!==0&&(typeof this.minimum=="number"?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),this.maximum!==void 0&&(typeof this.maximum=="number"?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}ps.CLASS_NAME="GeneralSubtree";const ka="permittedSubtrees",Ea="excludedSubtrees",u1=[ka,Ea];class vo extends D{constructor(e={}){super(),ka in e&&(this.permittedSubtrees=f(e,ka,vo.defaultValues(ka))),Ea in e&&(this.excludedSubtrees=f(e,Ea,vo.defaultValues(Ea))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ka:case Ea:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.permittedSubtrees||v,value:ps.schema()})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.excludedSubtrees||v,value:ps.schema()})]})]})}fromSchema(e){T(e,u1);const t=R(e,e,vo.schema({names:{permittedSubtrees:ka,excludedSubtrees:Ea}}));O.assertSchema(t,this.className),ka in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,r=>new ps({schema:r}))),Ea in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,r=>new ps({schema:r})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}vo.CLASS_NAME="NameConstraints";const Ns="requireExplicitPolicy",ks="inhibitPolicyMapping",l1=[Ns,ks];class bo extends D{constructor(e={}){super(),Ns in e&&(this.requireExplicitPolicy=f(e,Ns,bo.defaultValues(Ns))),ks in e&&(this.inhibitPolicyMapping=f(e,ks,bo.defaultValues(ks))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ns:return 0;case ks:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new _({name:t.requireExplicitPolicy||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.inhibitPolicyMapping||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){T(e,l1);const t=R(e,e,bo.schema({names:{requireExplicitPolicy:Ns,inhibitPolicyMapping:ks}}));if(O.assertSchema(t,this.className),Ns in t.result){const r=t.result.requireExplicitPolicy;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=je(a);O.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(ks in t.result){const r=t.result.inhibitPolicyMapping;r.idBlock.tagClass=1,r.idBlock.tagNumber=2;const a=r.toBER(!1),n=je(a);O.assert(n,"Integer"),this.inhibitPolicyMapping=n.result.valueBlock.valueDec}}toSchema(){const e=[];if(Ns in this){const t=new B({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(ks in this){const t=new B({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new A({value:e})}toJSON(){const e={};return Ns in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),ks in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}bo.CLASS_NAME="PolicyConstraints";const mu="issuerDomainPolicy",fu="subjectDomainPolicy",c1=[mu,fu];class Vn extends D{constructor(e={}){super(),this.issuerDomainPolicy=f(e,mu,Vn.defaultValues(mu)),this.subjectDomainPolicy=f(e,fu,Vn.defaultValues(fu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mu:return v;case fu:return v;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.issuerDomainPolicy||v}),new J({name:t.subjectDomainPolicy||v})]})}fromSchema(e){T(e,c1);const t=R(e,e,Vn.schema({names:{issuerDomainPolicy:mu,subjectDomainPolicy:fu}}));O.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new A({value:[new J({value:this.issuerDomainPolicy}),new J({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}Vn.CLASS_NAME="PolicyMapping";const du="mappings",h1=[du];class ac extends D{constructor(e={}){super(),this.mappings=f(e,du,ac.defaultValues(du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case du:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.mappings||v,value:Vn.schema()})]})}fromSchema(e){T(e,h1);const t=R(e,e,ac.schema({names:{mappings:du}}));O.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,r=>new Vn({schema:r}))}toSchema(){return new A({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}ac.CLASS_NAME="PolicyMappings";const dr="notBefore",pr="notAfter",m1=[dr,pr];class So extends D{constructor(e={}){super(),dr in e&&(this.notBefore=f(e,dr,So.defaultValues(dr))),pr in e&&(this.notAfter=f(e,pr,So.defaultValues(pr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dr:return new Date;case pr:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new _({name:t.notBefore||v,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new _({name:t.notAfter||v,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){T(e,m1);const t=R(e,e,So.schema({names:{notBefore:dr,notAfter:pr}}));if(O.assertSchema(t,this.className),dr in t.result){const r=new Ee;r.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=r.toDate()}if(pr in t.result){const r=new Ee({valueHex:t.result.notAfter.valueBlock.valueHex});r.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=r.toDate()}}toSchema(){const e=[];return dr in this&&e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:new Ee({valueDate:this.notBefore}).valueBlock.valueHexView})),pr in this&&e.push(new _({idBlock:{tagClass:3,tagNumber:1},valueHex:new Ee({valueDate:this.notAfter}).valueBlock.valueHexView})),new A({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}So.CLASS_NAME="PrivateKeyUsagePeriod";const Zn="id",Es="type",Qn="values",f1=[Zn,Es],d1=[Qn];class Bn extends D{constructor(e={}){super(),this.id=f(e,Zn,Bn.defaultValues(Zn)),Es in e&&(this.type=f(e,Es,Bn.defaultValues(Es))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Zn:return v;case Es:return new Fe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Zn:return t===v;case Es:return t instanceof Fe;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.id||v}),new X({name:t.type||v,optional:!0})]})}fromSchema(e){T(e,f1);const t=R(e,e,Bn.schema({names:{id:Zn,type:Es}}));O.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Es in t.result&&(this.type=t.result.type)}toSchema(){const e=[new J({value:this.id})];return Es in this&&e.push(this.type),new A({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}Bn.CLASS_NAME="QCStatement";class nc extends D{constructor(e={}){super(),this.values=f(e,Qn,nc.defaultValues(Qn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.values||v,value:Bn.schema(t.value||{})})]})}fromSchema(e){T(e,d1);const t=R(e,e,nc.schema({names:{values:Qn}}));O.assertSchema(t,this.className),this.values=Array.from(t.result.values,r=>new Bn({schema:r}))}toSchema(){return new A({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}nc.CLASS_NAME="QCStatements";var da;class aa{static register(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}static find(e){return this.namedCurves[e.toLowerCase()]||null}}da=aa,aa.namedCurves={},da.register("P-256","1.2.840.10045.3.1.7",32),da.register("P-384","1.3.132.0.34",48),da.register("P-521","1.3.132.0.35",66),da.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),da.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),da.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const bc="x",Sc="y",Ac="namedCurve";class St extends D{constructor(e={}){super(),this.x=f(e,bc,St.defaultValues(bc)),this.y=f(e,Sc,St.defaultValues(Sc)),this.namedCurve=f(e,Ac,St.defaultValues(Ac)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bc:case Sc:return Ue;case Ac:return v;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bc:case Sc:return t instanceof ArrayBuffer&&Ql(t,St.defaultValues(e));case Ac:return typeof t=="string"&&t===St.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Ch}fromSchema(e){const t=pe.toUint8Array(e);if(t[0]!==4)throw new Error("Object's schema was not verified against input data for ECPublicKey");const r=aa.find(this.namedCurve);if(!r)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));const a=r.size;if(t.byteLength!==a*2+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,a*2+1).buffer}toSchema(){return new Ch({data:yo(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=aa.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Qm(Eh(this.x),!0,!0,!1),y:Qm(Eh(this.y),!0,!0,!1)}}fromJSON(e){ne.assert("json",e,"crv","x","y");let t=0;const r=aa.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=Eo(Yl(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const u=new Uint8Array(this.x),i=new Uint8Array(a);u.set(i,1)}else this.x=a.slice(0,t);const n=Eo(Yl(e.y,!0));if(n.byteLength<t){this.y=new ArrayBuffer(t);const u=new Uint8Array(this.y),i=new Uint8Array(n);u.set(i,1)}else this.y=n.slice(0,t)}}St.CLASS_NAME="ECPublicKey";const pu="modulus",gu="publicExponent",p1=[pu,gu];class Pn extends D{constructor(e={}){super(),this.modulus=f(e,pu,Pn.defaultValues(pu)),this.publicExponent=f(e,gu,Pn.defaultValues(gu)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pu:return new B;case gu:return new B;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.modulus||v}),new B({name:t.publicExponent||v})]})}fromSchema(e){T(e,p1);const t=R(e,e,Pn.schema({names:{modulus:pu,publicExponent:gu}}));O.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new A({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:ce.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ce.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){ne.assert("json",e,"n","e");const t=Eo(Yl(e.n,!0));this.modulus=new B({valueHex:t.slice(0,Math.pow(2,pw(t.byteLength)))}),this.publicExponent=new B({valueHex:Eo(Yl(e.e,!0)).slice(0,3)})}}Pn.CLASS_NAME="RSAPublicKey";const wu="algorithm",yu="subjectPublicKey",g1=[wu,yu];class kt extends D{get parsedKey(){if(this._parsedKey===void 0){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===J.blockName())try{this._parsedKey=new St({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":{const e=je(this.subjectPublicKey.valueBlock.valueHexView);if(e.offset!==-1)try{this._parsedKey=new Pn({schema:e.result})}catch(t){}}break}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}constructor(e={}){super(),this.algorithm=f(e,wu,kt.defaultValues(wu)),this.subjectPublicKey=f(e,yu,kt.defaultValues(yu));const t=f(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wu:return new V;case yu:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.algorithm||{}),new re({name:t.subjectPublicKey||v})]})}fromSchema(e){T(e,g1);const t=R(e,e,kt.schema({names:{algorithm:{names:{blockName:wu}},subjectPublicKey:yu}}));O.assertSchema(t,this.className),this.algorithm=new V({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new A({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new St({json:e}),this.algorithm=new V({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Pn({json:e}),this.algorithm=new V({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Fe});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new re({valueHex:this.parsedKey.toSchema().toBER(!1)})}}async importKey(e,t=Q(!0)){try{if(!e)throw new Error("Need to provide publicKey input parameter");const r=await t.exportKey("spki",e),a=je(r);try{this.fromSchema(a.result)}catch(n){throw new Error("Error during initializing object from schema")}}catch(r){const a=r instanceof Error?r.message:"".concat(r);throw new Error("Error during exporting public key: ".concat(a))}}}kt.CLASS_NAME="PublicKeyInfo";const Yn="version",ei="privateKey",Qt="namedCurve",gr="publicKey",w1=[Yn,ei,Qt,gr];class Ht extends D{constructor(e={}){super(),this.version=f(e,Yn,Ht.defaultValues(Yn)),this.privateKey=f(e,ei,Ht.defaultValues(ei)),Qt in e&&(this.namedCurve=f(e,Qt,Ht.defaultValues(Qt))),gr in e&&(this.publicKey=f(e,gr,Ht.defaultValues(gr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yn:return 1;case ei:return new $;case Qt:return v;case gr:return new St;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yn:return t===Ht.defaultValues(e);case ei:return t.isEqual(Ht.defaultValues(e));case Qt:return t===v;case gr:return St.compareWithDefault(Qt,t.namedCurve)&&St.compareWithDefault("x",t.x)&&St.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new $({name:t.privateKey||v}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new J({name:t.namedCurve||v})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new re({name:t.publicKey||v})]})]})}fromSchema(e){T(e,w1);const t=R(e,e,Ht.schema({names:{version:Yn,privateKey:ei,namedCurve:Qt,publicKey:gr}}));if(O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,Qt in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),gr in t.result){const r={schema:t.result.publicKey.valueBlock.valueHex};Qt in this&&(r.namedCurve=this.namedCurve),this.publicKey=new St(r)}}toSchema(){const e=[new B({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[new J({value:this.namedCurve})]})),this.publicKey&&e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[new re({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new A({value:e})}toJSON(){if(!this.namedCurve||Ht.compareWithDefault(Qt,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=aa.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:ce.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const r=this.publicKey.toJSON();t.x=r.x,t.y=r.y}return t}fromJSON(e){ne.assert("json",e,"crv","d");let t=0;const r=aa.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);const a=ce.FromBase64Url(e.d);if(a.byteLength<t){const n=new ArrayBuffer(t),u=new Uint8Array(n),i=new Uint8Array(a);u.set(i,1),this.privateKey=new $({valueHex:n})}else this.privateKey=new $({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new St({json:e}))}}Ht.CLASS_NAME="ECPrivateKey";const vu="prime",bu="exponent",Su="coefficient",y1=[vu,bu,Su];class js extends D{constructor(e={}){super(),this.prime=f(e,vu,js.defaultValues(vu)),this.exponent=f(e,bu,js.defaultValues(bu)),this.coefficient=f(e,Su,js.defaultValues(Su)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vu:return new B;case bu:return new B;case Su:return new B;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.prime||v}),new B({name:t.exponent||v}),new B({name:t.coefficient||v})]})}fromSchema(e){T(e,y1);const t=R(e,e,js.schema({names:{prime:vu,exponent:bu,coefficient:Su}}));O.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new A({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:ce.ToBase64Url(this.prime.valueBlock.valueHexView),d:ce.ToBase64Url(this.exponent.valueBlock.valueHexView),t:ce.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){ne.assert("json",e,"r","d","r"),this.prime=new B({valueHex:ce.FromBase64Url(e.r)}),this.exponent=new B({valueHex:ce.FromBase64Url(e.d)}),this.coefficient=new B({valueHex:ce.FromBase64Url(e.t)})}}js.CLASS_NAME="OtherPrimeInfo";const Au="version",Nu="modulus",ku="publicExponent",Eu="privateExponent",Cu="prime1",xu="prime2",Iu="exponent1",Vu="exponent2",Bu="coefficient",Ca="otherPrimeInfos",v1=[Au,Nu,ku,Eu,Cu,xu,Iu,Vu,Bu,Ca];class pt extends D{constructor(e={}){super(),this.version=f(e,Au,pt.defaultValues(Au)),this.modulus=f(e,Nu,pt.defaultValues(Nu)),this.publicExponent=f(e,ku,pt.defaultValues(ku)),this.privateExponent=f(e,Eu,pt.defaultValues(Eu)),this.prime1=f(e,Cu,pt.defaultValues(Cu)),this.prime2=f(e,xu,pt.defaultValues(xu)),this.exponent1=f(e,Iu,pt.defaultValues(Iu)),this.exponent2=f(e,Vu,pt.defaultValues(Vu)),this.coefficient=f(e,Bu,pt.defaultValues(Bu)),Ca in e&&(this.otherPrimeInfos=f(e,Ca,pt.defaultValues(Ca))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Au:return 0;case Nu:return new B;case ku:return new B;case Eu:return new B;case Cu:return new B;case xu:return new B;case Iu:return new B;case Vu:return new B;case Bu:return new B;case Ca:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new B({name:t.modulus||v}),new B({name:t.publicExponent||v}),new B({name:t.privateExponent||v}),new B({name:t.prime1||v}),new B({name:t.prime2||v}),new B({name:t.exponent1||v}),new B({name:t.exponent2||v}),new B({name:t.coefficient||v}),new A({optional:!0,value:[new Z({name:t.otherPrimeInfosName||v,value:js.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){T(e,v1);const t=R(e,e,pt.schema({names:{version:Au,modulus:Nu,publicExponent:ku,privateExponent:Eu,prime1:Cu,prime2:xu,exponent1:Iu,exponent2:Vu,coefficient:Bu,otherPrimeInfo:{names:{blockName:Ca}}}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Ca in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,r=>new js({schema:r})))}toSchema(){const e=[];return e.push(new B({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new A({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={n:ce.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ce.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:ce.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:ce.ToBase64Url(this.prime1.valueBlock.valueHexView),q:ce.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:ce.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:ce.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:ce.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){ne.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new B({valueHex:ce.FromBase64Url(e.n)}),this.publicExponent=new B({valueHex:ce.FromBase64Url(e.e)}),this.privateExponent=new B({valueHex:ce.FromBase64Url(e.d)}),this.prime1=new B({valueHex:ce.FromBase64Url(e.p)}),this.prime2=new B({valueHex:ce.FromBase64Url(e.q)}),this.exponent1=new B({valueHex:ce.FromBase64Url(e.dp)}),this.exponent2=new B({valueHex:ce.FromBase64Url(e.dq)}),this.coefficient=new B({valueHex:ce.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new js({json:t})))}}pt.CLASS_NAME="RSAPrivateKey";const Pu="version",Ou="privateKeyAlgorithm",Du="privateKey",xa="attributes",Nc="parsedKey",b1=[Pu,Ou,Du,xa];class qt extends D{constructor(e={}){super(),this.version=f(e,Pu,qt.defaultValues(Pu)),this.privateKeyAlgorithm=f(e,Ou,qt.defaultValues(Ou)),this.privateKey=f(e,Du,qt.defaultValues(Du)),xa in e&&(this.attributes=f(e,xa,qt.defaultValues(xa))),Nc in e&&(this.parsedKey=f(e,Nc,qt.defaultValues(Nc))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pu:return 0;case Ou:return new V;case Du:return new $;case xa:return[];case Nc:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),V.schema(t.privateKeyAlgorithm||{}),new $({name:t.privateKey||v}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.attributes||v,value:ge.schema()})]})]})}fromSchema(e){T(e,b1);const t=R(e,e,qt.schema({names:{version:Pu,privateKeyAlgorithm:{names:{blockName:Ou}},privateKey:Du,attributes:xa}}));switch(O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new V({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,xa in t.result&&(this.attributes=Array.from(t.result.attributes,r=>new ge({schema:r}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const r=je(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new pt({schema:r.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof J){const r=je(this.privateKey.valueBlock.valueHexView);r.offset!==-1&&(this.parsedKey=new Ht({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:r.result}))}break}}toSchema(){const e=[new B({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new A({value:e})}toJSON(){if(!this.parsedKey){const r={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(r.attributes=Array.from(this.attributes,a=>a.toJSON())),r}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA";break}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ht({json:e}),this.privateKeyAlgorithm=new V({algorithmId:"1.2.840.10045.2.1",algorithmParams:new J({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new pt({json:e}),this.privateKeyAlgorithm=new V({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Fe});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new $({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}qt.CLASS_NAME="PrivateKeyInfo";const ti="contentType",si="contentEncryptionAlgorithm",Ia="encryptedContent",S1=[ti,si,Ia],fp=1024;class De extends D{constructor(e={}){if(super(),this.contentType=f(e,ti,De.defaultValues(ti)),this.contentEncryptionAlgorithm=f(e,si,De.defaultValues(si)),Ia in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,this.encryptedContent.idBlock.tagClass===1&&this.encryptedContent.idBlock.tagNumber===4&&this.encryptedContent.idBlock.isConstructed===!1&&!e.disableSplit)){const t=new $({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const u=new Uint8Array(a,r,r+fp>a.byteLength?a.byteLength-r:fp),i=new ArrayBuffer(u.length),l=new Uint8Array(i);for(let o=0;o<l.length;o++)l[o]=u[o];t.valueBlock.value.push(new $({valueHex:i})),n-=u.length,r+=u.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ti:return v;case si:return new V;case Ia:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ti:return t===v;case si:return t.algorithmId===v&&!("algorithmParams"in t);case Ia:return t.isEqual(De.defaultValues(Ia));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.contentType||v}),V.schema(t.contentEncryptionAlgorithm||{}),new ke({value:[new I({name:t.encryptedContent||v,idBlock:{tagClass:3,tagNumber:0},value:[new Z({value:new $})]}),new _({name:t.encryptedContent||v,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){T(e,S1);const t=R(e,e,De.schema({names:{contentType:ti,contentEncryptionAlgorithm:{names:{blockName:si}},encryptedContent:Ia}}));O.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new V({schema:t.result.contentEncryptionAlgorithm}),Ia in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new J({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new A({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return $.prototype.getValue.call(this.encryptedContent)}}De.CLASS_NAME="EncryptedContentInfo";const wr="hashAlgorithm",yr="maskGenAlgorithm",vr="saltLength",br="trailerField",A1=[wr,yr,vr,br];class tt extends D{constructor(e={}){super(),this.hashAlgorithm=f(e,wr,tt.defaultValues(wr)),this.maskGenAlgorithm=f(e,yr,tt.defaultValues(yr)),this.saltLength=f(e,vr,tt.defaultValues(vr)),this.trailerField=f(e,br,tt.defaultValues(br)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wr:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new Fe});case yr:return new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new Fe}).toSchema()});case vr:return 20;case br:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[V.schema(t.hashAlgorithm||{})]}),new I({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[V.schema(t.maskGenAlgorithm||{})]}),new I({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new B({name:t.saltLength||v})]}),new I({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new B({name:t.trailerField||v})]})]})}fromSchema(e){T(e,A1);const t=R(e,e,tt.schema({names:{hashAlgorithm:{names:{blockName:wr}},maskGenAlgorithm:{names:{blockName:yr}},saltLength:vr,trailerField:br}}));O.assertSchema(t,this.className),wr in t.result&&(this.hashAlgorithm=new V({schema:t.result.hashAlgorithm})),yr in t.result&&(this.maskGenAlgorithm=new V({schema:t.result.maskGenAlgorithm})),vr in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),br in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(tt.defaultValues(wr))||e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(tt.defaultValues(yr))||e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==tt.defaultValues(vr)&&e.push(new I({idBlock:{tagClass:3,tagNumber:2},value:[new B({value:this.saltLength})]})),this.trailerField!==tt.defaultValues(br)&&e.push(new I({idBlock:{tagClass:3,tagNumber:3},value:[new B({value:this.trailerField})]})),new A({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(tt.defaultValues(wr))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(tt.defaultValues(yr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==tt.defaultValues(vr)&&(e.saltLength=this.saltLength),this.trailerField!==tt.defaultValues(br)&&(e.trailerField=this.trailerField),e}}tt.CLASS_NAME="RSASSAPSSParams";const ri="salt",Tu="iterationCount",Yt="keyLength",Cs="prf",N1=[ri,Tu,Yt,Cs];class ht extends D{constructor(e={}){super(),this.salt=f(e,ri,ht.defaultValues(ri)),this.iterationCount=f(e,Tu,ht.defaultValues(Tu)),Yt in e&&(this.keyLength=f(e,Yt,ht.defaultValues(Yt))),Cs in e&&(this.prf=f(e,Cs,ht.defaultValues(Cs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ri:return{};case Tu:return-1;case Yt:return 0;case Cs:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new Fe});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new ke({value:[new $({name:t.saltPrimitive||v}),V.schema(t.saltConstructed||{})]}),new B({name:t.iterationCount||v}),new B({name:t.keyLength||v,optional:!0}),V.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){T(e,N1);const t=R(e,e,ht.schema({names:{saltPrimitive:ri,saltConstructed:{names:{blockName:ri}},iterationCount:Tu,keyLength:Yt,prf:{names:{blockName:Cs,optional:!0}}}}));O.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,Yt in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),Cs in t.result&&(this.prf=new V({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new B({value:this.iterationCount})),Yt in this&&ht.defaultValues(Yt)!==this.keyLength&&e.push(new B({value:this.keyLength})),this.prf&&ht.defaultValues(Cs).isEqual(this.prf)===!1&&e.push(this.prf.toSchema()),new A({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return Yt in this&&ht.defaultValues(Yt)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&ht.defaultValues(Cs).isEqual(this.prf)===!1&&(e.prf=this.prf.toJSON()),e}}ht.CLASS_NAME="PBKDF2Params";const Ru="keyDerivationFunc",Lu="encryptionScheme",k1=[Ru,Lu];class On extends D{constructor(e={}){super(),this.keyDerivationFunc=f(e,Ru,On.defaultValues(Ru)),this.encryptionScheme=f(e,Lu,On.defaultValues(Lu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ru:return new V;case Lu:return new V;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.keyDerivationFunc||{}),V.schema(t.encryptionScheme||{})]})}fromSchema(e){T(e,k1);const t=R(e,e,On.schema({names:{keyDerivationFunc:{names:{blockName:Ru}},encryptionScheme:{names:{blockName:Lu}}}}));O.assertSchema(t,this.className),this.keyDerivationFunc=new V({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new V({schema:t.result.encryptionScheme})}toSchema(){return new A({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}On.CLASS_NAME="PBES2Params";class E1{constructor(e){this.crypto=e.crypto,this.subtle="webkitSubtle"in e.crypto?e.crypto.webkitSubtle:e.crypto.subtle,this.name=f(e,"name",v)}async encrypt(...e){return this.subtle.encrypt(...e)}async decrypt(...e){return this.subtle.decrypt(...e)}sign(...e){return this.subtle.sign(...e)}async verify(...e){return this.subtle.verify(...e)}async digest(...e){return this.subtle.digest(...e)}async generateKey(...e){return this.subtle.generateKey(...e)}async deriveKey(...e){return this.subtle.deriveKey(...e)}async deriveBits(...e){return this.subtle.deriveBits(...e)}async wrapKey(...e){return this.subtle.wrapKey(...e)}async unwrapKey(...e){return this.subtle.unwrapKey(...e)}exportKey(...e){return this.subtle.exportKey(...e)}importKey(...e){return this.subtle.importKey(...e)}getRandomValues(e){return this.crypto.getRandomValues(e)}}async function dp(s,e,t,r,a){let n,u,i;switch(s.toUpperCase()){case"SHA-1":n=20,u=64,i=zb;break;case"SHA-256":n=32,u=64,i=Zb;break;case"SHA-384":n=48,u=128,i=N0;break;case"SHA-512":n=64,u=128,i=A0;break;default:throw new Error("Unsupported hashing algorithm")}const l=new Uint8Array(t);let o=new TextDecoder().decode(t);new TextEncoder().encode(o).some((b,N)=>b!==l[N])&&(o=String.fromCharCode(...l));const c=new Uint8Array(o.length*2+2),m=new DataView(c.buffer);for(let b=0;b<o.length;b++)m.setUint16(b*2,o.charCodeAt(b),!1);m.setUint16(o.length*2,0,!1);const h=new Uint8Array(u).fill(3),p=new Uint8Array(r),d=new Uint8Array(u*Math.ceil(p.length/u)).map((b,N)=>p[N%p.length]),w=new Uint8Array(u*Math.ceil(c.length/u)).map((b,N)=>c[N%c.length]);let y=new Uint8Array(d.length+w.length);y.set(d),y.set(w,d.length);const k=Math.ceil((e>>3)/n),g=[];for(let b=0;b<k;b++){let N=new Uint8Array(h.length+y.length);N.set(h),N.set(y,h.length);for(let E=0;E<a;E++)N=i(N);const S=new Uint8Array(u).map((E,P)=>N[P%N.length]),C=Math.ceil(p.length/u)+Math.ceil(c.length/u),x=[];for(let E=0;E<C;E++){const P=Array.from(y.slice(E*u,(E+1)*u));let K=511;for(let L=S.length-1;L>=0;L--)K>>=8,K+=S[L]+(P[L]||0),P[L]=K&255;x.push(...P)}y=new Uint8Array(x),g.push(...N)}return new Uint8Array(g.slice(0,e>>3)).buffer}function Mg(s){const e=typeof s=="string"?{name:s}:s;return"hash"in e?Et(Qe({},e),{hash:Mg(e.hash)}):e}class ic extends E1{async importKey(e,t,r,a,n){var u,i,l,o,c,m;let h={};const p=Mg(r);switch(e.toLowerCase()){case"raw":return this.subtle.importKey("raw",t,r,a,n);case"spki":{const d=je(pe.toArrayBuffer(t));O.assert(d,"keyData");const w=new kt;try{w.fromSchema(d.result)}catch(y){throw new he("Incorrect keyData")}switch(p.name.toUpperCase()){case"RSA-PSS":{if(!p.hash)throw new ne("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(p.hash.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(p.hash.name.toUpperCase()))}}case"RSASSA-PKCS1-V1_5":{if(n=["verify"],h.kty="RSA",h.ext=a,h.key_ops=n,w.algorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));if(!h.alg){if(!p.hash)throw new ne("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(p.hash.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat(p.hash.name.toUpperCase()))}}const y=w.toJSON();Object.assign(h,y)}break;case"ECDSA":n=["verify"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},w.algorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect public key algorithm: ".concat(w.algorithm.algorithmId));const y=w.toJSON();Object.assign(h,y)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else{if(!p.hash)throw new ne("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(p.hash.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat(p.hash.name.toUpperCase()))}}const y=w.toJSON();Object.assign(h,y)}break;case"RSAES-PKCS1-V1_5":{h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const y=w.toJSON();Object.assign(h,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(p.name.toUpperCase()))}}break;case"pkcs8":{const d=new qt,w=je(pe.toArrayBuffer(t));O.assert(w,"keyData");try{d.fromSchema(w.result)}catch(y){throw new Error("Incorrect keyData")}if(!d.parsedKey)throw new Error("Incorrect keyData");switch(p.name.toUpperCase()){case"RSA-PSS":switch((u=p.hash)===null||u===void 0?void 0:u.name.toUpperCase()){case"SHA-1":h.alg="PS1";break;case"SHA-256":h.alg="PS256";break;case"SHA-384":h.alg="PS384";break;case"SHA-512":h.alg="PS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((i=p.hash)===null||i===void 0?void 0:i.name.toUpperCase()))}case"RSASSA-PKCS1-V1_5":{if(n=["sign"],h.kty="RSA",h.ext=a,h.key_ops=n,d.privateKeyAlgorithm.algorithmId!=="1.2.840.113549.1.1.1")throw new Error("Incorrect private key algorithm: ".concat(d.privateKeyAlgorithm.algorithmId));if(!("alg"in h))switch((l=p.hash)===null||l===void 0?void 0:l.name.toUpperCase()){case"SHA-1":h.alg="RS1";break;case"SHA-256":h.alg="RS256";break;case"SHA-384":h.alg="RS384";break;case"SHA-512":h.alg="RS512";break;default:throw new Error("Incorrect hash algorithm: ".concat((o=p.hash)===null||o===void 0?void 0:o.name.toUpperCase()))}const y=d.toJSON();Object.assign(h,y)}break;case"ECDSA":n=["sign"];case"ECDH":{if(h={kty:"EC",ext:a,key_ops:n},d.privateKeyAlgorithm.algorithmId!=="1.2.840.10045.2.1")throw new Error("Incorrect algorithm: ".concat(d.privateKeyAlgorithm.algorithmId));const y=d.toJSON();Object.assign(h,y)}break;case"RSA-OAEP":{if(h.kty="RSA",h.ext=a,h.key_ops=n,this.name.toLowerCase()==="safari")h.alg="RSA-OAEP";else switch((c=p.hash)===null||c===void 0?void 0:c.name.toUpperCase()){case"SHA-1":h.alg="RSA-OAEP";break;case"SHA-256":h.alg="RSA-OAEP-256";break;case"SHA-384":h.alg="RSA-OAEP-384";break;case"SHA-512":h.alg="RSA-OAEP-512";break;default:throw new Error("Incorrect hash algorithm: ".concat((m=p.hash)===null||m===void 0?void 0:m.name.toUpperCase()))}const y=d.toJSON();Object.assign(h,y)}break;case"RSAES-PKCS1-V1_5":{n=["decrypt"],h.kty="RSA",h.ext=a,h.key_ops=n,h.alg="PS1";const y=d.toJSON();Object.assign(h,y)}break;default:throw new Error("Incorrect algorithm name: ".concat(p.name.toUpperCase()))}}break;case"jwk":h=t;break;default:throw new Error("Incorrect format: ".concat(e))}if(this.name.toLowerCase()==="safari")try{return this.subtle.importKey("jwk",Eo(JSON.stringify(h)),r,a,n)}catch(d){return this.subtle.importKey("jwk",h,r,a,n)}return this.subtle.importKey("jwk",h,r,a,n)}async exportKey(e,t){let r=await this.subtle.exportKey("jwk",t);switch(this.name.toLowerCase()==="safari"&&r instanceof ArrayBuffer&&(r=JSON.parse(Eh(r))),e.toLowerCase()){case"raw":return this.subtle.exportKey("raw",t);case"spki":{const a=new kt;try{a.fromJSON(r)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new qt;try{a.fromJSON(r)}catch(n){throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return r;default:throw new Error("Incorrect format: ".concat(e))}}async convert(e,t,r,a,n,u){if(e.toLowerCase()===t.toLowerCase())return r;const i=await this.importKey(e,r,a,n,u);return this.exportKey(t,i)}getAlgorithmByOID(e,t=!1,r){switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(r?"for ".concat(r," "):v,": ").concat(e));return{}}getOIDByAlgorithm(e,t=!1,r){let a=v;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13";break}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4";break}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3";break}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42";break}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46";break}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44";break}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45";break}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11";break}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"CONCAT":break;case"HKDF":break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35";break}if(!a&&t)throw new Error("Unsupported algorithm ".concat(r?"for ".concat(r," "):v,": ").concat(e.name));return a}getAlgorithmParameters(e,t){let r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}break}return r}getHashAlgorithm(e){let t=v;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{const r=new tt({schema:e.algorithmParams});if(r.hashAlgorithm){const a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if("name"in a)t=a.name;else return v}else t="SHA-1"}catch(r){}break}return t}async encryptEncryptedContentInfo(e){ne.assert(e,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=this.getOIDByAlgorithm(e.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),r=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=this.getOIDByAlgorithm({name:"HMAC",hash:{name:e.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),n=new ArrayBuffer(16),u=new Uint8Array(n);this.getRandomValues(u);const i=new ArrayBuffer(64),l=new Uint8Array(i);this.getRandomValues(l);const o=new Uint8Array(e.contentToEncrypt),c=new ht({salt:new $({valueHex:i}),iterationCount:e.iterationCount,prf:new V({algorithmId:a,algorithmParams:new Fe})}),m=new Uint8Array(e.password),h=await this.importKey("raw",m,"PBKDF2",!1,["deriveKey"]),p=await this.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:l,iterations:e.iterationCount},h,e.contentEncryptionAlgorithm,!1,["encrypt"]),d=await this.encrypt({name:e.contentEncryptionAlgorithm.name,iv:u},p,o),w=new On({keyDerivationFunc:new V({algorithmId:r,algorithmParams:c.toSchema()}),encryptionScheme:new V({algorithmId:t,algorithmParams:new $({valueHex:n})})});return new De({contentType:e.contentType,contentEncryptionAlgorithm:new V({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:w.toSchema()}),encryptedContent:new $({valueHex:d})})}async decryptEncryptedContentInfo(e){if(ne.assert(e,"password","encryptedContentInfo"),e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId!=="1.2.840.113549.1.5.13")throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));let t;try{t=new On({schema:e.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(d){throw new Error('Incorrectly encoded "pbes2Parameters"')}let r;try{r=new ht({schema:t.keyDerivationFunc.algorithmParams})}catch(d){throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=this.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),n=t.encryptionScheme.algorithmParams.valueBlock.valueHex,u=new Uint8Array(n),i=r.salt.valueBlock.valueHex,l=new Uint8Array(i),o=r.iterationCount;let c="SHA-1";r.prf&&(c=this.getAlgorithmByOID(r.prf.algorithmId,!0).hash.name);const m=await this.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"]),h=await this.deriveKey({name:"PBKDF2",hash:{name:c},salt:l,iterations:o},m,a,!1,["decrypt"]),p=e.encryptedContentInfo.getEncryptedContent();return this.decrypt({name:a.name,iv:u},h,p)}async stampDataWithPassword(e){if(!(e instanceof Object))throw new Error('Parameters must have type "Object"');ne.assert(e,"password","hashAlgorithm","iterationCount","salt","contentToStamp");let t;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await dp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["sign"]);return this.sign(r,n,new Uint8Array(e.contentToStamp))}async verifyDataStampedWithPassword(e){ne.assert(e,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(e.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(e.hashAlgorithm))}const r={name:"HMAC",length:t,hash:{name:e.hashAlgorithm}},a=await dp(e.hashAlgorithm,t,e.password,e.salt,e.iterationCount),n=await this.importKey("raw",new Uint8Array(a),r,!1,["verify"]);return this.verify(r,n,new Uint8Array(e.signatureToVerify),new Uint8Array(e.contentToVerify))}async getSignatureParameters(e,t="SHA-1"){this.getOIDByAlgorithm({name:t},!0,"hashAlgorithm");const r=new V,a=this.getAlgorithmParameters(e.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const n=a.algorithm;switch("hash"in e.algorithm&&e.algorithm.hash&&e.algorithm.hash.name?n.hash.name=e.algorithm.hash.name:n.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":r.algorithmId=this.getOIDByAlgorithm(n,!0);break;case"RSA-PSS":{switch(n.hash.name.toUpperCase()){case"SHA-256":n.saltLength=32;break;case"SHA-384":n.saltLength=48;break;case"SHA-512":n.saltLength=64;break}const u={};if(n.hash.name.toUpperCase()!=="SHA-1"){const l=this.getOIDByAlgorithm({name:n.hash.name},!0,"hashAlgorithm");u.hashAlgorithm=new V({algorithmId:l,algorithmParams:new Fe}),u.maskGenAlgorithm=new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:u.hashAlgorithm.toSchema()})}n.saltLength!==20&&(u.saltLength=n.saltLength);const i=new tt(u);r.algorithmId="1.2.840.113549.1.1.10",r.algorithmParams=i.toSchema()}break;default:throw new Error("Unsupported signature algorithm: ".concat(e.algorithm.name))}return{signatureAlgorithm:r,parameters:a}}async signWithPrivateKey(e,t,r){const a=await this.sign(r.algorithm,t,e);return r.algorithm.name==="ECDSA"?x1(a):a}fillPublicKeyParameters(e,t){const r={},a=this.getHashAlgorithm(t);if(a===v)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));let n;t.algorithmId==="1.2.840.113549.1.1.10"?n=t.algorithmId:n=e.algorithm.algorithmId;const u=this.getAlgorithmByOID(n,!0);if(r.algorithm=this.getAlgorithmParameters(u.name,"importKey"),"hash"in r.algorithm.algorithm&&(r.algorithm.algorithm.hash.name=a),u.name==="ECDSA"){const i=e.algorithm;if(!i.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=i.algorithmParams;if("idBlock"in i.algorithmParams&&!(l.idBlock.tagClass===1&&l.idBlock.tagNumber===6))throw new Error("Incorrect type for ECDSA public key parameters");const o=this.getAlgorithmByOID(l.valueBlock.toString(),!0);r.algorithm.algorithm.namedCurve=o.name}return r}async getPublicKey(e,t,r){r||(r=this.fillPublicKeyParameters(e,t));const a=e.toSchema().toBER(!1);return this.importKey("spki",a,r.algorithm.algorithm,!0,r.algorithm.usages)}async verifyWithPublicKey(e,t,r,a,n){let u;if(n){const o={};let c;a.algorithmId==="1.2.840.113549.1.1.10"?c=a.algorithmId:c=r.algorithm.algorithmId;const m=this.getAlgorithmByOID(c,!0);if(o.algorithm=this.getAlgorithmParameters(m.name,"importKey"),"hash"in o.algorithm.algorithm&&(o.algorithm.algorithm.hash.name=n),m.name==="ECDSA"){let h=!1;if("algorithmParams"in r.algorithm&&"idBlock"in r.algorithm.algorithmParams&&r.algorithm.algorithmParams.idBlock.tagClass===1&&r.algorithm.algorithmParams.idBlock.tagNumber===6&&(h=!0),h===!1)throw new Error("Incorrect type for ECDSA public key parameters");const p=this.getAlgorithmByOID(r.algorithm.algorithmParams.valueBlock.toString(),!0);o.algorithm.algorithm.namedCurve=p.name}u=await this.getPublicKey(r,null,o)}else{if(n=this.getHashAlgorithm(a),!n)throw new Error("Unsupported signature algorithm: ".concat(a.algorithmId));u=await this.getPublicKey(r,a)}const i=this.getAlgorithmParameters(u.algorithm.name,"verify");"hash"in i.algorithm&&(i.algorithm.hash.name=n);let l=t.valueBlock.valueHexView;if(u.algorithm.name==="ECDSA"){const o=aa.find(u.algorithm.namedCurve);if(!o)throw new Error("Unsupported named curve in use");const c=je(l);O.assert(c,"Signature value"),l=I1(c.result,o.size)}if(u.algorithm.name==="RSA-PSS"){const o=new tt({schema:a.algorithmParams});"saltLength"in o?i.algorithm.saltLength=o.saltLength:i.algorithm.saltLength=20;let c="SHA-1";"hashAlgorithm"in o&&(c=this.getAlgorithmByOID(o.hashAlgorithm.algorithmId,!0).name),i.algorithm.hash.name=c}return this.verify(i.algorithm,u,l,e)}}let Fg={name:"none",crypto:null};function pp(s){return!!(s&&typeof s=="object"&&"crypto"in s)}function gp(s,...e){let t=null;if(e.length<2)e.length?t=e[0]:t=typeof self<"u"&&self.crypto?new ic({name:"browser",crypto:self.crypto}):null;else{const r=e[0],a=e[1];pp(a)?t=a:pp(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new ic({crypto:r}))}if(typeof Ge<"u"&&"pid"in Ge&&typeof It<"u"&&typeof window>"u"){if(typeof It[Ge.pid]>"u")It[Ge.pid]={};else if(typeof It[Ge.pid]!="object")throw new Error("Name global.".concat(Ge.pid," already exists and it is not an object"));if(typeof It[Ge.pid].pkijs>"u")It[Ge.pid].pkijs={};else if(typeof It[Ge.pid].pkijs!="object")throw new Error("Name global.".concat(Ge.pid,".pkijs already exists and it is not an object"));It[Ge.pid].pkijs.engine={name:s,crypto:t}}else Fg={name:s,crypto:t}}function C1(){if(typeof Ge<"u"&&"pid"in Ge&&typeof It<"u"&&typeof window>"u"){let s;try{s=It[Ge.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return s}return Fg}function Q(s=!1){const e=C1();if(!e.crypto&&s)throw new Error("Unable to create WebCrypto object");return e.crypto}function x1(s){if(s.byteLength%2!==0)return Ue;const e=s.byteLength/2,t=new ArrayBuffer(e);new Uint8Array(t).set(new Uint8Array(s,0,e));const r=new B({valueHex:t}),a=new ArrayBuffer(e);new Uint8Array(a).set(new Uint8Array(s,e,e));const n=new B({valueHex:a});return new A({value:[r.convertToDER(),n.convertToDER()]}).toBER(!1)}function I1(s,e){if(!(s instanceof A&&s.valueBlock.value.length===2&&s.valueBlock.value[0]instanceof B&&s.valueBlock.value[1]instanceof B))return Ue;const t=s.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,r=s.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,a=new Uint8Array(e*2);return a.set(t,e-t.byteLength),a.set(r,2*e-r.byteLength),a.buffer}async function V1(s,e,t,r,a){switch(s.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new he("Unknown hash function: ".concat(s))}if(he.assert(e,"zBuffer","ArrayBuffer"),e.byteLength===0)throw new he("'zBuffer' has zero length, error");if(he.assert(r,"SharedInfo","ArrayBuffer"),t>255)throw new he("Please set 'Counter' argument to value less or equal to 255");const n=new ArrayBuffer(4),u=new Uint8Array(n);u[0]=0,u[1]=0,u[2]=0,u[3]=t;let i=Ue;i=yo(i,e),i=yo(i,n),i=yo(i,r);const l=await a.digest({name:s},i);return{counter:t,result:l}}async function wp(s,e,t,r,a=Q(!0)){let n=0,u=1;switch(s.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:throw new he("Unknown hash function: ".concat(s))}if(he.assert(e,"Zbuffer","ArrayBuffer"),e.byteLength===0)throw new he("'Zbuffer' has zero length, error");he.assert(r,"SharedInfo","ArrayBuffer");const i=t/n;Math.floor(i)>0&&(u=Math.floor(i),i-u>0&&u++);const l=[];for(let h=1;h<=u;h++)l.push(await V1(s,e,h,r,a));let o=Ue,c=1,m=!0;for(;m;){m=!1;for(const h of l)if(h.counter===c){o=yo(o,h.result),m=!0;break}c++}if(t>>=3,o.byteLength>t){const h=new ArrayBuffer(t),p=new Uint8Array(h),d=new Uint8Array(o);for(let w=0;w<t;w++)p[w]=d[w];return h}return o}const Sm="version",Am="logID",Nm="extensions",km="timestamp",Em="hashAlgorithm",Cm="signatureAlgorithm",xm="signature",yp="none",vp="md5",bp="sha1",Sp="sha224",Ap="sha256",Np="sha384",kp="sha512",Ep="anonymous",Cp="rsa",xp="dsa",Ip="ecdsa";class hs extends D{constructor(e={}){super(),this.version=f(e,Sm,hs.defaultValues(Sm)),this.logID=f(e,Am,hs.defaultValues(Am)),this.timestamp=f(e,km,hs.defaultValues(km)),this.extensions=f(e,Nm,hs.defaultValues(Nm)),this.hashAlgorithm=f(e,Em,hs.defaultValues(Em)),this.signatureAlgorithm=f(e,Cm,hs.defaultValues(Cm)),this.signature=f(e,xm,hs.defaultValues(xm)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sm:return 0;case Am:case Nm:return Ue;case km:return new Date(0);case Em:case Cm:return v;case xm:return new X;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Ch))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new ra({stream:new Ne({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],this.version===0){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(gw(new Uint8Array(e.getBlock(8)),8));const r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=yp;break;case 1:this.hashAlgorithm=vp;break;case 2:this.hashAlgorithm=bp;break;case 3:this.hashAlgorithm=Sp;break;case 4:this.hashAlgorithm=Ap;break;case 5:this.hashAlgorithm=Np;break;case 6:this.hashAlgorithm=kp;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Ep;break;case 1:this.signatureAlgorithm=Cp;break;case 2:this.signatureAlgorithm=xp;break;case 3:this.signatureAlgorithm=Ip;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),n=new Uint8Array(e.getBlock(a)).buffer.slice(0),u=je(n);if(O.assert(u,"SignedCertificateTimestamp"),this.signature=u.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Ch({data:e.stream.buffer})}toStream(){const e=new ra;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),r=new Uint8Array(t),a=Vd(this.timestamp.valueOf(),8);r.set(new Uint8Array(a),8-a.byteLength),e.appendView(r),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions));let n;switch(this.hashAlgorithm.toLowerCase()){case yp:n=0;break;case vp:n=1;break;case bp:n=2;break;case Sp:n=3;break;case Ap:n=4;break;case Np:n=5;break;case kp:n=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}e.appendChar(n);let u;switch(this.signatureAlgorithm.toLowerCase()){case Ep:u=0;break;case Cp:u=1;break;case xp:u=2;break;case Ip:u=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(u);const i=this.signature.toBER(!1);return e.appendUint16(i.byteLength),e.appendView(new Uint8Array(i)),e}toJSON(){return{version:this.version,logID:Bd(this.logID),timestamp:this.timestamp,extensions:Bd(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}async verify(e,t,r=0,a=Q(!0)){const n=Qm(Eh(this.logID));let u=null;const i=new ra;for(const p of e)if(p.log_id===n){u=p.key;break}if(!u)throw new Error("Public key not found for CT with logId: ".concat(n));const l=Eo(Yl(u)),o=kt.fromBER(l);i.appendChar(0),i.appendChar(0);const c=new ArrayBuffer(8),m=new Uint8Array(c),h=Vd(this.timestamp.valueOf(),8);return m.set(new Uint8Array(h),8-h.byteLength),i.appendView(m),i.appendUint16(r),r===0&&i.appendUint24(t.byteLength),i.appendView(new Uint8Array(t)),i.appendUint16(this.extensions.byteLength),this.extensions.byteLength!==0&&i.appendView(new Uint8Array(this.extensions)),a.verifyWithPublicKey(i.buffer.slice(0,i.length),new $({valueHex:this.signature.toBER(!1)}),o,{algorithmId:v},"SHA-256")}}hs.CLASS_NAME="SignedCertificateTimestamp";const kc="timestamps";class em extends D{constructor(e={}){super(),this.timestamps=f(e,kc,em.defaultValues(kc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case kc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){var t;const r=f(e,"names",{});return(t=r.optional)!==null&&t!==void 0||(r.optional=!1),new $({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}fromSchema(e){if(!(e instanceof $))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new ra({stream:new Ne({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new hs({stream:t}))}toSchema(){const e=new ra;let t=0;const r=[];for(const a of this.timestamps){const n=a.toStream();r.push(n),t+=n.stream.buffer.byteLength}e.appendUint16(t);for(const a of r)e.appendView(a.stream.view);return new $({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}em.CLASS_NAME="SignedCertificateTimestampList";const ju="attributes",B1=[ju];class oc extends D{constructor(e={}){super(),this.attributes=f(e,ju,oc.defaultValues(ju)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ju:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.attributes||v,value:ge.schema()})]})}fromSchema(e){T(e,B1);const t=R(e,e,oc.schema({names:{attributes:ju}}));O.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,r=>new ge({schema:r}))}toSchema(){return new A({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}oc.CLASS_NAME="SubjectDirectoryAttributes";class be{static getItems(){return this.types||(this.types={},be.register(xg,"SubjectAltName",Co),be.register(Ig,"IssuerAltName",Co),be.register(cd,"AuthorityKeyIdentifier",Qr),be.register(ud,"BasicConstraints",Cn),be.register(W0,"MicrosoftCaVersion",sc),be.register(Dg,"CertificatePolicies",xo),be.register(K0,"CertificatePoliciesMicrosoft",xo),be.register(q0,"MicrosoftCertTemplateV2",go),be.register(Og,"CRLDistributionPoints",Io),be.register(ld,"FreshestCRL",Io),be.register(H0,"ExtKeyUsage",rc),be.register(Bg,"CertificateIssuer",qe),be.register(hd,"AuthorityInfoAccess",Vo),be.register(F0,"SubjectInfoAccess",Vo),be.register(Vg,"IssuingDistributionPoint",Ye),be.register(Pg,"NameConstraints",vo),be.register(Rg,"PolicyConstraints",bo),be.register(Tg,"PolicyMappings",ac),be.register(R0,"PrivateKeyUsagePeriod",So),be.register(G0,"QCStatements",nc),be.register(J0,"SignedCertificateTimestampList",em),be.register(O0,"SubjectDirectoryAttributes",oc)),this.types}static fromBER(e,t){const r=je(t);if(r.offset===-1)return null;const a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch(n){const u=new a.type;return u.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),u}return r.result}static find(e){return this.getItems()[e]||null}static register(e,t,r){this.getItems()[e]={name:t,type:r}}}const Uu="extnID",Sr="critical",$u="extnValue",Ec="parsedValue",P1=[Uu,Sr,$u];class Te extends D{get parsedValue(){if(this._parsedValue===void 0){const e=be.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}constructor(e={}){super(),this.extnID=f(e,Uu,Te.defaultValues(Uu)),this.critical=f(e,Sr,Te.defaultValues(Sr)),$u in e?this.extnValue=new $({valueHex:e.extnValue}):this.extnValue=Te.defaultValues($u),Ec in e&&(this.parsedValue=f(e,Ec,Te.defaultValues(Ec))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Uu:return v;case Sr:return!1;case $u:return new $;case Ec:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.extnID||v}),new ua({name:t.critical||v,optional:!0}),new $({name:t.extnValue||v})]})}fromSchema(e){T(e,P1);const t=R(e,e,Te.schema({names:{extnID:Uu,critical:Sr,extnValue:$u}}));O.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Sr in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new J({value:this.extnID})),this.critical!==Te.defaultValues(Sr)&&e.push(new ua({value:this.critical})),e.push(this.extnValue),new A({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==Te.defaultValues(Sr)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}Te.CLASS_NAME="Extension";const Ku="extensions",O1=[Ku];class $e extends D{constructor(e={}){super(),this.extensions=f(e,Ku,$e.defaultValues(Ku)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return[];default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,"names",{});return new A({optional:t,name:r.blockName||v,value:[new Z({name:r.extensions||v,value:Te.schema(r.extension||{})})]})}fromSchema(e){T(e,O1);const t=R(e,e,$e.schema({names:{extensions:Ku}}));O.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,r=>new Te({schema:r}))}toSchema(){return new A({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}$e.CLASS_NAME="Extensions";const Hu="issuer",Mu="serialNumber",Va="issuerUID",D1=[Hu,Mu,Va];class Nt extends D{constructor(e={}){super(),this.issuer=f(e,Hu,Nt.defaultValues(Hu)),this.serialNumber=f(e,Mu,Nt.defaultValues(Mu)),Va in e&&(this.issuerUID=f(e,Va,Nt.defaultValues(Va))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hu:return new qe;case Mu:return new B;case Va:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[qe.schema(t.issuer||{}),new B({name:t.serialNumber||v}),new re({optional:!0,name:t.issuerUID||v})]})}fromSchema(e){T(e,D1);const t=R(e,e,Nt.schema({names:{issuer:{names:{blockName:Hu}},serialNumber:Mu,issuerUID:Va}}));O.assertSchema(t,this.className),this.issuer=new qe({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,Va in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new A({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}Nt.CLASS_NAME="IssuerSerial";const Fu="version",Ba="baseCertificateID",Pa="subjectName",Ju="issuer",qu="signature",Wu="serialNumber",Gu="attrCertValidityPeriod",zu="attributes",Oa="issuerUniqueID",Da="extensions",T1=[Fu,Ba,Pa,Ju,qu,Wu,Gu,zu,Oa,Da];class ct extends D{constructor(e={}){super(),this.version=f(e,Fu,ct.defaultValues(Fu)),Ba in e&&(this.baseCertificateID=f(e,Ba,ct.defaultValues(Ba))),Pa in e&&(this.subjectName=f(e,Pa,ct.defaultValues(Pa))),this.issuer=f(e,Ju,ct.defaultValues(Ju)),this.signature=f(e,qu,ct.defaultValues(qu)),this.serialNumber=f(e,Wu,ct.defaultValues(Wu)),this.attrCertValidityPeriod=f(e,Gu,ct.defaultValues(Gu)),this.attributes=f(e,zu,ct.defaultValues(zu)),Oa in e&&(this.issuerUniqueID=f(e,Oa,ct.defaultValues(Oa))),Da in e&&(this.extensions=f(e,Da,ct.defaultValues(Da))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fu:return 0;case Ba:return new Nt;case Pa:return new qe;case Ju:return new qe;case qu:return new V;case Wu:return new B;case Gu:return new is;case zu:return[];case Oa:return new re;case Da:return new $e;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new ke({value:[new I({name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Nt.schema().valueBlock.value}),new I({name:t.subjectName||v,idBlock:{tagClass:3,tagNumber:1},value:qe.schema().valueBlock.value})]}),qe.schema({names:{blockName:t.issuer||v}}),V.schema(t.signature||{}),new B({name:t.serialNumber||v}),is.schema(t.attrCertValidityPeriod||{}),new A({name:t.attributes||v,value:[new Z({value:ge.schema()})]}),new re({optional:!0,name:t.issuerUniqueID||v}),$e.schema(t.extensions||{},!0)]})}fromSchema(e){T(e,T1);const t=R(e,e,ct.schema({names:{version:Fu,baseCertificateID:Ba,subjectName:Pa,issuer:Ju,signature:{names:{blockName:qu}},serialNumber:Wu,attrCertValidityPeriod:{names:{blockName:Gu}},attributes:zu,issuerUniqueID:Oa,extensions:{names:{blockName:Da}}}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Ba in t.result&&(this.baseCertificateID=new Nt({schema:new A({value:t.result.baseCertificateID.valueBlock.value})})),Pa in t.result&&(this.subjectName=new qe({schema:new A({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new V({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new is({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new ge({schema:r})),Oa in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Da in t.result&&(this.extensions=new $e({schema:t.result.extensions}))}toSchema(){const e=new A({value:[new B({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new A({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}ct.CLASS_NAME="AttributeCertificateInfoV1";const _u="acinfo",Xu="signatureAlgorithm",Zu="signatureValue",R1=[_u,Zu,Xu];class Us extends D{constructor(e={}){super(),this.acinfo=f(e,_u,Us.defaultValues(_u)),this.signatureAlgorithm=f(e,Xu,Us.defaultValues(Xu)),this.signatureValue=f(e,Zu,Us.defaultValues(Zu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _u:return new ct;case Xu:return new V;case Zu:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[ct.schema(t.acinfo||{}),V.schema(t.signatureAlgorithm||{}),new re({name:t.signatureValue||v})]})}fromSchema(e){T(e,R1);const t=R(e,e,Us.schema({names:{acinfo:{names:{blockName:_u}},signatureAlgorithm:{names:{blockName:Xu}},signatureValue:Zu}}));O.assertSchema(t,this.className),this.acinfo=new ct({schema:t.result.acinfo}),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new A({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Us.CLASS_NAME="AttributeCertificateV1";const Qu="digestedObjectType",Ta="otherObjectTypeID",Yu="digestAlgorithm",el="objectDigest",L1=[Qu,Ta,Yu,el];class Rt extends D{constructor(e={}){super(),this.digestedObjectType=f(e,Qu,Rt.defaultValues(Qu)),Ta in e&&(this.otherObjectTypeID=f(e,Ta,Rt.defaultValues(Ta))),this.digestAlgorithm=f(e,Yu,Rt.defaultValues(Yu)),this.objectDigest=f(e,el,Rt.defaultValues(el)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qu:return new ec;case Ta:return new J;case Yu:return new V;case el:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new ec({name:t.digestedObjectType||v}),new J({optional:!0,name:t.otherObjectTypeID||v}),V.schema(t.digestAlgorithm||{}),new re({name:t.objectDigest||v})]})}fromSchema(e){T(e,L1);const t=R(e,e,Rt.schema({names:{digestedObjectType:Qu,otherObjectTypeID:Ta,digestAlgorithm:{names:{blockName:Yu}},objectDigest:el}}));O.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Ta in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new V({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new A({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}Rt.CLASS_NAME="ObjectDigestInfo";const Ra="issuerName",La="baseCertificateID",ja="objectDigestInfo",j1=[Ra,La,ja];class ea extends D{constructor(e={}){super(),Ra in e&&(this.issuerName=f(e,Ra,ea.defaultValues(Ra))),La in e&&(this.baseCertificateID=f(e,La,ea.defaultValues(La))),ja in e&&(this.objectDigestInfo=f(e,ja,ea.defaultValues(ja))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ra:return new qe;case La:return new Nt;case ja:return new Rt;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[qe.schema({names:{blockName:t.issuerName}},!0),new I({optional:!0,name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Nt.schema().valueBlock.value}),new I({optional:!0,name:t.objectDigestInfo||v,idBlock:{tagClass:3,tagNumber:1},value:Rt.schema().valueBlock.value})]})}fromSchema(e){T(e,j1);const t=R(e,e,ea.schema({names:{issuerName:Ra,baseCertificateID:La,objectDigestInfo:ja}}));O.assertSchema(t,this.className),Ra in t.result&&(this.issuerName=new qe({schema:t.result.issuerName})),La in t.result&&(this.baseCertificateID=new Nt({schema:new A({value:t.result.baseCertificateID.valueBlock.value})})),ja in t.result&&(this.objectDigestInfo=new Rt({schema:new A({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new A;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}ea.CLASS_NAME="V2Form";const Ua="baseCertificateID",$a="entityName",Ka="objectDigestInfo",U1=[Ua,$a,Ka];class $s extends D{constructor(e={}){super(),Ua in e&&(this.baseCertificateID=f(e,Ua,$s.defaultValues(Ua))),$a in e&&(this.entityName=f(e,$a,$s.defaultValues($a))),Ka in e&&(this.objectDigestInfo=f(e,Ka,$s.defaultValues(Ka))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ua:return new Nt;case $a:return new qe;case Ka:return new Rt;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({optional:!0,name:t.baseCertificateID||v,idBlock:{tagClass:3,tagNumber:0},value:Nt.schema().valueBlock.value}),new I({optional:!0,name:t.entityName||v,idBlock:{tagClass:3,tagNumber:1},value:qe.schema().valueBlock.value}),new I({optional:!0,name:t.objectDigestInfo||v,idBlock:{tagClass:3,tagNumber:2},value:Rt.schema().valueBlock.value})]})}fromSchema(e){T(e,U1);const t=R(e,e,$s.schema({names:{baseCertificateID:Ua,entityName:$a,objectDigestInfo:Ka}}));O.assertSchema(t,this.className),Ua in t.result&&(this.baseCertificateID=new Nt({schema:new A({value:t.result.baseCertificateID.valueBlock.value})})),$a in t.result&&(this.entityName=new qe({schema:new A({value:t.result.entityName.valueBlock.value})})),Ka in t.result&&(this.objectDigestInfo=new Rt({schema:new A({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new A;return this.baseCertificateID&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new I({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}$s.CLASS_NAME="Holder";const tl="version",sl="holder",rl="issuer",al="signature",nl="serialNumber",il="attrCertValidityPeriod",ol="attributes",Ha="issuerUniqueID",Ma="extensions",$1=[tl,sl,rl,al,nl,il,ol,Ha,Ma];class gt extends D{constructor(e={}){super(),this.version=f(e,tl,gt.defaultValues(tl)),this.holder=f(e,sl,gt.defaultValues(sl)),this.issuer=f(e,rl,gt.defaultValues(rl)),this.signature=f(e,al,gt.defaultValues(al)),this.serialNumber=f(e,nl,gt.defaultValues(nl)),this.attrCertValidityPeriod=f(e,il,gt.defaultValues(il)),this.attributes=f(e,ol,gt.defaultValues(ol)),Ha in e&&(this.issuerUniqueID=f(e,Ha,gt.defaultValues(Ha))),Ma in e&&(this.extensions=f(e,Ma,gt.defaultValues(Ma))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tl:return 1;case sl:return new $s;case rl:return{};case al:return new V;case nl:return new B;case il:return new is;case ol:return[];case Ha:return new re;case Ma:return new $e;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),$s.schema(t.holder||{}),new ke({value:[qe.schema({names:{blockName:t.issuer||v}}),new I({name:t.issuer||v,idBlock:{tagClass:3,tagNumber:0},value:ea.schema().valueBlock.value})]}),V.schema(t.signature||{}),new B({name:t.serialNumber||v}),is.schema(t.attrCertValidityPeriod||{}),new A({name:t.attributes||v,value:[new Z({value:ge.schema()})]}),new re({optional:!0,name:t.issuerUniqueID||v}),$e.schema(t.extensions||{},!0)]})}fromSchema(e){T(e,$1);const t=R(e,e,gt.schema({names:{version:tl,holder:{names:{blockName:sl}},issuer:rl,signature:{names:{blockName:al}},serialNumber:nl,attrCertValidityPeriod:{names:{blockName:il}},attributes:ol,issuerUniqueID:Ha,extensions:{names:{blockName:Ma}}}}));switch(O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new $s({schema:t.result.holder}),t.result.issuer.idBlock.tagClass){case 3:this.issuer=new ea({schema:new A({value:t.result.issuer.valueBlock.value})});break;case 1:default:throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2")}this.signature=new V({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new is({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,r=>new ge({schema:r})),Ha in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Ma in t.result&&(this.extensions=new $e({schema:t.result.extensions}))}toSchema(){const e=new A({value:[new B({value:this.version}),this.holder.toSchema(),new I({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new A({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}gt.CLASS_NAME="AttributeCertificateInfoV2";const ul="acinfo",ll="signatureAlgorithm",cl="signatureValue",K1=[ul,ll,cl];class Lt extends D{constructor(e={}){super(),this.acinfo=f(e,ul,Lt.defaultValues(ul)),this.signatureAlgorithm=f(e,ll,Lt.defaultValues(ll)),this.signatureValue=f(e,cl,Lt.defaultValues(cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return new gt;case ll:return new V;case cl:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[gt.schema(t.acinfo||{}),V.schema(t.signatureAlgorithm||{}),new re({name:t.signatureValue||v})]})}fromSchema(e){T(e,K1);const t=R(e,e,Lt.schema({names:{acinfo:{names:{blockName:ul}},signatureAlgorithm:{names:{blockName:ll}},signatureValue:cl}}));O.assertSchema(t,this.className),this.acinfo=new gt({schema:t.result.acinfo}),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new A({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}Lt.CLASS_NAME="AttributeCertificateV2";const Fa="contentType",ai="content",H1=[Fa,ai];class fe extends D{constructor(e={}){super(),this.contentType=f(e,Fa,fe.defaultValues(Fa)),this.content=f(e,ai,fe.defaultValues(ai)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fa:return v;case ai:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Fa:return typeof t=="string"&&t===this.defaultValues(Fa);case ai:return t instanceof X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return"optional"in t||(t.optional=!1),new A({name:t.blockName||"ContentInfo",optional:t.optional,value:[new J({name:t.contentType||Fa}),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.content||ai})]})]})}fromSchema(e){T(e,H1);const t=R(e,e,fe.schema());O.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new A({value:[new J({value:this.contentType}),new I({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof X||(e.content=this.content.toJSON()),e}}fe.CLASS_NAME="ContentInfo",fe.DATA=md,fe.SIGNED_DATA=Lg,fe.ENVELOPED_DATA=jg,fe.ENCRYPTED_DATA=Ug;const Im="type",Vm="value",gf="utcTimeName",wf="generalTimeName",M1=[gf,wf];var Vp;(function(s){s[s.UTCTime=0]="UTCTime",s[s.GeneralizedTime=1]="GeneralizedTime",s[s.empty=2]="empty"})(Vp||(Vp={}));class Le extends D{constructor(e={}){super(),this.type=f(e,Im,Le.defaultValues(Im)),this.value=f(e,Vm,Le.defaultValues(Vm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Im:return 0;case Vm:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const r=f(e,"names",{});return new ke({optional:t,value:[new Ym({name:r.utcTimeName||v}),new Ee({name:r.generalTimeName||v})]})}fromSchema(e){T(e,M1);const t=R(e,e,Le.schema({names:{utcTimeName:gf,generalTimeName:wf}}));O.assertSchema(t,this.className),gf in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),wf in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return this.type===0?new Ym({valueDate:this.value}):this.type===1?new Ee({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}Le.CLASS_NAME="Time";const Bm="tbs",Ar="version",zc="serialNumber",_c="signature",Xc="issuer",Zc="notBefore",Qc="notAfter",Yc="subject",eh="subjectPublicKeyInfo",hl="issuerUniqueID",ml="subjectUniqueID",fl="extensions",dl="signatureAlgorithm",pl="signatureValue",jt="tbsCertificate",Lh="".concat(jt,".").concat(Ar),fd="".concat(jt,".").concat(zc),dd="".concat(jt,".").concat(_c),pd="".concat(jt,".").concat(Xc),jh="".concat(jt,".").concat(Zc),Uh="".concat(jt,".").concat(Qc),gd="".concat(jt,".").concat(Yc),wd="".concat(jt,".").concat(eh),$h="".concat(jt,".").concat(hl),Kh="".concat(jt,".").concat(ml),_l="".concat(jt,".").concat(fl),F1=[jt,Lh,fd,dd,pd,jh,Uh,gd,wd,$h,Kh,_l,dl,pl];function J1(s={}){const e=f(s,"names",{});return new A({name:e.blockName||jt,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({name:e.tbsCertificateVersion||Lh})]}),new B({name:e.tbsCertificateSerialNumber||fd}),V.schema(e.signature||{names:{blockName:dd}}),me.schema(e.issuer||{names:{blockName:pd}}),new A({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[Le.schema(e.notBefore||{names:{utcTimeName:jh,generalTimeName:jh}}),Le.schema(e.notAfter||{names:{utcTimeName:Uh,generalTimeName:Uh}})]}),me.schema(e.subject||{names:{blockName:gd}}),kt.schema(e.subjectPublicKeyInfo||{names:{blockName:wd}}),new _({name:e.tbsCertificateIssuerUniqueID||$h,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new _({name:e.tbsCertificateSubjectUniqueID||Kh,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[$e.schema(e.extensions||{names:{blockName:_l}})]})]})}class oe extends D{get tbs(){return pe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Bm,oe.defaultValues(Bm))),this.version=f(e,Ar,oe.defaultValues(Ar)),this.serialNumber=f(e,zc,oe.defaultValues(zc)),this.signature=f(e,_c,oe.defaultValues(_c)),this.issuer=f(e,Xc,oe.defaultValues(Xc)),this.notBefore=f(e,Zc,oe.defaultValues(Zc)),this.notAfter=f(e,Qc,oe.defaultValues(Qc)),this.subject=f(e,Yc,oe.defaultValues(Yc)),this.subjectPublicKeyInfo=f(e,eh,oe.defaultValues(eh)),hl in e&&(this.issuerUniqueID=f(e,hl,oe.defaultValues(hl))),ml in e&&(this.subjectUniqueID=f(e,ml,oe.defaultValues(ml))),fl in e&&(this.extensions=f(e,fl,oe.defaultValues(fl))),this.signatureAlgorithm=f(e,dl,oe.defaultValues(dl)),this.signatureValue=f(e,pl,oe.defaultValues(pl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bm:return Ue;case Ar:return 0;case zc:return new B;case _c:return new V;case Xc:return new me;case Zc:return new Le;case Qc:return new Le;case Yc:return new me;case eh:return new kt;case hl:return Ue;case ml:return Ue;case fl:return[];case dl:return new V;case pl:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[J1(t.tbsCertificate),V.schema(t.signatureAlgorithm||{names:{blockName:dl}}),new re({name:t.signatureValue||pl})]})}fromSchema(e){T(e,F1);const t=R(e,e,oe.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:_l}}}}}}));O.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Lh in t.result&&(this.version=t.result[Lh].valueBlock.valueDec),this.serialNumber=t.result[fd],this.signature=new V({schema:t.result[dd]}),this.issuer=new me({schema:t.result[pd]}),this.notBefore=new Le({schema:t.result[jh]}),this.notAfter=new Le({schema:t.result[Uh]}),this.subject=new me({schema:t.result[gd]}),this.subjectPublicKeyInfo=new kt({schema:t.result[wd]}),$h in t.result&&(this.issuerUniqueID=t.result[$h].valueBlock.valueHex),Kh in t.result&&(this.subjectUniqueID=t.result[Kh].valueBlock.valueHex),_l in t.result&&(this.extensions=Array.from(t.result[_l],r=>new Te({schema:r}))),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Ar in this&&this.version!==oe.defaultValues(Ar)&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new A({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new _({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new _({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new A({value:Array.from(this.extensions,t=>t.toSchema())})]})),new A({value:e})}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return oe.schema().value[0];const r=je(this.tbsView);O.assert(r,"TBS Certificate"),t=r.result}else t=this.encodeTBS();return new A({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ce.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Ar in this&&this.version!==oe.defaultValues(Ar)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=ce.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=ce.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async getPublicKey(e,t=Q(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}async getKeyHash(e="SHA-1",t=Q(!0)){return t.digest({name:e},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)}async sign(e,t="SHA-1",r=Q(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new re({valueHex:u})}async verify(e,t=Q(!0)){let r;if(e?r=e.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(r=this.subjectPublicKeyInfo),!(r instanceof kt))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}oe.CLASS_NAME="Certificate";function Jg(s,e=null){if(e&&s.issuer.isEqual(e.issuer)&&s.serialNumber.isEqual(e.serialNumber))return null;let t=!1;if(s.extensions){for(const r of s.extensions)if(r.extnID===ud&&r.parsedValue instanceof Cn&&r.parsedValue.cA){t=!0;break}}return t?s:null}const ni="certId",ii="certValue",Kn="parsedValue",q1=[ni,ii];class bn extends D{constructor(e={}){super(),this.certId=f(e,ni,bn.defaultValues(ni)),this.certValue=f(e,ii,bn.defaultValues(ii)),Kn in e&&(this.parsedValue=f(e,Kn,bn.defaultValues(Kn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ni:return v;case ii:return new X;case Kn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ni:return t===v;case ii:return t instanceof X;case Kn:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.id||"id"}),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.value||"value"})]})]})}fromSchema(e){T(e,q1);const t=R(e,e,bn.schema({names:{id:ni,value:ii}}));O.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const r=this.certValue.valueBlock.valueHexView;switch(this.certId){case cp:try{this.parsedValue=oe.fromBER(r)}catch(a){Lt.fromBER(r)}break;case hp:this.parsedValue=Lt.fromBER(r);break;case _0:default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}toSchema(){return Kn in this&&("acinfo"in this.parsedValue?this.certId=hp:this.certId=cp,this.certValue=new $({valueHex:this.parsedValue.toSchema().toBER(!1)})),new A({value:[new J({value:this.certId}),new I({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}bn.CLASS_NAME="CertBag";const gl="userCertificate",oi="revocationDate",Ja="crlEntryExtensions",W1=[gl,oi,Ja];class Sn extends D{constructor(e={}){super(),this.userCertificate=f(e,gl,Sn.defaultValues(gl)),this.revocationDate=f(e,oi,Sn.defaultValues(oi)),Ja in e&&(this.crlEntryExtensions=f(e,Ja,Sn.defaultValues(Ja))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gl:return new B;case oi:return new Le;case Ja:return new $e;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.userCertificate||gl}),Le.schema({names:{utcTimeName:t.revocationDate||oi,generalTimeName:t.revocationDate||oi}}),$e.schema({names:{blockName:t.crlEntryExtensions||Ja}},!0)]})}fromSchema(e){T(e,W1);const t=R(e,e,Sn.schema());O.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Le({schema:t.result.revocationDate}),Ja in t.result&&(this.crlEntryExtensions=new $e({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new A({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}Sn.CLASS_NAME="RevokedCertificate";const Pm="tbs",Mo="version",Om="signature",Dm="issuer",Tm="thisUpdate",Cc="nextUpdate",xc="revokedCertificates",Ic="crlExtensions",wl="signatureAlgorithm",yl="signatureValue",Gs="tbsCertList",Hh="".concat(Gs,".version"),yd="".concat(Gs,".signature"),vd="".concat(Gs,".issuer"),Mh="".concat(Gs,".thisUpdate"),uc="".concat(Gs,".nextUpdate"),Fh="".concat(Gs,".revokedCertificates"),Jh="".concat(Gs,".extensions"),G1=[Gs,Hh,yd,vd,Mh,uc,Fh,Jh,wl,yl];function z1(s={}){const e=f(s,"names",{});return new A({name:e.blockName||Gs,value:[new B({optional:!0,name:e.tbsCertListVersion||Hh,value:2}),V.schema(e.signature||{names:{blockName:yd}}),me.schema(e.issuer||{names:{blockName:vd}}),Le.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:Mh,generalTimeName:Mh}}),Le.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:uc,generalTimeName:uc}},!0),new A({optional:!0,value:[new Z({name:e.tbsCertListRevokedCertificates||Fh,value:new A({value:[new B,Le.schema(),$e.schema({},!0)]})})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[$e.schema(e.crlExtensions||{names:{blockName:Jh}})]})]})}const _1=[cd,Ig,L0,j0,Vg,ld,hd,U0,$0,Bg];class Me extends D{get tbs(){return pe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Pm,Me.defaultValues(Pm))),this.version=f(e,Mo,Me.defaultValues(Mo)),this.signature=f(e,Om,Me.defaultValues(Om)),this.issuer=f(e,Dm,Me.defaultValues(Dm)),this.thisUpdate=f(e,Tm,Me.defaultValues(Tm)),Cc in e&&(this.nextUpdate=f(e,Cc,Me.defaultValues(Cc))),xc in e&&(this.revokedCertificates=f(e,xc,Me.defaultValues(xc))),Ic in e&&(this.crlExtensions=f(e,Ic,Me.defaultValues(Ic))),this.signatureAlgorithm=f(e,wl,Me.defaultValues(wl)),this.signatureValue=f(e,yl,Me.defaultValues(yl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pm:return Ue;case Mo:return 0;case Om:return new V;case Dm:return new me;case Tm:return new Le;case Cc:return new Le;case xc:return[];case Ic:return new $e;case wl:return new V;case yl:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||"CertificateList",value:[z1(e),V.schema(t.signatureAlgorithm||{names:{blockName:wl}}),new re({name:t.signatureValue||yl})]})}fromSchema(e){T(e,G1);const t=R(e,e,Me.schema());O.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,Hh in t.result&&(this.version=t.result[Hh].valueBlock.valueDec),this.signature=new V({schema:t.result[yd]}),this.issuer=new me({schema:t.result[vd]}),this.thisUpdate=new Le({schema:t.result[Mh]}),uc in t.result&&(this.nextUpdate=new Le({schema:t.result[uc]})),Fh in t.result&&(this.revokedCertificates=Array.from(t.result[Fh],r=>new Sn({schema:r}))),Jh in t.result&&(this.crlExtensions=new $e({schema:t.result[Jh]})),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==Me.defaultValues(Mo)&&e.push(new B({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new A({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new A({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return Me.schema();const r=je(this.tbsView);O.assert(r,"TBS Certificate Revocation List"),t=r.result}return new A({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ce.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==Me.defaultValues(Mo)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}async sign(e,t="SHA-1",r=Q(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),{parameters:n}=a;this.signature=a.signatureAlgorithm,this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new re({valueHex:u})}async verify(e={},t=Q(!0)){let r;if(e.issuerCertificate&&(r=e.issuerCertificate.subjectPublicKeyInfo,!this.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(r=e.publicKeyInfo),!r)throw new Error("Issuer's certificate must be provided as an input parameter");if(this.crlExtensions){for(const a of this.crlExtensions.extensions)if(a.critical&&!_1.includes(a.extnID))return!1}return t.verifyWithPublicKey(this.tbsView,this.signatureValue,r,this.signatureAlgorithm)}}Me.CLASS_NAME="CertificateRevocationList";const ui="crlId",li="crlValue",Fo="parsedValue",X1=[ui,li];class An extends D{constructor(e={}){super(),this.crlId=f(e,ui,An.defaultValues(ui)),this.crlValue=f(e,li,An.defaultValues(li)),Fo in e&&(this.parsedValue=f(e,Fo,An.defaultValues(Fo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ui:return v;case li:return new X;case Fo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ui:return t===v;case li:return t instanceof X;case Fo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.id||"id"}),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.value||"value"})]})]})}fromSchema(e){T(e,X1);const t=R(e,e,An.schema({names:{id:ui,value:li}}));switch(O.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId){case mp:this.parsedValue=Me.fromBER(this.certValue.valueBlock.valueHex);break;default:throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId))}}toSchema(){return this.parsedValue&&(this.crlId=mp,this.crlValue=new $({valueHex:this.parsedValue.toSchema().toBER(!1)})),new A({value:[new J({value:this.crlId}),new I({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}An.CLASS_NAME="CRLBag";const ci="version",hi="encryptedContentInfo",Nr="unprotectedAttrs",Z1=[ci,hi,Nr];class gs extends D{constructor(e={}){super(),this.version=f(e,ci,gs.defaultValues(ci)),this.encryptedContentInfo=f(e,hi,gs.defaultValues(hi)),Nr in e&&(this.unprotectedAttrs=f(e,Nr,gs.defaultValues(Nr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ci:return 0;case hi:return new De;case Nr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ci:return t===0;case hi:return De.compareWithDefault("contentType",t.contentType)&&De.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&De.compareWithDefault("encryptedContent",t.encryptedContent);case Nr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),De.schema(t.encryptedContentInfo||{}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.unprotectedAttrs||v,value:ge.schema()})]})]})}fromSchema(e){T(e,Z1);const t=R(e,e,gs.schema({names:{version:ci,encryptedContentInfo:{names:{blockName:hi}},unprotectedAttrs:Nr}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new De({schema:t.result.encryptedContentInfo}),Nr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new ge({schema:r})))}toSchema(){const e=[];return e.push(new B({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}async encrypt(e,t=Q(!0)){he.assert(e,"parameters","object");const r=Et(Qe({},e),{contentType:"1.2.840.113549.1.7.1"});this.encryptedContentInfo=await t.encryptEncryptedContentInfo(r)}async decrypt(e,t=Q(!0)){he.assert(e,"parameters","object");const r=Et(Qe({},e),{encryptedContentInfo:this.encryptedContentInfo});return t.decryptEncryptedContentInfo(r)}}gs.CLASS_NAME="EncryptedData";const qa="encryptionAlgorithm",kr="encryptedData",Jo="parsedValue",Q1=[qa,kr];class Wr extends D{constructor(e={}){super(),this.encryptionAlgorithm=f(e,qa,Wr.defaultValues(qa)),this.encryptedData=f(e,kr,Wr.defaultValues(kr)),Jo in e&&(this.parsedValue=f(e,Jo,Wr.defaultValues(Jo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qa:return new V;case kr:return new $;case Jo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qa:return V.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case kr:return t.isEqual(Wr.defaultValues(e));case Jo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.encryptionAlgorithm||{names:{blockName:qa}}),new ke({value:[new $({name:t.encryptedData||kr}),new $({idBlock:{isConstructed:!0},name:t.encryptedData||kr})]})]})}fromSchema(e){T(e,Q1);const t=R(e,e,Wr.schema({names:{encryptionAlgorithm:{names:{blockName:qa}},encryptedData:kr}}));O.assertSchema(t,this.className),this.encryptionAlgorithm=new V({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new A({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}async parseInternalValues(e,t=Q(!0)){const r=await new gs({encryptedContentInfo:new De({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}).decrypt(e,t);this.parsedValue=qt.fromBER(r)}async makeInternalValues(e,t=Q(!0)){if(!this.parsedValue)throw new Error('Please initialize "parsedValue" first');const r=new gs,a=Et(Qe({},e),{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)});if(await r.encrypt(a,t),!r.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");this.encryptionAlgorithm=r.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=r.encryptedContentInfo.encryptedContent}}Wr.CLASS_NAME="PKCS8ShroudedKeyBag";const mi="secretTypeId",fi="secretValue",Y1=[mi,fi];class Ao extends D{constructor(e={}){super(),this.secretTypeId=f(e,mi,Ao.defaultValues(mi)),this.secretValue=f(e,fi,Ao.defaultValues(fi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case mi:return v;case fi:return new X;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case mi:return t===v;case fi:return t instanceof X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.id||"id"}),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.value||"value"})]})]})}fromSchema(e){T(e,Y1);const t=R(e,e,Ao.schema({names:{id:mi,value:fi}}));O.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new A({value:[new J({value:this.secretTypeId}),new I({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}Ao.CLASS_NAME="SecretBag";class Jr{static getItems(){return this.items||(this.items={},Jr.register("1.2.840.113549.1.12.10.1.1",qt),Jr.register("1.2.840.113549.1.12.10.1.2",Wr),Jr.register("1.2.840.113549.1.12.10.1.3",bn),Jr.register("1.2.840.113549.1.12.10.1.4",An),Jr.register("1.2.840.113549.1.12.10.1.5",Ao),Jr.register("1.2.840.113549.1.12.10.1.6",Ks)),this.items}static register(e,t){this.getItems()[e]=t}static find(e){return this.getItems()[e]||null}}const Wa="bagId",Ga="bagValue",xs="bagAttributes",eS=[Wa,Ga,xs];class ta extends D{constructor(e={}){super(),this.bagId=f(e,Wa,ta.defaultValues(Wa)),this.bagValue=f(e,Ga,ta.defaultValues(Ga)),xs in e&&(this.bagAttributes=f(e,xs,ta.defaultValues(xs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wa:return v;case Ga:return new X;case xs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wa:return t===v;case Ga:return t instanceof X;case xs:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.bagId||Wa}),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.bagValue||Ga})]}),new Je({optional:!0,value:[new Z({name:t.bagAttributes||xs,value:ge.schema()})]})]})}fromSchema(e){T(e,eS);const t=R(e,e,ta.schema({names:{bagId:Wa,bagValue:Ga,bagAttributes:xs}}));O.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const r=Jr.find(this.bagId);if(!r)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new r({schema:t.result.bagValue}),xs in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new ge({schema:a})))}toSchema(){const e=[new J({value:this.bagId}),new I({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new Je({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}ta.CLASS_NAME="SafeBag";const Hn="safeBags";class Ks extends D{constructor(e={}){super(),this.safeBags=f(e,Hn,Ks.defaultValues(Hn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hn:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.safeBags||v,value:ta.schema()})]})}fromSchema(e){T(e,[Hn]);const t=R(e,e,Ks.schema({names:{safeBags:Hn}}));O.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,r=>new ta({schema:r}))}toSchema(){return new A({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}Ks.CLASS_NAME="SafeContents";const vl="otherCertFormat",bl="otherCert",tS=[vl,bl];class na extends D{constructor(e={}){super(),this.otherCertFormat=f(e,vl,na.defaultValues(vl)),this.otherCert=f(e,bl,na.defaultValues(bl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vl:return v;case bl:return new X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.otherCertFormat||vl}),new X({name:t.otherCert||bl})]})}fromSchema(e){T(e,tS);const t=R(e,e,na.schema());O.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}toSchema(){return new A({value:[new J({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof X||(e.otherCert=this.otherCert.toJSON()),e}}const Sl="certificates",sS=[Sl];class ys extends D{constructor(e={}){super(),this.certificates=f(e,Sl,ys.defaultValues(Sl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Sl:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Je({name:t.blockName||v,value:[new Z({name:t.certificates||Sl,value:new ke({value:[oe.schema(),new I({idBlock:{tagClass:3,tagNumber:0},value:[new X]}),new I({idBlock:{tagClass:3,tagNumber:1},value:[new A]}),new I({idBlock:{tagClass:3,tagNumber:2},value:Lt.schema().valueBlock.value}),new I({idBlock:{tagClass:3,tagNumber:3},value:na.schema().valueBlock.value})]})})]})}fromSchema(e){T(e,sS);const t=R(e,e,ys.schema());O.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],r=>{const a=r.idBlock.tagNumber;if(r.idBlock.tagClass===1)return new oe({schema:r});const n=new A({value:r.valueBlock.value});switch(a){case 1:return n.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec===1?new Lt({schema:n}):new Us({schema:n});case 2:return new Lt({schema:n});case 3:return new na({schema:n})}return r})}toSchema(){return new Je({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof oe:return e.toSchema();case e instanceof Us:return new I({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof Lt:return new I({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof na:return new I({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}ys.CLASS_NAME="CertificateSet";const Al="otherRevInfoFormat",Nl="otherRevInfo",rS=[Al,Nl];class Fs extends D{constructor(e={}){super(),this.otherRevInfoFormat=f(e,Al,Fs.defaultValues(Al)),this.otherRevInfo=f(e,Nl,Fs.defaultValues(Nl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Al:return v;case Nl:return new X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.otherRevInfoFormat||Al}),new X({name:t.otherRevInfo||Nl})]})}fromSchema(e){T(e,rS);const t=R(e,e,Fs.schema());O.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new A({value:[new J({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof X||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}Fs.CLASS_NAME="OtherRevocationInfoFormat";const kl="crls",Rm="otherRevocationInfos",aS=[kl];class Js extends D{constructor(e={}){super(),this.crls=f(e,kl,Js.defaultValues(kl)),this.otherRevocationInfos=f(e,Rm,Js.defaultValues(Rm)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case kl:return[];case Rm:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new Je({name:t.blockName||v,value:[new Z({name:t.crls||v,value:new ke({value:[Me.schema(),new I({idBlock:{tagClass:3,tagNumber:1},value:[new J,new X]})]})})]})}fromSchema(e){T(e,aS);const t=R(e,e,Js.schema({names:{crls:kl}}));if(O.assertSchema(t,this.className),t.result.crls)for(const r of t.result.crls)r.idBlock.tagClass===1?this.crls.push(new Me({schema:r})):this.otherRevocationInfos.push(new Fs({schema:r}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r})),new Je({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}Js.CLASS_NAME="RevocationInfoChoices";const El="certs",za="crls",nS=[El,za];class Dn extends D{constructor(e={}){super(),this.crls=f(e,za,Dn.defaultValues(za)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case El:return new ys;case za:return new Js;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case El:return t.certificates.length===0;case za:return t.crls.length===0&&t.otherRevocationInfos.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({name:t.certs||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ys.schema().valueBlock.value}),new I({name:t.crls||v,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Js.schema().valueBlock.value})]})}fromSchema(e){T(e,nS);const t=R(e,e,Dn.schema({names:{certs:El,crls:za}}));O.assertSchema(t,this.className),El in t.result&&(this.certs=new ys({schema:new Je({value:t.result.certs.valueBlock.value})})),za in t.result&&(this.crls=new Js({schema:new Je({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new A({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}Dn.CLASS_NAME="OriginatorInfo";const Cl="issuer",xl="serialNumber",iS=[Cl,xl];class Ke extends D{constructor(e={}){super(),this.issuer=f(e,Cl,Ke.defaultValues(Cl)),this.serialNumber=f(e,xl,Ke.defaultValues(xl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Cl:return new me;case xl:return new B;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[me.schema(t.issuer||{}),new B({name:t.serialNumber||v})]})}fromSchema(e){T(e,iS);const t=R(e,e,Ke.schema({names:{issuer:{names:{blockName:Cl}},serialNumber:xl}}));O.assertSchema(t,this.className),this.issuer=new me({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new A({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}Ke.CLASS_NAME="IssuerAndSerialNumber";const Vc="variant",qo="value",oS=["blockName"];class No extends D{constructor(e={}){super(),this.variant=f(e,Vc,No.defaultValues(Vc)),qo in e&&(this.value=f(e,qo,No.defaultValues(qo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vc:return-1;case qo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vc:return t===-1;case qo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new ke({value:[Ke.schema({names:{blockName:t.blockName||v}}),new _({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){T(e,oS);const t=R(e,e,No.schema({names:{blockName:"blockName"}}));O.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ke({schema:t.result.blockName})):(this.variant=2,this.value=new $({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Ke))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof $))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new X}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&this.value&&(e.value=this.value.toJSON()),e}}No.CLASS_NAME="RecipientIdentifier";const _a="version",di="rid",pi="keyEncryptionAlgorithm",gi="encryptedKey",Bc="recipientCertificate",uS=[_a,di,pi,gi];class Pt extends D{constructor(e={}){super(),this.version=f(e,_a,Pt.defaultValues(_a)),this.rid=f(e,di,Pt.defaultValues(di)),this.keyEncryptionAlgorithm=f(e,pi,Pt.defaultValues(pi)),this.encryptedKey=f(e,gi,Pt.defaultValues(gi)),this.recipientCertificate=f(e,Bc,Pt.defaultValues(Bc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _a:return-1;case di:return{};case pi:return new V;case gi:return new $;case Bc:return new oe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _a:return t===Pt.defaultValues(_a);case di:return Object.keys(t).length===0;case pi:case gi:return t.isEqual(Pt.defaultValues(e));case Bc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),No.schema(t.rid||{}),V.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){T(e,uS);const t=R(e,e,Pt.schema({names:{version:_a,rid:{names:{blockName:di}},keyEncryptionAlgorithm:{names:{blockName:pi}},encryptedKey:gi}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,t.result.rid.idBlock.tagClass===3?this.rid=new $({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new Ke({schema:t.result.rid}),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Ke?(this.version=0,e.push(new B({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new B({value:this.version})),e.push(new _({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new A({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Pt.CLASS_NAME="KeyTransRecipientInfo";const wi="algorithm",yi="publicKey",lS=[wi,yi];class Hs extends D{constructor(e={}){super(),this.algorithm=f(e,wi,Hs.defaultValues(wi)),this.publicKey=f(e,yi,Hs.defaultValues(yi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wi:return new V;case yi:return new re;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wi:case yi:return t.isEqual(Hs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.algorithm||{}),new re({name:t.publicKey||v})]})}fromSchema(e){T(e,lS);const t=R(e,e,Hs.schema({names:{algorithm:{names:{blockName:wi}},publicKey:yi}}));O.assertSchema(t,this.className),this.algorithm=new V({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new A({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}Hs.CLASS_NAME="OriginatorPublicKey";const Pc="variant",Wo="value",cS=["blockName"];class qs extends D{constructor(e={}){super(),this.variant=f(e,Pc,qs.defaultValues(Pc)),Wo in e&&(this.value=f(e,Wo,qs.defaultValues(Wo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pc:return-1;case Wo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pc:return t===-1;case Wo:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new ke({value:[Ke.schema({names:{blockName:t.blockName||v}}),new _({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||v}),new I({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||v,value:Hs.schema().valueBlock.value})]})}fromSchema(e){T(e,cS);const t=R(e,e,qs.schema({names:{blockName:"blockName"}}));O.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ke({schema:t.result.blockName})):t.result.blockName.idBlock.tagNumber===0?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new Hs({schema:new A({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new X}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2||this.variant===3)&&(e.value=this.value.toJSON()),e}}qs.CLASS_NAME="OriginatorIdentifierOrKey";const vi="keyAttrId",cs="keyAttr",hS=[vi,cs];class os extends D{constructor(e={}){super(),this.keyAttrId=f(e,vi,os.defaultValues(vi)),cs in e&&(this.keyAttr=f(e,cs,os.defaultValues(cs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case vi:return v;case cs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case vi:return typeof t=="string"&&t===v;case cs:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({optional:t.optional||!0,name:t.blockName||v,value:[new J({name:t.keyAttrId||v}),new X({optional:!0,name:t.keyAttr||v})]})}fromSchema(e){T(e,hS);const t=R(e,e,os.schema({names:{keyAttrId:vi,keyAttr:cs}}));O.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),cs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new J({value:this.keyAttrId})),cs in this&&e.push(this.keyAttr),new A({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return cs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}os.CLASS_NAME="OtherKeyAttribute";const Xa="subjectKeyIdentifier",Er="date",Cr="other",mS=[Xa,Er,Cr];class fs extends D{constructor(e={}){super(),this.subjectKeyIdentifier=f(e,Xa,fs.defaultValues(Xa)),Er in e&&(this.date=f(e,Er,fs.defaultValues(Er))),Cr in e&&(this.other=f(e,Cr,fs.defaultValues(Cr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xa:return new $;case Er:return new Ee;case Cr:return new os;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xa:return t.isEqual(fs.defaultValues(Xa));case Er:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Cr:return t.keyAttrId===v&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new $({name:t.subjectKeyIdentifier||v}),new Ee({optional:!0,name:t.date||v}),os.schema(t.other||{})]})}fromSchema(e){T(e,mS);const t=R(e,e,fs.schema({names:{subjectKeyIdentifier:Xa,date:Er,other:{names:{blockName:Cr}}}}));O.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,Er in t.result&&(this.date=t.result.date),Cr in t.result&&(this.other=new os({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new A({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}fs.CLASS_NAME="RecipientKeyIdentifier";const Oc="variant",Dc="value",fS=["blockName"];class vs extends D{constructor(e={}){super(),this.variant=f(e,Oc,vs.defaultValues(Oc)),this.value=f(e,Dc,vs.defaultValues(Dc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oc:return-1;case Dc:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Oc:return t===-1;case Dc:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new ke({value:[Ke.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||v}}),new I({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:0},value:fs.schema(t.rKeyId||{names:{blockName:t.blockName||v}}).valueBlock.value})]})}fromSchema(e){T(e,fS);const t=R(e,e,vs.schema({names:{blockName:"blockName"}}));O.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1?(this.variant=1,this.value=new Ke({schema:t.result.blockName})):(this.variant=2,this.value=new fs({schema:new A({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new I({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new X}}toJSON(){const e={variant:this.variant};return(this.variant===1||this.variant===2)&&(e.value=this.value.toJSON()),e}}vs.CLASS_NAME="KeyAgreeRecipientIdentifier";const bi="rid",Za="encryptedKey",dS=[bi,Za];class Ms extends D{constructor(e={}){super(),this.rid=f(e,bi,Ms.defaultValues(bi)),this.encryptedKey=f(e,Za,Ms.defaultValues(Za)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case bi:return new vs;case Za:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case bi:return t.variant===-1&&!("value"in t);case Za:return t.isEqual(Ms.defaultValues(Za));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[vs.schema(t.rid||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){T(e,dS);const t=R(e,e,Ms.schema({names:{rid:{names:{blockName:bi}},encryptedKey:Za}}));O.assertSchema(t,this.className),this.rid=new vs({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new A({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Ms.CLASS_NAME="RecipientEncryptedKey";const Tc="encryptedKeys",qg="RecipientEncryptedKeys",pS=[qg];class ia extends D{constructor(e={}){super(),this.encryptedKeys=f(e,Tc,ia.defaultValues(Tc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tc:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tc:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.RecipientEncryptedKeys||v,value:Ms.schema()})]})}fromSchema(e){T(e,pS);const t=R(e,e,ia.schema({names:{RecipientEncryptedKeys:qg}}));O.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,r=>new Ms({schema:r}))}toSchema(){return new A({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}ia.CLASS_NAME="RecipientEncryptedKeys";const Si="version",Ai="originator",Is="ukm",Ni="keyEncryptionAlgorithm",ki="recipientEncryptedKeys",Rc="recipientCertificate",Lc="recipientPublicKey",gS=[Si,Ai,Is,Ni,ki];class xt extends D{constructor(e={}){super(),this.version=f(e,Si,xt.defaultValues(Si)),this.originator=f(e,Ai,xt.defaultValues(Ai)),Is in e&&(this.ukm=f(e,Is,xt.defaultValues(Is))),this.keyEncryptionAlgorithm=f(e,Ni,xt.defaultValues(Ni)),this.recipientEncryptedKeys=f(e,ki,xt.defaultValues(ki)),this.recipientCertificate=f(e,Rc,xt.defaultValues(Rc)),this.recipientPublicKey=f(e,Lc,xt.defaultValues(Lc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return 0;case Ai:return new qs;case Is:return new $;case Ni:return new V;case ki:return new ia;case Rc:return new oe;case Lc:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t===0;case Ai:return t.variant===-1&&!("value"in t);case Is:return t.isEqual(xt.defaultValues(Is));case Ni:return t.algorithmId===v&&!("algorithmParams"in t);case ki:return t.encryptedKeys.length===0;case Rc:return!1;case Lc:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new I({idBlock:{tagClass:3,tagNumber:0},value:[qs.schema(t.originator||{})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new $({name:t.ukm||v})]}),V.schema(t.keyEncryptionAlgorithm||{}),ia.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){T(e,gS);const t=R(e,e,xt.schema({names:{version:Si,originator:{names:{blockName:Ai}},ukm:Is,keyEncryptionAlgorithm:{names:{blockName:Ni}},recipientEncryptedKeys:{names:{blockName:ki}}}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new qs({schema:t.result.originator}),Is in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new ia({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new B({value:this.version})),e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new A({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}xt.CLASS_NAME="KeyAgreeRecipientInfo";const Qa="keyIdentifier",xr="date",Ir="other",wS=[Qa,xr,Ir];class as extends D{constructor(e={}){super(),this.keyIdentifier=f(e,Qa,as.defaultValues(Qa)),xr in e&&(this.date=f(e,xr,as.defaultValues(xr))),Ir in e&&(this.other=f(e,Ir,as.defaultValues(Ir))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qa:return new $;case xr:return new Ee;case Ir:return new os;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qa:return t.isEqual(as.defaultValues(Qa));case xr:return t.year===0&&t.month===0&&t.day===0&&t.hour===0&&t.minute===0&&t.second===0&&t.millisecond===0;case Ir:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new $({name:t.keyIdentifier||v}),new Ee({optional:!0,name:t.date||v}),os.schema(t.other||{})]})}fromSchema(e){T(e,wS);const t=R(e,e,as.schema({names:{keyIdentifier:Qa,date:xr,other:{names:{blockName:Ir}}}}));O.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,xr in t.result&&(this.date=t.result.date),Ir in t.result&&(this.other=new os({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new A({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}as.CLASS_NAME="KEKIdentifier";const Ei="version",Ci="kekid",xi="keyEncryptionAlgorithm",Ya="encryptedKey",jc="preDefinedKEK",yS=[Ei,Ci,xi,Ya];class Ot extends D{constructor(e={}){super(),this.version=f(e,Ei,Ot.defaultValues(Ei)),this.kekid=f(e,Ci,Ot.defaultValues(Ci)),this.keyEncryptionAlgorithm=f(e,xi,Ot.defaultValues(xi)),this.encryptedKey=f(e,Ya,Ot.defaultValues(Ya)),this.preDefinedKEK=f(e,jc,Ot.defaultValues(jc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ei:return 0;case Ci:return new as;case xi:return new V;case Ya:return new $;case jc:return Ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===Ot.defaultValues(Ei);case Ci:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case xi:return t.algorithmId===v&&!("algorithmParams"in t);case Ya:return t.isEqual(Ot.defaultValues(Ya));case jc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),as.schema(t.kekid||{}),V.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){T(e,yS);const t=R(e,e,Ot.schema({names:{version:Ei,kekid:{names:{blockName:Ci}},keyEncryptionAlgorithm:{names:{blockName:xi}},encryptedKey:Ya}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new as({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new A({value:[new B({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}Ot.CLASS_NAME="KEKRecipientInfo";const Ii="version",Vr="keyDerivationAlgorithm",Vi="keyEncryptionAlgorithm",en="encryptedKey",Uc="password",vS=[Ii,Vr,Vi,en];class Mt extends D{constructor(e={}){super(),this.version=f(e,Ii,Mt.defaultValues(Ii)),Vr in e&&(this.keyDerivationAlgorithm=f(e,Vr,Mt.defaultValues(Vr))),this.keyEncryptionAlgorithm=f(e,Vi,Mt.defaultValues(Vi)),this.encryptedKey=f(e,en,Mt.defaultValues(en)),this.password=f(e,Uc,Mt.defaultValues(Uc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ii:return-1;case Vr:return new V;case Vi:return new V;case en:return new $;case Uc:return Ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ii:return t===-1;case Vr:case Vi:return t.algorithmId===v&&!("algorithmParams"in t);case en:return t.isEqual(Mt.defaultValues(en));case Uc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new I({name:t.keyDerivationAlgorithm||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:V.schema().valueBlock.value}),V.schema(t.keyEncryptionAlgorithm||{}),new $({name:t.encryptedKey||v})]})}fromSchema(e){T(e,vS);const t=R(e,e,Mt.schema({names:{version:Ii,keyDerivationAlgorithm:Vr,keyEncryptionAlgorithm:{names:{blockName:Vi}},encryptedKey:en}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Vr in t.result&&(this.keyDerivationAlgorithm=new V({schema:new A({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new V({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new B({value:this.version})),this.keyDerivationAlgorithm&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new A({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}Mt.CLASS_NAME="PasswordRecipientInfo";const Bi="oriType",tn="oriValue",bS=[Bi,tn];class sa extends D{constructor(e={}){super(),this.oriType=f(e,Bi,sa.defaultValues(Bi)),this.oriValue=f(e,tn,sa.defaultValues(tn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bi:return v;case tn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bi:return t===v;case tn:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.oriType||v}),new X({name:t.oriValue||v})]})}fromSchema(e){T(e,bS);const t=R(e,e,sa.schema({names:{oriType:Bi,oriValue:tn}}));O.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new A({value:[new J({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return sa.compareWithDefault(tn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}sa.CLASS_NAME="OtherRecipientInfo";const $c="variant",Go="value",SS=["blockName"];class Wt extends D{constructor(e={}){super(),this.variant=f(e,$c,Wt.defaultValues($c)),Go in e&&(this.value=f(e,Go,Wt.defaultValues(Go))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $c:return-1;case Go:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $c:return t===Wt.defaultValues(e);case Go:return Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new ke({value:[Pt.schema({names:{blockName:t.blockName||v}}),new I({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:1},value:xt.schema().valueBlock.value}),new I({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:2},value:Ot.schema().valueBlock.value}),new I({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:3},value:Mt.schema().valueBlock.value}),new I({name:t.blockName||v,idBlock:{tagClass:3,tagNumber:4},value:sa.schema().valueBlock.value})]})}fromSchema(e){T(e,SS);const t=R(e,e,Wt.schema({names:{blockName:"blockName"}}));if(O.assertSchema(t,this.className),t.result.blockName.idBlock.tagClass===1)this.variant=1,this.value=new Pt({schema:t.result.blockName});else{const r=new A({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new xt({schema:r});break;case 2:this.variant=3,this.value=new Ot({schema:r});break;case 3:this.variant=4,this.value=new Mt({schema:r});break;case 4:this.variant=5,this.value=new sa({schema:r});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){ne.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new X}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}Wt.CLASS_NAME="RecipientInfo";const Br="hashAlgorithm",Pr="maskGenAlgorithm",Or="pSourceAlgorithm",AS=[Br,Pr,Or];class wt extends D{constructor(e={}){super(),this.hashAlgorithm=f(e,Br,wt.defaultValues(Br)),this.maskGenAlgorithm=f(e,Pr,wt.defaultValues(Pr)),this.pSourceAlgorithm=f(e,Or,wt.defaultValues(Or)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Br:return new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new Fe});case Pr:return new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new V({algorithmId:"1.3.14.3.2.26",algorithmParams:new Fe}).toSchema()});case Or:return new V({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new $({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new I({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[V.schema(t.hashAlgorithm||{})]}),new I({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[V.schema(t.maskGenAlgorithm||{})]}),new I({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[V.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){T(e,AS);const t=R(e,e,wt.schema({names:{hashAlgorithm:{names:{blockName:Br}},maskGenAlgorithm:{names:{blockName:Pr}},pSourceAlgorithm:{names:{blockName:Or}}}}));O.assertSchema(t,this.className),Br in t.result&&(this.hashAlgorithm=new V({schema:t.result.hashAlgorithm})),Pr in t.result&&(this.maskGenAlgorithm=new V({schema:t.result.maskGenAlgorithm})),Or in t.result&&(this.pSourceAlgorithm=new V({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(wt.defaultValues(Br))||e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(wt.defaultValues(Pr))||e.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(wt.defaultValues(Or))||e.push(new I({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new A({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(wt.defaultValues(Br))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(wt.defaultValues(Pr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(wt.defaultValues(Or))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}wt.CLASS_NAME="RSAESOAEPParams";const Pi="keyInfo",Dr="entityUInfo",Oi="suppPubInfo",NS=[Pi,Dr,Oi];class Rs extends D{constructor(e={}){super(),this.keyInfo=f(e,Pi,Rs.defaultValues(Pi)),Dr in e&&(this.entityUInfo=f(e,Dr,Rs.defaultValues(Dr))),this.suppPubInfo=f(e,Oi,Rs.defaultValues(Oi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pi:return new V;case Dr:return new $;case Oi:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Pi:case Dr:case Oi:return t.isEqual(Rs.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.keyInfo||{}),new I({name:t.entityUInfo||v,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new $]}),new I({name:t.suppPubInfo||v,idBlock:{tagClass:3,tagNumber:2},value:[new $]})]})}fromSchema(e){T(e,NS);const t=R(e,e,Rs.schema({names:{keyInfo:{names:{blockName:Pi}},entityUInfo:Dr,suppPubInfo:Oi}}));O.assertSchema(t,this.className),this.keyInfo=new V({schema:t.result.keyInfo}),Dr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new I({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new A({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}Rs.CLASS_NAME="ECCCMSSharedInfo";const Di="version",Tr="originatorInfo",Ti="recipientInfos",Ri="encryptedContentInfo",Rr="unprotectedAttrs",kS=[Di,Tr,Ti,Ri,Rr],Bp={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},ES={"P-256":256,"P-384":384,"P-521":528};class ss extends D{constructor(e={}){super(),this.version=f(e,Di,ss.defaultValues(Di)),Tr in e&&(this.originatorInfo=f(e,Tr,ss.defaultValues(Tr))),this.recipientInfos=f(e,Ti,ss.defaultValues(Ti)),this.encryptedContentInfo=f(e,Ri,ss.defaultValues(Ri)),Rr in e&&(this.unprotectedAttrs=f(e,Rr,ss.defaultValues(Rr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return 0;case Tr:return new Dn;case Ti:return[];case Ri:return new De;case Rr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Di:return t===ss.defaultValues(e);case Tr:return t.certs.certificates.length===0&&t.crls.crls.length===0;case Ti:case Rr:return t.length===0;case Ri:return De.compareWithDefault("contentType",t.contentType)&&De.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&De.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||v}),new I({name:t.originatorInfo||v,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Dn.schema().valueBlock.value}),new Je({value:[new Z({name:t.recipientInfos||v,value:Wt.schema()})]}),De.schema(t.encryptedContentInfo||{}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.unprotectedAttrs||v,value:ge.schema()})]})]})}fromSchema(e){T(e,kS);const t=R(e,e,ss.schema({names:{version:Di,originatorInfo:Tr,recipientInfos:Ti,encryptedContentInfo:{names:{blockName:Ri}},unprotectedAttrs:Rr}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Tr in t.result&&(this.originatorInfo=new Dn({schema:new A({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,r=>new Wt({schema:r})),this.encryptedContentInfo=new De({schema:t.result.encryptedContentInfo}),Rr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,r=>new ge({schema:r})))}toSchema(){const e=[];return e.push(new B({value:this.version})),this.originatorInfo&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new Je({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,r,a=Q(!0)){const n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},Bp,t||{});if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549")!==-1)r=1;else if(e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045")!==-1)r=2;else throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));switch(r){case 1:{let u,i;if(n.useOAEP===!0){u=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const o=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),c=new V({algorithmId:o,algorithmParams:new Fe});i=new wt({hashAlgorithm:c,maskGenAlgorithm:new V({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:c.toSchema()})}).toSchema()}else{if(u=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),u===v)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");i=new Fe}const l=new Pt({version:0,rid:new Ke({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new V({algorithmId:u,algorithmParams:i}),recipientCertificate:e});this.recipientInfos.push(new Wt({variant:1,value:l}))}break;case 2:{const u=new vs({variant:1,value:new Ke({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(u,n,{recipientCertificate:e},a)}break;default:throw new Error('Unknown "variant" value: '.concat(r))}return!0}addRecipientByPreDefinedData(e,t={},r,a=Q(!0)){if(he.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const n=new ArrayBuffer(16),u=new Uint8Array(n);a.getRandomValues(u),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),t.iterationCount===void 0&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new Fe),r){case 1:{const n=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new Ot({version:4,kekid:new as({keyIdentifier:new $({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new V({algorithmId:n,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Wt({variant:3,value:u}))}break;case 2:{const n=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),u=new ArrayBuffer(64),i=new Uint8Array(u);a.getRandomValues(i);const l=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),o=new ht({salt:new $({valueHex:u}),iterationCount:t.iterationCount,prf:new V({algorithmId:l,algorithmParams:new Fe})}),c=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),m=new Mt({version:0,keyDerivationAlgorithm:new V({algorithmId:n,algorithmParams:o.toSchema()}),keyEncryptionAlgorithm:new V({algorithmId:c,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Wt({variant:4,value:m}))}break;default:throw new Error('Unknown value for "variant": '.concat(r))}}addRecipientByKeyIdentifier(e,t,r,a=Q(!0)){const n=Object.assign({},Bp,r||{}),u=new vs({variant:2,value:new fs({subjectKeyIdentifier:new $({valueHex:t})})});this._addKeyAgreeRecipientInfo(u,n,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,r,a=Q(!0)){const n=new Ms({rid:e}),u=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),i=new V({algorithmId:u}),l=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),o=new ArrayBuffer(64),c=new Uint8Array(o);a.getRandomValues(c);const m={version:3,ukm:new $({valueHex:o}),keyEncryptionAlgorithm:new V({algorithmId:l,algorithmParams:i.toSchema()}),recipientEncryptedKeys:new ia({encryptedKeys:[n]})},h=new xt(Object.assign(m,r));this.recipientInfos.push(new Wt({variant:2,value:h}))}async encrypt(e,t,r=Q(!0)){const a=new ArrayBuffer(16),n=new Uint8Array(a);r.getRandomValues(n);const u=new Uint8Array(t),i=r.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),l=await r.generateKey(e,!0,["encrypt"]),o=await r.encrypt({name:e.name,iv:n},l,u),c=await r.exportKey("raw",l);this.version=2,this.encryptedContentInfo=new De({disableSplit:this.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new V({algorithmId:i,algorithmParams:new $({valueHex:a})}),encryptedContent:new $({valueHex:o})});const m=async y=>{const k=this.recipientInfos[y].value;let g,b;if(k.recipientPublicKey)g=k.recipientPublicKey.algorithm.namedCurve,b=k.recipientPublicKey;else if(k.recipientCertificate){const se=k.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(se.constructor.blockName()!==J.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(y));switch(se.valueBlock.toString()){case"1.2.840.10045.3.1.7":g="P-256";break;case"1.3.132.0.34":g="P-384";break;case"1.3.132.0.35":g="P-521";break;default:throw new Error("Incorrect curve OID for index ".concat(y))}b=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:g},usages:[]}},r)}else throw new Error("Unsupported RecipientInfo");const N=ES[g],S=await r.generateKey({name:"ECDH",namedCurve:g},!0,["deriveBits"]),C=await r.exportKey("spki",S.publicKey),x=await r.deriveBits({name:"ECDH",public:b},S.privateKey,N),E=new V({schema:k.keyEncryptionAlgorithm.algorithmParams}),P=r.getAlgorithmByOID(E.algorithmId,!0,"aesKWAlgorithm");let K=P.length;const L=new ArrayBuffer(4),U=new Uint8Array(L);for(let se=3;se>=0;se--)U[se]=K,K>>=8;const j=new Rs({keyInfo:new V({algorithmId:E.algorithmId}),entityUInfo:k.ukm,suppPubInfo:new $({valueHex:L})}).toSchema().toBER(!1),M=r.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),G=await wp(M.kdf,x,P.length,j,r),we=await r.importKey("raw",G,{name:"AES-KW"},!0,["wrapKey"]),ae=await r.wrapKey("raw",l,we,{name:"AES-KW"}),Y=new qs;return Y.variant=3,Y.value=Hs.fromBER(C),k.originator=Y,k.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new $({valueHex:ae}),{ecdhPrivateKey:S.privateKey}},h=async y=>{const k=this.recipientInfos[y].value,g=r.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(g.name==="RSA-OAEP"){const b=k.keyEncryptionAlgorithm.algorithmParams,N=new wt({schema:b});if(g.hash=r.getAlgorithmByOID(N.hashAlgorithm.algorithmId),!("name"in g.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(N.hashAlgorithm.algorithmId))}try{const b=await k.recipientCertificate.getPublicKey({algorithm:{algorithm:g,usages:["encrypt","wrapKey"]}},r),N=await r.encrypt(b.algorithm,b,c);k.encryptedKey=new $({valueHex:N})}catch(b){}},p=async y=>{const k=this.recipientInfos[y].value,g=r.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),b=await r.importKey("raw",new Uint8Array(k.preDefinedKEK),g,!0,["wrapKey"]),N=await r.wrapKey("raw",l,b,g);k.encryptedKey=new $({valueHex:N})},d=async y=>{const k=this.recipientInfos[y].value;let g;if(!k.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!k.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{g=new ht({schema:k.keyDerivationAlgorithm.algorithmParams})}catch(L){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const b=new Uint8Array(k.password),N=await r.importKey("raw",b,"PBKDF2",!1,["deriveKey"]),S=r.getAlgorithmByOID(k.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let C="SHA-1";g.prf&&(C=r.getAlgorithmByOID(g.prf.algorithmId,!0,"prfAlgorithm").hash.name);const x=new Uint8Array(g.salt.valueBlock.valueHex),E=g.iterationCount,P=await r.deriveKey({name:"PBKDF2",hash:{name:C},salt:x,iterations:E},N,S,!0,["wrapKey"]),K=await r.wrapKey("raw",l,P,S);k.encryptedKey=new $({valueHex:K})},w=[];for(let y=0;y<this.recipientInfos.length;y++)switch(this.recipientInfos[y].variant){case 1:w.push(await h(y));break;case 2:w.push(await m(y));break;case 3:w.push(await p(y));break;case 4:w.push(await d(y));break;default:throw new Error("Unknown recipient type in array with index ".concat(y))}return w}async decrypt(e,t,r=Q(!0)){const a=t||{};if(e+1>this.recipientInfos.length)throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));const n=async w=>{const y=this.recipientInfos[w].value;let k,g,b;const N=y.originator;if(a.recipientCertificate){const G=a.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(G.constructor.blockName()!==J.blockName())throw new Error('Incorrect "recipientCertificate" for index '.concat(w));k=G.valueBlock.toString()}else if(N.value.algorithm.algorithmParams){const G=N.value.algorithm.algorithmParams;if(G.constructor.blockName()!==J.blockName())throw new Error("Incorrect originator for index ".concat(w));k=G.valueBlock.toString()}else throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(k){case"1.2.840.10045.3.1.7":g="P-256",b=256;break;case"1.3.132.0.34":g="P-384",b=384;break;case"1.3.132.0.35":g="P-521",b=528;break;default:throw new Error("Incorrect curve OID for index ".concat(w))}let S,C=r;pe.isBufferSource(a.recipientPrivateKey)?S=await r.importKey("pkcs8",a.recipientPrivateKey,{name:"ECDH",namedCurve:g},!0,["deriveBits"]):(S=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(C=a.crypto.subtle)),"algorithmParams"in N.value.algorithm||(N.value.algorithm.algorithmParams=new J({value:k}));const x=N.value.toSchema().toBER(!1),E=await r.importKey("spki",x,{name:"ECDH",namedCurve:g},!0,[]),P=await C.deriveBits({name:"ECDH",public:E},S,b);async function K(G){G=G||!1;const we=new V({schema:y.keyEncryptionAlgorithm.algorithmParams}),ae=r.getAlgorithmByOID(we.algorithmId,!0,"kwAlgorithm");let Y=ae.length;const se=new ArrayBuffer(4),F=new Uint8Array(se);for(let ie=3;ie>=0;ie--)F[ie]=Y,Y>>=8;const W={algorithmId:we.algorithmId};G&&(W.algorithmParams=new Fe);const q=new Rs({keyInfo:new V(W),entityUInfo:y.ukm,suppPubInfo:new $({valueHex:se})}).toSchema().toBER(!1),ee=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!ee.name)throw new Error("Incorrect OID for key encryption algorithm: ".concat(y.keyEncryptionAlgorithm.algorithmId));return wp(ee.kdf,P,ae.length,q,r)}const L=await K(),U=async G=>r.importKey("raw",G,{name:"AES-KW"},!0,["unwrapKey"]),j=await U(L),M=async G=>{const we=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,ae=r.getAlgorithmByOID(we,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",y.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,G,{name:"AES-KW"},ae,!0,["decrypt"])};try{return await M(j)}catch(G){const we=await K(!0),ae=await U(we);return M(ae)}},u=async w=>{const y=this.recipientInfos[w].value;if(!a.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const k=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if(k.name==="RSA-OAEP"){const x=y.keyEncryptionAlgorithm.algorithmParams,E=new wt({schema:x});if(k.hash=r.getAlgorithmByOID(E.hashAlgorithm.algorithmId),!("name"in k.hash))throw new Error("Incorrect OID for hash algorithm: ".concat(E.hashAlgorithm.algorithmId))}let g,b=r;pe.isBufferSource(a.recipientPrivateKey)?g=await r.importKey("pkcs8",a.recipientPrivateKey,k,!0,["decrypt"]):(g=a.recipientPrivateKey,"crypto"in a&&a.crypto&&(b=a.crypto.subtle));const N=await b.decrypt(g.algorithm,g,y.encryptedKey.valueBlock.valueHexView),S=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,C=r.getAlgorithmByOID(S,!0,"contentEncryptionAlgorithm");if(!("name"in C))throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(S));return r.importKey("raw",N,C,!0,["decrypt"])},i=async w=>{const y=this.recipientInfos[w].value;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const k=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),g=await r.importKey("raw",a.preDefinedData,k,!0,["unwrapKey"]),b=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,N=r.getAlgorithmByOID(b,!0,"contentEncryptionAlgorithm");if(!N.name)throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(b));return r.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,g,k,N,!0,["decrypt"])},l=async w=>{const y=this.recipientInfos[w].value;let k;if(!a.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!y.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!y.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{k=new ht({schema:y.keyDerivationAlgorithm.algorithmParams})}catch(K){throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const g=await r.importKey("raw",a.preDefinedData,"PBKDF2",!1,["deriveKey"]),b=r.getAlgorithmByOID(y.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),N=k.prf?r.getAlgorithmByOID(k.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",S=new Uint8Array(k.salt.valueBlock.valueHex),C=k.iterationCount,x=await r.deriveKey({name:"PBKDF2",hash:{name:N},salt:S,iterations:C},g,b,!0,["unwrapKey"]),E=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,P=r.getAlgorithmByOID(E,!0,"contentEncryptionAlgorithm");return r.unwrapKey("raw",y.encryptedKey.valueBlock.valueHexView,x,b,P,!0,["decrypt"])};let o;switch(this.recipientInfos[e].variant){case 1:o=await u(e);break;case 2:o=await n(e);break;case 3:o=await i(e);break;case 4:o=await l(e);break;default:throw new Error("Unknown recipient type in array with index ".concat(e))}const c=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=r.getAlgorithmByOID(c,!0,"contentEncryptionAlgorithm"),h=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,p=new Uint8Array(h);if(!this.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const d=this.encryptedContentInfo.getEncryptedContent();return r.decrypt({name:m.name,iv:p},o,d)}}ss.CLASS_NAME="EnvelopedData";const Mn="safeContents",zo="parsedValue",Pp="contentInfos";class Tn extends D{constructor(e={}){super(),this.safeContents=f(e,Mn,Tn.defaultValues(Mn)),zo in e&&(this.parsedValue=f(e,zo,Tn.defaultValues(zo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mn:return[];case zo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mn:return t.length===0;case zo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new Z({name:t.contentInfos||v,value:fe.schema()})]})}fromSchema(e){T(e,[Pp]);const t=R(e,e,Tn.schema({names:{contentInfos:Pp}}));O.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,r=>new fe({schema:r}))}toSchema(){return new A({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}async parseInternalValues(e,t=Q(!0)){if(ne.assert(e,Mn),he.assert(e.safeContents,Mn,"Array"),e.safeContents.length!==this.safeContents.length)throw new he('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');this.parsedValue={safeContents:[]};for(const[r,a]of this.safeContents.entries()){const n=e.safeContents[r],u="parameters.safeContents[".concat(r,"]");switch(a.contentType){case md:{he.assert(a.content,"this.safeContents[j].content",$);const i=a.content.getValue();this.parsedValue.safeContents.push({privacyMode:0,value:Ks.fromBER(i)})}break;case jg:{const i=new ss({schema:a.content});ne.assert(u,n,"recipientCertificate","recipientKey");const l=n,o=l.recipientCertificate,c=l.recipientKey,m=await i.decrypt(0,{recipientCertificate:o,recipientPrivateKey:c},t);this.parsedValue.safeContents.push({privacyMode:2,value:Ks.fromBER(m)})}break;case Ug:{const i=new gs({schema:a.content});ne.assert(u,n,"password");const l=n.password,o=await i.decrypt({password:l},t);this.parsedValue.safeContents.push({privacyMode:1,value:Ks.fromBER(o)})}break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(a.contentType))}}}async makeInternalValues(e,t=Q(!0)){if(!this.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(he.assert(this.parsedValue,"this.parsedValue","object"),he.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),he.assert(e,"parameters","object"),ne.assert(e,"safeContents"),he.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==this.parsedValue.safeContents.length)throw new he('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');this.safeContents=[];for(const[r,a]of this.parsedValue.safeContents.entries())switch(ne.assert("content",a,"privacyMode","value"),he.assert(a.value,"content.value",Ks),a.privacyMode){case 0:{const n=a.value.toSchema().toBER(!1);this.safeContents.push(new fe({contentType:"1.2.840.113549.1.7.1",content:new $({valueHex:n})}))}break;case 1:{const n=new gs,u=e.safeContents[r];u.contentToEncrypt=a.value.toSchema().toBER(!1),await n.encrypt(u,t),this.safeContents.push(new fe({contentType:"1.2.840.113549.1.7.6",content:n.toSchema()}))}break;case 2:{const n=new ss,u=a.value.toSchema().toBER(!1),i=e.safeContents[r];switch(ne.assert("parameters.safeContents[".concat(r,"]"),i,"encryptingCertificate","encryptionAlgorithm"),!0){case i.encryptionAlgorithm.name.toLowerCase()==="aes-cbc":case i.encryptionAlgorithm.name.toLowerCase()==="aes-gcm":break;default:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(i.encryptionAlgorithm))}switch(!0){case i.encryptionAlgorithm.length===128:case i.encryptionAlgorithm.length===192:case i.encryptionAlgorithm.length===256:break;default:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(i.encryptionAlgorithm.length))}const l=i.encryptionAlgorithm;n.addRecipientByCertificate(i.encryptingCertificate,{},void 0,t),await n.encrypt(l,u,t),this.safeContents.push(new fe({contentType:"1.2.840.113549.1.7.3",content:n.toSchema()}))}break;default:throw new Error('Incorrect value for "content.privacyMode": '.concat(a.privacyMode))}return this}}Tn.CLASS_NAME="AuthenticatedSafe";const sn="hashAlgorithm",Li="issuerNameHash",ji="issuerKeyHash",rn="serialNumber",CS=[sn,Li,ji,rn];class Re extends D{static async create(e,t,r=Q(!0)){const a=new Re;return await a.createForCertificate(e,t,r),a}constructor(e={}){super(),this.hashAlgorithm=f(e,sn,Re.defaultValues(sn)),this.issuerNameHash=f(e,Li,Re.defaultValues(Li)),this.issuerKeyHash=f(e,ji,Re.defaultValues(ji)),this.serialNumber=f(e,rn,Re.defaultValues(rn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case sn:return new V;case Li:case ji:return new $;case rn:return new B;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case sn:return t.algorithmId===v&&!("algorithmParams"in t);case Li:case ji:case rn:return t.isEqual(Re.defaultValues(rn));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||v}}),new $({name:t.issuerNameHash||v}),new $({name:t.issuerKeyHash||v}),new B({name:t.serialNumber||v})]})}fromSchema(e){T(e,CS);const t=R(e,e,Re.schema({names:{hashAlgorithm:sn,issuerNameHash:Li,issuerKeyHash:ji,serialNumber:rn}}));O.assertSchema(t,this.className),this.hashAlgorithm=new V({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new A({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!pe.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!pe.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}async createForCertificate(e,t,r=Q(!0)){ne.assert(t,sn,"issuerCertificate");const a=r.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");this.hashAlgorithm=new V({algorithmId:a,algorithmParams:new Fe});const n=t.issuerCertificate;this.serialNumber=e.serialNumber;const u=await r.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1));this.issuerNameHash=new $({valueHex:u});const i=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,l=await r.digest({name:t.hashAlgorithm},i);this.issuerKeyHash=new $({valueHex:l})}}Re.CLASS_NAME="CertID";const Ui="certID",$i="certStatus",Ki="thisUpdate",Lr="nextUpdate",an="singleExtensions",xS=[Ui,$i,Ki,Lr,an];class rs extends D{constructor(e={}){super(),this.certID=f(e,Ui,rs.defaultValues(Ui)),this.certStatus=f(e,$i,rs.defaultValues($i)),this.thisUpdate=f(e,Ki,rs.defaultValues(Ki)),Lr in e&&(this.nextUpdate=f(e,Lr,rs.defaultValues(Lr))),an in e&&(this.singleExtensions=f(e,an,rs.defaultValues(an))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ui:return new Re;case $i:return{};case Ki:case Lr:return new Date(0,0,0);case an:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ui:return Re.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Re.compareWithDefault("issuerNameHash",t.issuerNameHash)&&Re.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&Re.compareWithDefault("serialNumber",t.serialNumber);case $i:return Object.keys(t).length===0;case Ki:case Lr:return t===rs.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[Re.schema(t.certID||{}),new ke({value:[new _({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:0}}),new I({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:1},value:[new Ee,new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ec]})]}),new _({name:t.certStatus||v,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Ee({name:t.thisUpdate||v}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ee({name:t.nextUpdate||v})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[$e.schema(t.singleExtensions||{})]})]})}fromSchema(e){T(e,xS);const t=R(e,e,rs.schema({names:{certID:{names:{blockName:Ui}},certStatus:$i,thisUpdate:Ki,nextUpdate:Lr,singleExtensions:{names:{blockName:an}}}}));O.assertSchema(t,this.className),this.certID=new Re({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Lr in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),an in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,r=>new Te({schema:r})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Ee({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[new Ee({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new A({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}rs.CLASS_NAME="SingleResponse";const Kc="tbs",nn="version",Il="responderID",Vl="producedAt",Bl="responses",Hi="responseExtensions",jn="ResponseData",th="".concat(jn,".").concat(nn),Mi="".concat(jn,".").concat(Il),yf="".concat(jn,".").concat(Vl),vf="".concat(jn,".").concat(Bl),sh="".concat(jn,".").concat(Hi),IS=[jn,th,Mi,yf,vf,sh];class ze extends D{get tbs(){return pe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Kc,ze.defaultValues(Kc))),nn in e&&(this.version=f(e,nn,ze.defaultValues(nn))),this.responderID=f(e,Il,ze.defaultValues(Il)),this.producedAt=f(e,Vl,ze.defaultValues(Vl)),this.responses=f(e,Bl,ze.defaultValues(Bl)),Hi in e&&(this.responseExtensions=f(e,Hi,ze.defaultValues(Hi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case nn:return 0;case Kc:return Ue;case Il:return{};case Vl:return new Date(0,0,0);case Bl:case Hi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Kc:return t.byteLength===0;case Il:return Object.keys(t).length===0;case Vl:return t===ze.defaultValues(e);case Bl:case Hi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||jn,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({name:t.version||th})]}),new ke({value:[new I({name:t.responderID||Mi,idBlock:{tagClass:3,tagNumber:1},value:[me.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new I({name:t.responderID||Mi,idBlock:{tagClass:3,tagNumber:2},value:[new $({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Ee({name:t.producedAt||yf}),new A({value:[new Z({name:vf,value:rs.schema(t.response||{})})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[$e.schema(t.extensions||{names:{blockName:sh}})]})]})}fromSchema(e){T(e,IS);const t=R(e,e,ze.schema());O.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,th in t.result&&(this.version=t.result[th].valueBlock.valueDec),t.result[Mi].idBlock.tagNumber===1?this.responderID=new me({schema:t.result[Mi].valueBlock.value[0]}):this.responderID=t.result[Mi].valueBlock.value[0],this.producedAt=t.result[yf].toDate(),this.responses=Array.from(t.result[vf],r=>new rs({schema:r})),sh in t.result&&(this.responseExtensions=Array.from(t.result[sh].valueBlock.value,r=>new Te({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(!this.tbsView.byteLength)return ze.schema();const r=je(this.tbsView);O.assert(r,"TBS Response Data"),t=r.result}else{const r=[];nn in this&&r.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[new B({value:this.version})]})),this.responderID instanceof me?r.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):r.push(new I({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),r.push(new Ee({valueDate:this.producedAt})),r.push(new A({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&r.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[new A({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new A({value:r})}return t}toJSON(){const e={};return nn in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}ze.CLASS_NAME="ResponseData";const Lm="trustedCerts",jm="certs",Um="crls",$m="ocsps",Km="checkDate",Hm="findOrigin",Mm="findIssuer";var gn;(function(s){s[s.unknown=-1]="unknown",s[s.success=0]="success",s[s.noRevocation=11]="noRevocation",s[s.noPath=60]="noPath",s[s.noValidPath=97]="noValidPath"})(gn||(gn={}));class Gr extends Error{constructor(e,t){super(t),this.name=Gr.NAME,this.code=e,this.message=t}}Gr.NAME="ChainValidationError";function VS(s,e){for(let t=0;t<e.length;t++)if(pe.isEqual(s.tbsView,e[t].tbsView))return!0;return!1}class tm{constructor(e={}){this.trustedCerts=f(e,Lm,this.defaultValues(Lm)),this.certs=f(e,jm,this.defaultValues(jm)),this.crls=f(e,Um,this.defaultValues(Um)),this.ocsps=f(e,$m,this.defaultValues($m)),this.checkDate=f(e,Km,this.defaultValues(Km)),this.findOrigin=f(e,Hm,this.defaultValues(Hm)),this.findIssuer=f(e,Mm,this.defaultValues(Mm))}static defaultFindOrigin(e,t){e.tbsView.byteLength===0&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));for(const r of t.certs)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),pe.isEqual(e.tbsView,r.tbsView))return"Intermediate Certificates";for(const r of t.trustedCerts)if(r.tbsView.byteLength===0&&(r.tbsView=new Uint8Array(r.encodeTBS().toBER())),pe.isEqual(e.tbsView,r.tbsView))return"Trusted Certificates";return"Unknown"}async defaultFindIssuer(e,t,r=Q(!0)){const a=[];let n=null,u=null,i=null;if(e.subject.isEqual(e.issuer))try{if(await e.verify(void 0,r))return[e]}catch(o){}if(e.extensions){for(const o of e.extensions)if(o.extnID===cd&&o.parsedValue instanceof Qr){o.parsedValue.keyIdentifier?n=o.parsedValue.keyIdentifier:(o.parsedValue.authorityCertIssuer&&(u=o.parsedValue.authorityCertIssuer),o.parsedValue.authorityCertSerialNumber&&(i=o.parsedValue.authorityCertSerialNumber));break}}function l(o){if(n!==null&&o.extensions){let m=!1;for(const h of o.extensions)if(h.extnID===D0&&h.parsedValue){m=!0,pe.isEqual(h.parsedValue.valueBlock.valueHex,n.valueBlock.valueHexView)&&a.push(o);break}if(m)return}let c=!1;i!==null&&(c=o.serialNumber.isEqual(i)),u!==null?o.subject.isEqual(u)&&c&&a.push(o):e.issuer.isEqual(o.subject)&&a.push(o)}for(const o of t.trustedCerts)l(o);for(const o of t.certs)l(o);for(let o=a.length-1;o>=0;o--)try{await e.verify(a[o],r)===!1&&a.splice(o,1)}catch(c){a.splice(o,1)}return a}defaultValues(e){switch(e){case Lm:return[];case jm:return[];case Um:return[];case $m:return[];case Km:return new Date;case Hm:return tm.defaultFindOrigin;case Mm:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(e))}}async sort(e=!1,t=Q(!0)){const r=[],a=async(d,w)=>{const y=[];function k(b){let N=!0;for(let S=0;S<b.length;S++){for(let C=0;C<b.length;C++)if(C!==S&&b[S]===b[C]){N=!1;break}if(!N)break}return N}if(VS(d,this.trustedCerts))return[[d]];const g=await this.findIssuer(d,this,w);if(g.length===0)throw new Error("No valid certificate paths found");for(let b=0;b<g.length;b++){if(pe.isEqual(g[b].tbsView,d.tbsView)){y.push([g[b]]);continue}const N=await a(g[b],w);for(let S=0;S<N.length;S++){const C=N[S].slice();C.splice(0,0,g[b]),k(C)?y.push(C):y.push(N[S])}}return y},n=async d=>{const w=[],y=[],k=[];if(w.push(...r.filter(g=>d.issuer.isEqual(g.subject))),w.length===0)return{status:1,statusMessage:"No certificate's issuers"};if(y.push(...this.crls.filter(g=>g.issuer.isEqual(d.issuer))),y.length===0)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let g=0;g<y.length;g++){const b=y[g];if(!(b.nextUpdate&&b.nextUpdate.value<this.checkDate))for(let N=0;N<w.length;N++)try{if(await y[g].verify({issuerCertificate:w[N]},t)){k.push({crl:y[g],certificate:w[N]});break}}catch(S){}}return k.length?{status:0,statusMessage:v,result:k}:{status:3,statusMessage:"No valid CRLs found"}},u=async(d,w)=>{const y=t.getAlgorithmByOID(d.signatureAlgorithm.algorithmId);if(!y.name||!y.hash)return 1;for(let k=0;k<this.ocsps.length;k++){const g=await this.ocsps[k].getCertificateStatus(d,w,t);if(g.isForCertificate)return g.status===0?0:1}return 2};async function i(d,w=!1){let y=!1,k=!1,g=!1,b=!1;if(d.extensions){for(let N=0;N<d.extensions.length;N++){const S=d.extensions[N];if(S.critical&&!S.parsedValue)return{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(S.extnID)};if(S.extnID===T0){g=!0;const C=new Uint8Array(S.parsedValue.valueBlock.valueHex);(C[0]&4)===4&&(k=!0),(C[0]&2)===2&&(b=!0)}S.extnID===ud&&"cA"in S.parsedValue&&S.parsedValue.cA===!0&&(y=!0)}if(k===!0&&y===!1)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(g===!0&&y===!0&&k===!1)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(y===!0&&g===!0&&w&&b===!1)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return y===!1?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:v}}const l=async(d,w)=>{for(let y=0;y<d.length;y++)if(d[y].notBefore.value>w||d[y].notAfter.value<w)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(d.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let y=d.length-2;y>=0;y--)if(d[y].issuer.isEqual(d[y].subject)===!1&&d[y].issuer.isEqual(d[y+1].subject)===!1)return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(this.crls.length!==0||this.ocsps.length!==0)for(let y=0;y<d.length-1;y++){let k=2,g={status:0,statusMessage:v};if(this.ocsps.length!==0)switch(k=await u(d[y],d[y+1]),k){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(this.crls.length!==0){if(g=await n(d[y]),g.status===0&&g.result)for(let b=0;b<g.result.length;b++){if(g.result[b].crl.isCertificateRevoked(d[y]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if((await i(g.result[b].certificate,!0)).result===!1)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(e===!1)throw new Gr(gn.noRevocation,"No revocation values found for one of certificates: ".concat(g.statusMessage))}else if(k===2)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(k===2&&g.status===2&&e){const b=d[y+1];let N=!1;if(b.extensions)for(const S of b.extensions)switch(S.extnID){case Og:case ld:case hd:N=!0;break}if(N)throw new Gr(gn.noRevocation,"No revocation values found for one of certificates: ".concat(g.statusMessage))}}for(const[y,k]of d.entries())if(y&&!(await i(k)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}};r.push(...this.trustedCerts),r.push(...this.certs);for(let d=0;d<r.length;d++)for(let w=0;w<r.length;w++)if(d!==w&&pe.isEqual(r[d].tbsView,r[w].tbsView)){r.splice(w,1),d=0;break}const o=r[r.length-1];let c;const m=[o];if(c=await a(o,t),c.length===0)throw new Gr(gn.noPath,"Unable to find certificate path");for(let d=c.length-1;d>=0;d--){let w=!1;for(let y=0;y<c[d].length;y++){const k=c[d][y];for(let g=0;g<this.trustedCerts.length;g++)if(pe.isEqual(k.tbsView,this.trustedCerts[g].tbsView)){w=!0;break}if(w)break}w||c.splice(d,1)}if(c.length===0)throw new Gr(gn.noValidPath,"No valid certificate paths found");let h=c[0].length,p=0;for(let d=0;d<c.length;d++)c[d].length<h&&(h=c[d].length,p=d);for(let d=0;d<c[p].length;d++)m.push(c[p][d]);if(c=await l(m,this.checkDate),c.result===!1)throw c;return m}async verify(e={},t=Q(!0)){function r(l,o){const c=Fr(l),m=Fr(o),h=c.split("."),p=m.split("."),d=h.length,w=p.length;if(d===0||w===0||d<w)return!1;for(let y=0;y<d;y++)if(h[y].length===0)return!1;for(let y=0;y<w;y++)if(p[y].length===0){if(y===0){if(w===1)return!1;continue}return!1}for(let y=0;y<w;y++)if(p[w-1-y].length!==0&&h[d-1-y].localeCompare(p[w-1-y])!==0)return!1;return!0}function a(l,o){const c=Fr(l),m=Fr(o),h=c.split("@"),p=m.split("@");if(h.length===0||p.length===0||h.length<p.length)return!1;if(p.length===1){if(r(h[1],p[0])){const d=h[1].split("."),w=p[0].split(".");return w[0].length===0?!0:d.length===w.length}return!1}return c.localeCompare(m)===0}function n(l,o){let c=Fr(l);const m=Fr(o),h=c.split("/");if(m.split("/").length>1)return!1;if(h.length>1){for(let p=0;p<h.length;p++)if(h[p].length>0&&h[p].charAt(h[p].length-1)!==":"){c=h[p].split(":")[0];break}}if(r(c,m)){const p=c.split("."),d=m.split(".");return d[0].length===0?!0:p.length===d.length}return!1}function u(l,o){const c=l.valueBlock.valueHexView,m=o.valueBlock.valueHexView;if(c.length===4&&m.length===8){for(let h=0;h<4;h++)if((c[h]^m[h])&m[h+4])return!1;return!0}if(c.length===16&&m.length===32){for(let h=0;h<16;h++)if((c[h]^m[h])&m[h+16])return!1;return!0}return!1}function i(l,o){if(l.typesAndValues.length===0||o.typesAndValues.length===0)return!0;if(l.typesAndValues.length<o.typesAndValues.length)return!1;let c=!0,m=0;for(let h=0;h<o.typesAndValues.length;h++){let p=!1;for(let d=m;d<l.typesAndValues.length;d++)if(p=l.typesAndValues[d].isEqual(o.typesAndValues[h]),l.typesAndValues[d].type===o.typesAndValues[h].type&&(c=c&&p),p===!0)if(m===0||m===d){m=d+1;break}else return!1;if(p===!1)return!1}return m===0?!1:c}try{if(this.certs.length===0)throw new Error("Empty certificate array");const l=e.passedWhenNotRevValues||!1,o=e.initialPolicySet||[$t],c=e.initialExplicitPolicy||!1,m=e.initialPolicyMappingInhibit||!1,h=e.initialInhibitPolicy||!1,p=e.initialPermittedSubtreesSet||[],d=e.initialExcludedSubtreesSet||[],w=e.initialRequiredNameForms||[];let y=c,k=m,g=h;const b=[!1,!1,!1];let N=0,S=0,C=0,x=p,E=d;const P=w;let K=1;this.certs=await this.sort(l,t);const L=[];L.push($t);const U=[],j=new Array(this.certs.length-1);for(let F=0;F<this.certs.length-1;F++)j[F]=!0;U.push(j);const M=new Array(this.certs.length-1),G=new Array(this.certs.length-1);let we=y?this.certs.length-1:-1;for(let F=this.certs.length-2;F>=0;F--,K++){const W=this.certs[F];if(W.extensions){for(let q=0;q<W.extensions.length;q++){const ee=W.extensions[q];if(ee.extnID===Dg){G[F]=ee.parsedValue;for(let ie=0;ie<L.length;ie++)if(L[ie]===$t){delete U[ie][F];break}for(let ie=0;ie<ee.parsedValue.certificatePolicies.length;ie++){let Ie=-1;const Zt=ee.parsedValue.certificatePolicies[ie].policyIdentifier;for(let Ve=0;Ve<L.length;Ve++)if(Zt===L[Ve]){Ie=Ve;break}if(Ie===-1){L.push(Zt);const Ve=new Array(this.certs.length-1);Ve[F]=!0,U.push(Ve)}else U[Ie][F]=!0}}if(ee.extnID===Tg){if(k)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};M[F]=ee.parsedValue}ee.extnID===Rg&&y===!1&&(ee.parsedValue.requireExplicitPolicy===0?(y=!0,we=F):b[0]===!1?(b[0]=!0,N=ee.parsedValue.requireExplicitPolicy):N=N>ee.parsedValue.requireExplicitPolicy?ee.parsedValue.requireExplicitPolicy:N,ee.parsedValue.inhibitPolicyMapping===0?k=!0:b[1]===!1?(b[1]=!0,S=ee.parsedValue.inhibitPolicyMapping+1):S=S>ee.parsedValue.inhibitPolicyMapping+1?ee.parsedValue.inhibitPolicyMapping+1:S),ee.extnID===M0&&g===!1&&(ee.parsedValue.valueBlock.valueDec===0?g=!0:b[2]===!1?(b[2]=!0,C=ee.parsedValue.valueBlock.valueDec):C=C>ee.parsedValue.valueBlock.valueDec?ee.parsedValue.valueBlock.valueDec:C)}if(g===!0){let q=-1;for(let ee=0;ee<L.length;ee++)if(L[ee]===$t){q=ee;break}q!==-1&&delete U[0][F]}y===!1&&b[0]===!0&&(N--,N===0&&(y=!0,we=F,b[0]=!1)),k===!1&&b[1]===!0&&(S--,S===0&&(k=!0,b[1]=!1)),g===!1&&b[2]===!0&&(C--,C===0&&(g=!0,b[2]=!1))}}for(let F=0;F<this.certs.length-1;F++)if(F<this.certs.length-2&&typeof M[F+1]<"u")for(let W=0;W<M[F+1].mappings.length;W++){if(M[F+1].mappings[W].issuerDomainPolicy===$t||M[F+1].mappings[W].subjectDomainPolicy===$t)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let q=-1,ee=-1;for(let ie=0;ie<L.length;ie++)L[ie]===M[F+1].mappings[W].issuerDomainPolicy&&(q=ie),L[ie]===M[F+1].mappings[W].subjectDomainPolicy&&(ee=ie);typeof U[q][F]<"u"&&delete U[q][F];for(let ie=0;ie<G[F].certificatePolicies.length;ie++)if(M[F+1].mappings[W].subjectDomainPolicy===G[F].certificatePolicies[ie].policyIdentifier&&q!==-1&&ee!==-1)for(let Ie=0;Ie<=F;Ie++)typeof U[ee][Ie]<"u"&&(U[q][Ie]=!0,delete U[ee][Ie])}for(let F=0;F<L.length;F++)if(L[F]===$t)for(let W=0;W<we;W++)delete U[F][W];const ae=[];for(let F=0;F<U.length;F++){let W=!0;for(let q=0;q<this.certs.length-1;q++){let ee=!1;if(q<we&&L[F]===$t&&L.length>1){W=!1;break}if(typeof U[F][q]>"u"){if(q>=we){for(let ie=0;ie<L.length;ie++)if(L[ie]===$t){U[ie][q]===!0&&(ee=!0);break}}if(!ee){W=!1;break}}}W===!0&&ae.push(L[F])}let Y=[];if(o.length===1&&o[0]===$t&&y===!1)Y=o;else if(ae.length===1&&ae[0]===$t)Y=o;else for(let F=0;F<ae.length;F++)for(let W=0;W<o.length;W++)if(o[W]===ae[F]||o[W]===$t){Y.push(ae[F]);break}const se={result:Y.length>0,resultCode:0,resultMessage:Y.length>0?v:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:ae,userConstrPolicies:Y,explicitPolicyIndicator:y,policyMappings:M,certificatePath:this.certs};if(Y.length===0||se.result===!1)return se;K=1;for(let F=this.certs.length-2;F>=0;F--,K++){const W=this.certs[F];let q=[],ee=[],ie=[];if(W.extensions)for(let le=0;le<W.extensions.length;le++){const z=W.extensions[le];z.extnID===Pg&&("permittedSubtrees"in z.parsedValue&&(ee=ee.concat(z.parsedValue.permittedSubtrees)),"excludedSubtrees"in z.parsedValue&&(ie=ie.concat(z.parsedValue.excludedSubtrees))),z.extnID===xg&&(q=q.concat(z.parsedValue.altNames))}let Ie=P.length<=0;for(let le=0;le<P.length;le++)switch(P[le].base.type){case 4:{if(P[le].base.value.typesAndValues.length!==W.subject.typesAndValues.length)continue;Ie=!0;for(let z=0;z<W.subject.typesAndValues.length;z++)if(W.subject.typesAndValues[z].type!==P[le].base.value.typesAndValues[z].type){Ie=!1;break}if(Ie===!0)break}break;default:}if(Ie===!1)throw se.result=!1,se.resultCode=21,se.resultMessage="No necessary name form found",se;const Zt=[[],[],[],[],[]];for(let le=0;le<x.length;le++)switch(x[le].base.type){case 1:Zt[0].push(x[le]);break;case 2:Zt[1].push(x[le]);break;case 4:Zt[2].push(x[le]);break;case 6:Zt[3].push(x[le]);break;case 7:Zt[4].push(x[le]);break;default:}for(let le=0;le<5;le++){let z=!1,ca=!1;const zs=Zt[le];for(let _s=0;_s<zs.length;_s++){switch(le){case 0:if(q.length>0)for(let ye=0;ye<q.length;ye++)q[ye].type===1&&(ca=!0,z=z||a(q[ye].value,zs[_s].base.value));else for(let ye=0;ye<W.subject.typesAndValues.length;ye++)(W.subject.typesAndValues[ye].type==="1.2.840.113549.1.9.1"||W.subject.typesAndValues[ye].type==="0.9.2342.19200300.100.1.3")&&(ca=!0,z=z||a(W.subject.typesAndValues[ye].value.valueBlock.value,zs[_s].base.value));break;case 1:if(q.length>0)for(let ye=0;ye<q.length;ye++)q[ye].type===2&&(ca=!0,z=z||r(q[ye].value,zs[_s].base.value));break;case 2:ca=!0,z=i(W.subject,zs[_s].base.value);break;case 3:if(q.length>0)for(let ye=0;ye<q.length;ye++)q[ye].type===6&&(ca=!0,z=z||n(q[ye].value,zs[_s].base.value));break;case 4:if(q.length>0)for(let ye=0;ye<q.length;ye++)q[ye].type===7&&(ca=!0,z=z||u(q[ye].value,zs[_s].base.value));break;default:}if(z)break}if(z===!1&&zs.length>0&&ca)throw se.result=!1,se.resultCode=41,se.resultMessage='Failed to meet "permitted sub-trees" name constraint',se}let Ve=!1;for(let le=0;le<E.length;le++){switch(E[le].base.type){case 1:if(q.length>=0)for(let z=0;z<q.length;z++)q[z].type===1&&(Ve=Ve||a(q[z].value,E[le].base.value));else for(let z=0;z<W.subject.typesAndValues.length;z++)(W.subject.typesAndValues[z].type==="1.2.840.113549.1.9.1"||W.subject.typesAndValues[z].type==="0.9.2342.19200300.100.1.3")&&(Ve=Ve||a(W.subject.typesAndValues[z].value.valueBlock.value,E[le].base.value));break;case 2:if(q.length>0)for(let z=0;z<q.length;z++)q[z].type===2&&(Ve=Ve||r(q[z].value,E[le].base.value));break;case 4:Ve=Ve||i(W.subject,E[le].base.value);break;case 6:if(q.length>0)for(let z=0;z<q.length;z++)q[z].type===6&&(Ve=Ve||n(q[z].value,E[le].base.value));break;case 7:if(q.length>0)for(let z=0;z<q.length;z++)q[z].type===7&&(Ve=Ve||u(q[z].value,E[le].base.value));break;default:}if(Ve)break}if(Ve===!0)throw se.result=!1,se.resultCode=42,se.resultMessage='Failed to meet "excluded sub-trees" name constraint',se;x=x.concat(ee),E=E.concat(ie)}return se}catch(l){return l instanceof Error?l instanceof Gr?{result:!1,resultCode:l.code,resultMessage:l.message,error:l}:{result:!1,resultCode:gn.unknown,resultMessage:l.message,error:l}:l&&typeof l=="object"&&"resultMessage"in l?l:{result:!1,resultCode:-1,resultMessage:"".concat(l)}}}}const rh="tbsResponseData",Pl="signatureAlgorithm",Ol="signature",Fi="certs",fc="BasicOCSPResponse",bf="".concat(fc,".").concat(rh),Sf="".concat(fc,".").concat(Pl),Af="".concat(fc,".").concat(Ol),ah="".concat(fc,".").concat(Fi),BS=[bf,Sf,Af,ah];class Gt extends D{constructor(e={}){super(),this.tbsResponseData=f(e,rh,Gt.defaultValues(rh)),this.signatureAlgorithm=f(e,Pl,Gt.defaultValues(Pl)),this.signature=f(e,Ol,Gt.defaultValues(Ol)),Fi in e&&(this.certs=f(e,Fi,Gt.defaultValues(Fi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case rh:return new ze;case Pl:return new V;case Ol:return new re;case Fi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let r=ze.compareWithDefault("tbs",t.tbs)&&ze.compareWithDefault("responderID",t.responderID)&&ze.compareWithDefault("producedAt",t.producedAt)&&ze.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&ze.compareWithDefault("responseExtensions",t.responseExtensions)),r}case Pl:return t.algorithmId===v&&!("algorithmParams"in t);case Ol:return t.isEqual(Gt.defaultValues(e));case Fi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||fc,value:[ze.schema(t.tbsResponseData||{names:{blockName:bf}}),V.schema(t.signatureAlgorithm||{names:{blockName:Sf}}),new re({name:t.signature||Af}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new A({value:[new Z({name:ah,value:oe.schema(t.certs||{})})]})]})]})}fromSchema(e){T(e,BS);const t=R(e,e,Gt.schema());O.assertSchema(t,this.className),this.tbsResponseData=new ze({schema:t.result[bf]}),this.signatureAlgorithm=new V({schema:t.result[Sf]}),this.signature=t.result[Af],ah in t.result&&(this.certs=Array.from(t.result[ah],r=>new oe({schema:r})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[new A({value:Array.from(this.certs,t=>t.toSchema())})]})),new A({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}async getCertificateStatus(e,t,r=Q(!0)){const a={isForCertificate:!1,status:2},n={},u=[];for(const i of this.tbsResponseData.responses){const l=r.getAlgorithmByOID(i.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!n[l.name]){n[l.name]=1;const o=new Re;u.push(o),await o.createForCertificate(e,{hashAlgorithm:l.name,issuerCertificate:t},r)}}for(const i of this.tbsResponseData.responses)for(const l of u)if(i.certID.isEqual(l)){a.isForCertificate=!0;try{switch(i.certStatus.idBlock.isConstructed){case!0:i.certStatus.idBlock.tagNumber===1&&(a.status=1);break;case!1:switch(i.certStatus.idBlock.tagNumber){case 0:a.status=0;break;case 2:a.status=2;break;default:}break;default:}}catch(o){}return a}return a}async sign(e,t="SHA-1",r=Q(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters.algorithm;if(!("name"in n))throw new Error("Empty algorithm");this.signatureAlgorithm=a.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER());const u=await r.signWithPrivateKey(this.tbsResponseData.tbsView,e,{algorithm:n});this.signature=new re({valueHex:u})}async verify(e={},t=Q(!0)){let r=null,a=-1;const n=e.trustedCerts||[];if(!this.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case this.tbsResponseData.responderID instanceof me:for(const[i,l]of this.certs.entries())if(l.subject.isEqual(this.tbsResponseData.responderID)){a=i;break}break;case this.tbsResponseData.responderID instanceof $:for(const[i,l]of this.certs.entries()){const o=await t.digest({name:"sha-1"},l.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ql(o,this.tbsResponseData.responderID.valueBlock.valueHex)){a=i;break}}break;default:throw new Error("Wrong value for responderID")}if(a===-1)throw new Error("Correct certificate was not found in OCSP response");r=this.certs[a];const u=[r];for(const i of this.certs){const l=await Jg(i,r);l&&u.push(l)}if(!(await new tm({certs:u,trustedCerts:n}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[a].subjectPublicKeyInfo,this.signatureAlgorithm)}}Gt.CLASS_NAME="BasicOCSPResponse";const Fm="tbs",Jm="version",qm="subject",Wm="subjectPublicKeyInfo",Fn="attributes",Dl="signatureAlgorithm",Tl="signatureValue",Bo="CertificationRequestInfo",bd="".concat(Bo,".version"),Sd="".concat(Bo,".subject"),Ad="".concat(Bo,".subjectPublicKeyInfo"),qh="".concat(Bo,".attributes"),PS=[Bo,bd,Sd,Ad,qh,Dl,Tl];function OS(s={}){const e=f(s,"names",{});return new A({name:e.CertificationRequestInfo||Bo,value:[new B({name:e.CertificationRequestInfoVersion||bd}),me.schema(e.subject||{names:{blockName:Sd}}),kt.schema({names:{blockName:Ad}}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({optional:!0,name:e.CertificationRequestInfoAttributes||qh,value:ge.schema(e.attributes||{})})]})]})}class ts extends D{get tbs(){return pe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Fm,ts.defaultValues(Fm))),this.version=f(e,Jm,ts.defaultValues(Jm)),this.subject=f(e,qm,ts.defaultValues(qm)),this.subjectPublicKeyInfo=f(e,Wm,ts.defaultValues(Wm)),Fn in e&&(this.attributes=f(e,Fn,ts.defaultValues(Fn))),this.signatureAlgorithm=f(e,Dl,ts.defaultValues(Dl)),this.signatureValue=f(e,Tl,ts.defaultValues(Tl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Fm:return Ue;case Jm:return 0;case qm:return new me;case Wm:return new kt;case Fn:return[];case Dl:return new V;case Tl:return new re;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({value:[OS(t.certificationRequestInfo||{}),new A({name:t.signatureAlgorithm||Dl,value:[new J,new X({optional:!0})]}),new re({name:t.signatureValue||Tl})]})}fromSchema(e){T(e,PS);const t=R(e,e,ts.schema());O.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[bd].valueBlock.valueDec,this.subject=new me({schema:t.result[Sd]}),this.subjectPublicKeyInfo=new kt({schema:t.result[Ad]}),qh in t.result&&(this.attributes=Array.from(t.result[qh],r=>new ge({schema:r}))),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new B({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return Fn in this&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new A({value:e})}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return ts.schema();const r=je(this.tbsView);O.assert(r,"PKCS#10 Certificate Request"),t=r.result}else t=this.encodeTBS();return new A({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ce.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Fn in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}async sign(e,t="SHA-1",r=Q(!0)){if(!e)throw new Error("Need to provide a private key for signing");const a=await r.getSignatureParameters(e,t),n=a.parameters;this.signatureAlgorithm=a.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER());const u=await r.signWithPrivateKey(this.tbsView,e,n);this.signatureValue=new re({valueHex:u})}async verify(e=Q(!0)){return e.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm)}async getPublicKey(e,t=Q(!0)){return t.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,e)}}ts.CLASS_NAME="CertificationRequest";const on="digestAlgorithm",un="digest",DS=[on,un];class _t extends D{constructor(e={}){super(),this.digestAlgorithm=f(e,on,_t.defaultValues(on)),this.digest=f(e,un,_t.defaultValues(un)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case on:return new V;case un:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case on:return V.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case un:return t.isEqual(_t.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.digestAlgorithm||{names:{blockName:on}}),new $({name:t.digest||un})]})}fromSchema(e){T(e,DS);const t=R(e,e,_t.schema({names:{digestAlgorithm:{names:{blockName:on}},digest:un}}));O.assertSchema(t,this.className),this.digestAlgorithm=new V({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new A({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}_t.CLASS_NAME="DigestInfo";const Ji="eContentType",es="eContent",TS=[Ji,es];class Vt extends D{constructor(e={}){if(super(),this.eContentType=f(e,Ji,Vt.defaultValues(Ji)),es in e&&(this.eContent=f(e,es,Vt.defaultValues(es)),this.eContent.idBlock.tagClass===1&&this.eContent.idBlock.tagNumber===4&&this.eContent.idBlock.isConstructed===!1)){const t=new $({idBlock:{isConstructed:!0},isConstructed:!0});let r=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let n=a.byteLength;for(;n>0;){const u=new Uint8Array(a,r,r+65536>a.byteLength?a.byteLength-r:65536),i=new ArrayBuffer(u.length),l=new Uint8Array(i);for(let o=0;o<l.length;o++)l[o]=u[o];t.valueBlock.value.push(new $({valueHex:i})),n-=u.length,r+=u.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ji:return v;case es:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ji:return t===v;case es:return t.idBlock.tagClass===1&&t.idBlock.tagNumber===4?t.isEqual(Vt.defaultValues(es)):!1;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.eContentType||v}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new X({name:t.eContent||v})]})]})}fromSchema(e){T(e,TS);const t=R(e,e,Vt.schema({names:{eContentType:Ji,eContent:es}}));O.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),es in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new J({value:this.eContentType})),this.eContent&&Vt.compareWithDefault(es,this.eContent)===!1&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new A({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&Vt.compareWithDefault(es,this.eContent)===!1&&(e.eContent=this.eContent.toJSON()),e}}Vt.CLASS_NAME="EncapsulatedContentInfo";const ln="mac",cn="macSalt",Vs="iterations",RS=[ln,cn,Vs];class yt extends D{constructor(e={}){super(),this.mac=f(e,ln,yt.defaultValues(ln)),this.macSalt=f(e,cn,yt.defaultValues(cn)),Vs in e&&(this.iterations=f(e,Vs,yt.defaultValues(Vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return new _t;case cn:return new $;case Vs:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return _t.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&_t.compareWithDefault("digest",t.digest);case cn:return t.isEqual(yt.defaultValues(e));case Vs:return t===yt.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,optional:t.optional||!0,value:[_t.schema(t.mac||{names:{blockName:ln}}),new $({name:t.macSalt||cn}),new B({optional:!0,name:t.iterations||Vs})]})}fromSchema(e){T(e,RS);const t=R(e,e,yt.schema({names:{mac:{names:{blockName:ln}},macSalt:cn,iterations:Vs}}));O.assertSchema(t,this.className),this.mac=new _t({schema:t.result.mac}),this.macSalt=t.result.macSalt,Vs in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return this.iterations!==void 0&&e.push(new B({value:this.iterations})),new A({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return this.iterations!==void 0&&(e.iterations=this.iterations),e}}yt.CLASS_NAME="MacData";const wn="hashAlgorithm",yn="hashedMessage",LS=[wn,yn];class nt extends D{static async create(e,t,r=Q(!0)){const a=r.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),n=await r.digest(e,t);return new nt({hashAlgorithm:new V({algorithmId:a,algorithmParams:new Fe}),hashedMessage:new $({valueHex:n})})}constructor(e={}){super(),this.hashAlgorithm=f(e,wn,nt.defaultValues(wn)),this.hashedMessage=f(e,yn,nt.defaultValues(yn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case wn:return new V;case yn:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case wn:return t.algorithmId===v&&!("algorithmParams"in t);case yn:return t.isEqual(nt.defaultValues(e))===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.hashAlgorithm||{}),new $({name:t.hashedMessage||v})]})}fromSchema(e){T(e,LS);const t=R(e,e,nt.schema({names:{hashAlgorithm:{names:{blockName:wn}},hashedMessage:yn}}));O.assertSchema(t,this.className),this.hashAlgorithm=new V({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new A({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}nt.CLASS_NAME="MessageImprint";const qi="reqCert",jr="singleRequestExtensions",jS=[qi,jr];let Wh=class Rl extends D{constructor(e={}){super(),this.reqCert=f(e,qi,Rl.defaultValues(qi)),jr in e&&(this.singleRequestExtensions=f(e,jr,Rl.defaultValues(jr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qi:return new Re;case jr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case qi:return t.isEqual(Rl.defaultValues(e));case jr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[Re.schema(t.reqCert||{}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Te.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||v}})]})]})}fromSchema(e){T(e,jS);const t=R(e,e,Rl.schema({names:{reqCert:{names:{blockName:qi}},extensions:{names:{blockName:jr}}}}));O.assertSchema(t,this.className),this.reqCert=new Re({schema:t.result.reqCert}),jr in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,r=>new Te({schema:r})))}toSchema(){const e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new A({value:Array.from(this.singleRequestExtensions,t=>t.toSchema())})]})),new A({value:e})}toJSON(){const e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,t=>t.toJSON())),e}};Wh.CLASS_NAME="Request";const Hc="tbs",Wi="version",Gi="requestorName",Mc="requestList",zi="requestExtensions",Po="TBSRequest",nh="".concat(Po,".").concat(Wi),ih="".concat(Po,".").concat(Gi),Nf="".concat(Po,".requests"),oh="".concat(Po,".").concat(zi),US=[Po,nh,ih,Nf,oh];class rt extends D{get tbs(){return pe.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}constructor(e={}){super(),this.tbsView=new Uint8Array(f(e,Hc,rt.defaultValues(Hc))),Wi in e&&(this.version=f(e,Wi,rt.defaultValues(Wi))),Gi in e&&(this.requestorName=f(e,Gi,rt.defaultValues(Gi))),this.requestList=f(e,Mc,rt.defaultValues(Mc)),zi in e&&(this.requestExtensions=f(e,zi,rt.defaultValues(zi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hc:return Ue;case Wi:return 0;case Gi:return new ue;case Mc:case zi:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hc:return t.byteLength===0;case Wi:return t===rt.defaultValues(e);case Gi:return t.type===ue.defaultValues("type")&&Object.keys(t.value).length===0;case Mc:case zi:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||Po,value:[new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new B({name:t.TBSRequestVersion||nh})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[ue.schema(t.requestorName||{names:{blockName:ih}})]}),new A({name:t.requestList||"TBSRequest.requestList",value:[new Z({name:t.requests||Nf,value:Wh.schema(t.requestNames||{})})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[$e.schema(t.extensions||{names:{blockName:t.requestExtensions||oh}})]})]})}fromSchema(e){T(e,US);const t=R(e,e,rt.schema());O.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,nh in t.result&&(this.version=t.result[nh].valueBlock.valueDec),ih in t.result&&(this.requestorName=new ue({schema:t.result[ih]})),this.requestList=Array.from(t.result[Nf],r=>new Wh({schema:r})),oh in t.result&&(this.requestExtensions=Array.from(t.result[oh].valueBlock.value,r=>new Te({schema:r})))}toSchema(e=!1){let t;if(e===!1){if(this.tbsView.byteLength===0)return rt.schema();const r=je(this.tbsView);if(O.assert(r,"TBS Request"),!(r.result instanceof A))throw new Error("ASN.1 result should be SEQUENCE");t=r.result}else{const r=[];this.version!==void 0&&r.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[new B({value:this.version})]})),this.requestorName&&r.push(new I({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),r.push(new A({value:Array.from(this.requestList,a=>a.toSchema())})),this.requestExtensions&&r.push(new I({idBlock:{tagClass:3,tagNumber:2},value:[new A({value:Array.from(this.requestExtensions,a=>a.toSchema())})]})),t=new A({value:r})}return t}toJSON(){const e={};return this.version!=null&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,t=>t.toJSON()),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,t=>t.toJSON())),e}}rt.CLASS_NAME="TBSRequest";const Jn="signatureAlgorithm",qn="signature",sr="certs";class Tt extends D{constructor(e={}){super(),this.signatureAlgorithm=f(e,Jn,Tt.defaultValues(Jn)),this.signature=f(e,qn,Tt.defaultValues(qn)),sr in e&&(this.certs=f(e,sr,Tt.defaultValues(sr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Jn:return new V;case qn:return new re;case sr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Jn:return t.algorithmId===v&&!("algorithmParams"in t);case qn:return t.isEqual(Tt.defaultValues(e));case sr:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[V.schema(t.signatureAlgorithm||{}),new re({name:t.signature||v}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new A({value:[new Z({name:t.certs||v,value:oe.schema({})})]})]})]})}fromSchema(e){T(e,[Jn,qn,sr]);const t=R(e,e,Tt.schema({names:{signatureAlgorithm:{names:{blockName:Jn}},signature:qn,certs:sr}}));O.assertSchema(t,this.className),this.signatureAlgorithm=new V({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,sr in t.result&&(this.certs=Array.from(t.result.certs,r=>new oe({schema:r})))}toSchema(){const e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new A({value:Array.from(this.certs,t=>t.toSchema())})]})),new A({value:e})}toJSON(){const e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}}Tt.CLASS_NAME="Signature";const _i="tbsRequest",Ur="optionalSignature",$S=[_i,Ur];class Xl extends D{constructor(e={}){super(),this.tbsRequest=f(e,_i,Xl.defaultValues(_i)),Ur in e&&(this.optionalSignature=f(e,Ur,Xl.defaultValues(Ur))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _i:return new rt;case Ur:return new Tt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _i:return rt.compareWithDefault("tbs",t.tbs)&&rt.compareWithDefault("version",t.version)&&rt.compareWithDefault("requestorName",t.requestorName)&&rt.compareWithDefault("requestList",t.requestList)&&rt.compareWithDefault("requestExtensions",t.requestExtensions);case Ur:return Tt.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Tt.compareWithDefault("signature",t.signature)&&Tt.compareWithDefault("certs",t.certs);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||"OCSPRequest",value:[rt.schema(t.tbsRequest||{names:{blockName:_i}}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Tt.schema(t.optionalSignature||{names:{blockName:Ur}})]})]})}fromSchema(e){T(e,$S);const t=R(e,e,Xl.schema());O.assertSchema(t,this.className),this.tbsRequest=new rt({schema:t.result.tbsRequest}),Ur in t.result&&(this.optionalSignature=new Tt({schema:t.result.optionalSignature}))}toSchema(e=!1){const t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new A({value:t})}toJSON(){const e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}async createForCertificate(e,t,r=Q(!0)){const a=new Re;await a.createForCertificate(e,t,r),this.tbsRequest.requestList.push(new Wh({reqCert:a}))}async sign(e,t="SHA-1",r=Q(!0)){if(ne.assertEmpty(e,"privateKey","OCSPRequest.sign method"),!this.optionalSignature)throw new Error('Need to create "optionalSignature" field before signing');const a=await r.getSignatureParameters(e,t),n=a.parameters;this.optionalSignature.signatureAlgorithm=a.signatureAlgorithm;const u=this.tbsRequest.toSchema(!0).toBER(!1),i=await r.signWithPrivateKey(u,e,n);this.optionalSignature.signature=new re({valueHex:i})}verify(){}}Xl.CLASS_NAME="OCSPRequest";const Xi="responseType",Zi="response",KS=[Xi,Zi];class ns extends D{constructor(e={}){super(),this.responseType=f(e,Xi,ns.defaultValues(Xi)),this.response=f(e,Zi,ns.defaultValues(Zi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Xi:return v;case Zi:return new $;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Xi:return t===v;case Zi:return t.isEqual(ns.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new J({name:t.responseType||v}),new $({name:t.response||v})]})}fromSchema(e){T(e,KS);const t=R(e,e,ns.schema({names:{responseType:Xi,response:Zi}}));O.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}toSchema(){return new A({value:[new J({value:this.responseType}),this.response]})}toJSON(){return{responseType:this.responseType,response:this.response.toJSON()}}}ns.CLASS_NAME="ResponseBytes";const Wn="responseStatus",bs="responseBytes";class wo extends D{constructor(e={}){super(),this.responseStatus=f(e,Wn,wo.defaultValues(Wn)),bs in e&&(this.responseBytes=f(e,bs,wo.defaultValues(bs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wn:return new ec;case bs:return new ns;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wn:return t.isEqual(wo.defaultValues(e));case bs:return ns.compareWithDefault("responseType",t.responseType)&&ns.compareWithDefault("response",t.response);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||"OCSPResponse",value:[new ec({name:t.responseStatus||Wn}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ns.schema(t.responseBytes||{names:{blockName:bs}})]})]})}fromSchema(e){T(e,[Wn,bs]);const t=R(e,e,wo.schema());O.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,bs in t.result&&(this.responseBytes=new ns({schema:t.result.responseBytes}))}toSchema(){const e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new A({value:e})}toJSON(){const e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}async getCertificateStatus(e,t,r=Q(!0)){let a;const n={isForCertificate:!1,status:2};if(!this.responseBytes||this.responseBytes.responseType!==Gc)return n;try{const u=je(this.responseBytes.response.valueBlock.valueHexView);O.assert(u,"Basic OCSP response"),a=new Gt({schema:u.result})}catch(u){return n}return a.getCertificateStatus(e,t,r)}async sign(e,t,r=Q(!0)){var a;if(this.responseBytes&&this.responseBytes.responseType===Gc)return Gt.fromBER(this.responseBytes.response.valueBlock.valueHexView).sign(e,t,r);throw new Error("Unknown ResponseBytes type: ".concat(((a=this.responseBytes)===null||a===void 0?void 0:a.responseType)||"Unknown"))}async verify(e=null,t=Q(!0)){var r;if(!(bs in this))throw new Error("Empty ResponseBytes field");if(this.responseBytes&&this.responseBytes.responseType===Gc){const a=Gt.fromBER(this.responseBytes.response.valueBlock.valueHexView);return e!==null&&(a.certs||(a.certs=[]),a.certs.push(e)),a.verify({},t)}throw new Error("Unknown ResponseBytes type: ".concat(((r=this.responseBytes)===null||r===void 0?void 0:r.responseType)||"Unknown"))}}wo.CLASS_NAME="OCSPResponse";const pa="type",Bs="attributes",Fc="encodedValue",HS=[Bs];class Ae extends D{constructor(e={}){super(),this.type=f(e,pa,Ae.defaultValues(pa)),this.attributes=f(e,Bs,Ae.defaultValues(Bs)),this.encodedValue=f(e,Fc,Ae.defaultValues(Fc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pa:return-1;case Bs:return[];case Fc:return Ue;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pa:return t===Ae.defaultValues(pa);case Bs:return t.length===0;case Fc:return t.byteLength===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new I({name:t.blockName||v,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new Z({name:t.attributes||v,value:ge.schema()})]})}fromSchema(e){T(e,HS);const t=R(e,e,Ae.schema({names:{tagNumber:this.type,attributes:Bs}}));O.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=pe.toArrayBuffer(t.result.valueBeforeDecodeView);const r=new Uint8Array(this.encodedValue);if(r[0]=49,!(Bs in t.result)){if(this.type===0)throw new Error("Wrong structure of SignedUnsignedAttributes");return}this.attributes=Array.from(t.result.attributes,a=>new ge({schema:a}))}toSchema(){if(Ae.compareWithDefault(pa,this.type)||Ae.compareWithDefault(Bs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new I({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(Ae.compareWithDefault(pa,this.type)||Ae.compareWithDefault(Bs,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}Ae.CLASS_NAME="SignedAndUnsignedAttributes";const Qi="version",hn="sid",Yi="digestAlgorithm",$r="signedAttrs",eo="signatureAlgorithm",Ll="signature",Kr="unsignedAttrs",la="SignerInfo",kf="".concat(la,".").concat(Qi),jl="".concat(la,".").concat(hn),Ef="".concat(la,".").concat(Yi),uh="".concat(la,".").concat($r),Cf="".concat(la,".").concat(eo),xf="".concat(la,".").concat(Ll),lh="".concat(la,".").concat(Kr),MS=[kf,jl,Ef,uh,Cf,xf,lh];class Be extends D{constructor(e={}){super(),this.version=f(e,Qi,Be.defaultValues(Qi)),this.sid=f(e,hn,Be.defaultValues(hn)),this.digestAlgorithm=f(e,Yi,Be.defaultValues(Yi)),$r in e&&(this.signedAttrs=f(e,$r,Be.defaultValues($r))),this.signatureAlgorithm=f(e,eo,Be.defaultValues(eo)),this.signature=f(e,Ll,Be.defaultValues(Ll)),Kr in e&&(this.unsignedAttrs=f(e,Kr,Be.defaultValues(Kr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qi:return 0;case hn:return new X;case Yi:return new V;case $r:return new Ae({type:0});case eo:return new V;case Ll:return new $;case Kr:return new Ae({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qi:return Be.defaultValues(Qi)===t;case hn:return t instanceof X;case Yi:return t instanceof V?t.isEqual(Be.defaultValues(Yi)):!1;case $r:return Ae.compareWithDefault("type",t.type)&&Ae.compareWithDefault("attributes",t.attributes)&&Ae.compareWithDefault("encodedValue",t.encodedValue);case eo:return t instanceof V?t.isEqual(Be.defaultValues(eo)):!1;case Ll:case Kr:return Ae.compareWithDefault("type",t.type)&&Ae.compareWithDefault("attributes",t.attributes)&&Ae.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:la,value:[new B({name:t.version||kf}),new ke({value:[Ke.schema(t.sidSchema||{names:{blockName:jl}}),new ke({value:[new I({optional:!0,name:t.sid||jl,idBlock:{tagClass:3,tagNumber:0},value:[new $]}),new _({optional:!0,name:t.sid||jl,idBlock:{tagClass:3,tagNumber:0}})]})]}),V.schema(t.digestAlgorithm||{names:{blockName:Ef}}),Ae.schema(t.signedAttrs||{names:{blockName:uh,tagNumber:0}}),V.schema(t.signatureAlgorithm||{names:{blockName:Cf}}),new $({name:t.signature||xf}),Ae.schema(t.unsignedAttrs||{names:{blockName:lh,tagNumber:1}})]})}fromSchema(e){T(e,MS);const t=R(e,e,Be.schema());O.assertSchema(t,this.className),this.version=t.result[kf].valueBlock.valueDec;const r=t.result[jl];r.idBlock.tagClass===1?this.sid=new Ke({schema:r}):this.sid=r,this.digestAlgorithm=new V({schema:t.result[Ef]}),uh in t.result&&(this.signedAttrs=new Ae({type:0,schema:t.result[uh]})),this.signatureAlgorithm=new V({schema:t.result[Cf]}),this.signature=t.result[xf],lh in t.result&&(this.unsignedAttrs=new Ae({type:1,schema:t.result[lh]}))}toSchema(){if(Be.compareWithDefault(hn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new B({value:this.version})),this.sid instanceof Ke?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&Be.compareWithDefault($r,this.signedAttrs)===!1&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&Be.compareWithDefault(Kr,this.unsignedAttrs)===!1&&e.push(this.unsignedAttrs.toSchema()),new A({value:e})}toJSON(){if(Be.compareWithDefault(hn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof X||(e.sid=this.sid.toJSON()),this.signedAttrs&&Be.compareWithDefault($r,this.signedAttrs)===!1&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&Be.compareWithDefault(Kr,this.unsignedAttrs)===!1&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}Be.CLASS_NAME="SignerInfo";const Ul="version",$l="policy",Kl="messageImprint",Hl="serialNumber",Ml="genTime",mn="ordering",fn="nonce",to="accuracy",so="tsa",ro="extensions",us="TSTInfo",If="".concat(us,".").concat(Ul),Vf="".concat(us,".").concat($l),Bf="".concat(us,".").concat(Kl),Pf="".concat(us,".").concat(Hl),Of="".concat(us,".").concat(Ml),ch="".concat(us,".").concat(to),hh="".concat(us,".").concat(mn),mh="".concat(us,".").concat(fn),fh="".concat(us,".").concat(so),dh="".concat(us,".").concat(ro),FS=[If,Vf,Bf,Pf,Of,ch,hh,mh,fh,dh];class lt extends D{constructor(e={}){super(),this.version=f(e,Ul,lt.defaultValues(Ul)),this.policy=f(e,$l,lt.defaultValues($l)),this.messageImprint=f(e,Kl,lt.defaultValues(Kl)),this.serialNumber=f(e,Hl,lt.defaultValues(Hl)),this.genTime=f(e,Ml,lt.defaultValues(Ml)),to in e&&(this.accuracy=f(e,to,lt.defaultValues(to))),mn in e&&(this.ordering=f(e,mn,lt.defaultValues(mn))),fn in e&&(this.nonce=f(e,fn,lt.defaultValues(fn))),so in e&&(this.tsa=f(e,so,lt.defaultValues(so))),ro in e&&(this.extensions=f(e,ro,lt.defaultValues(ro))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ul:return 0;case $l:return v;case Kl:return new nt;case Hl:return new B;case Ml:return new Date(0,0,0);case to:return new Dt;case mn:return!1;case fn:return new B;case so:return new ue;case ro:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ul:case $l:case Ml:case mn:return t===lt.defaultValues(mn);case Kl:return nt.compareWithDefault(wn,t.hashAlgorithm)&&nt.compareWithDefault(yn,t.hashedMessage);case Hl:case fn:return t.isEqual(lt.defaultValues(fn));case to:return Dt.compareWithDefault(nr,t.seconds)&&Dt.compareWithDefault(ir,t.millis)&&Dt.compareWithDefault(or,t.micros);case so:return ue.compareWithDefault(Qo,t.type)&&ue.compareWithDefault(Yo,t.value);case ro:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||us,value:[new B({name:t.version||If}),new J({name:t.policy||Vf}),nt.schema(t.messageImprint||{names:{blockName:Bf}}),new B({name:t.serialNumber||Pf}),new Ee({name:t.genTime||Of}),Dt.schema(t.accuracy||{names:{blockName:ch}}),new ua({name:t.ordering||hh,optional:!0}),new B({name:t.nonce||mh,optional:!0}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[ue.schema(t.tsa||{names:{blockName:fh}})]}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Z({name:t.extensions||dh,value:Te.schema(t.extension||{})})]})]})}fromSchema(e){T(e,FS);const t=R(e,e,lt.schema());O.assertSchema(t,this.className),this.version=t.result[If].valueBlock.valueDec,this.policy=t.result[Vf].valueBlock.toString(),this.messageImprint=new nt({schema:t.result[Bf]}),this.serialNumber=t.result[Pf],this.genTime=t.result[Of].toDate(),ch in t.result&&(this.accuracy=new Dt({schema:t.result[ch]})),hh in t.result&&(this.ordering=t.result[hh].valueBlock.value),mh in t.result&&(this.nonce=t.result[mh]),fh in t.result&&(this.tsa=new ue({schema:t.result[fh]})),dh in t.result&&(this.extensions=Array.from(t.result[dh],r=>new Te({schema:r})))}toSchema(){const e=[];return e.push(new B({value:this.version})),e.push(new J({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Ee({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),this.ordering!==void 0&&e.push(new ua({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),this.ordering!==void 0&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}async verify(e,t=Q(!0)){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const r=e.data;if(e.notBefore&&this.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&this.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const a=t.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),n=await t.digest(a.name,new Uint8Array(r));return pe.isEqual(n,this.messageImprint.hashedMessage.valueBlock.valueHexView)}}lt.CLASS_NAME="TSTInfo";const ao="version",Fl="digestAlgorithms",Jl="encapContentInfo",no="certificates",io="crls",ql="signerInfos",_o="ocsps",Un="SignedData",Df="".concat(Un,".").concat(ao),ph="".concat(Un,".").concat(Fl),Tf="".concat(Un,".").concat(Jl),gh="".concat(Un,".").concat(no),wh="".concat(Un,".").concat(io),yh="".concat(Un,".").concat(ql),JS=[Df,ph,Tf,gh,wh,yh];class ut extends Error{constructor({message:e,code:t=0,date:r=new Date,signatureVerified:a=null,signerCertificate:n=null,signerCertificateVerified:u=null,timestampSerial:i=null,certificatePath:l=[]}){super(e),this.name="SignedDataVerifyError",this.date=r,this.code=t,this.timestampSerial=i,this.signatureVerified=a,this.signerCertificate=n,this.signerCertificateVerified=u,this.certificatePath=l}}class st extends D{constructor(e={}){super(),this.version=f(e,ao,st.defaultValues(ao)),this.digestAlgorithms=f(e,Fl,st.defaultValues(Fl)),this.encapContentInfo=f(e,Jl,st.defaultValues(Jl)),no in e&&(this.certificates=f(e,no,st.defaultValues(no))),io in e&&(this.crls=f(e,io,st.defaultValues(io))),_o in e&&(this.ocsps=f(e,_o,st.defaultValues(_o))),this.signerInfos=f(e,ql,st.defaultValues(ql)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ao:return 0;case Fl:return[];case Jl:return new Vt;case no:return[];case io:return[];case _o:return[];case ql:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ao:return t===st.defaultValues(ao);case Jl:return Vt.compareWithDefault("eContentType",t.eContentType)&&Vt.compareWithDefault("eContent",t.eContent);case Fl:case no:case io:case _o:case ql:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return t.optional===void 0&&(t.optional=!1),new A({name:t.blockName||Un,optional:t.optional,value:[new B({name:t.version||Df}),new Je({value:[new Z({name:t.digestAlgorithms||ph,value:V.schema()})]}),Vt.schema(t.encapContentInfo||{names:{blockName:Tf}}),new I({name:t.certificates||gh,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:ys.schema().valueBlock.value}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Js.schema(t.crls||{names:{crls:wh}}).valueBlock.value}),new Je({value:[new Z({name:t.signerInfos||yh,value:Be.schema()})]})]})}fromSchema(e){T(e,JS);const t=R(e,e,st.schema());if(O.assertSchema(t,this.className),this.version=t.result[Df].valueBlock.valueDec,ph in t.result&&(this.digestAlgorithms=Array.from(t.result[ph],r=>new V({schema:r}))),this.encapContentInfo=new Vt({schema:t.result[Tf]}),gh in t.result){const r=new ys({schema:new Je({value:t.result[gh].valueBlock.value})});this.certificates=r.certificates.slice(0)}wh in t.result&&(this.crls=Array.from(t.result[wh],r=>r.idBlock.tagClass===1?new Me({schema:r}):(r.idBlock.tagClass=1,r.idBlock.tagNumber=16,new Fs({schema:r})))),yh in t.result&&(this.signerInfos=Array.from(t.result[yh],r=>new Be({schema:r})))}toSchema(e=!1){const t=[];if(this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof na)||this.crls&&this.crls.length&&this.crls.some(r=>r instanceof Fs)?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof Lt)?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some(r=>r instanceof Us)||this.signerInfos.some(r=>r.version===3)||this.encapContentInfo.eContentType!==st.ID_DATA?this.version=3:this.version=1,t.push(new B({value:this.version})),t.push(new Je({value:Array.from(this.digestAlgorithms,r=>r.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const r=new ys({certificates:this.certificates}).toSchema();t.push(new I({idBlock:{tagClass:3,tagNumber:0},value:r.valueBlock.value}))}return this.crls&&t.push(new I({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,r=>{if(r instanceof Fs){const a=r.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return r.toSchema(e)})})),t.push(new Je({value:Array.from(this.signerInfos,r=>r.toSchema())})),new A({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}async verify({signer:e=-1,data:t=Ue,trustedCerts:r=[],checkDate:a=new Date,checkChain:n=!1,passedWhenNotRevValues:u=!1,extendedMode:i=!1,findOrigin:l=null,findIssuer:o=null}={},c=Q(!0)){let m=null,h=null;try{let p=Ue,d=v,w=[];const y=this.signerInfos[e];if(!y)throw new ut({date:a,code:1,message:"Unable to get signer by supplied index"});if(!this.certificates)throw new ut({date:a,code:2,message:"No certificates attached to this signed data"});if(y.sid instanceof Ke){for(const N of this.certificates)if(N instanceof oe&&N.issuer.isEqual(y.sid.issuer)&&N.serialNumber.isEqual(y.sid.serialNumber)){m=N;break}}else{const N=y.sid,S=N.idBlock.isConstructed?N.valueBlock.value[0].valueBlock.valueHex:N.valueBlock.valueHex;for(const C of this.certificates){if(!(C instanceof oe))continue;const x=await c.digest({name:"sha-1"},C.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);if(Ql(x,S)){m=C;break}}}if(!m)throw new ut({date:a,code:3,message:"Unable to find signer certificate"});if(this.encapContentInfo.eContentType===z0){if(!this.encapContentInfo.eContent)throw new ut({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});let N;try{N=lt.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView)}catch(S){throw new ut({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(a=N.genTime,h=N.serialNumber.valueBlock.valueHexView.slice(),t.byteLength===0)throw new ut({date:a,code:4,message:"Missed detached data input array"});if(!await N.verify({data:t},c))throw new ut({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}if(n){const N=this.certificates.filter(E=>E instanceof oe&&!!Jg(E,m)),S={checkDate:a,certs:N,trustedCerts:r};o&&(S.findIssuer=o),l&&(S.findOrigin=l);const C=new tm(S);if(C.certs.push(m),this.crls)for(const E of this.crls)"thisUpdate"in E?C.crls.push(E):E.otherRevInfoFormat===Gc&&C.ocsps.push(new Gt({schema:E.otherRevInfo}));this.ocsps&&C.ocsps.push(...this.ocsps);const x=await C.verify({passedWhenNotRevValues:u},c).catch(E=>{throw new ut({date:a,code:5,message:"Validation of signer's certificate failed with error: ".concat(E instanceof Object?E.resultMessage:E),signerCertificate:m,signerCertificateVerified:!1})});if(x.certificatePath&&(w=x.certificatePath),!x.result)throw new ut({date:a,code:5,message:"Validation of signer's certificate failed: ".concat(x.resultMessage),signerCertificate:m,signerCertificateVerified:!1})}const k=c.getAlgorithmByOID(y.digestAlgorithm.algorithmId);if(!("name"in k))throw new ut({date:a,code:7,message:"Unsupported signature algorithm: ".concat(y.digestAlgorithm.algorithmId),signerCertificate:m,signerCertificateVerified:!0});d=k.name;const g=this.encapContentInfo.eContent;if(g)g.idBlock.tagClass===1&&g.idBlock.tagNumber===4?t=g.getValue():t=g.valueBlock.valueBeforeDecodeView;else if(t.byteLength===0)throw new ut({date:a,code:8,message:"Missed detached data input array",signerCertificate:m,signerCertificateVerified:!0});if(y.signedAttrs){let N=!1,S=!1;for(const C of y.signedAttrs.attributes)if(C.type==="1.2.840.113549.1.9.3"&&(N=!0),C.type==="1.2.840.113549.1.9.4"&&(S=!0,p=C.values[0].valueBlock.valueHex),N&&S)break;if(N===!1)throw new ut({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:m,signerCertificateVerified:!0});if(S===!1)throw new ut({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:m,signerCertificateVerified:!0})}if(y.signedAttrs){const N=await c.digest(d,new Uint8Array(t));if(!Ql(N,p))throw new ut({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0});t=y.signedAttrs.encodedValue}const b=y.signatureAlgorithm.algorithmId==="1.2.840.113549.1.1.1"?await c.verifyWithPublicKey(t,y.signature,m.subjectPublicKeyInfo,y.signatureAlgorithm,d):await c.verifyWithPublicKey(t,y.signature,m.subjectPublicKeyInfo,y.signatureAlgorithm);return i?{date:a,code:14,message:v,signatureVerified:b,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0,certificatePath:w}:b}catch(p){throw p instanceof ut?p:new ut({date:a,code:15,message:"Error during verification: ".concat(p instanceof Error?p.message:p),signatureVerified:null,signerCertificate:m,timestampSerial:h,signerCertificateVerified:!0})}}async sign(e,t,r="SHA-1",a=Ue,n=Q(!0)){var u;if(!e)throw new Error("Need to provide a private key for signing");const i=this.signerInfos[t];if(!i)throw new RangeError("SignerInfo index is out of range");!(!((u=i.signedAttrs)===null||u===void 0)&&u.attributes.length)&&"hash"in e.algorithm&&"hash"in e.algorithm&&e.algorithm.hash&&(r=e.algorithm.hash.name);const l=n.getOIDByAlgorithm({name:r},!0,"hashAlgorithm");this.digestAlgorithms.filter(h=>h.algorithmId===l).length===0&&this.digestAlgorithms.push(new V({algorithmId:l,algorithmParams:new Fe})),i.digestAlgorithm=new V({algorithmId:l,algorithmParams:new Fe});const o=await n.getSignatureParameters(e,r),c=o.parameters;if(i.signatureAlgorithm=o.signatureAlgorithm,i.signedAttrs)if(i.signedAttrs.encodedValue.byteLength!==0)a=i.signedAttrs.encodedValue;else{a=i.signedAttrs.toSchema().toBER();const h=pe.toUint8Array(a);h[0]=49}else{const h=this.encapContentInfo.eContent;if(h)h.idBlock.tagClass===1&&h.idBlock.tagNumber===4?a=h.getValue():a=h.valueBlock.valueBeforeDecodeView;else if(a.byteLength===0)throw new Error("Missed detached data input array")}const m=await n.signWithPrivateKey(a,e,c);i.signature=new $({valueHex:m})}}st.CLASS_NAME="SignedData",st.ID_DATA=md;const dn="version",pn="authSafe",Ps="macData",Xo="parsedValue",qS=[dn,pn,Ps];class qr extends D{constructor(e={}){super(),this.version=f(e,dn,qr.defaultValues(dn)),this.authSafe=f(e,pn,qr.defaultValues(pn)),Ps in e&&(this.macData=f(e,Ps,qr.defaultValues(Ps))),Xo in e&&(this.parsedValue=f(e,Xo,qr.defaultValues(Xo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dn:return 3;case pn:return new fe;case Ps:return new yt;case Xo:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case dn:return t===qr.defaultValues(e);case pn:return fe.compareWithDefault("contentType",t.contentType)&&fe.compareWithDefault("content",t.content);case Ps:return yt.compareWithDefault("mac",t.mac)&&yt.compareWithDefault("macSalt",t.macSalt)&&yt.compareWithDefault("iterations",t.iterations);case Xo:return t instanceof Object&&Object.keys(t).length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.version||dn}),fe.schema(t.authSafe||{names:{blockName:pn}}),yt.schema(t.macData||{names:{blockName:Ps,optional:!0}})]})}fromSchema(e){T(e,qS);const t=R(e,e,qr.schema({names:{version:dn,authSafe:{names:{blockName:pn}},macData:{names:{blockName:Ps}}}}));O.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new fe({schema:t.result.authSafe}),Ps in t.result&&(this.macData=new yt({schema:t.result.macData}))}toSchema(){const e=[new B({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new A({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}async makeInternalValues(e={},t=Q(!0)){if(he.assert(e,"parameters","object"),!this.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(ne.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),ne.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),this.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new ne("iterations");ne.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),ne.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),ne.assertEmpty(e.password,"password");const r=new ArrayBuffer(64),a=new Uint8Array(r);t.getRandomValues(a);const n=this.parsedValue.authenticatedSafe.toSchema().toBER(!1);this.authSafe=new fe({contentType:fe.DATA,content:new $({valueHex:n})});const u=await t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:r,iterationCount:e.iterations,contentToStamp:n});this.macData=new yt({mac:new _t({digestAlgorithm:new V({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new $({valueHex:u})}),macSalt:new $({valueHex:r}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new ne("signingCertificate");ne.assertEmpty(e.privateKey,"privateKey"),ne.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const r=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),a=new st({version:1,encapContentInfo:new Vt({eContentType:"1.2.840.113549.1.7.1",eContent:new $({valueHex:r})}),certificates:[e.signingCertificate]}),n=await t.digest({name:e.hashAlgorithm},new Uint8Array(r)),u=[];u.push(new ge({type:"1.2.840.113549.1.9.3",values:[new J({value:"1.2.840.113549.1.7.1"})]})),u.push(new ge({type:"1.2.840.113549.1.9.5",values:[new Ym({valueDate:new Date})]})),u.push(new ge({type:"1.2.840.113549.1.9.4",values:[new $({valueHex:n})]})),a.signerInfos.push(new Be({version:1,sid:new Ke({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new Ae({type:0,attributes:u})})),await a.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),this.authSafe=new fe({contentType:"1.2.840.113549.1.7.2",content:a.toSchema(!0)})}break;default:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode))}}async parseInternalValues(e,t=Q(!0)){switch(he.assert(e,"parameters","object"),e.checkIntegrity===void 0&&(e.checkIntegrity=!0),this.parsedValue={},this.authSafe.contentType){case fe.DATA:{ne.assertEmpty(e.password,"password"),this.parsedValue.integrityMode=0,he.assert(this.authSafe.content,"authSafe.content",$);const r=this.authSafe.content.getValue();if(this.parsedValue.authenticatedSafe=Tn.fromBER(r),e.checkIntegrity){if(!this.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const a=t.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!await t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:a.name,salt:pe.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||1,contentToVerify:r,signatureToVerify:pe.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)}))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case fe.SIGNED_DATA:{this.parsedValue.integrityMode=1;const r=new st({schema:this.authSafe.content}),a=r.encapContentInfo.eContent;ne.assert(a,"eContent","cmsSigned.encapContentInfo"),he.assert(a,"eContent",$);const n=a.getValue();if(this.parsedValue.authenticatedSafe=Tn.fromBER(n),!await r.verify({signer:0,checkChain:!1},t))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType))}}}qr.CLASS_NAME="PFX";const oo="status",Hr="statusStrings",Mr="failInfo",WS=[oo,Hr,Mr];var Op;(function(s){s[s.granted=0]="granted",s[s.grantedWithMods=1]="grantedWithMods",s[s.rejection=2]="rejection",s[s.waiting=3]="waiting",s[s.revocationWarning=4]="revocationWarning",s[s.revocationNotification=5]="revocationNotification"})(Op||(Op={}));class zt extends D{constructor(e={}){super(),this.status=f(e,oo,zt.defaultValues(oo)),Hr in e&&(this.statusStrings=f(e,Hr,zt.defaultValues(Hr))),Mr in e&&(this.failInfo=f(e,Mr,zt.defaultValues(Mr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oo:return 2;case Hr:return[];case Mr:return new re;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oo:return t===zt.defaultValues(e);case Hr:return t.length===0;case Mr:return t.isEqual(zt.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||v,value:[new B({name:t.status||v}),new A({optional:!0,value:[new Z({name:t.statusStrings||v,value:new xh})]}),new re({name:t.failInfo||v,optional:!0})]})}fromSchema(e){T(e,WS);const t=R(e,e,zt.schema({names:{status:oo,statusStrings:Hr,failInfo:Mr}}));O.assertSchema(t,this.className);const r=t.result.status;if(r.valueBlock.isHexOnly===!0||r.valueBlock.valueDec<0||r.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=r.valueBlock.valueDec,Hr in t.result&&(this.statusStrings=t.result.statusStrings),Mr in t.result&&(this.failInfo=t.result.failInfo)}toSchema(){const e=[];return e.push(new B({value:this.status})),this.statusStrings&&e.push(new A({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new A({value:e})}toJSON(){const e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,t=>t.toJSON())),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}zt.CLASS_NAME="PKIStatusInfo";const Wl="version",Gl="messageImprint",uo="reqPolicy",lo="nonce",Os="certReq",co="extensions",$n="TimeStampReq",Rf="".concat($n,".").concat(Wl),Lf="".concat($n,".").concat(Gl),vh="".concat($n,".").concat(uo),bh="".concat($n,".").concat(lo),Sh="".concat($n,".").concat(Os),Ah="".concat($n,".").concat(co),GS=[Rf,Lf,vh,bh,Sh,Ah];class Bt extends D{constructor(e={}){super(),this.version=f(e,Wl,Bt.defaultValues(Wl)),this.messageImprint=f(e,Gl,Bt.defaultValues(Gl)),uo in e&&(this.reqPolicy=f(e,uo,Bt.defaultValues(uo))),lo in e&&(this.nonce=f(e,lo,Bt.defaultValues(lo))),Os in e&&(this.certReq=f(e,Os,Bt.defaultValues(Os))),co in e&&(this.extensions=f(e,co,Bt.defaultValues(co))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Wl:return 0;case Gl:return new nt;case uo:return v;case lo:return new B;case Os:return!1;case co:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Wl:case uo:case Os:return t===Bt.defaultValues(e);case Gl:return nt.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&nt.compareWithDefault("hashedMessage",t.hashedMessage);case lo:return t.isEqual(Bt.defaultValues(e));case co:return t.length===0;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||$n,value:[new B({name:t.version||Rf}),nt.schema(t.messageImprint||{names:{blockName:Lf}}),new J({name:t.reqPolicy||vh,optional:!0}),new B({name:t.nonce||bh,optional:!0}),new ua({name:t.certReq||Sh,optional:!0}),new I({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Z({name:t.extensions||Ah,value:Te.schema()})]})]})}fromSchema(e){T(e,GS);const t=R(e,e,Bt.schema());O.assertSchema(t,this.className),this.version=t.result[Rf].valueBlock.valueDec,this.messageImprint=new nt({schema:t.result[Lf]}),vh in t.result&&(this.reqPolicy=t.result[vh].valueBlock.toString()),bh in t.result&&(this.nonce=t.result[bh]),Sh in t.result&&(this.certReq=t.result[Sh].valueBlock.value),Ah in t.result&&(this.extensions=Array.from(t.result[Ah],r=>new Te({schema:r})))}toSchema(){const e=[];return e.push(new B({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new J({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),Os in this&&Bt.compareWithDefault(Os,this.certReq)===!1&&e.push(new ua({value:this.certReq})),this.extensions&&e.push(new I({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,t=>t.toSchema())})),new A({value:e})}toJSON(){const e={version:this.version,messageImprint:this.messageImprint.toJSON()};return this.reqPolicy!==void 0&&(e.reqPolicy=this.reqPolicy),this.nonce!==void 0&&(e.nonce=this.nonce.toJSON()),this.certReq!==void 0&&Bt.compareWithDefault(Os,this.certReq)===!1&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}}Bt.CLASS_NAME="TimeStampReq";const ho="status",mo="timeStampToken",Nd="TimeStampResp",jf="".concat(Nd,".").concat(ho),Nh="".concat(Nd,".").concat(mo),zS=[jf,Nh];class Zl extends D{constructor(e={}){super(),this.status=f(e,ho,Zl.defaultValues(ho)),mo in e&&(this.timeStampToken=f(e,mo,Zl.defaultValues(mo))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ho:return new zt;case mo:return new fe;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ho:return zt.compareWithDefault(ho,t.status)&&!("statusStrings"in t)&&!("failInfo"in t);case mo:return t.contentType===v&&t.content instanceof X;default:return super.defaultValues(e)}}static schema(e={}){const t=f(e,"names",{});return new A({name:t.blockName||Nd,value:[zt.schema(t.status||{names:{blockName:jf}}),fe.schema(t.timeStampToken||{names:{blockName:Nh,optional:!0}})]})}fromSchema(e){T(e,zS);const t=R(e,e,Zl.schema());O.assertSchema(t,this.className),this.status=new zt({schema:t.result[jf]}),Nh in t.result&&(this.timeStampToken=new fe({schema:t.result[Nh]}))}toSchema(){const e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new A({value:e})}toJSON(){const e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}async sign(e,t,r=Q(!0)){return this.assertContentType(),new st({schema:this.timeStampToken.content}).sign(e,0,t,void 0,r)}async verify(e={signer:0,trustedCerts:[],data:Ue},t=Q(!0)){return this.assertContentType(),new st({schema:this.timeStampToken.content}).verify(e,t)}assertContentType(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==Lg)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}Zl.CLASS_NAME="TimeStampResp";function _S(){if(typeof self<"u"){if("crypto"in self){let s="webcrypto";"webkitSubtle"in self.crypto&&(s="safari"),gp(s,new ic({name:s,crypto}))}}else if(typeof crypto<"u"&&"webcrypto"in crypto){const s="NodeJS ^15",e=crypto.webcrypto;gp(s,new ic({name:s,crypto:e}))}}_S();var XS=Object.defineProperty,ZS=Object.defineProperties,QS=Object.getOwnPropertyDescriptors,Dp=Object.getOwnPropertySymbols,YS=Object.prototype.hasOwnProperty,eA=Object.prototype.propertyIsEnumerable,Tp=(s,e,t)=>e in s?XS(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Uf=(s,e)=>{for(var t in e||(e={}))YS.call(e,t)&&Tp(s,t,e[t]);if(Dp)for(var t of Dp(e))eA.call(e,t)&&Tp(s,t,e[t]);return s},Rp=(s,e)=>ZS(s,QS(e));async function kd(s,e,t={}){return await self.crypto.subtle.decrypt(Uf({name:"AES-GCM"},t),e,s)}async function tA(s,e){return await self.crypto.subtle.decrypt({name:"RSA-OAEP"},e,s)}async function Wg(s){return await self.crypto.subtle.importKey("raw",s,{name:"AES-GCM",length:128},!0,["decrypt","encrypt"])}async function sA(s){return await self.crypto.subtle.importKey("spki",s,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,["verify"])}async function rA(s){return await self.crypto.subtle.importKey("pkcs8",s,{name:"RSA-OAEP",hash:"SHA-256"},!0,["decrypt"])}async function aA(s){return new Uint8Array(await self.crypto.subtle.exportKey("raw",s))}async function nA(s){const e=await self.crypto.subtle.digest("SHA-256",s);return Kb(new Uint8Array(e))}async function iA(s,e){return new Aw(s).verify({publicKey:e},oA())}function oA(){return Rp(Uf({},self.crypto),{subtle:Rp(Uf({},self.crypto.subtle),{async verify(s,e,t,r){return self.crypto.subtle.verify(s,e,new Uint8Array(t),new Uint8Array(r))}})})}async function uA(s,e,t){const r=fe.fromBER(e),a=new st({schema:r.content}),n=a.signerInfos[0].sid.issuer.typesAndValues.find(({type:l})=>l==="2.5.4.3").value.valueBlock.value,u=t.find(({userId:l})=>l===n);if(u===void 0)throw new Error("Signer not found in the users array");const i=oe.fromBER(id(u.certificate));return await a.verify({signer:0,trustedCerts:[i],data:s,checkChain:!0},cA())}class lA extends ic{verify(e,t,r,a){return super.verify(e,t,r,new Uint8Array(a))}}function cA(){return new lA({crypto:self.crypto})}async function hA(s,e){it.debug("Decrypting metadata info",{metadata:s});const[t,r]=s.metadata.ciphertext.split("|"),a=await kd(ws(t),e,{iv:ws(r)}),n=JSON.parse(await dA(a));return mA(n,s),fA(n,e),n}function mA(s,e){var t,r;if(((t=s.keyChecksums)==null?void 0:t.length)!==((r=e.users)==null?void 0:r.length))throw new Error("Key checksums length does not match users length")}async function fA(s,e){if(s.keyChecksums===void 0)return;const t=await aA(e),r=await nA(t);if(!s.keyChecksums.includes(r))throw new Error("Key checksum is not in keyChecksums")}async function dA(s){const e=new ReadableStream({start(t){t.enqueue(new Uint8Array(s)),t.close()}}).pipeThrough(new DecompressionStream("gzip"));return await new Response(e).text()}async function pA(s,e,t){var r;it.debug("Getting metadata private key",{metadata:s,userId:e});const a=(r=s.users)==null?void 0:r.find(i=>i.userId===e);if(!a)throw new Error("User not found in metadata");const n=ws(a.encryptedMetadataKey),u=await tA(n,t);return await Wg(new Uint8Array(u))}const Gm="apps/end_to_end_encryption/api/v2",Ed={PrivateKey:Gm+"/private-key",Metadata:Gm+"/meta-data/{fileId}",ServerKey:Gm+"/server-key"};async function gA(){const s=(await Mf.get(Ff(Ed.PrivateKey),{headers:{"X-E2EE-SUPPORTED":"true"}})).data.ocs.data["private-key"],[e,t,r]=s.split("|");return{encryptedPrivateKey:ws(e),iv:ws(t),salt:ws(r)}}async function Gg(s,e){const t=await Mf.get(Ff(Ed.Metadata,{fileId:s}),{headers:{"X-E2EE-SUPPORTED":"true"}}),r=JSON.parse(t.data.ocs.data["meta-data"]);return await wA(r,t.headers["x-nc-e2ee-signature"]),await yA(r,e),r}async function wA(s,e){var t;const r=JSON.stringify(s,(a,n)=>{if(a!=="filedrop")return n});if(!await uA(vg(btoa(r)),ws(e),(t=s.users)!=null?t:[]))throw new Error("Metadata signature verification failed")}async function yA(s,e){if(s.users===void 0)return;const t=s.users.map(async({userId:r,certificate:a})=>{if(!await iA(a,e))throw new Error("Certificate verification failed for user ".concat(r))});await Promise.all(t)}async function zg(){const s=await Mf.get(Ff(Ed.ServerKey),{headers:{"X-E2EE-SUPPORTED":"true"}});return await sA(id(s.data.ocs.data["public-key"]))}var vA=Object.defineProperty,Lp=Object.getOwnPropertySymbols,bA=Object.prototype.hasOwnProperty,SA=Object.prototype.propertyIsEnumerable,jp=(s,e,t)=>e in s?vA(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,AA=(s,e)=>{for(var t in e||(e={}))bA.call(e,t)&&jp(s,t,e[t]);if(Lp)for(var t of Lp(e))SA.call(e,t)&&jp(s,t,e[t]);return s};async function NA(s,e){it.debug("Decrypting private key",{privateKeyInfo:s,mnemonic:e});const t=await Promise.all([await zm(e,s.salt,{hash:"SHA-256",iterations:6e5}),await zm(e,s.salt,{hash:"SHA-1",iterations:1024}),await zm(e,s.salt,{hash:"SHA-1",iterations:6e5})]);for(const r of t)try{const a=await kd(s.encryptedPrivateKey,r,{iv:s.iv,tagLength:128}),n=atob($b(new Uint8Array(a)));return rA(id(n))}catch(a){}throw new Error("Failed to decrypt private key")}async function zm(s,e,t){const r=await crypto.subtle.importKey("raw",new TextEncoder().encode(s.replaceAll(" ","")),{name:"PBKDF2"},!1,["deriveKey"]);return await crypto.subtle.deriveKey(AA({name:"PBKDF2",salt:e},t),r,{name:"AES-GCM",length:256},!0,["decrypt","encrypt"])}const kA={name:"AlertCircleOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var EA=function(){var s=this,e=s._self._c;return e("span",s._b({staticClass:"material-design-icon alert-circle-outline-icon",attrs:{"aria-hidden":s.title?null:"true","aria-label":s.title,role:"img"},on:{click:function(t){return s.$emit("click",t)}}},"span",s.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:s.fillColor,width:s.size,height:s.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M11,15H13V17H11V15M11,7H13V13H11V7M12,2C6.47,2 2,6.5 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20Z"}},[s.title?e("title",[s._v(s._s(s.title))]):s._e()])])])},CA=[],xA=hc(kA,EA,CA,!1,null,null);const IA=xA.exports,VA={name:"CheckIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var BA=function(){var s=this,e=s._self._c;return e("span",s._b({staticClass:"material-design-icon check-icon",attrs:{"aria-hidden":s.title?null:"true","aria-label":s.title,role:"img"},on:{click:function(t){return s.$emit("click",t)}}},"span",s.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:s.fillColor,width:s.size,height:s.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}},[s.title?e("title",[s._v(s._s(s.title))]):s._e()])])])},PA=[],OA=hc(VA,BA,PA,!1,null,null);const DA=OA.exports,TA={name:"NcInputField",components:{NcButton:aw,AlertCircle:IA,Check:DA},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:{value:{type:[String,Number],default:void 0},modelValue:{type:[String,Number],default:void 0},type:{type:String,default:"text",validator:s=>["text","password","email","tel","url","search","number"].includes(s)},label:{type:String,default:void 0},labelOutside:{type:Boolean,default:!1},placeholder:{type:String,default:void 0},showTrailingButton:{type:Boolean,default:!1},trailingButtonLabel:{type:String,default:""},success:{type:Boolean,default:!1},error:{type:Boolean,default:!1},helperText:{type:String,default:""},disabled:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},inputClass:{type:[Object,String],default:""}},emits:["update:value","update:modelValue","update:model-value","trailing-button-click"],setup(){return{model:Kp("value","update:value",!0)}},computed:{computedId(){return this.$attrs.id&&this.$attrs.id!==""?this.$attrs.id:this.inputName},inputName(){return"input"+nw()},hasLeadingIcon(){return this.$slots.default},hasTrailingIcon(){return this.success},hasPlaceholder(){return this.placeholder!==""&&this.placeholder!==void 0},computedPlaceholder(){return this.hasPlaceholder?this.placeholder:this.label},isValidLabel(){const s=this.label||this.labelOutside;return s||console.warn("You need to add a label to the NcInputField component. Either use the prop label or use an external one, as per the example in the documentation."),s},ariaDescribedby(){const s=[];return this.helperText.length>0&&s.push("".concat(this.inputName,"-helper-text")),this.$attrs["aria-describedby"]&&s.push(this.$attrs["aria-describedby"]),s.join(" ")||null}},methods:{focus(){this.$refs.input.focus()},select(){this.$refs.input.select()},handleInput(s){const e=this.type==="number"&&typeof this.model=="number"?parseFloat(s.target.value,10):s.target.value;this.model=e},handleTrailingButtonClick(s){this.$emit("trailing-button-click",s)}}};var RA=function(){var t;var s=this,e=s._self._c;return e("div",{staticClass:"input-field",class:{"input-field--disabled":s.disabled,"input-field--label-outside":s.labelOutside||!s.isValidLabel,"input-field--leading-icon":s.hasLeadingIcon,"input-field--trailing-icon":s.showTrailingButton||s.hasTrailingIcon,"input-field--pill":s.pill}},[e("div",{staticClass:"input-field__main-wrapper"},[e("input",s._g(s._b({ref:"input",staticClass:"input-field__input",class:[s.inputClass,{"input-field__input--success":s.success,"input-field__input--error":s.error}],attrs:{id:s.computedId,type:s.type,disabled:s.disabled,placeholder:s.computedPlaceholder,"aria-describedby":s.ariaDescribedby,"aria-live":"polite"},domProps:{value:(t=s.model)==null?void 0:t.toString()},on:{input:s.handleInput}},"input",s.$attrs,!1),s.$listeners)),!s.labelOutside&&s.isValidLabel?e("label",{staticClass:"input-field__label",attrs:{for:s.computedId}},[s._v(" "+s._s(s.label)+" ")]):s._e(),e("div",{directives:[{name:"show",rawName:"v-show",value:s.hasLeadingIcon,expression:"hasLeadingIcon"}],staticClass:"input-field__icon input-field__icon--leading"},[s._t("default")],2),s.showTrailingButton?e("NcButton",{staticClass:"input-field__trailing-button",attrs:{type:"tertiary-no-background","aria-label":s.trailingButtonLabel,disabled:s.disabled},on:{click:s.handleTrailingButtonClick},scopedSlots:s._u([{key:"icon",fn:function(){return[s._t("trailing-button-icon")]},proxy:!0}],null,!0)}):s.success||s.error?e("div",{staticClass:"input-field__icon input-field__icon--trailing"},[s.success?e("Check",{staticStyle:{color:"var(--color-success-text)"},attrs:{size:20}}):s.error?e("AlertCircle",{staticStyle:{color:"var(--color-error-text)"},attrs:{size:20}}):s._e()],1):s._e()],1),s.helperText.length>0?e("p",{staticClass:"input-field__helper-text-message",class:{"input-field__helper-text-message--error":s.error,"input-field__helper-text-message--success":s.success},attrs:{id:"".concat(s.inputName,"-helper-text")}},[s.success?e("Check",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):s.error?e("AlertCircle",{staticClass:"input-field__helper-text-message__icon",attrs:{size:18}}):s._e(),s._v(" "+s._s(s.helperText)+" ")],1):s._e()])},LA=[],jA=hc(TA,RA,LA,!1,null,"e4fac465");const $f=jA.exports,UA={name:"UndoVariantIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var $A=function(){var s=this,e=s._self._c;return e("span",s._b({staticClass:"material-design-icon undo-variant-icon",attrs:{"aria-hidden":s.title?null:"true","aria-label":s.title,role:"img"},on:{click:function(t){return s.$emit("click",t)}}},"span",s.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:s.fillColor,width:s.size,height:s.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M13.5,7A6.5,6.5 0 0,1 20,13.5A6.5,6.5 0 0,1 13.5,20H10V18H13.5C16,18 18,16 18,13.5C18,11 16,9 13.5,9H7.83L10.91,12.09L9.5,13.5L4,8L9.5,2.5L10.92,3.91L7.83,7H13.5M6,18H8V20H6V18Z"}},[s.title?e("title",[s._v(s._s(s.title))]):s._e()])])])},KA=[],HA=hc(UA,$A,KA,!1,null,null);const MA=HA.exports;iw(lw,uw);const FA=new Set(Object.keys($f.props)),JA={name:"NcTextField",components:{NcInputField:$f,Close:ow,ArrowRight:Nw,Undo:MA},inheritAttrs:!1,model:{prop:"modelValue",event:"update:modelValue"},props:Et(Qe({" ":{}},$f.props),{trailingButtonLabel:{type:String,default:""},trailingButtonIcon:{type:String,default:"close",validator:s=>["close","arrowRight","undo"].includes(s)}}),emits:["update:value","update:modelValue","update:model-value"],setup(){return{model:Kp("value","update:value")}},computed:{propsAndAttrsToForward(){const s={undo:am("Undo changes"),close:am("Clear text"),arrowRight:am("Save changes")};return Et(Qe(Qe({},this.$attrs),Object.fromEntries(Object.entries(this.$props).filter(([e])=>FA.has(e)))),{trailingButtonLabel:this.trailingButtonLabel||s[this.trailingButtonIcon]})}},methods:{focus(){this.$refs.inputField.focus()},select(){this.$refs.inputField.select()}}};var qA=function(){var s=this,e=s._self._c;return e("NcInputField",s._g(s._b({ref:"inputField",scopedSlots:s._u([s.type!=="search"?{key:"trailing-button-icon",fn:function(){return[s.trailingButtonIcon==="close"?e("Close",{attrs:{size:20}}):s.trailingButtonIcon==="arrowRight"?e("ArrowRight",{attrs:{size:20}}):s.trailingButtonIcon==="undo"?e("Undo",{attrs:{size:20}}):s._e()]},proxy:!0}:null],null,!0)},"NcInputField",s.propsAndAttrsToForward,!1),s.$listeners),[s._t("default")],2)},WA=[],GA=hc(JA,qA,WA,!1,null,null);const zA=GA.exports,_A=cw({__name:"MnemonicPromptDialog",emits:["close"],setup(s,{emit:e}){const t=nm(),r=nm(""),a=nm(!1),n=Id(()=>a.value===!0&&r.value.trim().split(/\s+/g).length===12);function u(){e("close",r.value)}const i=Id(()=>[{label:Zm("end_to_en_encryption","Submit"),nativeType:"submit",type:"primary",disabled:!n.value,callback:u}]);return{__sfc:!0,emit:e,dialogRef:t,mnemonic:r,confirmToggle:a,isFormValid:n,submit:u,buttons:i,t:Zm,NcDialog:hw,NcTextField:zA,NcNoteCard:mw,NcCheckboxRadioSwitch:kw}}});var XA=function(){var s=this,e=s._self._c,t=s._self._setupProxy;return e(t.NcDialog,{ref:"dialogRef",attrs:{name:t.t("end_to_end_encryption","Enter your 12 words mnemonic"),buttons:t.buttons,"is-form":!0},on:{submit:t.submit}},[e(t.NcNoteCard,{attrs:{type:"warning","show-alert":!0,heading:t.t("end_to_end_encryption","Decrypting your files in the browser can weaken security")}},[s._v(" "+s._s(t.t("end_to_end_encryption","The server could serve malicious source code to extract the secret that protects your files."))+" "),e(t.NcCheckboxRadioSwitch,{attrs:{required:!0,"data-cy-e2ee-mnemonic-prompt":"i_understand_the_risks",type:"switch"},model:{value:t.confirmToggle,callback:function(r){t.confirmToggle=r},expression:"confirmToggle"}},[s._v(" "+s._s(t.t("end_to_end_encryption","I understand the risks"))+" ")])],1),e(t.NcTextField,{attrs:{value:t.mnemonic,required:"true",pattern:"^(\\w+\\s+){11}\\w+$",label:t.t("end_to_end_encryption","Mnemonic"),autofocus:!0},on:{"update:value":function(r){t.mnemonic=r}}})],1)},ZA=[],QA=fw(_A,XA,ZA,!1,null,null);const YA=QA.exports;async function eN(){const s=Promise.withResolvers();return dw(YA,void 0,e=>{e!==void 0?s.resolve(e):s.reject()}),s.promise}let lc;const tN=ov();let _m,ko;const ds={};function sN(){lc=window.fetch,it.debug("Setting up WebDAV decryption proxy"),window.fetch=async(s,e={})=>{let t=new Request(s,e);if(!(t.url.includes("/remote.php/dav/files/")&&(t.method==="GET"||t.method==="PROPFIND")))return lc(t);it.debug("Proxying ".concat(t.method," ").concat(t.url),{request:t});const r=new Headers(t.headers);switch(r.set("X-E2EE-SUPPORTED","true"),t=new Request(t,{headers:r}),t.method){case"PROPFIND":return aN(t);case"GET":default:return rN(t)}}}async function rN(s){const e=new URL(s.url).pathname,t=await Kf(e);if(t===void 0)return it.debug("File is not part of e2ee folder",{path:e}),lc(s);const r=await kh(Ft.dirname(e),t),a=r.files[Ft.basename(s.url)];if(a===void 0)throw it.debug("Could not find metadata info",{path:e,metadataInfo:r}),new Error("Could not find file in metadata");return it.debug("Fetching encrypted file",{request:s}),await nN(await lc(s),a)}async function aN(s){var e,t;it.debug("Fetching raw PROPFIND",{request:s});const r=await lc(s),a=new URL(s.url).pathname,n=await r.text(),u=await Xy(n),i=_y(u,a,!0);let l=a;if(i.type==="directory"){if(((e=i.props)==null?void 0:e["is-encrypted"])!==1)return it.debug("Folder is not e2ee",{xml:u}),new Response(n,r);ko===void 0&&(ko=await zg()),ds[a]=await Gg((t=i.props)==null?void 0:t.fileid,ko);const o=await Kf(l);if(o===void 0)return it.debug("Cannot find root E2EE folder",{path:a}),new Response(n,r);const c=await kh(l,o);let m;try{m=await kh(Ft.dirname(l),o)}catch(h){}Up(u,a,c,m)}if(i.type==="file"){l=Ft.dirname(a);const o=await Kf(l);if(o===void 0)return it.debug("Cannot find root E2EE folder",{path:a}),new Response(n,r);Up(u,a,void 0,await kh(l,o))}return new Response(new jb.XMLBuilder().build(u),r)}function Up(s,e,t,r){it.debug("Updating PROPFIND info",{folderPath:e,metadataInfo:t,parentMetadataInfo:r,xml:s}),s.multistatus.response.forEach(a=>{if(a.propstat===void 0)return;let n=t;if(a.href===e&&r&&(n=r),n===void 0)return;const u=a.propstat.prop.displayname;let i=u;n.files[u]?(i=n.files[u].filename,a.propstat.prop.getcontenttype=n.files[u].mimetype):n.folders[u]&&(i=n.folders[u],a.propstat.prop.getcontenttype="httpd/unix-directory"),a.propstat.prop.displayname=i,a.propstat.prop.permissions=a.propstat.prop.permissions.replace(/(R)|(D)|(N)|(V)|(W)|(CK)/g,"")})}async function nN(s,e){const t=await kd(new Uint8Array(await s.arrayBuffer()),await Wg(ws(e.key)),{iv:ws(e.nonce)});return new Response(t,s)}async function kh(s,e){it.debug("Getting metadata info",{path:s});const t=Gh();if(!t)throw new Error("No user logged in");return _m===void 0&&(_m=await NA(await gA(),await eN())),await hA(await _g(s),await pA(e,t.uid,_m))}async function iN(s){it.debug("Getting file id",{path:s});const e=await tN.stat(decodeURI(s).replace("remote.php/dav/",""),{details:!0,data:rv()}),t=uv(e.data);if(!t.fileid)throw new Error("File ID not found");return String(t.fileid)}async function _g(s){return it.debug("Getting metadata",{path:s,metadataCache:ds}),ds[s]||(ko===void 0&&(ko=await zg()),ds[s]=await Gg(await iN(s),ko)),ds[s]}async function Kf(s){it.debug("Getting root metadata",{path:s,metadataCache:ds});const e=Object.entries(ds).filter(([,t])=>t.users!==void 0).find(([t])=>s.startsWith(t));if(e)return e[1];for(;s!=="/";){if(ds[s]=await _g(s),ds[s].users!==void 0)return ds[s];s=Ft.dirname(s)}}const oN='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-arrow-down" viewBox="0 0 24 24"><path d="M11,4H13V16L18.5,10.5L19.92,11.92L12,19.84L4.08,11.92L5.5,10.5L11,16V4Z" /></svg>';function uN(s){if(!(s.permissions&Jt.READ))return!1;if(s.attributes["share-attributes"]){const e=JSON.parse(s.attributes["share-attributes"]||"[]").find(({scope:t,key:r})=>t==="permissions"&&r==="download");if(e!==void 0)return e.value===!0}return!0}async function lN([s]){const e=await(await fetch(s.encodedSource)).arrayBuffer(),t=new Blob([e],{type:s.mime}),r=document.createElement("a");r.href=window.URL.createObjectURL(t),r.download=s.displayname,r.click()}const cN=new lv({id:"download_unencrypted",default:rd.DEFAULT,displayName:()=>Zm("files","Download unencrypted"),iconSvgInline:()=>oN,enabled(s){return s.length!==1||s.some(e=>!e.isDavRessource)||s.some(e=>e.type!==Xh.File)?!1:s.every(uN)},async exec(s){return lN([s]),null},order:30}),hN=Hf("end_to_end_encryption","userConfig",{e2eeInBrowserEnabled:!1});hN.e2eeInBrowserEnabled&&(sN(),cv(cN));
